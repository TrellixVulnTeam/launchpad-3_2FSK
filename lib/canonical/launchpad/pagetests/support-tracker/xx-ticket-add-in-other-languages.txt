== Adding tickets in languages other than English ==

Although it's possible to add tickets in any of the user's preferred
languages, we need to do some checks to warn the user in case he's using
a language that is not spoken/understood by any of the context's support
contacts.

    >>> browser.addHeader('Authorization', 'Basic salgado@ubuntu.com:zeca')
    >>> browser.open('http://launchpad.dev/distros/ubuntu/+addticket')

    >>> browser.getControl('Language').value = ['pt_BR']
    >>> browser.getControl('Summary').value = (
    ...     'Abrir uma pagina que requer java quebra o firefox')
    >>> browser.getControl('Continue').click()

At this point we'll present any similar tickets (in any language) /and/
a warning message explaining that the chosen language is not understood
by any member of the support community.

    >>> from BeautifulSoup import BeautifulSoup
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.first('table', {'id': 'similar-tickets'})
    <table id="similar-tickets">
    ...<a...href=".../distros/ubuntu/+ticket/8"...>Installation of Java
    Runtime Environment for Mozilla</a>...
    ...<a...href=".../distros/ubuntu/+ticket/9"...>mailto: problem in
    webpage</a>...
    </table>

    >>> for tag in find_tags_by_class(browser.contents, 'warning message'):
    ...     print tag.renderContents()
    <strong>Portuguese (Brazil) (pt_BR)</strong> doesn't seem to be
    a language spoken by any support contacts in this community. If you
    go ahead and make a support request in that language, no support
    contacts will be able to read it. Currently, the languages spoken
    by at least one support contact are: English.

Since we've already shown the warning, we won't try to block the user
from making a request in the language of his choice.

    >>> browser.getControl('Description').value = (
    ...     u'Eu uso Ubuntu em um AMD64 e instalei o plugin java blackdown. '
    ...     u'O plugin \xe9 exibido em about:plugins e quando eu abro a '
    ...     u'pagina http://java.com/en/download/help/testvm.xml, ela '
    ...     u'carrega corretamente e mostra a minha versao do java. No '
    ...     u'entanto, mover o mouse na pagina faz com que o firefox quebre.'
    ...     ).encode('utf-8')
    >>> browser.getControl('Add').click()
    >>> browser.url
    '.../distros/ubuntu/+ticket/...'
    >>> browser.title
    'Ubuntu support request #...Abrir uma pagina que requer...'


It's also possible that the user choses English in the first page but
then changes his mind on the second page.

    >>> browser.open('http://launchpad.dev/distros/ubuntu/+addticket')

    >>> browser.getControl('Language').value = ['en']
    >>> browser.getControl('Summary').value = 'some random words'
    >>> browser.getControl('Continue').click()

In this case he won't be warned, because we assume all members of the
support community can understand English.

    >>> len(find_tags_by_class(browser.contents, 'warning message'))
    0

If now he changes his mind and decides to enter the request details in
Portuguese, we'll have to warn him.

    >>> browser.getControl('Language').value = ['pt_BR']
    >>> browser.getControl('Summary').value = 'algumas palavras aleatorias'
    >>> browser.getControl('Description').value = (
    ...     'Este eh apenas um pedido de suporte aleatorio.')
    >>> browser.getControl('Add').click()

    >>> browser.url
    'http://launchpad.dev/distros/ubuntu/+addticket'

    >>> for tag in find_tags_by_class(browser.contents, 'warning message'):
    ...     print tag.renderContents()
    <strong>Portuguese (Brazil) (pt_BR)</strong> doesn't seem to be
    a language spoken by any support contacts in this community. If you
    go ahead and make a support request in that language, no support
    contacts will be able to read it. Currently, the languages spoken
    by at least one support contact are: English.

If even after the warning he decides to go ahead, we have to accept the
new support request.

    >>> browser.getControl('Add').click()
    >>> browser.url
    '.../distros/ubuntu/+ticket/...'
    >>> browser.title
    'Ubuntu support request #...algumas palavras aleatorias...'

