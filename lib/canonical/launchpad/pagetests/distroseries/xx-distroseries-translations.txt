= Distribution series translations =

This page shows a list of PO templates contained within all source
packages in a particular distibution series.

We are going to work with visible (Spanish) and non visible
(Spanish (Spain)) languages.

Here we can see that Spanish (Spain) is not visible.

    >>> admin_browser.open(
    ...     'http://translations.launchpad.dev/+languages/es_ES/+admin')
    >>> print admin_browser.getControl('The English name').value
    Spanish (Spain)
    >>> admin_browser.getControl('Visible').selected
    False

But Spanish is visible.

    >>> admin_browser.open(
    ...     'http://translations.launchpad.dev/+languages/es/+admin')
    >>> print admin_browser.getControl('The English name').value
    Spanish
    >>> admin_browser.getControl('Visible').selected
    True

In this case, we're asking for the translation overview for Hoary.

    >>> anon_browser.open('http://translations.launchpad.dev/ubuntu/hoary')

The system is not showing non visible languages:

    >>> anon_browser.getLink('Spanish (Spain)')
    Traceback (most recent call last):
    ...
    LinkNotFoundError

The system will not show English because it is not translatable:

    >>> anon_browser.getLink('English')
    Traceback (most recent call last):
    ...
    LinkNotFoundError

But it shows the ones not hidden:

    >>> print anon_browser.getLink('Spanish').url
    http://translations.launchpad.dev/ubuntu/hoary/+lang/es

Launchpad has an option to hide all of the translations for a distribution
series.  The link to hide translations is not available to anonymous users:

    >>> anon_browser.getLink('Administer translation options')
    Traceback (most recent call last):
    ...
    LinkNotFoundError

And the page is not available either:

    >>> anon_browser.open(
    ...     'http://translations.launchpad.dev/ubuntu/hoary/+admin')
    Traceback (most recent call last):
    ...
    Unauthorized:...

... but the link is available to administrators:

    >>> admin_browser.open('http://translations.launchpad.dev/ubuntu/hoary')

    >>> admin_browser.getLink('Administer translation options').click()

Once the administrator hides all translations...

    >>> admin_browser.getControl(
    ...     'Hide translations for this release').selected = True
    >>> admin_browser.getControl('Change').click()
    >>> print admin_browser.url
    http://translations.launchpad.dev/ubuntu/hoary

... the translation status page will not display any languages.

    >>> admin_browser.getLink('Spanish')
    Traceback (most recent call last):
    ...
    LinkNotFoundError

    >>> main_content = find_main_content(admin_browser.contents)
    >>> 'hoary/+lang/' in main_content
    False

And the page tells the user that the translations are not available.

    >>> user_browser.open('http://translations.launchpad.dev/ubuntu/hoary')
    >>> main_content = find_main_content(user_browser.contents)
    >>> print main_content.findNext('p').renderContents()
    Translation status for Hoary is not available because we are updating
    translations in bulk. You will be able to see the status once the update
    process is finished. Try again in several hours.

Also, if the user tries to navigate directly to launchpad pages,
the system tells him that he's not allowed to see those pages.

    >>> user_browser.handleErrors = True
    >>> user_browser.open(
    ...     'http://translations.launchpad.dev/ubuntu/hoary/+lang/es')
    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 503: Service Unavailable
    >>> main_content = find_main_content(user_browser.contents)
    >>> print main_content.findNext('p').renderContents()
    Translation status for Hoary is not available because we are updating
    translations in bulk. You will be able to see the status once the update
    process is finished. Try again in several hours.
    >>> user_browser.handleErrors = False

Although, an administrator can see the same page.

    >>> admin_browser.open(
    ...     'http://translations.launchpad.dev/ubuntu/hoary/+lang/es')

Non existing languages are not viewable. English is a special case
in that we store the translatable messages as English, so it cannot
should not viewed

    >>> user_browser.open(
    ...     'http://translations.launchpad.dev/ubuntu/hoary/+lang/notexists')
    Traceback (most recent call last):
    ...
    NotFound: ...

    >>> user_browser.open(
    ...     'http://translations.launchpad.dev/ubuntu/hoary/+lang/en')
    Traceback (most recent call last):
    ...
    NotFound: ...

Translation pages for source packages are also unavailable to
non-administrative users.

    >>> user_browser.open(
    ...     'http://translations.launchpad.dev/ubuntu/hoary/+sources/evolution/'
    ...     '+pots/evolution-2.2')
    Traceback (most recent call last):
    ...
    TranslationUnavailable: ...

However, source package translations are still available to the
administrators.

    >>> admin_browser.open(
    ...     'http://translations.launchpad.dev/ubuntu/hoary/'
    ...     '+sources/evolution')

There is also an option to set/unset whether translation imports for a
distribution should be deferred. That option is set also from the same
form where we hide all translations and an admin is able to change it:

    >>> admin_browser.open('http://translations.launchpad.dev/ubuntu/hoary')
    >>> admin_browser.getLink('Administer translation options').click()
    >>> admin_browser.getControl(
    ...     'Defer translation imports').selected
    False
    >>> admin_browser.getControl(
    ...     'Defer translation imports').selected = True
    >>> admin_browser.getControl('Change').click()
    >>> print admin_browser.url
    http://translations.launchpad.dev/ubuntu/hoary

Once the system accepts the submission, we can see such change applied.

    >>> admin_browser.getLink('Administer translation options').click()
    >>> admin_browser.getControl(
    ...     'Defer translation imports').selected
    True

There are no visible user interface changes once this flag is changed. It
just prevents that the translation import script, which is executed by cron,
handle translation imports for this distro series.
