<?xml version="1.0"?>
<application xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://research.sun.com/wadl/2006/10/wadl.xsd"
  xmlns="http://research.sun.com/wadl/2006/10"
  xmlns:wadl="http://research.sun.com/wadl/2006/10"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
>

  <!--There is one "service root" resource, located (as you'd expect)
      at the service root. This very document is the WADL
      representation of the "service root" resource.-->
  <resources tal:attributes="base context/wadl:url">
    <resource path="" type="#service-root" />
  </resources>

  <!--A "service root" resource responds to GET.-->
  <resource_type id="service-root">
    <doc>The root of the web service.</doc>
    <method name="GET" id="service-root-get">
      <response>
        <representation href="#service-root-json" />
        <representation mediaType="application/vd.sun.wadl+xml"
                        id="service-root-wadl" />
        </response>
      </method>
  </resource_type>

  <!--The JSON representation of a "service root" resource contains a
      number of links to collection-type resources.-->
  <representation mediaType="application/json" id="service-root-json">
    <tal:root_params tal:repeat="param context/wadl:top_level_resources">
      <param style="plain" tal:attributes="name param/name;
                                           path param/path">
        <link tal:attributes="resource_type param/resource/wadl:type_link" />
      </param>
    </tal:root_params>
  </representation>

  <!--In addition to the service root, this document describes all the
      types of resources you might encounter as you browse this web
      service.-->

  <!--Begin resource_type definitions for collection resources.-->
  <tal:collection_classes tal:repeat="context collections">
    <resource_type tal:attributes="id context/wadl_collection:collection_type"
      tal:define="entry_schema nocall:context/wadl_collection:entry_schema">
      <wadl:doc tal:content="context/wadl_collection:doc"
           tal:condition="context/wadl_collection:doc"
           xmlns="http://www.w3.org/1999/xhtml/">
        Human-readable description of the resource type, in XHTML format.
      </wadl:doc>
      <method name="GET"
        tal:attributes="id string:${context/wadl_collection:collection_type}-get">
        <response>
          <representation
             tal:attributes="
               href entry_schema/wadl_entry:entry_page_representation_link"
             />
          <representation mediaType="application/vd.sun.wadl+xml"
            tal:attributes="id string:${context/wadl_collection:collection_type}-wadl" />
        </response>
      </method>

      <method tal:repeat="operation context/wadl_collection:named_operations"
        tal:attributes="id
                        string:${context/wadl_collection:collection_type}-${operation/name};
                        name operation/op/wadl_operation:http_method">
        <wadl:doc tal:replace="operation/op/wadl_operation:doc"
             tal:condition="operation/op/wadl_operation:doc"
             xmlns="http://www.w3.org/1999/xhtml/">
          Human-readable documentation for the method.
        </wadl:doc>
        <request>
          <param style="query" name="ws.op" required="true"
                 tal:attributes="fixed operation/name">
            <doc>The name of the operation being invoked.</doc>
          </param>
          <param style="query" tal:repeat="field operation/op/params"
                 tal:attributes="name field/__name__;
                                 required field/wadl:required">
            <wadl:doc tal:content="field/wadl:doc"
                 tal:condition="field/wadl:doc"
                 xmlns="http://www.w3.org/1999/xhtml/">
              Field title: field description
            </wadl:doc>
            <link tal:condition="field/wadl:represented_as_link"
                  tal:attributes="resource_type field/wadl:type_link" />
            <option tal:repeat="option field/wadl:options"
                    tal:attributes="value option/title" />
          </param>
        </request>
        <response
           tal:condition="operation/op/wadl_operation:has_return_type">
          <param tal:condition="operation/op/wadl_operation:returns_link"
                 name="Location" style="header">
            <link
               tal:attributes="resource_type
                   operation/op/wadl_operation:return_type_resource_type_link"
               />
          </param>
          <representation
             tal:condition="not:operation/op/wadl_operation:returns_link"
             tal:attributes="href
                 operation/op/wadl_operation:return_type_representation_link"
             />
        </response>
      </method>
    </resource_type>

  </tal:collection_classes>
  <!--End resource_type definitions for collection resources.-->

  <!--Begin representation and resource_type definitions for entry
      resources and the collections that contain them. -->
  <tal:entry_classes tal:repeat="context entries">
    <resource_type tal:attributes="id context/wadl_entry:singular_type">
      <wadl:doc tal:content="context/wadl_entry:doc"
           tal:condition="context/wadl_entry:doc"
           xmlns="http://www.w3.org/1999/xhtml/">
        Human-readable description of the resource type, in XHTML format.
      </wadl:doc>
      <method name="GET"
              tal:attributes="id string:${context/wadl_entry:singular_type}-get">
        <response>
          <representation
             tal:attributes="href context/wadl_entry:full_representation_link" />
          <representation mediaType="application/vd.sun.wadl+xml"
            tal:attributes="id string:${context/wadl_entry:singular_type}-wadl" />
        </response>
      </method>

      <method name="PUT"
              tal:attributes="id string:${context/wadl_entry:singular_type}-put">
        <request>
          <representation
             tal:attributes="href context/wadl_entry:full_representation_link" />
        </request>
      </method>

      <method name="PATCH"
              tal:attributes="id string:${context/wadl_entry:singular_type}-patch">
        <request>
          <representation
             tal:attributes="href context/wadl_entry:patch_representation_link" />
        </request>
      </method>

      <method tal:repeat="operation context/wadl_entry:named_operations"
              tal:attributes="
                id string:${context/wadl_entry:singular_type}-${operation/name};
                name operation/op/wadl_operation:http_method">
        <wadl:doc tal:content="operation/op/wadl_operation:doc"
             tal:condition="operation/op/wadl_operation:doc"
             xmlns="http://www.w3.org/1999/xhtml/">
        </wadl:doc>
        <request>
          <param style="query" name="ws.op" required="true"
                 tal:attributes="fixed operation/name" />
          <param style="query" tal:repeat="field operation/op/params"
                 tal:attributes="name field/__name__;
                                 required field/wadl:required">
            <wadl:doc tal:content="field/wadl:doc"
                 tal:condition="field/wadl:doc"
                 xmlns="http://www.w3.org/1999/xhtml/">
              Field title: field description
            </wadl:doc>
            <link tal:condition="field/wadl:represented_as_link"
                  tal:attributes="resource_type field/wadl:type_link" />
            <option tal:repeat="option field/wadl:options"
                    tal:attributes="value option/title" />
          </param>
        </request>
        <response
           tal:condition="operation/op/wadl_operation:has_return_type">
          <param tal:condition="operation/op/wadl_operation:returns_link"
                 name="Location" style="header">
            <link
               tal:attributes="resource_type
                   operation/op/wadl_operation:return_type_resource_type_link"
               />
          </param>
          <representation
             tal:condition="not:operation/op/wadl_operation:returns_link"
             tal:attributes="href
                 operation/op/wadl_operation:return_type_representation_link"
             />
        </response>
      </method>
    </resource_type>


    <representation mediaType="application/json"
       tal:attributes="id string:${context/wadl_entry:singular_type}-full">
      <param style="plain"
             tal:repeat="field context/wadl_entry:all_fields" required="true"
             tal:attributes="name field/wadl:name;
                             path field/wadl:path">
        <wadl:doc tal:content="field/wadl:doc"
             tal:condition="field/wadl:doc"
             xmlns="http://www.w3.org/1999/xhtml/">
          Field title: field description
        </wadl:doc>
        <link tal:condition="field/wadl:represented_as_link"
              tal:attributes="resource_type field/wadl:type_link" />
        <option tal:repeat="option field/wadl:options"
                tal:attributes="value option/title" />
      </param>
    </representation>

    <representation mediaType="application/json"
       tal:attributes="id string:${context/wadl_entry:singular_type}-diff">
      <param tal:repeat="field context/wadl_entry:all_writable_fields"
             style="plain" required="false"
             tal:attributes="name field/wadl:name;
                             path field/wadl:path">
        <wadl:doc tal:content="field/wadl:doc"
             tal:condition="field/wadl:doc"
             xmlns="http://www.w3.org/1999/xhtml/">
          Field title: field description
        </wadl:doc>
        <link tal:condition="field/wadl:represented_as_link"
              tal:attributes="resource_type field/wadl:type_link" />
        <option tal:repeat="option field/wadl:options"
                tal:attributes="value option/title" />
      </param>
    </representation>

    <!--Collection page for this type of entry-->
    <resource_type
      tal:attributes="id context/wadl_entry:entry_page_type">
      <method name="GET"
        tal:attributes="id
          string:${context/wadl_entry:entry_page_type}-get">
        <response>
          <representation
             tal:attributes="href
             string:#${context/wadl_entry:entry_page_representation_id}"
             />
        </response>
      </method>
    </resource_type>

    <representation mediaType="application/json"
       tal:attributes="id
         string:${context/wadl_entry:entry_page_representation_id}">
      <param style="plain" name="total_size" path="$['total_size']"
             required="true" />

      <param style="plain" name="start" path="$['start']" required="true" />

      <param style="plain" name="next_collection_link"
             path="$['next_collection_link']">
        <link tal:attributes="resource_type
          string:#${context/wadl_entry:entry_page_type}" />
      </param>

      <param style="plain" name="prev_collection_link"
             path="$['prev_collection_link']">
        <link tal:attributes="resource_type
          string:#${context/wadl_entry:entry_page_type}" />
      </param>

      <param style="plain" name="entries" path="$['entries']"
             required="true" />

      <param style="plain" name="entry_links"
             path="$['entries'][*]['self_link']">
        <link tal:attributes="resource_type context/wadl_entry:type_link" />
      </param>
  </representation>

  </tal:entry_classes>
  <!--End representation and resource_type definitions for entry
      resources. -->

  <!--Finally, describe the 'hosted binary file' type.-->
  <resource_type id="HostedFile">
    <method name="GET" id="HostedFile-get">
      <response>
        <representation status="303">
          <param style="header" name="Location" />
        </representation>
      </response>
    </method>
    <method name="PUT" id="HostedFile-put" />
    <method name="DELETE" id="HostedFile-put" />
  </resource_type>
</application>
