<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  omit-tag="">

<tal:block condition="not: context/rcstype">
<tal:block condition="not: view/user_branch_visible">
  <div id="branch-details">

    <tal:edit-link condition="context/required:launchpad.Edit">
      <tal:comment condition="nothing">
        We want to show different things depending on whether or not
        the logged in user is able to alter the information for the
        product series.
      </tal:comment>

      <p id="no-rcs-details">
        You haven't yet told Launchpad where your source code is for
        <em><tal:series replace="context/title">evolution MAIN</tal:series></em>.
      </p>

      <p>
        If the code is already in a Bazaar branch registered with Launchpad
        <a href="+linkbranch">link the branch to this series</a>.
      </p>

      <p>
        If the code is in a Bazaar branch not yet on Launchpad
        you can either: have the branch mirrored from a remote location by
        <a tal:attributes="href string:/${context/product/name}/+addbranch">
          registering a mirrored branch</a>; or push the branch
          directly to Launchpad.
      </p>

      <tal:no-keys condition="not:view/user/sshkeys">
        <p id="ssh-key-directions">
          To authenticate with the Launchpad branch upload service, you need
          to <a tal:attributes="href string:${view/user/fmt:url}/+editsshkeys">
          register a SSH key </a>.
        </p>
      </tal:no-keys>
      <tal:user-can-push condition="view/user/sshkeys">
        <p>
          You can push a branch to Launchpad for this project with the name
          <em>trunk</em> using a command line like:<br/>
          <tt><strong>bzr push lp:~<tal:user replace="view/user/name"/>/<tal:project replace="context/product/name"/>/trunk</strong></tt>
        </p>
      </tal:user-can-push>

      <p>
        If the code is in CVS or Subversion you can
        import the branch to Bazaar.
        The first step of this is to specify the
        <a href="+source">upstream location</a>.
      </p>

    </tal:edit-link>

    <tal:user-cannot-edit condition="not: context/required:launchpad.Edit">
      <p id="no-rcs-details">
        No revision control details recorded for
        <em><tal:series replace="context/title">evolution MAIN</tal:series></em>.
      </p>
    </tal:user-cannot-edit>
  </div>

</tal:block>
</tal:block>

<tal:block tal:condition="view/user_branch_visible">
  <p>The following branch has been registered as the mainline branch
  for this release series:</p>

  <ul class="branch" id="branch-details"
      tal:content="structure context/user_branch/@@+product-summary-listing" />
</tal:block>

<tal:block tal:condition="context/rcstype">

  <tal:converted condition="context/new_style_import">
    <p id="new-style-import-message">
      The details of the import associated with this series can now be
      seen on the <a tal:attributes="href context/new_style_import/branch/fmt:url">
	branch page</a>.
    </p>
    <p>
      The details listed below are informational only.
    </p>
  </tal:converted>
  <table>
    <tbody>
        <tal:block condition="context/rcstype/enumvalue:CVS">
          <tr>
            <th>CVS</th>
	  </tr>
	  <tr>
            <th>Root:</th>
            <td id="cvs-root" tal:content="context/cvsroot">
              :pserver:anonymous@anoncvs.gnome.org:/cvs/gnome</td>
	  </tr>
	  <tr>
	    <th>Module:</th>
	    <td id="cvs-module" tal:content="context/cvsmodule">evolution</td>
          </tr>
          <tr>
            <th>Branch:</th>
            <td id="cvs-branch" tal:content="context/cvsbranch">MAIN</td>
          </tr>
        </tal:block>
        <tal:block condition="context/rcstype/enumvalue:SVN">
          <tr>
            <th>Subversion:</th>
            <td id="svn-url" tal:content="context/svnrepository">http://svn.gnome.org/evolution/trunk</td>
          </tr>
        </tal:block>
        <tr tal:condition="context/importstatus">
          <th>Import status:</th>
          <td id="import-status"
              tal:content="context/importstatus/title">Syncing</td>
        </tr>
        <tal:has-import-success condition="view/hasVcsImportSuccessStatus">
          <tr class="secondary">
            <th>Last run:</th>
            <td id="last-import-status">
              <span tal:condition="view/lastVcsImportSuccessful"
                    class="vcsimportSUCCESS">Success</span>
              <span tal:condition="not:view/lastVcsImportSuccessful"
                    class="vcsimportFAILURE">Failure</span>
              <tal:last-attempt-age
                content="view/lastVcsImportAttemptAge/fmt:approximateduration"
              /> ago
            </td>
          </tr>
        </tal:has-import-success>
        <tr class="secondary" tal:condition="context/importstatus">
          <td colspan="2" tal:content="context/importstatus/description">
            This upstream branch is being imported every day to Bazaar.
          </td>
        </tr>
        <tal:block condition="context/import_branch"
            replace="structure context/import_branch/@@+series-reference" />
        <tal:has-import-age condition="view/hasVcsImportBranchAge">
          <tr class="secondary">
            <th>Last imported:</th>
            <td id="import-branch-age"><tal:branch-age
                content="view/currentVcsImportBranchAge/fmt:approximateduration"
              /> ago
            </td>
          </tr>
        </tal:has-import-age>
    </tbody>
  </table>
</tal:block>
</tal:root>
