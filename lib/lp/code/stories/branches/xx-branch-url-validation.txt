= Validating of branch URLs =

First, let's define a helper to post to the Person +addbranch form.

    >>> def add_branch(url):
    ...     user_browser.open('http://launchpad.dev/~lifeless/+addbranch')
    ...     user_browser.getControl('Name').value = 'pyresources'
    ...     user_browser.getControl('Branch URL').value = url
    ...     user_browser.getControl('Register Branch').click()

Try to create a branch with an invalid URL.

    >>> add_branch('example.com/~lifeless/pyresources/')
    >>> for message in get_feedback_messages(user_browser.contents):
    ...     print message
    There is 1 error.
    "example.com/~lifeless/pyresources/" is not a valid URI

Try to create branches with URLs in bazaar.launchpad.dev.

    >>> add_branch('http://bazaar.launchpad.dev')
    >>> for message in get_feedback_messages(user_browser.contents):
    ...     print message
    There is 1 error.
    For Launchpad to mirror a branch, the original branch cannot be on
    launchpad.dev.

    >>> add_branch('http://bazaar.launchpad.dev/~me/that/this')
    >>> for message in get_feedback_messages(user_browser.contents):
    ...     print message
    There is 1 error.
    For Launchpad to mirror a branch, the original branch cannot be on
    launchpad.dev.

    >>> add_branch('sftp://bazaar.launchpad.dev/~me/that/this')
    >>> for message in get_feedback_messages(user_browser.contents):
    ...     print message
    There is 1 error.
    For Launchpad to mirror a branch, the original branch cannot be on
    launchpad.dev.

Try to create a branch with a URL that is already registered.

    >>> add_branch('http://example.com/gnome-terminal/main/')
    >>> for message in get_feedback_messages(user_browser.contents):
    ...     print message
    There is 1 error.
    The bzr branch lp://dev/~name12/gnome-terminal/main is already registered
    with this URL.


Try to create a branch without URL

    >>> add_branch('')
    >>> for message in get_feedback_messages(user_browser.contents):
    ...     print message
    There is 1 error.
    Branch URLs are required for Mirrored branches.

Try to create a branch using the bzr+ssh URL scheme. Bug 76854 (see also 5573)

    >>> add_branch('bzr+ssh://example.com/code/branch')
    >>> print user_browser.url
    http://code.launchpad.dev/~no-priv/+junk/pyresources


= The other forms =

The +addbranch form of Product, and the +edit form of a branch all use the same
validation logic that the previous form, since it is defined in the IBranch
interface. No point in repeating the tests here.
