<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
>
<body>
  <metal:portlets fill-slot="portlets">
  </metal:portlets>

  <div metal:fill-slot="main">

  <script type="text/javascript">
/*
 * When step 2 of this wizard has search results, we want to hide the
 * details widgets until the user states that the project they are
 * registering is not a duplicate.
 */
YUI().use('node', function(Y) {
    Y.on('domready', function() {
        var form_widgets = Y.get('#launchpad-form-widgets');
        var form_actions = Y.get('#launchpad-form-actions');
        var search_results = Y.get('#search-results');
        var details_buttons = Y.get('#registration-details-buttons');
        var title = Y.get('#registration-details-title');
        var step_title = Y.get('#step-title');
        var separator = Y.get('#registration-separator');

        /* This is the magic hidden widget used by the MultiStepView. */
        var marker = Y.get(Y.DOM.byId('field.__visited_steps__'));

        /* When the 'No' button is clicked, we swap in the registration
         * details for the search results.  It really doesn't look good
         * to leave the search results there.
         */
        function complete_registration(event) {
            /* Toggle the visibility of the various widgets. */
            form_widgets.setStyle('display', 'block');
            form_actions.setStyle('display', 'block');
            title.setStyle('display', 'block');
            search_results.setStyle('display', 'none');
            details_buttons.setStyle('display', 'none');

            /* Set the H2 title to something more appropriate for the
             * selected task.
             */
            step_title.set('innerHTML', 'Step 2 (of 2) Registration details');

            /* Append a special marker to the hidden state widget.  See
             * ProjectAddStepTwo.search_results_count() for details.
             */
            var steps = marker.getAttribute('value');
            if (steps.search(/hidesearch/) < 0) {
                marker.setAttribute('value', steps + "|hidesearch");
            }
        }

        /* The details button is only visible when JavaScript is enabled, but
         * the H3 separator is only visible when JavaScript is disabled.
         * Neither is displayed on the step 1 page.
         */
        if (separator) {
            separator.setStyle('display', 'none');
        }
        if (details_buttons) {
            details_buttons.setStyle('display', 'block');
            connect(details_buttons, 'onclick', complete_registration);
        }

        /* If there are search results, hide the registration details. */
        if (search_results) {
            form_widgets.setStyle('display', 'none');
            form_actions.setStyle('display', 'none');
            title.setStyle('display', 'none');
        }
    })
});
  </script>

    <div style="font-size: larger; background: #e0f0d0;
        padding: 0.3em; -moz-border-radius: 5px; -o-border-radius: 5px;
       -webkit-border-radius: 5px; margin-bottom: 1em;">
      <strong>Requesting Ubuntu CDs</strong> is done at <a
      href="https://shipit.ubuntu.com/">shipit.ubuntu.com</a>
      <form style="display: inline; font-size: smaller"
            action="https://shipit.ubuntu.com/">
        <input type="submit" value="Oh, I want Ubuntu CDs" />
      </form>
    </div>

    <div metal:use-macro="context/@@launchpad_form/form">
      <metal:step fill-slot="extra_info">
      <h2 class="legend" id="step-title">Step
          <tal:step_number tal:replace="view/step_number"/>
          (of <tal:total_steps tal:replace="view/total_steps"/>):
          <tal:step_description tal:replace="view/step_description"/></h2>
      </metal:step>

      <metal:extra metal:fill-slot="extra_top">
        <div tal:condition="view/search_results_count"
             id="search-results">
          <div style="font-size: larger; margin-bottom: 1em; max-width: 60em;">
          <img src="/@@/info" />
          There are similar projects already registered in Launchpad.
          Is project
          <strong><tal:displayname tal:replace="view/request/displayname" />
          (<tal:name  tal:replace="view/request/name" />)</strong>
          one of these?
          </div>

          <table tal:define="results view/search_results">
            <tbody>
              <tr tal:repeat="pillar_name results"
                  tal:replace="structure pillar_name/@@+listing-simple">
              </tr>
            </tbody>
          </table>
          <div id="registration-details-buttons" style="display: none;">
            <input type="button"
                   value="No, this is a new project"/>
            or <a tal:attributes="href view/cancel_url">Cancel</a>
          </div>
        </div>

        <div id="registration-details-title"
             style="font-size: larger; max-width: 60em;"
             tal:condition="python: view.step_number == 2">
          <h3 id="registration-separator"
              tal:condition="view/search_results_count"
              >Registration details</h3>
          Select the licenses for project
          <strong><tal:displayname tal:replace="view/request/displayname" />
          (<tal:name  tal:replace="view/request/name" />)</strong>
          and complete the registration.  You may also update the project's
          title and summary.
        </div>
      </metal:extra>
    </div>

  </div>
</body>
</html>
