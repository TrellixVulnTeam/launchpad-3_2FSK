<!-- Copyright 2009 Canonical Ltd.  This software is licensed under the
     GNU Affero General Public License version 3 (see the file LICENSE).
-->

<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="context/@@main_template/master"
  i18n:domain="launchpad"
>
<body>

<metal:portlets fill-slot="portlets">
  <div tal:replace="structure context/@@+portlet-details" />
</metal:portlets>


  <div metal:fill-slot="main">

    <h2>Current polls for 
      &#8220;<span tal:replace="context/displayname" />&#8221;
    </h2>

    <p tal:condition="not: view/hasCurrentPolls">
      This team has no open polls nor polls that are not yet opened.
    </p>

    <ul tal:condition="view/hasCurrentPolls">
      <li tal:repeat="poll view/openpolls">
        <a tal:attributes="href poll/fmt:url">
          <span tal:replace="poll/title" />
        </a> - closes
        <span
          tal:attributes="title poll/datecloses/fmt:datetime"
          tal:content="poll/datecloses/fmt:displaydate" />.

        <tal:block define="user request/lp:person" condition="user">
          <tal:block condition="python: poll.personVoted(user)">
            You have
            <span tal:replace="poll/closesIn/fmt:approximateduration" /> 
            to change your vote if you wish.
          </tal:block>

          <tal:block condition="python: not poll.personVoted(user)">
            You have
            <span tal:replace="poll/closesIn/fmt:approximateduration" />
            left to vote in this poll.
          </tal:block>
        </tal:block>

      </li>

      <li tal:repeat="poll view/notyetopenedpolls">
        <a tal:attributes="href poll/fmt:url">
          <span tal:replace="poll/title" />
        </a> - opens
        <span
          tal:attributes="title poll/dateopens/fmt:datetime"
          tal:content="poll/dateopens/fmt:displaydate" />
      </li>
    </ul>

    <tal:block condition="view/closedpolls" >
      <h2>Recent polls</h2>

      <ul>
        <li tal:repeat="poll view/closedpolls">
          <a tal:attributes="href poll/fmt:url">
            <span tal:replace="poll/title" />
          </a> - closed
          <span
            tal:attributes="title poll/datecloses/fmt:datetime"
            tal:content="poll/datecloses/fmt:displaydate" />
        </li>
      </ul>
    </tal:block>

    <br />
    <tal:block tal:condition="request/lp:person">
      <ul class="add" tal:condition="context/required:launchpad.Edit">
        <li><a href="+newpoll">Set up a new poll</a></li>
      </ul>
    </tal:block>

    <tal:block tal:condition="not: request/lp:person">
      <a href="+login">Log in as an admin to set up a new poll</a>
    </tal:block>

  </div>

</body>
</html>

