We make Zope 3 give us funky real time stats.

    >>> import xmlrpclib
    >>> from canonical.functional import XMLRPCTestTransport
    >>> lp_xmlrpc = xmlrpclib.ServerProxy(
    ...     'http://xmlrpc.launchpad.dev/+opstats',
    ...     transport=XMLRPCTestTransport()
    ...     )

Number of requests

    >>> opstats = lp_xmlrpc.opstats()
    >>> old_requests = opstats['requests']
    >>> opstats = lp_xmlrpc.opstats()

    >>> new_requests = opstats['requests']
    >>> new_requests == old_requests + 1
    True

Number of HTTP requests and success codes:

    >>> old_http = opstats['http requests']
    >>> old_2XXs = opstats['2XXs']
    >>> old_requests = opstats['requests']
    >>> output = http("GET / HTTP/1.1\nHost: code.launchpad.dev\n")
    >>> output.getStatus()
    200
    >>> opstats = lp_xmlrpc.opstats()

    >>> new_http = opstats['http requests']
    >>> new_http == old_http + 1
    True

    >>> new_2XXs = opstats['2XXs']
    >>> new_2XXs == old_2XXs + 1
    True

    Note that 'requests' has increased by 2, once for the HTTP requestand
    once for the XML-RPC requests to obtain updated stats

    >>> new_requests = opstats['requests']
    >>> new_requests == old_requests + 2
    True

Number of XML-RPC requests:

    >>> old_xmlrpc = opstats['xml-rpc requests']
    >>> old_requests = opstats['requests']
    >>> opstats = lp_xmlrpc.opstats()

    >>> new_xmlrpc = opstats['xml-rpc requests']
    >>> new_xmlrpc == old_xmlrpc + 1
    True

    >>> new_requests = opstats['requests']
    >>> new_requests == old_requests + 1
    True

Number of 404s:

    >>> old_404s = opstats['404s']
    >>> old_requests = opstats['requests']
    >>> output = http("GET http://launchpad.dev/non-existant HTTP/1.1\n")
    >>> output.getStatus()
    404
    >>> opstats = lp_xmlrpc.opstats()

    >>> new_404s = opstats['404s']
    >>> new_404s == old_404s + 1
    True

    >>> new_requests = opstats['requests']
    >>> new_requests == old_requests + 2
    True

Number of XML-RPC Faults:

    >>> old_faults = opstats['xml-rpc faults']
    >>> old_requests = opstats['xml-rpc requests']
    >>> try:
    ...     opstats = lp_xmlrpc.invalid() # XXX: Need a HTTP test too
    ...     print 'Should have raised an exception!'
    ... except xmlrpclib.Fault:
    ...     pass
    >>> opstats = lp_xmlrpc.opstats()

    >>> new_faults = opstats['xml-rpc faults']
    >>> new_faults == old_faults + 1
    True

    >>> new_requests = opstats['xml-rpc requests']
    >>> new_requests == old_requests + 2
    True

Number of OOPSes:

Number of SoftTimeouts:

Number of Timeouts:


