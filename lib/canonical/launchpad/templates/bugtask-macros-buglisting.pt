<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

<div metal:fill-slot="main">

<metal:assignee_widget define-macro="assignee_widget_in_table">
  <tal:comment replace="nothing">
    This macro expects that the view has the following attributes:
    :assignee_widget: The widget rendered by a Choice field named assignee
    :unassigned_widget: The widget rendered by a Bool field named unassignee
  </tal:comment>

  <tr tal:condition="view/assignee_widget">
    <th>
      <label
        tal:attributes="for view/assignee_widget/name"
        tal:content="view/assignee_widget/label"
      >Assigned to:</label>
    </th>
    <td>
      <div tal:content="structure view/assignee_widget" />
      <div>
        <tal:block content="structure view/unassigned_widget" />
        <label style="font-weight: normal;"
            tal:attributes="for view/unassigned_widget/name"
            tal:content="structure view/unassigned_widget/label">
          Unassigned bugs only
        </label>
      </div>
    </td>
  </tr>
</metal:assignee_widget>


<metal:include_dupes_widget define-macro="include_dupes_widget_in_table">
  <tal:comment replace="nothing">
    This macro expects that the view has the following attributes:
    :include_dupes_widget: The widget rendered by a Bool field named
                           include_dupes
  </tal:comment>

  <tr>
    <th />
    <td>
      <tal:block content="structure view/include_dupes_widget" />
      <label style="font-weight: normal;"
          tal:attributes="for view/include_dupes_widget/name"
          tal:content="structure view/include_dupes_widget/label">
        Include duplicates
      </label>
    </td>
  </tr>
</metal:include_dupes_widget>

<metal:page
    define-macro="page"
    tal:define="listing_columns view/task_columns;
                task_batch_navigator view/search">

  <tal:tag condition="view/assign_to_milestones|nothing"/>

  <metal:heading define-slot="heading" tal:replace="nothing" />

  <form name="bugtask_search" action="" method="GET">
  <tal:show-search-widgets condition="view/shouldShowSearchWidgets">
    <table>
      <tr>
        <th>
          <label tal:attributes="for view/searchtext_widget/name"
                 tal:content="view/searchtext_widget/label">
            Bug ID or text:
          </label>
        </th>
        <td>
          <tal:searchtext content="structure view/searchtext_widget" />
        </td>
      </tr>
      <tr>
        <th>
          <label metal:use-macro="context/@@+bugtask-macros-listview/sortwidget_label" />
        </th>
        <td>
          <metal:widget use-macro="context/@@+bugtask-macros-listview/sortwidget" />
        </td>
      </tr>
      <tr>
        <th>
        </th>
        <td>
          <tal:block condition="not: view/shouldShowAdvancedSearchWidgets">
            <input type="submit" name="search" value="Search" />
            <input type="submit" name="advanced" value="Advanced..." />
          </tal:block>
        </td>
      </tr>

      <tal:extra_search_widgets_in_table
          condition="view/shouldShowAdvancedSearchWidgets">

        <input type="hidden" name="advanced" value="1" />

        <tal:block condition="view/shouldShowAssignee">
          <metal:widget
            use-macro="context/@@+bugtask-macros-buglisting/assignee_widget_in_table" />
        </tal:block>

        <metal:widget 
          use-macro="context/@@+bugtask-macros-buglisting/include_dupes_widget_in_table" />
      </tal:extra_search_widgets_in_table>

    </table>

    <table style="width: auto;"
           tal:condition="view/shouldShowAdvancedSearchWidgets">
      <tr>
        <td>
          <table style="width: auto;">
            <tbody>
              <tr>
                <td tal:condition="view/status_widget|nothing">
                  <label tal:attributes="for view/status_widget/name"
                          tal:content="view/status_widget/label">
                    Status:
                  </label>
                </td>
                <td tal:condition="view/importance_widget|nothing">
                  <label tal:attributes="for view/importance_widget/name"
                          tal:content="view/importance_widget/label">
                    Importance:
                  </label>
                </td>
                <td tal:condition="view/attachmenttype_widget|nothing">
                  <label tal:attributes="for view/attachmenttype_widget/name"
                          tal:content="view/attachmenttype_widget/label">
                    Attachment:
                  </label>
                </td>
                <td tal:condition="view/milestone_widget|nothing">
                  <label tal:attributes="for view/milestone_widget/name"
                          tal:content="view/milestone_widget/label">
                    Target:
                  </label>
                </td>
              </tr>

              <tr>
                <td tal:condition="view/status_widget"
                    tal:content="structure view/status_widget" />
                <td tal:condition="view/importance_widget"
                    tal:content="structure view/importance_widget" />
                <td tal:condition="view/attachmenttype_widget"
                    tal:content="structure view/attachmenttype_widget" />
                <td tal:condition="view/milestone_widget|nothing"
                    tal:content="structure view/milestone_widget" />
              </tr>
            </tbody>
          </table>
        </td>
      </tr>
      <tr>
        <td>
          <input type="submit" name="search" value="Search" />
          <input tal:condition="view/hasSimpleMode|nothing"
                 type="submit" name="simple" value="Simple..." />
        </td>
      </tr>
    </table>
  </tal:show-search-widgets>

  <tal:navigation
    replace="structure task_batch_navigator/@@+navigation-links"
    tal:condition="task_batch_navigator/currentBatch"
  />
  <tal:table_view tal:condition="view/showTableView">
    <table
       metal:use-macro="context/@@+bugtask-macros-tableview/batched-table" />
  </tal:table_view>
  <tal:list_view tal:condition="view/showListView"
                 tal:define="show_targetname view/shouldShowTargetName|nothing;
                             should_show_assignee view/shouldShowAssignee">

      <table>
        <tr tal:repeat="task task_batch_navigator/currentBatch">
          <td tal:condition="view/mass_edit_allowed">
            <input type="checkbox" name="task" tal:attributes="value task/id" />
          </td>
          <metal:taskrow use-macro="task/@@+bugtask-macros-listview/item" />
        </tr>
      </table>
    </tal:list_view>

    <tal:edit tal:condition="view/mass_edit_allowed">
      <tal:block content="structure view/milestone_assignment_widget" />
      <input type="submit" name="assign_to_milestone"
             value="Assign to Milestone" />
    </tal:edit>

    </form>

    <tal:navigation
      replace="structure task_batch_navigator/@@+navigation-links"
      tal:condition="task_batch_navigator/currentBatch"
    />
    <p tal:condition="not: task_batch_navigator/currentBatch">
       No matching results found.
    </p>

  <script>
    <!--
        document.forms[0].elements['field.searchtext'].focus();
        //-->
  </script>

</metal:page>

</div>


</body>

</html>
