= Deactivating mailing lists =

A team administrator can also deactivate a mailing list.  Mailman handles this
by archiving and deleting the mailing list data, which allows for easy
reconstitution later.

First, create the mailing list, which will send notification messages
to all the members of the mailing list.  We can ignore these messages.

    >>> from canonical.launchpad.mailman.testing import helpers
    >>> list_one = helpers.create_list('itest-one')

Because the mailing list is active, there is no archived backup file.

    >>> from Mailman import mm_cfg
    >>> import os
    >>> backup_file = os.path.join(mm_cfg.VAR_PREFIX,
    ...                            'backups', 'itest-one.tgz')
    >>> os.path.exists(backup_file)
    False

The team administrator can deactivate the list through the web.

    >>> from canonical.launchpad.mailman.testing import logwatcher
    >>> serial_watcher = logwatcher.LogWatcher('serial')
    >>> browser = Browser('no-priv@canonical.com:test')
    >>> browser.open('http://launchpad.dev/~itest-one/+mailinglist')
    >>> browser.getControl('Deactivate this Mailing List').click()
    >>> serial_watcher.wait()

As far as Mailman is concerned, the mailing list no longer exists.

    >>> import time; time.sleep(2)
    >>> from Mailman.Utils import list_names
    >>> sorted(name for name in list_names() if name.startswith('itest-'))
    []

The list data has been backed up into the archive directory.  The backup is a
gzip'd tarfile containing the list's pickle data.

    >>> os.path.exists(backup_file)
    True
    >>> import tarfile
    >>> tarball = tarfile.open(backup_file, 'r:gz')
    >>> tarball.list()
    -... itest-one/
    -... itest-one/config.pck
    -... itest-one/config.pck.last
