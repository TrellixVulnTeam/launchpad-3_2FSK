<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/locationless"
  i18n:domain="launchpad"
>
<body>
  <div class="top-portlet" metal:fill-slot="main" tal:define="token view/token">
    <tal:no-token condition="not:token">
      <h1>Unable to identify application</h1>
      <p>
        The information provided by the remote application was incorrect or
        incomplete. Because of that we were unable to identify the
        application which would access Launchpad on your behalf.
      </p>
    </tal:no-token>

    <tal:has-token condition="token">
      <tal:token-not-reviewed condition="not:token/is_reviewed">
        <div metal:use-macro="context/@@launchpad_form/form">
          <div metal:fill-slot="extra_top">

           <tal:desktop-integration-token condition="token/consumer/is_integrated_desktop">
             <h1>Integrating
               <tal:hostname replace="structure
                token/consumer/integrated_desktop_name" />
               into your Launchpad account</h1>
             <p>The
               <tal:desktop replace="structure
               token/consumer/integrated_desktop_type" />
             called
             <strong tal:content="token/consumer/integrated_desktop_name">hostname</strong>
             wants access to your Launchpad account. If you allow the
             integration, all applications running
             on <strong tal:content="token/consumer/integrated_desktop_name">hostname</strong>
             will have read-write access to your Launchpad account,
             including to your private data.</p>

             <p>If you're using a public computer, if
             <strong tal:content="token/consumer/integrated_desktop_name">hostname</strong>
             is not the computer you're using right now, or if
             something just doesn't feel right about this situation,
             you should choose "No, thanks, I don't trust
             '<tal:hostname replace="structure
              token/consumer/integrated_desktop_name" />'",
             or close this window now. You can always try
             again later.</p>

             <p>Even if you decide to allow the integration, you can
             change your mind later.</p>
           </tal:desktop-integration-token>

           <tal:web-integration-token condition="not:token/consumer/is_integrated_desktop">
             <h1>Integrating
               <tal:hostname replace="structure token/consumer/key" />
               into your Launchpad account</h1>

             <p>The application identified as
               <strong tal:content="token/consumer/key">consumer</strong>
               wants to access
               <tal:has-context condition="view/token_context">
                 things related to
                 <strong tal:content="view/token_context/title">Context</strong>
                 in
               </tal:has-context>
               Launchpad on your behalf. What level of access
               do you want to grant?</p>
           </tal:web-integration-token>

           <table>
             <tr tal:repeat="action view/visible_actions">
               <td style="text-align: right">
                 <tal:action replace="structure action/render" />
               </td>

               <tal:web-integration-token
                  condition="not:token/consumer/is_integrated_desktop">
                 <td>
                   <span class="lesser"
                     tal:content="action/permission/description" />
                 </td>
               </tal:web-integration-token>
             </tr>
           </table>
          </div>

          <div metal:fill-slot="extra_bottom">
            <input type="hidden" name="oauth_token"
                   tal:condition="request/form/oauth_token|nothing"
                   tal:attributes="value request/form/oauth_token" />
            <input type="hidden" name="oauth_callback"
                   tal:condition="request/form/oauth_callback|nothing"
                   tal:attributes="value request/form/oauth_callback" />
            <input type="hidden" name="lp.context"
                   tal:condition="request/form/lp.context|nothing"
                   tal:attributes="value request/form/lp.context" />
          </div>

          <div metal:fill-slot="buttons" />
        </div>
      </tal:token-not-reviewed>

      <tal:token-reviewed condition="token/is_reviewed">
        <h1>Request already reviewed</h1>
        <p>
          This request for accessing Launchpad on your behalf has been
          reviewed <tal:date-reviewed 
                      content="token/date_reviewed/fmt:approximatedate" />.
        </p>
      </tal:token-reviewed>
    </tal:has-token>

    <p>
      See all <a tal:attributes="href string:${view/user/fmt:url}/+oauth-tokens"
        >applications authorized</a> to access Launchpad on your behalf.
    </p>
  </div>

</body>
</html>

