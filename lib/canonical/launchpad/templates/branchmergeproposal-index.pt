<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
>

<body>

<style type="text/css" metal:fill-slot="head_epilogue">
  #code-review-votes {
    margin: 2em 0;
  }
</style>

<metal:heading fill-slot="before_nav_menu"
               tal:content="structure context/source_branch/@@+heading"/>

<div metal:fill-slot="main"
     tal:define="context_menu context/menu:context">

  <tal:proposal-heading tal:replace="structure context/@@+heading-links"/>

  <div id="actions" class="actions aside"
       tal:condition="context/required:launchpad.Edit">
    <tal:action define="link context_menu/set_work_in_progress"
                condition="link/enabled"
                content="structure link/render">
      Set WIP
    </tal:action>
    <tal:action define="link context_menu/review"
                condition="link/enabled"
                content="structure link/render">
      Review
    </tal:action>
    <tal:action define="link context_menu/merge"
                condition="link/enabled"
                content="structure link/render">
      Mark as merged
    </tal:action>
    <tal:action define="link context_menu/enqueue"
                condition="link/enabled"
                content="structure link/render">
      Enqueue
    </tal:action>
    <tal:action define="link context_menu/dequeue"
                condition="link/enabled"
                content="structure link/render">
      Dequeue
    </tal:action>
    <tal:action define="link context_menu/resubmit"
                condition="link/enabled"
                content="structure link/render">
      Resubmit
    </tal:action>

  </div>

  <div class="aside">
    <aside tal:content="structure context/@@+pagelet-subscribers" />
  </div>

  <p id="proposal-merged" tal:condition="context/merged_revno">
    This proposal was merged at revision
    <tal:revno replace="context/merged_revno" />

    <a tal:define="link context_menu/update_merge_revno"
       tal:condition="link/enabled"
       tal:attributes="href link/url"
       ><img src="/@@/edit" tal:attributes="title link/text; alt link/text" />
    </a>
  </p>

  <tal:superseded-proposal condition="context/supersedes">
    <p id="superseded-proposal">
      This proposal supersedes a
      <a tal:attributes="href context/supersedes/fmt:url">
        proposal from
        <tal:when replace="context/supersedes/date_created/fmt:date" /></a>.
    </p>
  </tal:superseded-proposal>
  <tal:superseded-by condition="context/superseded_by">
    <p id="superseded-by">
      This proposal has been superseded by a
      <a tal:attributes="href context/superseded_by/fmt:url">
        proposal from
        <tal:when replace="context/superseded_by/date_created/fmt:date" /></a>.
    </p>
  </tal:superseded-by>
  <div>

    <h2>Proposed commit message
    </h2>

  </div>
  <div id="commit-message">
    <p tal:content="structure context/commit_message/fmt:text-to-html">
      Commit message
    </p>
    <p tal:condition="not: context/commit_message">
      No commit message specified.
    </p>
  </div>


  <tal:whiteboard condition="context/whiteboard">
    <h2>Whiteboard</h2>
    <div id="branch-whiteboard-value" class="whiteboard"
      tal:content="structure context/whiteboard/fmt:text-to-html">
      Whiteboard text goes here.
    </div>
  </tal:whiteboard>

  <tal:votes replace="structure context/@@+votes-with-links"/>

  <div tal:define="link context/menu:context/request_review"
       tal:condition="link/enabled"
       tal:content="structure link/render">
       Request review
  </div>

  <tal:comments repeat="row view/comments" >
    <div tal:content="structure row/comment/@@+fragment-summary"
         tal:attributes="style row/style" />
  </tal:comments>

  <div tal:define="link context/menu:context/add_comment"
       tal:condition="link/enabled"
       tal:content="structure link/render">
       Add comment
  </div>

  <div id="related-bugs-and-blueprints"
    tal:define="branch context/source_branch"
    tal:condition="view/has_bug_or_spec"
    >
    <h2>Linked bug reports and blueprints</h2>
    <div class="actions">

      <metal:bug-branch-links use-macro="branch/@@+macros/bug-branch-links"/>
    </div>
    <div class="actions">
      <metal:spec-branch-links use-macro="branch/@@+macros/spec-branch-links"/>
    </div>
  </div>

  <div id="source-revisions"
       tal:condition="not: context/queue_status/enumvalue:MERGED">
  <h2>Unmerged revisions</h2>

    <tal:history-available condition="context/source_branch/revision_count"
                           define="branch context/source_branch;
                                   revisions view/unlanded_revisions">
      <metal:landing-target use-macro="branch/@@+macros/branch-revisions"/>
    </tal:history-available>

    <tal:remote-branch condition="context/source_branch/branch_type/enumvalue:REMOTE">
      <p>Recent revisions are not available due to the source branch being remote.</p>
    </tal:remote-branch>
  </div>
</div>

</body>
</html>
