= Branch Visibility =

Most branches on launchpad are considered public branches, and are
visible to everybody, even people not logged in.

Some branches are also considered "private".  These are branches that
are only visible to a specific team of people.  This team is specified
on the branch in the attribute visibility_team.  

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces import IBranchSet
    >>> branch = getUtility(IBranchSet).getByUniqueName('~name12/gnome-terminal/scanned')

== Public Visibility ==

If the visibility_team is None then the branch is "public".
  
    >>> login(ANONYMOUS)
    >>> print branch.visibility_team
    None

Public branches are viewable to all, even those not logged in.

    >>> from canonical.launchpad.webapp.authorization import check_permission
    >>> check_permission('launchpad.View', branch)
    True

== Visibility due to team membership ==

Now if we set the visibility_team to something like the Ubuntu Gnome team.

    >>> from canonical.launchpad.interfaces import IPersonSet
    >>> from zope.security.proxy import removeSecurityProxy
    >>> person_set = getUtility(IPersonSet)
    >>> ubuntu_gnome_team = person_set.getByName('name18')
    >>> removeSecurityProxy(branch).visibility_team = ubuntu_gnome_team

The branch will not be publicly viewable any more.

    >>> check_permission('launchpad.View', branch)
    False

Sample Person though is a member of the Ubuntu Gnome team, so they
can see the branch.

    >>> login('test@canonical.com')
    >>> check_permission('launchpad.View', branch)
    True

No Privledges person though isn't a member of any team.

    >>> login('no-priv@canonical.com')
    >>> check_permission('launchpad.View', branch)
    False


== Visibility due to subscription ==

Branches that are not public are viewable by members of the visibility_team
and to subscribers.

We are going to use Sample Person here, so firstly log them on.

    >>> login('test@canonical.com')
    >>> branch = getUtility(IBranchSet).getByUniqueName(
    ...     '~launchpad/gnome-terminal/launchpad')

The branch is one that Sample Person has subscribed to.

    >>> sample_person = person_set.getByEmail('test@canonical.com')
    >>> branch in sample_person.subscribed_branches
    True

Sample Person isn't a member of the launchpad team.

    >>> launchpad_team = person_set.getByName('launchpad')
    >>> sample_person.inTeam(launchpad_team)
    False

Set the visibility_team of the branch to the launchpad team.

    >>> removeSecurityProxy(branch).visibility_team = launchpad_team

Sample Person can see the branch.

    >>> check_permission('launchpad.View', branch)
    True

No Privledges person can't.

    >>> login('no-priv@canonical.com')
    >>> check_permission('launchpad.View', branch)
    False

Foo Bar can as they are a member of the launchpad team.

    >>> login('foo.bar@canonical.com')
    >>> foobar = person_set.getByEmail('foo.bar@canonical.com')
    >>> branch in foobar.subscribed_branches
    False
    >>> foobar.inTeam(launchpad_team)
    True
    >>> check_permission('launchpad.View', branch)
    True

Non-logged in users cannot see it.

    >>> login(ANONYMOUS)
    >>> check_permission('launchpad.View', branch)
    False
    