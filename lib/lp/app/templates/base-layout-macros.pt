<macros
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="launchpad"
  tal:omit-tag=""
>

<metal:notifications define-macro="notifications"
  tal:define="notifications notifications|request/notifications">
  <tal:comment replace="nothing">
    This macro expects the following variables:
    :notifications: An object implementing INotificationList.
  </tal:comment>

  <div class="error message"
    tal:repeat="notification notifications/error"
    tal:content="structure notification/message"
  >An error notification message</div>
  <div class="warning message"
    tal:repeat="notification notifications/warning"
    tal:content="structure notification/message"
  >A warning notification message</div>
  <div class="informational message"
    tal:repeat="notification notifications/notice"
    tal:content="structure notification/message"
  >A notice notification message</div>
  <div class="informational message"
    tal:repeat="notification notifications/info"
    tal:content="structure notification/message"
  >An info notification message</div>
  <div class="debug message"
    tal:repeat="notification notifications/debug"
    tal:content="structure notification/message"
  >A debug notification message, only displayed for developers.</div>
</metal:notifications>


<metal:load-javascript define-macro="load-javascript"
  tal:define="
      revno modules/canonical.launchpad.versioninfo/revno | string:unknown;
      rooturl modules/canonical.launchpad.webapp.vhosts/allvhosts/configs/mainsite/rooturl;
      icingroot string:${rooturl}+icing/rev${revno};
      icingroot_contrib string:${rooturl}+icing-contrib/rev${revno};
      devmode modules/canonical.config/config/devmode;
      map_query string:&amp;file=api&amp;v=2&amp;key=${modules/canonical.config/config/google/maps_api_key};
      yui string:${icingroot}/yui/3.0.0pr2/build;
      lazr_js string:${icingroot}/lazr/build;
      lp_js string:${icingroot}/build"
  >
  <tal:comment replace="nothing">
    This macro just loads javascript files. It doesn't
    do any initialization.
  </tal:comment>

  <tal:needs_json tal:condition="request/needs_json">
    <script type="text/javascript"
            tal:attributes="src string:${icingroot_contrib}/json2.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${icingroot_contrib}/JSONScriptRequest.js"></script>
  </tal:needs_json>
  <tal:needs-gmap2 condition="request/needs_gmap2">
    <script type="text/javascript"
            tal:condition="devmode"
            tal:attributes="src string:http://maps.google.com/maps?${map_query};"></script>
    <script type="text/javascript"
            tal:condition="not: devmode"
            tal:attributes="src string:https://maps-api-ssl.google.com/maps?oe=utf-8&amp;client=gme-canonical${map_query};"></script>
  </tal:needs-gmap2>

  <tal:devmode condition="devmode">
    <script type="text/javascript"
            tal:attributes="src string:${yui}/yui/yui.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/oop/oop.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/event/event.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/dom/dom.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/node/node.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/dump/dump.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/io/io.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/json/json.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/attribute/attribute.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/base/base.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/substitute/substitute.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/anim/anim.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/classnamemanager/classnamemanager.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/plugin/plugin.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-position-ext.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/cookie/cookie.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-position.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-position-ext.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-stack.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/widget/widget-stdmod.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/overlay/overlay.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${yui}/node-menunav/node-menunav.js"></script>

    <script type="text/javascript"
            tal:attributes="src string:${icingroot}/MochiKit.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/lazr/lazr.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/anim/anim.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/inlineedit/editor.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/autocomplete/autocomplete.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/overlay/overlay.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/activator/activator.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/picker/picker.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/formoverlay/formoverlay.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lazr_js}/effects/effects.js"></script>

    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/lp.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/dragscroll.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/picker.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/lp/mapping.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/registry/milestoneoverlay.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/registry/timeline.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/sorttable/sorttable.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/inlinehelp/inlinehelp.js"></script>
    <script type="text/javascript"
            tal:attributes="src string:${lp_js}/client/client.js"></script>
  </tal:devmode>
  <tal:production condition="not:devmode">
    <script type="text/javascript"
            tal:attributes="src string:${icingroot}/build/launchpad.js"></script>
  </tal:production>

  <script type="text/javascript"
      tal:content="string:var cookie_scope = '${request/lp:cookie_scope}';"></script>

  <script type="text/javascript">
    YUI().use('node', function(Y) {
        Y.on('load', function(e) {
            sortables_init();
            initInlineHelp();
            activateCollapsibles();
            activateFoldables();
            activateConstrainBugExpiration();
        }, window);

        // Hook up the function that dismisses the help window if we click
        // anywhere outside of it.
        Y.on('click', handleClickOnPage, window);
    });
  </script>
</metal:load-javascript>


<metal:launchpad-stylesheet define-macro="launchpad-stylesheet"
  tal:define="
      revno modules/canonical.launchpad.versioninfo/revno | string:unknown;
      rooturl modules/canonical.launchpad.webapp.vhosts/allvhosts/configs/mainsite/rooturl;
      icingroot string:${rooturl}+icing/rev${revno};
      devmode modules/canonical.config/config/devmode"
  >
  <style
    type="text/css"
    media="screen, print"
    tal:condition="not: devmode"
    tal:content="string:@import url(${icingroot}/+style-slimmer.css);"/>
  <style
    type="text/css"
    media="screen, print"
    tal:condition="devmode"
    tal:content="string:@import url(${icingroot}/style.css);"/>

  <link rel="stylesheet" type="text/css"
      tal:attributes="href
      string:${icingroot}/lazr/build/lazr/assets/skins/sam/lazr.css"
      />
  <link rel="stylesheet" type="text/css"
      tal:attributes="href
      string:${icingroot}/lazr/build/inlineedit/assets/skins/sam/editor.css"
      />
  <link rel="stylesheet" type="text/css"
      tal:attributes="href
      string:${icingroot}/lazr/build/autocomplete/assets/skins/sam/autocomplete.css"
      />
  <link rel="stylesheet" type="text/css"
      tal:attributes="href
      string:${icingroot}/lazr/build/overlay/assets/skins/sam/pretty-overlay.css"
      />
  <link rel="stylesheet" type="text/css"
      tal:attributes="href
      string:${icingroot}/lazr/build/formoverlay/assets/formoverlay.css"
      />
  <link rel="stylesheet" type="text/css"
      tal:attributes="href
      string:${icingroot}/lazr/build/picker/assets/skins/sam/picker.css"
      />
  <link rel="stylesheet" type="text/css"
      tal:attributes="href
      string:${icingroot}/lazr/build/activator/assets/skins/sam/activator.css"
      />
</metal:launchpad-stylesheet>


<metal:launchpad-stylesheet-3-0 define-macro="launchpad-stylesheet-3-0"
  tal:define="
    revno modules/canonical.launchpad.versioninfo/revno | string:unknown;
    rooturl modules/canonical.launchpad.webapp.vhosts/allvhosts/configs/mainsite/rooturl;
    icingroot string:${rooturl}+icing/rev${revno};
    yui string:${icingroot}/yui/3.0.0pr2/build;
    devmode modules/canonical.config/config/devmode">
  <tal:comment replace="nothing">
    This macro loads the old stylesheet, then the YUI CSS, and finally
    the new stylesheet. When no pages use main-template, this can be
    refactored.
  </tal:comment>
  <metal:old-style-sheet use-macro="template/macros/launchpad-stylesheet" />
  <link rel="stylesheet" type="text/css"
    tal:attributes="href string:${yui}/cssreset/reset.css" />
  <link rel="stylesheet" type="text/css"
    tal:attributes="href string:${yui}/cssfonts/fonts.css" />
  <link rel="stylesheet" type="text/css"
    tal:attributes="href string:${yui}/cssgrids/grids.css" />

  <style type="text/css" media="screen, print"
    tal:content="string:@import url(${icingroot}/style-3-0.css);"/>
</metal:launchpad-stylesheet-3-0>


<metal:lp-client-cache define-macro="lp-client-cache">
  <tal:cache condition="view/user|nothing"
              define="cache request/webservicerequest:cache;
                      links cache/links;
                      objects cache/objects;">
    <script tal:repeat="key links"
      tal:content="string:LP.client.links['${key}'] =
                   '${links/?key/fmt:api_url}';">
    </script>
    <script tal:repeat="key objects"
      tal:content="string:LP.client.cache['${key}'] =
                   ${objects/?key/webservice:json};">
    </script>
  </tal:cache>

  <script tal:condition="context/webservice:is_entry"
    tal:content="string:LP.client.cache['context'] =
                 ${context/webservice:json};">
  </script>
</metal:lp-client-cache>

</macros>
