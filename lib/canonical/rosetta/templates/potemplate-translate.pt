<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="rosetta">

<head>
    <!-- Plone style sheet -->
    <style type="text/css" media="screen">@import url(plone.css);</style>
    <!-- Rosetta style sheet -->
    <style type="text/css" media="screen">@import url(rosetta.css);</style>
</head>

<body>

<div metal:fill-slot="main">

    <div tal:content="view/submitTranslations" />
    <!--
    <div tal:condition="not: view/submitted">
    -->

    <h1>Translating <span tal:replace="context/product/project/title">Project
        title</span> &mdash; <span tal:replace="context/title">POT file
        title</span></h1>

    <div class="documentDescription">
    Hint: use the <code>Tab</code> key to move quickly between translation fields.
    </div>

    <!-- Show which messages are displayed. -->

    <div tal:condition="view/atBeginning">
        <div tal:condition="view/atEnd">
            Showing all
            <span tal:replace="context/__len__">23</span>
            messages.
        </div>
    </div>

    <div tal:condition="python:
            (not view.atBeginning()) or (not view.atEnd())">
        Showing messages
        <span tal:replace="python: view.offset + 1"
            >5</span>
        &ndash;
        <span tal:replace="python:
            min(len(context), view.offset + view.count)">10</span>
        of
        <span tal:replace="context/__len__">23</span>.
    </div>

    <!-- Navigation doodads. -->

    <div class="listingBar">
        <span class="previous">
            <!-- Link to beginning, if this is not the beginning page. -->
            <span tal:condition="not:view/atBeginning">
                <a tal:attributes="href view/beginningURL">&laquo; Beginning</a>
            </span>

            <!-- Link to previous page, if it's not the beginning page. -->
            <span tal:condition="python: view.offset - view.count > 0">
                <a tal:attributes="href view/previousURL">&laquo; Previous
                    <span tal:replace="view/count">5</span> messages</a>
            </span>
        </span>

        <span class="next">
            <!-- Link to next page, if it's not the end page. -->
            <span tal:condition="python:
                    view.offset + 2 * view.count < len(context)">
                <a tal:attributes="href view/nextURL">Next
                    <span tal:replace="view/count">5</span> messages &raquo;</a>
            </span>

            <!-- Link to end page, if this is not the end page. -->
            <span tal:condition="not:view/atEnd">
                <a tal:attributes="href view/endURL">End &raquo;</a>
            </span>
        </span>
        &nbsp;
    </div>

    <!-- The actual translation form. -->

    <form method="post" tal:attributes="action request/URL">
    <tal:msgstring repeat="set view/messageSets">
        <fieldset class="message-strings">
            <legend>String #<span tal:replace="set/sequence">120</span></legend>

                <!-- Simple message. -->
                <span tal:condition="not:set/isPlural">
                    <div class="field">
                        <label class="language-code">English (Source)</label>
                        <!--
                        <span
                            tal:condition="not:set/messageID/isMultiline"><span
                            tal:content="set/messageID/text">text</span></span>
                        -->
                        <div class="messageSourceString"
                             xtal:condition="set/messageID/isMultiline"
                             tal:content="structure set/messageID/text">text</div>
                    </div>

                    <div class="field" tal:repeat="language view/languages">
                        <label class="language-code"
                            tal:content="language/englishName">pt_BR</label>:
                        <br/>
			<!-- XXX: I think this logic should be moved inside browser.py
			     Added so it does not breaks with msgsets not available with
			     a POFile. -->
			<span tal:condition="python: len(set['translations'][language]) > 0" >
                            <input type="text"
                                tal:condition="not:set/messageID/isMultiline"
                                xtal:attributes="value python:sighting.currentTranslation(language).text[0]"
                                tal:attributes="
                                    name string:t_${set/id}_${language/code};
                                    value python:set['translations'][language][0];
                                    " />
			</span>
			<span tal:condition="python: len(set['translations'][language]) < 1" >
			    <input type="text"
                                tal:condition="not:set/messageID/isMultiline"
                                xtal:attributes="value python:sighting.currentTranslation(language).text[0]"
                                tal:attributes="
                                    name string:t_${set/id}_${language/code};
                                    " />
			</span>
                        <textarea
                            tal:condition="set/messageID/isMultiline"
                            tal:attributes="name
                                string:t_${set/id}_${language/code}"></textarea>
                    </div>
                </span>

                <!-- Plural message. -->
                <span tal:condition="set/isPlural">
                    <div class="field">
                        <label class="language-code">English 1</label>:
                        <span tal:content="set/messageID/text">singular</span>
                    </div>

                    <div class="field">
                        <label class="language-code">English 2</label>:
                        <span tal:content="set/messageIDPlural/text">plural</span>
                    </div>

                    <fieldset>
                        <legend>Plural forms translation</legend>

                        <span tal:repeat="language view/languages">

                            <div class="field" tal:repeat="i python:
                                    range(view.pluralForms[language.code])">
                                <label class="language-code"
                                    tal:content="language/englishName">pt_BR[0]</label>:
                                <input type="text"
                                    tal:attributes="
                                        name string:t_${set/id}_${language/code}_0;
                                        value python:set['translations'][language][0];
                                        "
                                   />
                                <!--
                                <img src="++resource++info.gif" title="Example: 1 dead horse." />
                                -->
                            </div>

                        </span>
                    </fieldset>
                </span>

            <div class="field" tal:condition="set/commentText">
                <label>Comment</label>
                <img src="++resource++arrowDown.gif" />
                <div class="discreet" tal:content="set/commentText">This refers to the content type.</div>
            </div>

            <fieldset class="collapsible collapsed">
                <legend>Located in</legend>
                <pre tal:content="set/fileReferences"
                    >./plone_forms/discussion_reply_form.pt</pre>
            </fieldset>

            <!--
            <div class="field">
                <label>Code reference</label>
                <img src="++resource++arrowRight.gif" />
            </div>
            -->
        </fieldset>

        <div class="visualClear"></div>
    </tal:msgstring>

        <!-- Offset of next page, if not at end. -->
        <input type="hidden" name="offset"
            tal:condition="not: view/atEnd"
            tal:attributes="value python: view.offset + view.count" />
        <input type="submit" name="SUBMIT" value="Submit" />
    </form>

    <!-- </div> --> <!-- tal:condition="not: view/submitted" -->
</div>

</body>
</html>
