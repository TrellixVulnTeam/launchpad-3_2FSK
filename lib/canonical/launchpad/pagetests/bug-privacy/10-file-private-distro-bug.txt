Foo Bar files a security (private) bug on Ubuntu Linux. He gets
redirected to the bug page. (Note that only the advanced bug
filing page, not the simple one, supports filing security bugs.)

    >>> browser = setupBrowser("Basic foo.bar@canonical.com:test")
    >>> browser.open("http://launchpad.dev/ubuntu/+filebug-advanced")

Ubuntu has no security contact, so the Ubuntu maintainer, Ubuntu Team,
will be subscribed instead.

    >>> print browser.contents
    <!DOCTYPE...
    ...The maintainer of...Ubuntu...Ubuntu Team...will be notified...
    ...

    >>> browser.getControl(name="packagename_option").value = ["choose"]
    >>> browser.getControl(name="field.packagename").value = "evolution"
    >>> browser.getControl(name="field.title").value = "a private bug"
    >>> browser.getControl(name="field.comment").value = "secret info"
    >>> browser.getControl(
    ...     "This bug is a security vulnerability").selected = True
    >>> browser.getControl("Submit Bug Report").click()

    >>> bug_id = browser.url.split("/")[-1]
    >>> print browser.url.replace(bug_id, "BUG-ID")
    http://bugs.launchpad.dev/ubuntu/+source/evolution/+bug/BUG-ID

    >>> print browser.contents
    <!DOCTYPE...
    ...Security-related bugs are by default...private...

Foo Bar sees the private bug he filed.

    >>> browser.open("http://launchpad.dev/ubuntu/+bugs")
    >>> print browser.contents.replace(bug_id, "BUG-ID")
    <!DOCTYPE...
    ...
    ...Ubuntu Linux...
    ...<a...>...BUG-ID...</a>...

Foo Bar and the Ubuntu Team are subscribed to the bug.

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.ftests import login, logout
    >>> from canonical.launchpad.interfaces import IBugSet

    >>> login("foo.bar@canonical.com")

    >>> bug = getUtility(IBugSet).get(bug_id)

    >>> sorted(subscriber.name for subscriber in bug.getDirectSubscribers())
    [u'name16', u'ubuntu-team']

    >>> logout()

Now let's set an Ubuntu security team, and see how the filebug page and
subscriptions differ.

    >>> browser.open("http://launchpad.dev/ubuntu/+securitycontact")
    >>> browser.getControl("Security Contact").value = "name12"
    >>> browser.getControl("Change").click()

    >>> browser.open("http://launchpad.dev/ubuntu/+filebug-advanced")

    >>> print browser.contents
    <!DOCTYPE...
    ...The security contact for...Ubuntu...Sample Person...will be notified...
    ...

    >>> browser.getControl(name="packagename_option").value = ["choose"]
    >>> browser.getControl(name="field.packagename").value = "evolution"
    >>> browser.getControl(name="field.title").value = "a private bug"
    >>> browser.getControl(name="field.comment").value = "secret info"
    >>> browser.getControl(
    ...     "This bug is a security vulnerability").selected = True
    >>> browser.getControl("Submit Bug Report").click()

    >>> other_bug_id = browser.url.split("/")[-1]
    >>> print browser.url.replace(other_bug_id, "BUG-ID")
    http://bugs.launchpad.dev/ubuntu/+source/evolution/+bug/BUG-ID


Now only the reporter and /security contact/ are subscribed.

    >>> login("foo.bar@canonical.com")

    >>> bug = getUtility(IBugSet).get(other_bug_id)

    >>> sorted(subscriber.name for subscriber in bug.getDirectSubscribers())
    [u'name12', u'name16']

    >>> logout()

