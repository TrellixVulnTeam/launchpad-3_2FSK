<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="launchpad">

<body>

<metal:block fill-slot="head_epilogue">
  <style type="text/css">
    .subordinate {
      margin: 0.5em 0 0.5em 4em;
    }
  </style>
</metal:block>

<div metal:fill-slot="main">

  <div metal:use-macro="context/@@launchpad_form/form">

    <metal:formbody fill-slot="widgets">

      <table class="form">

        <tr>
          <td>
            <label>
              <input tal:replace="structure view/branch_type_link" />
              Link to a Bazaar branch already in Launchpad
            </label>
            <table class="subordinate">
              <tal:widget define="widget nocall:view/widgets/branch_location">
                <metal:block use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
            </table>
          </td>
        </tr>

        <tr>
          <td>
            <label>
              <input tal:replace="structure view/branch_type_create" />
              Create a new, empty branch in Launchpad and link
              to this series
            </label>
          </td>
        </tr>

        <tr>
          <td>
            <label>
              <input tal:replace="structure view/branch_type_import" />
              Import a branch hosted somewhere else
            </label>
            <table class="subordinate">
              <tal:widget define="widget nocall:view/widgets/repo_url">
                <metal:block use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>

              <tr>
                <td>
                  <label>
                    <input tal:replace="structure view/rcs_type_bzr" />
                    Bazaar, hosted externally
                  </label>
                </td>
              </tr>

              <tr>
                <td>
                  <label>
                    <input tal:replace="structure view/rcs_type_git" />
                    Git
                  </label>
                </td>
              </tr>

              <tr>
                <td>
                  <label>
                    <input tal:replace="structure view/rcs_type_svn" />
                    SVN
                  </label>
                </td>
              </tr>

              <tr>
                <td>
                  <label>
                    <input tal:replace="structure view/rcs_type_hg" />
                    Mercurial
                  </label>
                </td>
              </tr>

              <tr>
                <td>
                  <label>
                    <input tal:replace="structure view/rcs_type_cvs" />
                    CVS
                  </label>
                  <table class="subordinate">
                  <tal:widget define="widget nocall:view/widgets/cvs_module">
                    <metal:block use-macro="context/@@launchpad_form/widget_row" />
                  </tal:widget>
                  </table>
                </td>
              </tr>

            </table>
          </td>
        </tr>

      </table>
      <input tal:replace="structure view/rcs_type_emptymarker" />

      <script type="text/javascript">
        //<![CDATA[
        function getRcsType(rcs_types) {
          var rcs_type = 'None';
          for (var i = 0; i < rcs_types.length; i++) {
            if (rcs_types[i].checked) {
              rcs_type = rcs_types[i].value;
              break;
            }
          }
          return rcs_type;
        }

        function updateWidgets() {
          /* Which rcs type radio button has been selected? */
          // CVS
          var rcs_types = document.getElementsByName('field.rcs_type');
          var rcs_type = getRcsType(rcs_types);
          var form = rcs_types[0].form;
          updateField(form['field.cvs_module'], rcs_type == 'CVS');
        }

        registerLaunchpadFunction(updateWidgets);

        function updateBranchType() {
          /* Which branch type radio button was selected? */
          var rcs_types = document.getElementsByName('field.rcs_type');
          var rcs_type = getRcsType(rcs_types);
          var types = document.getElementsByName('field.branch_type');
          var form = types[0].form;
          var type = 'None';
          for (var i = 0; i < types.length; i++) {
            if (types[i].checked) {
              type = types[i].value;
              break;
            }
          }
          // Linked
          updateField(form['field.branch_location'], type == 'link-lp-bzr')
          // New, empty branch -- do nothing
          // Import
          is_external = (type == 'import-external')
          updateField(form['field.repo_url'], is_external)
          updateField(form['field.cvs_module'],
            (is_external & rcs_type == 'CVS'))
          for (var i = 0; i < rcs_types.length; i++) {
            updateField(rcs_types[i], is_external)
          }

        }
        registerLaunchpadFunction(updateBranchType);


        //]]>
      </script>

    </metal:formbody>
  </div>


</div>
</body>
</html>
