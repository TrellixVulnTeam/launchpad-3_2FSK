<!-- Copyright 2009 Canonical Ltd.  This software is licensed under the
     GNU Affero General Public License version 3 (see the file LICENSE).
-->

<tal:root
   xmlns:tal="http://xml.zope.org/namespaces/tal"
   xmlns:metal="http://xml.zope.org/namespaces/metal"
   omit-tag="">

  <metal:macro define-macro="comment-display">
    <tal:comment condition="nothing">
      This macro requires the following defined variables:
      comment - the code review comment
      show_expander - show the expand contract link
      show_link - if the expander actually does anything
      display_style - the display style for the primary div
    </tal:comment>

    <div tal:attributes="style display_style; id id;"
         tal:define="expand view/is_long_message|nothing">
      <div class="boardCommentDetails">
        <div tal:condition="comment/vote" style="float:right">
          <tal:vote-tags condition="comment/vote_tag"
                         replace="comment/vote_tag"/>
          <span tal:attributes="class string:vote${comment/vote/name}"
                tal:content="comment/vote/title">
            Approve
          </span>
        </div>

        <tal:author replace="structure comment/message/owner/fmt:link:mainsite"/>
        <tal:has-comment condition="message">wrote</tal:has-comment>
        <tal:just-vote condition="not: message">voted</tal:just-vote>
        <tal:date replace="comment/message/datecreated/fmt:displaydate" />

      </div>
      <div class="boardCommentBody codereviewcomment" tal:condition="message">
        <tal:message replace="structure message/fmt:obfuscate-email/fmt:nice_pre" />
        <tal:short-message-view condition="view/message_summary|nothing">
          <tal:long-message condition="view/is_long_message">
            (<a tal:attributes="href comment/fmt:url;
            onclick string:return switchDisplay('${expanded_id}','${contracted_id}')"
            tal:content="expander_text">full message</a>)
          </tal:long-message>
        </tal:short-message-view>
        <tal:good-attachments repeat="attachment view/display_attachments">
          <div class="boardComment attachment" tal:define="body_text python:str(attachment.read())">
            <div class="boardCommentDetails filename"><a tal:content="attachment/filename" tal:attributes="href attachment/getURL"/></div>
            <div class="boardCommentBody attachmentBody" tal:content="structure body_text/fmt:nice_pre"/>
          </div>
        </tal:good-attachments>
        <tal:other-attachments repeat="attachment view/other_attachments">
          <tal:comment replace="structure string:&lt;!-- '${attachment/filename}' '${attachment/mimetype}' --&gt;"/>
        </tal:other-attachments>
      </div>
    </div>
  </metal:macro>

</tal:root>
