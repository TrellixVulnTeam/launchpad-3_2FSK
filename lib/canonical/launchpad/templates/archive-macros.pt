<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  omit-tag="">

<metal:source_package_list define-macro="source-package-list">
  <tal:comment replace="nothing">
    Presents a table listing all the published source packages for an
    archive.
  </tal:comment>

  <div style="padding-top: 1em;" tal:define="batch view/search_results">
    <form name="package_search" action="" method="GET" style="clear:both">
      <label for="name">Package name contains:</label>
      <input id="field.name_filter" title="Package Name" size="20"
              type="text" name="field.name_filter"
              tal:attributes="value request/field.name_filter|nothing"/>
      <tal:status_filter
          replace="structure view/plain_status_filter_widget" /> in
      <tal:series_filter
          replace="structure view/plain_series_filter_widget" />
      <input type="submit" value="Filter" />
    </form>

    <tal:navigation_top
        replace="structure view/batchnav/@@+navigation-links-upper" />

    <table class="listing" id="packages_list" tal:condition="batch">
      <thead>
        <tr class="archive_package_row">
        <th colspan="2">Source</th>
        <th tal:condition="context/owner/isTeam">Uploader</th>
        <th>Published</th>
        <th>Status</th>
        <th>Series</th>
        <th>Section</th>
        <th>Build Status</th>
        </tr>
      </thead>
      <tbody>
        <tal:block repeat="publishing batch"
                   replace="structure publishing/@@+listing-archive-detailed">
        </tal:block>
      </tbody>
    </table>

    <tal:navigation_bottom
        replace="structure view/batchnav/@@+navigation-links-lower" />

    <div id="empty-result"
            tal:define="name_filter request/field.name_filter|nothing"
            tal:condition="not: batch">
      No matching package for '<tal:name_filter replace="name_filter" />'.
    </div>

  </div>

</metal:source_package_list>

<metal:package_copy_request_list define-macro="package-copy-request-list">
  <tal:comment replace="nothing">
    Presents a table listing all the published source packages for an
    archive.
  </tal:comment>
  <tal:block define="requests view/package_copy_requests">
    <p tal:condition="not: requests">
      There are currently no requests to copy packages into this archive.
    </p>
    <tal:request_list tal:condition="requests">
      <p>
        The following requests have been made to copy packages
        into this archive:
      </p>
      <ul>
        <li tal:repeat="request requests">
          <tal:src_archive replace="request/source_archive/name" />
          <tal:src_distroseries replace="request/source_distroseries/name" />-<tal:src_pocket replace="request/source_pocket/name/fmt:lower" />
          <tal:src_component condition="request/source_component">
            (<tal:src_component_name replace="request/source_component/name" />)
          </tal:src_component>
          requested by <tal:requestor replace="request/requester/name" />
          at <tal:requested_date replace="request/date_created/fmt:approximatedate" />
          (status: <tal:status replace="request/status/name" />)
        </li>
      </ul>
    </tal:request_list>
  </tal:block>
</metal:package_copy_request_list>

<metal:selectable_sources define-macro="selectable-sources">

  <tal:comment replace="nothing">
    Presents a table with selectable sources for an
    IArchiveSelectableSourceView.
  </tal:comment>

  <tal:search define="name_widget nocall:view/widgets/name_filter;
                      status_widget nocall:view/widgets/status_filter">
     <label tal:attributes="for name_widget/name">
       Show only sources with name matching:
     </label>
     <input tal:replace="structure name_widget" />
     <input tal:replace="structure status_widget" />
     <input
       tal:replace="structure view/actions/field.actions.update/render" />
  </tal:search>

  <tal:no_sources tal:condition="not:view/available_sources_size">
    <div id="empty-result" style="border: 1px solid;">
      <p>No matching source packages for '<tal:name_filter
         tal:replace="request/field.name_filter|nothing" />'.</p>
    </div>
  </tal:no_sources>

  <tal:sources condition="view/available_sources_size"
               define="widget nocall:view/widgets/selected_sources;
                       field_name widget/context/__name__;
                       error python:view.getFieldError(field_name);">
    <table class="listing" style="margin-top: 1em;">
      <thead>
      <tr class="archive_package_row">
        <th colspan="2">Source</th>
        <th tal:condition="context/owner/isTeam">Uploader</th>
        <th>Published</th>
        <th>Status</th>
        <th>Series</th>
        <th>Section</th>
        <th>Build Status</th>
      </tr>
      </thead>
      <tbody>
      <tal:terms tal:repeat="term widget/vocabulary">
        <tal:block
          define="pub term/value"
          replace="structure pub/@@+listing-archive-detailed-selectable" />
      </tal:terms>
      </tbody>
      <tfoot tal:condition="view/has_undisplayed_sources">
         <tr>
           <td colspan="8" tal:condition="context/owner/isTeam">
             <div>Presenting only <tal:presented replace="
               view/max_sources_presented"/> of <tal:available replace="
               view/available_sources_size" /> available sources.</div>
           </td>
           <td colspan="7" tal:condition="not: context/owner/isTeam">
             <div>Presenting only <tal:presented replace="
               view/max_sources_presented"/> of <tal:available replace="
               view/available_sources_size" /> available sources.</div>
           </td>
         </tr>
      </tfoot>
    </table>
    <input tal:attributes="name string:${widget/name}-empty-marker"
           type="hidden" value="1" />
    <div class="error message" tal:condition="error"
         tal:content="structure error">Error message</div>
  </tal:sources>

</metal:selectable_sources>


<metal:package_counters define-macro="package-counters">

  <tal:comment replace="nothing">
    Presents package counters for a defined IArchive.
    :archive: targeted IArchive.
  </tal:comment>

  <ul>
    <li id="source_counter">
       <tal:source_count_text replace="archive/@@+index/source_count_text" />
       (<tal:sources_size
          replace="archive/sources_size/fmt:bytes" />)</li>
    <li id="binary_counter">
       <tal:binary_count_text replace="archive/@@+index/binary_count_text" />
       (<tal:binaries_size
          replace="archive/binaries_size/fmt:bytes" />)</li>
    <li id="total_size">
       Estimated archive size:
       <tal:estimated_size
         replace="archive/estimated_size/fmt:bytes" /></li>
  </ul>

</metal:package_counters>

<metal:build_status_summary define-macro="build-status-summary">

  <tal:comment replace="nothing">
    Present the build pie chart for the context IArchiveRebuild.
    :archive: targetted IArchive.
  </tal:comment>

  <table id="build-count-table"
         summary="An overview of the build status for this archive."
         tal:define="build_counters view/build_counters">
    <thead>
      <tr>
        <th>Total builds:</th>
        <td class="total" tal:content="view/build_counters/total">100</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th>Failed</th>
        <td class="failed" tal:content="build_counters/failed">100</td>
      </tr>
      <tr>
        <th>Pending</th>
        <td class="pending" tal:content="build_counters/pending">100</td>
      </tr>
      <tr>
        <th>Superseded</th>
        <td class="superseded" tal:content="build_counters/superseded">100</td>
      </tr>
      <tr>
        <th>Succeeded</th>
        <td class="succeeded" tal:content="build_counters/succeeded">100</td>
      </tr>
    </tbody>
  </table>
</metal:build_status_summary>

</tal:root>
