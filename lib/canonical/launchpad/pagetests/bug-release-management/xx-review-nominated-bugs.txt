= Review Nominated Bugs =

== Distribution Series ==

From the distribution series bug page you can go to a page to review
all the bugs nominated for this series.

    >>> anon_browser.open('http://bugs.launchpad.dev/ubuntu/hoary')
    
    >>> anon_browser.getLink('Review nominations').click()
    >>> print anon_browser.title
    Bugs nominated for Hoary

All the basic bug details are displayed.

    >>> from canonical.launchpad.ftests.bug import print_bugtasks
    >>> print_bugtasks(anon_browser.contents)
    1  Firefox does not support SVG  mozilla-firefox  Medium  Unconfirmed

There are no controls for approving/declining the nominations if the
user don't have permissions to do it.

    >>> user_browser.open('http://bugs.launchpad.dev/ubuntu/hoary')
    >>> user_browser.getLink('Review nominations').click()
    >>> print anon_browser.title
    Bugs nominated for Hoary

    >>> print_bugtasks(user_browser.contents)
    1  Firefox does not support SVG  mozilla-firefox  Medium  Unconfirmed

    >>> bug_listing = find_tag_by_id(user_browser.contents, 'buglisting')
    >>> for tr in bug_listing.tbody('tr'):
    ...     approve_td, bug_id = tr('td')[:2]
    ...     if approve_td.renderContents().isdigit():
    ...         # No widget column is rendered at all.
    ...         has_input_controls = False
    ...         bug_id = approve_td
    ...     else:
    ...         has_input_controls = approve_td.renderContents().strip() != ''
    ...     print "%s: %s" % (extract_text(bug_id), has_input_controls)
    1: False

No button for submitting the form is shown, nor is the approve/decline
header:

    >>> user_browser.getControl('Save changes')
    Traceback (most recent call last):
    ...
    LookupError: label 'Save changes'

    >>> for th in bug_listing.thead('th'):
    ...     print "'%s'" % extract_text(th).strip()
    'Summary'
    'Package'
    'Importance'
    'Status'

Someone with enough permissions sees controls for approving/declining
nominations.

    >>> admin_browser.open('http://bugs.launchpad.dev/ubuntu/hoary')
    >>> admin_browser.getLink('Review nominations').click()
    >>> print anon_browser.title
    Bugs nominated for Hoary

    >>> print_bugtasks(admin_browser.contents)
    1  Firefox does not support SVG  mozilla-firefox  Medium  Unconfirmed

    >>> bug_listing = find_tag_by_id(admin_browser.contents, 'buglisting')
    >>> for tr in bug_listing.tbody('tr'):
    ...     approve_td, bug_id = tr('td')[:2]
    ...     has_input_controls = approve_td.renderContents().strip() != ''
    ...     print "%s: %s" % (extract_text(bug_id), has_input_controls)
    1: True

    >>> for th in bug_listing.thead('th'):
    ...     print "'%s'" % extract_text(th).strip()
    'Accept Decline No change'
    'Summary'
    'Package'
    'Importance'
    'Status'

After approving the nominated bugs, the listing is empty.

    >>> from canonical.launchpad.database import BugSet, DistributionSet
    >>> ubuntu = DistributionSet().getByName('ubuntu')
    >>> hoary = ubuntu.getSeries('hoary')
    >>> bug_one = BugSet().get(1)
    >>> hoary_nomination = bug_one.getNominationFor(hoary)
    >>> nomination_control = admin_browser.getControl(
    ...     name='field.review_action_%s' % hoary_nomination.id)
    >>> nomination_control.getControl(value='Accept').click()
    >>> admin_browser.getControl('Save changes').click()
    >>> for message in get_feedback_messages(admin_browser):
    ...     print message
    1 nomination(s) accepted

    >>> print find_tag_by_id(admin_browser.contents, 'buglisting')
    None
    >>> user_browser.getControl('Save changes')
    Traceback (most recent call last):
    ...
    LookupError: label 'Save changes'
