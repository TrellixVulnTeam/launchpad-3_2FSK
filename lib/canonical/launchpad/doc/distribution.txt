Distributions
=============

From the DerivationOverview spec[1]:

    A distribution of GNU/Linux comprises a set of packages, an installer,
    possibly a live-CD, some amount of metadata associated with the arrangement
    of those elements and also a lot of information on managing it.

In Launchpad, one distribution is mapped to one row in the Distribution table.
To retrieve a distribution, use the IDistributionSet utility. If you've already
used IPersonSet to retrieve a Person, or IBugTaskSet to retrieve a task, this
syntax should look familiar.

The IDistributionSet utility is accessed in the usual fashion:

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces import IDistributionSet
    >>> distroset = getUtility(IDistributionSet)

To retrieve a specific distribution, use IDistributionSet.get:

    >>> ubuntu = distroset.get(1)
    >>> print ubuntu.name
    ubuntu

Once you've got a distribution, you can retrieve a source package if you
have a SourcePackageName object for it.

    >>> from canonical.launchpad.database.sourcepackagename import SourcePackageName
    >>> evo = SourcePackageName.byName("evolution")
    >>> evo_ubuntu = ubuntu.getSourcePackage(evo)
    >>> print evo_ubuntu.name
    evolution

You can also get a release by name:

    >>> hoary = ubuntu.getRelease("hoary")
    >>> print hoary.name
    hoary

Or by version:

    >>> v504 = ubuntu.getRelease("5.04")
    >>> print v504.name
    hoary

You can list development distroreleases:

    >>> devdists = ubuntu.getDevelopmentReleases()
    >>> for devdist in devdists:
    ...     print devdist.name
    hoary


CVE BugTasks on a Distribution
------------------------------

A distribution should know what CVE-related bug tasks exist on it, and what
state they are in. We should be able to find open, and closed, bugtasks,
using this API. Based on the sample data we know the following about Ubuntu:

    >>> tasks = ubuntu.open_cve_bugtasks
    >>> for task in tasks:
    ...     print task.id
    17

There should be NO resolved CVE tasks:

    >>> tasks = ubuntu.resolved_cve_bugtasks
    >>> print len(tasks)
    0

[1] https://wiki.launchpad.canonical.com/DerivationOverview


Finding distroreleases and pockets from distribution names
----------------------------------------------------------

A distribution knows what distroreleases it has. Those distroreleases have
pockets which have suffixes used by the archive publisher. Because we sometimes
need to talk about distroreleases such as ubuntu/hoary-security we need some
way to decompose that into the distrorelease and the pocket. Distribution
can do that for us.

If we ask for a totally unknown distrorelease, we raise KeyError
    >>> ubuntu.getDistroReleaseAndPocket('unknown') 
    Traceback (most recent call last):
    ...
    KeyError: 'unknown'

If we ask for a plain distrorelease, it should come back with the RELEASE
pocket as the pocket.
    >>> dr, pocket = ubuntu.getDistroReleaseAndPocket('hoary')
    >>> print dr.name
    hoary
    >>> print pocket.name
    RELEASE

If we ask for a security pocket in a known distrorelease it should come out
on the other side.
    >>> dr, pocket = ubuntu.getDistroReleaseAndPocket('hoary-security')
    >>> print dr.name
    hoary
    >>> print pocket.name
    SECURITY

If we ask for a valid distrorelease which doesn't have a given pocket it should
raise KeyError for us
    >>> ubuntu.getDistroReleaseAndPocket('hoary-bullshit')
    Traceback (most recent call last):
    ...
    KeyError: 'hoary-bullshit'
