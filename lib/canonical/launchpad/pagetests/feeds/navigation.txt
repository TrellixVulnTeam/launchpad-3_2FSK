= Feeds Navigation =

Feeds are served over HTTP, and are heavily cached. Pages which are not
registered on the Feeds layer should not be served from the feeds.lp.n
subdomain.
XXX: statik bug=150941: When this bug is fixed (in 1.1.11) this test
should be changed to show that trying to view a page which is not
registered on the Feeds layer returns a 404.


== Index of a product ==

    >>> browser.open('http://feeds.launchpad.dev/jokosher')
    >>> browser.url
    'http://feeds.launchpad.dev/jokosher'


== Redirection ==

We expect that people may manually enter feed URLs, since they follow
a predictable pattern. If someone enters a feed URL and it has
uppercase letters in it, we redirect to the canonical form of the URL
before serving the page.

   >>> browser.open('http://feeds.launchpad.dev/jOkOshEr')
   >>> browser.url
   'http://feeds.launchpad.dev/jokosher'


== Query String Normalization ==

If multiple urls contain the same query string with the same arguments
in a different order, we want to redirect the user to the url with
the normalized query string, so that there is only one cached copy that
has to be refreshed.
XXX: statik 2007-10-18 bug=154114: We don't yet normalize case in
query strings.

    >>> from canonical.config import config
    >>> config.launchpad.is_bug_search_feed_active = True
    >>> browser.open('http://feeds.launchpad.dev/bugs/+bugs.atom?'
    ...     'field.scope=all&search=Search+Bug+Reports&aaa=foo')
    >>> browser.url
    '...+bugs.atom?aaa=foo&field.scope=all&search=Search+Bug+Reports'


== Feeds only available on feeds.launchpad.net ==

It should not be possible to get any feeds through http://launchpad.net,
http://bugs.launchpad.net, etc.

Use the verify_feed_host() function to verify that the feed does work
on feeds.launchpad.dev and does not work on all the other vhosts.

    >>> from zope.publisher.interfaces import NotFound
    >>> def verify_feed_host(path):
    ...     url = 'http://feeds.launchpad.dev' + path
    ...     try:
    ...         browser.open(url)
    ...     except:
    ...         print "Error accessing:", url
    ...         raise
    ...     prefixes = ('', 'answers.', 'blueprints.', 'bugs.', 
    ...         'code.', 'translations.')
    ...     for prefix in prefixes:
    ...         try:
    ...             url = 'http://%slaunchpad.dev%s' % (prefix, path)
    ...             browser.open(url)
    ...         except NotFound:
    ...             pass
    ...         except:
    ...             print "Error accessing:", url
    ...             raise
    ...         else:
    ...             raise AssertionError, "Page should not exist: %s" % url

These atom feeds should only exist on feeds.launchpad.dev:

    >>> verify_feed_host('/jokosher/latest-bugs.atom')
    >>> verify_feed_host('/mozilla/latest-bugs.atom')
    >>> verify_feed_host('/~name16/latest-bugs.atom')
    >>> verify_feed_host('/~admins/latest-bugs.atom')
    >>> verify_feed_host('/~simple-team/latest-bugs.atom')
    >>> verify_feed_host('/bugs/1/bug.atom')
    >>> verify_feed_host('/bugs/+bugs.atom?'
    ...        'field.searchtext=&search=Search+Bug+Reports&'
    ...        'field.scope=all&field.scope.target=')

These html feeds should only exist on feeds.launchpad.dev:

    >>> verify_feed_host('/jokosher/latest-bugs.html')
    >>> verify_feed_host('/mozilla/latest-bugs.html')
    >>> verify_feed_host('/~name16/latest-bugs.html')
    >>> verify_feed_host('/~simple-team/latest-bugs.html')
    >>> verify_feed_host('/bugs/1/bug.html')
    >>> verify_feed_host('/bugs/+bugs.html?'
    ...        'field.searchtext=&search=Search+Bug+Reports&'
    ...        'field.scope=all&field.scope.target=')

Revert configuration change after tests are finished.

    >>> config.launchpad.is_bug_search_feed_active = False
