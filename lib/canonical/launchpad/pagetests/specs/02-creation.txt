
Creating Specifications
=======================

And on both Product and Distribution, we should be able to add a
specification. Let's make sure we can see the relevant page on a Product.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://features.launchpad.dev/products/firefox/+addspec')
  >>> browser.url
  'http://features.launchpad.dev/products/firefox/+addspec'

Let's also validate that a new spec's form page has the appropriate default
specification status.

  >>> browser.getControl(name='field.status').value
  ['New']


And now, on a distribution.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://features.launchpad.dev/distros/ubuntu/+addspec')
  >>> browser.url
  'http://features.launchpad.dev/distros/ubuntu/+addspec'
  >>> browser.getControl(name='field.status').value
  ['New']


Let's go one step further and confirm that we can actually POST to that
form, to register a new specification. We'll do it on the Ubuntu
distribution.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://features.launchpad.dev/distros/ubuntu/+addspec')
  >>> browser.getControl(name='field.name').value = 'networkmagic'
  >>> browser.getControl(
  ...   name='field.title').value = ('Network Magic - Automatic Network'
  ...       'Detection')
  >>> browser.getControl(
  ...   name='field.specurl').value = ('http://wiki.ubuntu.com/NetworkMagic')
  >>> summary = (
  ...   "Users are increasingly using multiple"
  ...   "networks. Being able to seamlessly move between networks whilst"
  ...   "remembering the correct settings for each network would greatly"
  ...   "enhance Ubuntu's usability for mobile professionals. Many network"
  ...   "dependent services should only be run when the system is positive"
  ...   "that it has a network. This would greatly enhance the system's"
  ...   "flexibility and responsiveness.")
  >>> browser.getControl(name='field.summary').value = summary
  >>> browser.getControl(name='field.status').value = ['Approved']
  >>> browser.getControl(name='field.assignee').value = 'daf@canonical.com'
  >>> browser.getControl(name='field.drafter').value = 'carlos@canonical.com'
  >>> browser.getControl(name='field.approver').value = 'tsukimi@quaqua.net'
  >>> browser.getControl(name='UPDATE_SUBMIT').click()
  >>> browser.url
  'http://features.launchpad.dev/distros/ubuntu/+spec/networkmagic'


OK, that created a new specification. Let's make sure we can see it.

  >>> url = 'http://features.launchpad.dev/distros/ubuntu/+spec/networkmagic'
  >>> browser.open(url)
  >>> browser.url
  'http://features.launchpad.dev/distros/ubuntu/+spec/networkmagic'

Now we test if the specification name validator is working trying to register
a spec with the same name.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://features.launchpad.dev/distros/ubuntu/+addspec')
  >>> browser.getControl(name='field.name').value = 'networkmagic'
  >>> browser.getControl(name='field.title').value = ('Network Magic'
  ...       '- Automatic Network Detection')
  >>> browser.getControl(
  ...   name='field.specurl').value = ('http://wiki.ubuntu.com/NetworkMagic')
  >>> browser.getControl(name='field.summary').value = ("Users are"
  ...       "increasingly using multiple networks.")
  >>> browser.getControl(name='field.status').value = ['Approved']
  >>> browser.getControl(name='field.assignee').value = 'daf@canonical.com'
  >>> browser.getControl(name='field.drafter').value = 'carlos@canonical.com'
  >>> browser.getControl(name='field.approver').value = 'tsukimi@quaqua.net'
  >>> browser.getControl(name='UPDATE_SUBMIT').click()
  >>> browser.url
  'http://features.launchpad.dev/distros/ubuntu/+addspec'

Seeing that we were redirected again to the addspec page is a good sign
(something prevented the spec from being registered) however better make sure
this happened due to the right reason.

  >>> 'is already in use by another specification' in browser.contents
  True

And we test again the validator using a invalid name.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://features.launchpad.dev/distros/ubuntu/+addspec')
  >>> browser.getControl(name='field.name').value = 'NetworkMagic'
  >>> browser.getControl(name='field.title').value = (
  ...   'Network Magic - Automatic Network Detection')
  >>> browser.getControl(name='field.specurl').value = (
  ...   'http://wiki.ubuntu.com/NetworkMagic')
  >>> browser.getControl(name='field.summary').value = (
  ...   "Users are increasingly using multiple networks.")
  >>> browser.getControl(name='field.status').value = ['Approved']
  >>> browser.getControl(name='field.assignee').value = 'daf@canonical.com'
  >>> browser.getControl(name='field.drafter').value = 'carlos@canonical.com'
  >>> browser.getControl(name='field.approver').value = 'tsukimi@quaqua.net'
  >>> browser.getControl(name='UPDATE_SUBMIT').click()
  >>> browser.url
  'http://features.launchpad.dev/distros/ubuntu/+addspec'
  >>> "Invalid name 'NetworkMagic'" in browser.contents
  True


Now we test the URL field validator trying to register a new spec with the same
URL.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://features.launchpad.dev/distros/ubuntu/+addspec')
  >>> browser.getControl(name='field.name').value = 'dupenetworkmagic'
  >>> browser.getControl(name='field.title').value = (
  ...   'This is a dupe Network Magic Spec')
  >>> browser.getControl(name='field.specurl').value = (
  ...   'http://wiki.ubuntu.com/NetworkMagic')
  >>> browser.getControl(name='field.summary').value = "Users are increasingly"
  >>> browser.getControl(name='field.status').value = ['Approved']
  >>> browser.getControl(name='field.assignee').value = 'daf@canonical.com'
  >>> browser.getControl(name='field.drafter').value = 'carlos@canonical.com'
  >>> browser.getControl(name='field.approver').value = 'tsukimi@quaqua.net'
  >>> browser.getControl(name='UPDATE_SUBMIT').click()
  >>> browser.url
  'http://features.launchpad.dev/distros/ubuntu/+addspec'
  >>> "is already registered by another specification" in browser.contents
  True

