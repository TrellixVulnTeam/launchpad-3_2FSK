= Filing bugs on a Distribution from the front page =

On the Bugs front page there is a link to file a bug.

    >>> user_browser.open('http://bugs.launchpad.dev/')
    >>> user_browser.getLink('Report a bug').click()
    >>> user_browser.title
    'Report a bug'

Since it's not known on what the bug should be filed on, the page asks
for either a product or a package in a distribution.

    >>> user_browser.getControl('Product') is not None
    True
    >>> user_browser.getControl('Distribution') is not None
    True
    >>> user_browser.getControl('Package') is not None
    True

After we selected a target and entered a summary, a list of possible
duplicates are presented.

    >>> user_browser.getControl('Distribution').selected = True
    >>> user_browser.getControl(
    ...     name='field.bugtarget.distribution').value = ['ubuntu']
    >>> user_browser.getControl('Summary').value = 'Evolution crashes'
    >>> user_browser.getControl('Continue').click()

    >>> from canonical.launchpad.ftests.bug import print_bugs_table
    >>> print_bugs_table(user_browser.contents, "similar-bugs")
    9 Thunderbird crashes

Entering a description and submitting the bug takes the user to the bug
page.

    >>> user_browser.getControl('Further information').value = 'Crash.'
    >>> user_browser.getControl('Submit Bug Report').click()
    >>> user_browser.url
    'http://bugs.launchpad.dev/ubuntu/+bug/...'
    >>> user_browser.title
    'Bug #... in Ubuntu: ...Evolution crashes...'

== Bug on distribution, later switching to product ==

When reporting a new bug a user might enter a summary, leaving the
location as it is (which is Ubuntu, no package):

    >>> user_browser.open('http://bugs.launchpad.dev/')
    >>> user_browser.getLink('Report a bug').click()
    >>> user_browser.getControl('Summary').value = 'Foo'
    >>> user_browser.getControl('Continue').click()
    >>> user_browser.url
    'http://bugs.launchpad.dev/bugs/+filebug'
    >>> [ tag.renderContents().strip() for tag in
    ...      find_tags_by_class(user_browser.contents, 'message') ]
    ['No similar bugs were found.']

Changing the bug location to a project (called "Product" on the page),
entering a description and submitting will file the bug against the
project not against the distribution. (Previously this has caused an
OOPS.)

    >>> user_browser.getControl('Product').selected = True
    >>> user_browser.getControl(
    ...     name='field.bugtarget.product').value = 'iso-codes'
    >>> user_browser.getControl(name='field.comment').value = 'sausage'
    >>> user_browser.getControl('Submit Bug Report').click()
    >>> user_browser.url
    'http://bugs.launchpad.dev/iso-codes/+bug/...'
    >>> user_browser.title
    'Bug #... in iso-codes (upstream)...'

Another user might attempt to file a duplicate bug in a similar way:

    >>> user_browser.open('http://bugs.launchpad.dev/')
    >>> user_browser.getLink('Report a bug').click()
    >>> user_browser.getControl('Summary').value = 'Foo'
    >>> user_browser.getControl('Continue').click()
    >>> user_browser.url
    'http://bugs.launchpad.dev/bugs/+filebug'
    >>> [ tag.renderContents().strip() for tag in
    ...      find_tags_by_class(user_browser.contents, 'message') ]
    ['No similar bugs were found.']

Again, correcting the bug location like before:

    >>> user_browser.getControl('Product').selected = True
    >>> user_browser.getControl(
    ...     name='field.bugtarget.product').value = 'iso-codes'
    >>> user_browser.getControl('Submit Bug Report').click()
    >>> user_browser.url
    'http://bugs.launchpad.dev/bugs/+filebug'

If for any reason the form fails to validate (for example, no
description), we look again for similar bugs, this time searching the
project. Then we should find the bug we just filed:

    >>> find_tag_by_id(user_browser.contents, 'similar-bugs'
    ...     ).findPrevious('strong').renderContents()
    'Your bug may have already been reported.'

== Advanced filebug page ==

From the frontpage's filebug page it's possible to go to the advanced
filebug page and file a bug directly.

    >>> user_browser.open('http://bugs.launchpad.dev/')
    >>> user_browser.getLink('Report a bug').click()
    >>> user_browser.getLink('complicated bug filing form').click()
    >>> user_browser.title
    'Report a bug'

    >>> user_browser.getControl('Distribution').selected = True
    >>> user_browser.getControl(
    ...     name='field.bugtarget.distribution').value = ['ubuntu']
    >>> user_browser.getControl('Summary').value = 'Ubuntu crashes'
    >>> user_browser.getControl('Further information').value = 'Crash.'
    >>> user_browser.getControl('Submit Bug Report').click()
    >>> user_browser.url
    'http://bugs.launchpad.dev/ubuntu/+bug/...'
    >>> user_browser.title
    'Bug #... in Ubuntu: ...Ubuntu crashes...'
