
DistroReleaseLanguage
=====================

This is a special class which encapsulates the information associated with a
particular language and distrorelease.

First we need to know which distroreleaselanguage we are working with. We
will work with french in Hoary first.

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces import (
    ...     IDistroReleaseSet, IDistributionSet, ILanguageSet,
    ...     IDistroReleaseLanguage)
    >>> distroreleaseset = getUtility(IDistroReleaseSet)
    >>> ubuntu = getUtility(IDistributionSet).getByName("ubuntu")
    >>> hoary = distroreleaseset.queryByName(ubuntu, "hoary")
    >>> hoary.name
    u'hoary'
    >>> french = getUtility(ILanguageSet)['fr']
    >>> hoary_french = hoary.getDistroReleaseLanguage(french)

Now lets get the list of real pofiles. By this we mean the ones where there
is actually a translation or two:

    >>> for po in hoary_french.pofiles: print po.potemplate.name
    pmount
    pkgconf-mozilla

Now lets include the dummies:

    >>> for po in hoary_french.po_files_or_dummies: print po.potemplate.name
    evolution-2.2
    pkgconf-mozilla
    pmount

Note that the sorting is by template name, and there is an evolution-2.2
dummy po file.

We also have DummyDistroReleaseLanguages.

    >>> from canonical.launchpad.database import DummyDistroReleaseLanguage
    >>> amharic = getUtility(ILanguageSet)['am']
    >>> hoary_amharic = hoary.getDistroReleaseLanguageOrDummy(amharic)
    >>> print hoary_amharic.__class__
    <class 'canonical.launchpad.database.distroreleaselanguage.DummyDistroReleaseLanguage'>

It should give you the same set of templates to translate.

    >>> for po in hoary_amharic.po_files_or_dummies: print po.potemplate.name
    evolution-2.2
    pkgconf-mozilla
    pmount

Now, we should test that a DummyDistroReleaseLanguage implements the full
interface of a normal DistroReleaseLanguage.

NB IF THIS FAILS then it means that the DistroReleaseLanguage object has
been extended, and the DummyDistroReleaseLanguage has not been similarly
extended.

   >>> print IDistroReleaseLanguage.providedBy(hoary_amharic)
   True


POTemplate Sorting
==================

In general, potemplates should be sorted by priority (descending) then name.
The sample data all has priority 0. So it's all sorted by name (the above
tests show that).

Now we will show that the priority can dominate the sort order.

 >>> potemplates = hoary.currentpotemplates
 >>> evo = potemplates[0]
 >>> print evo.name
 evolution-2.2
 >>> mozconf = potemplates[1]
 >>> print mozconf.name
 pkgconf-mozilla
 >>> pm = potemplates[2]
 >>> print pm.name
 pmount

OK, so we have the three templates. Let's set their priorities and see if
that changes the default sort order.

We need to login so we can poke at the potemplates.

 >>> from canonical.launchpad.ftests import login
 >>> login('foo.bar@canonical.com')

We set their priorities so that the lowest alpha-sort one has the highest
priority.

 >>> evo.priority = 5
 >>> mozconf.priority = 6
 >>> pm.priority = 7

And now we can confirm that priority does in fact dominate

 >>> for pot in hoary.currentpotemplates: print pot.priority, pot.name
 7 pmount
 6 pkgconf-mozilla
 5 evolution-2.2

And now this priority should also dominate the distrorelease language pofile
sort order:

 >>> for po in hoary_amharic.po_files_or_dummies: print po.potemplate.name
 pmount
 pkgconf-mozilla
 evolution-2.2

