= The Mentoring System =

== Offers of Mentoring ==

Launchpad allows people to make an offer of mentoring for a bug or
specification. Here, Foo Bar will make an offer on a spec and a bug:

    >>> from canonical.launchpad.interfaces import IPersonSet, IBugSet
    >>> from canonical.launchpad.interfaces import IDistributionSet
    >>> from canonical.launchpad.ftests import login, syncUpdate
    >>> distroset = getUtility(IDistributionSet)
    >>> personset = getUtility(IPersonSet)
    >>> bugset = getUtility(IBugSet)
    >>> foo_bar = personset.getByEmail('foo.bar@canonical.com')
    >>> lpteam = personset.getByName('launchpad')
    >>> kubuntu = distroset.getByName('kubuntu')
    >>> bug2 = bugset.get(2)
    >>> bug2.is_complete
    False
    >>> spec1 = kubuntu.getSpecification('cluster-installation')
    >>> spec1.is_complete
    False
    >>> login('foo.bar@canonical.com')
    >>> offer1 = bug2.offerMentoring(foo_bar, lpteam)
    >>> offer2 = spec1.offerMentoring(foo_bar, lpteam)

Now, it should be possible to see those offers on a variety of lists.

First, we look at foo_bar's offers:

    >>> for offer in foo_bar.mentoring_offers:
    ...     print offer.target.title
    Blackhole Trash folder
    Facilitate mass installs  of Ubuntu using Netboot configuration

Now, let's look at the list of offers associated with lpteam. For this we
use the team_mentorships attribute, because mentoring_offers would imply
offers made *by* the team, which we don't do. The team_memberships attribute
is for mentorships made by people specifically in support of new members
wanting to join that specific team:

    >>> for offer in lpteam.team_mentorships:
    ...     print offer.target.title
    Blackhole Trash folder
    Facilitate mass installs  of Ubuntu using Netboot configuration

And at the offers related to Bug #2:

    >>> for offer in bug2.mentoring_offers:
    ...     print offer.target.title
    Blackhole Trash folder

And for the specification concerned:

    >>> for offer in spec1.mentoring_offers:
    ...     print offer.target.title
    Facilitate mass installs  of Ubuntu using Netboot configuration

Now, Bug #2 is associated with both Ubuntu and Debian

    >>> ubuntu = distroset.getByName('ubuntu')
    >>> for offer in ubuntu.mentoring_offers:
    ...     print offer.target.title
    Blackhole Trash folder
    >>> debian = distroset.getByName('debian')
    >>> for offer in debian.mentoring_offers:
    ...     print offer.target.title
    Blackhole Trash folder

It is also associated with the ubuntu *upstream* (this is a weirdness in the
Launchpad sample data, we have an upstream product called Ubuntu).

    >>> from canonical.launchpad.interfaces import IProductSet
    >>> productset = getUtility(IProductSet)
    >>> ubuntu_prod = productset.getByName('ubuntu-product')
    >>> for offer in ubuntu_prod.mentoring_offers:
    ...     print offer.target.title
    Blackhole Trash folder

Now, it gets more interesting. There is a bugtask for Bug #2 on the Firefox
product that has been rejected. So the offer of mentoring is NOT relevant to
Firefox, and should not show up there.

    >>> firefox = productset.getByName('firefox')
    >>> print firefox.mentoring_offers.count()
    0

We also can get lists of offers of mentoring associated with groups of
products (Project classes :-)). The ubuntu-product is part of the
ubuntu-project project, so:

    >>> from canonical.launchpad.interfaces import IProjectSet
    >>> projectset = getUtility(IProjectSet)
    >>> uproj = projectset.getByName('ubuntu-project')
    >>> for offer in uproj.mentoring_offers:
    ...     print offer.target.title
    Blackhole Trash folder


== The Mentorship Manager ==

There is a utility which we can use to see all current mentorship offers
across the whole system.

    >>> from canonical.launchpad.interfaces import IMentoringOfferSet
    >>> mm = getUtility(IMentoringOfferSet)
    >>> print mm.mentoring_offers.count()
    2

== Mentoring lists include only incomplete items ==

When a spec or a bug is completed, it drops off the mentoring lists.

   >>> from canonical.lp.dbschema import BugTaskStatus
   >>> from canonical.lp.dbschema import SpecificationDelivery
   >>> bug2.is_complete
   False
   >>> from canonical.database.sqlbase import flush_database_updates
   >>> for task in bug2.bugtasks:
   ...   if task.conjoined_master is None:
   ...     task.transitionToStatus(BugTaskStatus.FIXRELEASED)
   >>> flush_database_updates()
   >>> bug2.is_complete
   True

So, now that Bug #2 is "complete" it should no longer appear in the list of
mentorships offered by foo_bar:

   >>> for offer in foo_bar.mentoring_offers:
   ...     print offer.target.title
   Facilitate mass installs  of Ubuntu using Netboot configuration

And lets see if we can eliminate the spec by making that complete too.

   >>> spec1.is_complete
   False
   >>> spec1.delivery = SpecificationDelivery.IMPLEMENTED
   >>> newstate = spec1.updateLifecycleStatus(foo_bar)
   >>> syncUpdate(spec1)
   >>> spec1.is_complete
   True
   >>> print foo_bar.mentoring_offers.count()
   0

And both offers should have disappeared from ALL the listings we looked at
earlier:

   >>> print lpteam.team_mentorships.count()
   0
   >>> print uproj.mentoring_offers.count()
   0
   >>> print ubuntu_prod.mentoring_offers.count()
   0
   >>> print debian.mentoring_offers.count()
   0
   >>> print ubuntu.mentoring_offers.count()
   0

The mentorship manager should also no longer show those items:

   >>> print mm.mentoring_offers.count()
   0

However, the mentorship manager should show these as recent successful
mentorings:

   >>> for offer in mm.recent_completed_mentorships:
   ...     print offer.target.title
   Blackhole Trash folder
   Facilitate mass installs  of Ubuntu using Netboot configuration


== Checking if the person is a Mentor ==

Once an offer has been made, you can test to see if a person is a mentor for
a bug or a blueprint.

    >>> stevea = personset.getByName('stevea')
    >>> bug2.isMentor(stevea)
    False
    >>> bug2.isMentor(foo_bar)
    True
    >>> spec1.isMentor(stevea)
    False
    >>> bug2.isMentor(foo_bar)
    True

== Retracting mentorship offers ==

We can also retract offers of mentoring.

    >>> bug2.retractMentoring(foo_bar)
    >>> bug2.isMentor(foo_bar)
    False
    >>> spec1.retractMentoring(foo_bar)
    >>> spec1.isMentor(foo_bar)
    False

