<!--
    This is the main bug page tasks portal. It should show only
    the tasks that are critical to see in the current context.
    Other tasks, in all their glory, can be displayed on a
    specialised tasks page.
-->

<div tal:omit-tag
     tal:define="bug_url string:/malone/bugs/${context/id}">
<table class="listing rowNavigation" style="width: 100%;">
    <thead>
        <tr>
            <th>Upstream / Package</th>
            <th>Status</th>
            <th>Severity</th>
            <th>Priority</th>
            <th>Assigned to</th>
        </tr>
    </thead>


    <tbody>
        <!-- Upstream Tasks -->
        <tr tal:repeat="bugtask context/bugtasks"
            tal:attributes="onclick string:window.location='/malone/tasks/${bugtask/id}/+edit';">

            <td>
                <a href=""
                    tal:condition="bugtask/product"
                    tal:attributes="href string:/malone/products/${bugtask/product/name}"
                    >
                    upstream <span tal:replace="bugtask/product/name">$Product.name</span>
                </a>
                <a href=""
                    tal:condition="python: bugtask.distribution and bugtask.sourcepackagename"
                    tal:attributes="href string:/malone/distros/${bugtask/distribution/name}/${bugtask/sourcepackagename/name}"
                    >
                        <span tal:replace="bugtask/distribution/name">
                            distro
                        </span>
                        <span tal:replace="bugtask/sourcepackagename/name">
                            sourcepackagename
                        </span>
                </a>
                <a href=""
                    tal:condition="python: bugtask.distribution and not bugtask.sourcepackagename"
                    tal:attributes="href string:/malone/distros/${bugtask/distribution/name}/}"
                    >
                        <span tal:replace="bugtask/distribution/name">
                            distro
                        </span>
                </a>
                <a href=""
                    tal:condition="python: bugtask.distrorelease and bugtask.sourcepackagename"
                    tal:attributes="href string:/malone/distros/${bugtask/distrorelease/distribution/name}/${bugtask/sourcepackagename/name}"
                    >
                        <span tal:replace="string: ${bugtask/distrorelease/distribution/name} ${bugtask/distrorelease/name}">
                            distro
                        </span>
                        <span tal:replace="bugtask/sourcepackagename/name">
                            sourcepackagename
                        </span>
                </a>
                <a href=""
                    tal:condition="python: bugtask.distrorelease and not bugtask.sourcepackagename"
                    tal:attributes="href string:/malone/distros/${bugtask/distrorelease/distribution/name}/}"
                    >
                        <span tal:replace="string: ${bugtask/distrorelease/distribution/name} ${bugtask/distrorelease/name}">
                            distro
                        </span>
                </a>
             </td>

            <td tal:content="bugtask/status/title">
                $BugTask.status
            </td>

            <td tal:content="bugtask/severity/title"
                tal:attributes="class string:severity${bugtask/severity/title}">
                Critical
            </td>

            <td tal:content="bugtask/priority/title"
                tal:attributes="class string:priority${bugtask/priority/title}">
                Medium
            </td>

            <td>
                <a tal:condition="bugtask/assignee"
                   tal:attributes="href string:/malone/bugs/assigned?name=${bugtask/assignee/name}">
                   <img src="/++resource++user.gif" alt=""
                    /><span tal:replace="bugtask/assignee/browsername">
                    assignee.browsername
                    </span>
                </a>
            </td>

        </tr>

    </tbody>
</table>
</div>
