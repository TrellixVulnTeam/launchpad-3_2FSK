<!-- Copyright 2009 Canonical Ltd.  This software is licensed under the
     GNU Affero General Public License version 3 (see the file LICENSE).
-->

<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  omit-tag="">

<tal:do-this-first condition="view/processForm" />
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="context/@@main_template/master"
  i18n:domain="launchpad"
>
<body>

  <div metal:fill-slot="body" style="padding-left: 1em">

  <h1>ShipIt requests</h1>

  <table>
  <tbody>
  <tr>
  <td width="80%" id="main-content">

  <form name="search" method="get" tal:attributes="action request/URL">
  <table class="headers-right-aligned">
    <tbody>
    <tr>
      <th >Show:</th>
      <td colspan="2">
        <select name="statusfilter">
          <option tal:repeat="option view/status_options"
                  tal:attributes="
                    value option/name;
                    selected option/is_selected"
                  tal:content="option/title" />
        </select>
        requests
      </td>
    </tr>
    <tr>
      <th>with:</th>
      <td>
        <select name="seriesfilter">
          <option tal:repeat="option view/series_options"
                  tal:attributes="
                    value option/name;
                    selected option/is_selected"
                  tal:content="option/title" />
        </select>
        CDs of
        <select name="flavourfilter">
          <option tal:repeat="option view/flavour_options"
                  tal:attributes="
                    value option/name;
                    selected option/is_selected"
                  tal:content="option/title" />
        </select>
      </td>
    </tr>
    <tr>
      <th>submitted by:</th>
      <td colspan="2">
        <input type="text" size="30" name="recipient_text"
               tal:attributes="value view/recipient_text" />
        <span class="formHelp">(optional)</span>
      </td>
    </tr>
    <tr>
      <th>sorted by:</th>
      <td colspan="2">
        <select name="orderby" tal:define="orderby request/orderby|nothing">
          <option value="recipientdisplayname"
            tal:attributes="selected python: orderby == 'recipientdisplayname'">
            recipient</option>
          <option value="daterequested" 
            tal:attributes="selected python: orderby == 'daterequested'">
            oldest first</option>
          <option value="-daterequested" 
            tal:attributes="selected python: orderby == '-daterequested'">
            newest first</option>
          <option value="-highpriority"
            tal:attributes="selected python: orderby == '-highpriority'">
            priority</option>
        </select>
        <input type="submit" value="Show" name="show" />
      </td>
    </tr>
    </tbody>
  </table>
  </form>

  <br />
  <tal:block condition="view/submitted"
             define="bn view/batchNavigator;
                     prev_url bn/prevBatchURL;
                     next_url bn/nextBatchURL;
                     shipitrequests view/shipitrequests">

    <p tal:condition="not: shipitrequests">
      No requests were found
    </p>

    <tal:block condition="shipitrequests">
      <table width="90%" class="listing" id="results">
        <thead style="border: none">
          <tr>
            <td colspan="7" style="background-color: white"> 
              <tal:navigation replace="structure bn/@@+navigation-links-upper" />
            </td>
          </tr>
          <tr>
            <th>id</th>
            <th>Recipient</th>
            <th>Date</th>
            <th>Country</th>
            <th style="text-align: right">Requested</th>
            <th style="text-align: right">Approved</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="results-body">
          <tal:block repeat="shipitrequest shipitrequests">
            <tr tal:define="
              bg python: shipitrequest.highpriority and '#ff6666' or None;
              total_requested python: view.totals_for_shipitrequests[shipitrequest.id][0];
              total_approved python: view.totals_for_shipitrequests[shipitrequest.id][1]"
                tal:attributes="style string: background-color:${bg}">
              <td><a tal:attributes="href shipitrequest/fmt:url"
                     tal:content="shipitrequest/id">id</a></td>
              <td>
                <span tal:replace="shipitrequest/recipientdisplayname" /><br />
                (<span
                  tal:replace="shipitrequest/recipient_email"
                  />)
              </td>
              <td>
                <span
                  tal:attributes="
                    title shipitrequest/daterequested/fmt:datetime"
                  tal:content="
                    shipitrequest/daterequested/fmt:approximatedate" />
              </td>
              <td tal:content="shipitrequest/country/name" />
              <td style="text-align: right" tal:content="total_requested" />
              <td style="text-align: right" tal:content="total_approved" />
              <td tal:content="shipitrequest/status_desc" />
            </tr>
          </tal:block>
        </tbody>
        <tr>
          <td colspan="7" style="background-color: white"> 
            <tal:navigation replace="structure bn/@@+navigation-links-lower" />
          </td>
        </tr>
      </table>
    </tal:block>

  </tal:block>

  </td>
  <td
    width="20%" id="navigation"
    style="vertical-align: top;"
    tal:content="structure context/@@+portlet-navigation"
  />
  </tr>
  </tbody>
  </table>  
  
</div>

</body>
</html>
</tal:root>
