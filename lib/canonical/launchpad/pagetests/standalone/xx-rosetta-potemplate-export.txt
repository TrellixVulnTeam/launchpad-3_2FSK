Exporting Files from PO Templates Through the Web
-------------------------------------------------

Not logged in users can't access the +export page.

  >>> anon_browser.open(
  ...     'http://launchpad.dev/ubuntu/hoary'
  ...     '/+source/evolution/+pots/evolution-2.2/')
  >>> anon_browser.getLink('Download').click()
  Traceback (most recent call last):
  ...
  Unauthorized:...

Logged in as a regular user, the +export page is accessible.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open(
  ...     'http://launchpad.dev/ubuntu/hoary'
  ...     '/+source/evolution/+pots/evolution-2.2')
  >>> browser.getLink('Download Translations').click()

  >>> browser.url
  'http://launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/+export'

  >>> browser.title
  'Export translations of \xe2\x80\x9cTemplate "evolution-2.2" in 
  Ubuntu Hoary package "evolution"\xe2\x80\x9d'

If we POST without the appropriate format included, we tell the user off:

  >>> browser.getControl('Everything').selected = True
  >>> browser.getControl('Format:').clear() 
  >>> browser.getControl('Request Download').click()

  >>> for tag in find_tags_by_class(browser.contents, 'error'):
  ...     print tag
  <div class="error message">Please select a valid format for download.</div>

If we choose 'Selected files' but don't select any PO file, we should receive
a nice error message.

  >>> browser.getControl('Selected files:').selected = True
  >>> browser.getControl('Format:').value = ['PO']
  >>> browser.getControl('Request Download').click()

  >>> for tag in find_tags_by_class(browser.contents, 'error'):
  ...     print tag
  <div class="error message">Please select at least one pofile or the PO template.</div>

If we POST the page with valid data, it should add the request to the queue.
Note that when we choose 'Everything', one request for the PO template is
added to the export queue and individual requests are added for the PO files.

  >>> browser.getControl('Everything').selected = True
  >>> browser.getControl('Format:').value = ['PO']
  >>> browser.getControl('Request Download').click()

  >>> browser.url
  'http://launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2'

  >>> for tag in find_tags_by_class(browser.contents, 'informational'):
  ...     print tag
  <div class="informational message">Your request has been received. Expect to receive an email shortly.</div>

We can also request only the PO Template. By doing this we're basically adding
a duplicate request for the PO template to the export queue.
This is a no-op: (See bug https://launchpad.net/rosetta/+bug/1558)

  >>> browser.getLink('Download Translations').click()
  >>> browser.getControl('Selected files:').selected = True
  >>> browser.getControl('The PO template').selected = True
  >>> browser.getControl('Format:').value = ['PO']
  >>> browser.getControl('Request Download').click()

  >>> browser.url
  'http://launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2'

  >>> for tag in find_tags_by_class(browser.contents, 'informational'):
  ...     print tag
  <div class="informational message">Your request has been received. Expect to receive an email shortly.</div>

