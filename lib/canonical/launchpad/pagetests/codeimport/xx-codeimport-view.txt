Currently, the pages relating to code imports are only visible to
members of the vcs-imports team and Launchpad admins.  We log in as
David Allouche, a member of vcs-imports (and not an admin):

    >>> browser.addHeader('Authorization',
    ...                   'Basic david.allouche@canonical.com:test')

For now, there is no link to the page that lists all code imports, so
we browse there directly:

    >>> browser.open('http://code.launchpad.dev/+code-imports')

Admins can also browse to this page, although anonymous and ordinary
users cannot:

    >>> admin_browser.open('http://code.launchpad.dev/+code-imports')
    >>> admin_browser.url
    'http://code.launchpad.dev/+code-imports'
    >>> anon_browser.open('http://code.launchpad.dev/+code-imports')
    Traceback (most recent call last):
      ...
    Unauthorized: ...
    >>> user_browser.open('http://code.launchpad.dev/+code-imports')
    Traceback (most recent call last):
      ...
    Unauthorized: ...


There are two CodeImports in the sample data and they both show up in
the page:

    >>> table = find_tag_by_id(browser.contents, 'code-import-listing')
    >>> rows = table.tbody('tr')
    >>> names = [extract_text(tr.td) for tr in rows]
    >>> sorted(names)
    [u'a52dec-trunk-3', u'gnome-terminal-trunk-1']

If we click on the code import's name, we go to the page for that
import:

    >>> browser.getLink('gnome-terminal-trunk-1').click()
    >>> browser.url
    'http://code.launchpad.dev/+code-imports/gnome-terminal-trunk-1'

It displays some information about the code import, for example the
review status and the URL of the Subversion branch the import is from:

    >>> extract_text(
    ...     find_tag_by_id(browser.contents, 'review-status'))
    u'Reviewed'
    >>> extract_text(
    ...     find_tag_by_id(browser.contents, 'subversion-url'))
    u'http://svn.example.org/svnroot/gnome-terminal/trunk'

This import has a branch associated to it, so there's a link to the
branch:

    >>> browser.getLink('GNOME Terminal Mainline').url
    'http://code.launchpad.dev/~name12/gnome-terminal/main'

There's a similar page for the other import, which uses CVS:

    >>> browser.getLink('Code Imports').click()
    >>> browser.getLink('a52dec-trunk-3').click()
    >>> browser.url
    'http://code.launchpad.dev/+code-imports/a52dec-trunk-3'
    >>> extract_text(
    ...     find_tag_by_id(browser.contents, 'review-status'))
    u'Pending Review'
    >>> extract_text(
    ...     find_tag_by_id(browser.contents, 'cvs-root'))
    u'cvs.example.org/cvsroot'
    >>> extract_text(
    ...     find_tag_by_id(browser.contents, 'cvs-module'))
    u'a52dec'

If we create a lot of imports, the listing view will be batched.

    >>> from canonical.launchpad.ftests import login, ANONYMOUS, logout
    >>> login(ANONYMOUS)
    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces import ICodeImportSet
    >>> from canonical.lp.dbschema import RevisionControlSystems
    >>> code_import_set = getUtility(ICodeImportSet)
    >>> svn = RevisionControlSystems.SVN
    >>> svn_url = 'svn://svn.example.com/trunk-%s'
    >>> from canonical.launchpad.interfaces import IProductSet
    >>> product = getUtility(IProductSet).get(1)
    >>> for i in range(100):
    ...     new_import = code_import_set.new(
    ...         rcs_type=svn, product=product, series=None,
    ...         name="import-%s"%(i,), svn_branch_url=svn_url%(i,))
    >>> logout()

    >>> browser.open('http://code.launchpad.dev/+code-imports')
    >>> browser.getLink('Next').click()
    >>> browser.url
    'http://code.launchpad.dev/+code-imports/+index?start=50'
