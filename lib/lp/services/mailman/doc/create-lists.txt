======================
Creating mailing lists
======================

When a Launchpad user creates a mailing list for a team, and that mailing list
is approved by a special 'mailing list expert', Mailman will eventually notice
this and create the mailing list itself.

First, No Privileges Person creates a new team.

    >>> browser = Browser('no-priv@canonical.com:test')
    >>> browser.open('http://launchpad.dev:8085/people/+newteam')
    >>> browser.getControl(name='field.name').value = 'itest-one'
    >>> browser.getControl('Display Name').value = 'ITest One'
    >>> browser.getControl(name='field.subscriptionpolicy').displayValue = [
    ...     'Open Team']
    >>> browser.getControl('Create').click()
    >>> browser.title
    'ITest One in Launchpad'

To request a mailing list, No Privileges Person navigates to the 'Configure
mailing list' page and registers their application for a mailing list.

    >>> browser.getLink('Configure mailing list').click()
    >>> browser.getControl('Apply for Mailing List').click()

At this point, Mailman has still not created the mailing list.

    >>> from Mailman.Utils import list_names
    >>> sorted(name for name in list_names() if name.startswith('itest-'))
    []


Approved requests
=================

In order for Mailman to create the mailing list, a Launchpad 'mailing list
expert' must approve the application.  This cannot currently be done through
the web, so we'll go behind the scenes to do this.

    >>> from lp.services.mailman.testing import helpers
    >>> list_one = helpers.review_list('itest-one')
    >>> sorted(name for name in list_names() if name.startswith('itest-'))
    ['itest-one']


Declined requests
=================

Now, No Privileges Person creates another team, and requests a mailing list
for this new team.

    >>> browser.open('http://launchpad.dev:8085/people/+newteam')
    >>> browser.getControl(name='field.name').value = 'itest-two'
    >>> browser.getControl('Display Name').value = 'ITest Two'
    >>> browser.getControl(name='field.subscriptionpolicy').displayValue = [
    ...     'Open Team']
    >>> browser.getControl('Create').click()
    >>> browser.getLink('Configure mailing list').click()
    >>> browser.getControl('Apply for Mailing List').click()

This time, however, the mailing list expert declines the application for a new
mailing list.

    # This will time out because Mailman is never informed of the decline, so
    # nothing gets written to its log files.
    >>> xmlrpc_watcher.expecting_timeout = True
    >>> helpers.review_list('itest-two', 'decline')
    Timed out
    >>> sorted(name for name in list_names() if name.startswith('itest-'))
    ['itest-one']
