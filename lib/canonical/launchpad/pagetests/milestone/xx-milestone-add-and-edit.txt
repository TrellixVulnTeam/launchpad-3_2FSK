= Adding and editing milestones =

== Adding a milestone ==

Let's make Sample Person the owner of Ubuntu and alsa-utils for this
story.

    >>> admin_browser.open('http://launchpad.dev/ubuntu/+reassign')
    >>> admin_browser.getControl(name='field.owner').value = 'name12'
    >>> admin_browser.getControl('Change Registrant').click()

    >>> admin_browser.open('http://launchpad.dev/alsa-utils/+reassign')
    >>> admin_browser.getControl(name='field.owner').value = 'name12'
    >>> admin_browser.getControl('Change Registrant').click()

Milestone creations is restricted to the project owner, or to the series
owner or driver. This means that No Privileges Person won't be able to
see the link to add a milestone nor access the page directly.

    >>> user_browser.open('http://launchpad.dev/alsa-utils/trunk')
    >>> user_browser.getLink('Add milestone').click()
    Traceback (most recent call last):
      ...
    LinkNotFoundError
    >>> user_browser.open(
    ...     'http://launchpad.dev/alsa-utils/trunk/+addmilestone')
    Traceback (most recent call last):
      ...
    Unauthorized: ...

    >>> user_browser.open('http://launchpad.dev/ubuntu/hoary')
    >>> user_browser.getLink('Add milestone').click()
    Traceback (most recent call last):
      ...
    LinkNotFoundError
    >>> user_browser.open('http://launchpad.dev/ubuntu/hoary/+addmilestone')
    Traceback (most recent call last):
      ...
    Unauthorized: ...

But Sample Person will be able to use the 'Add milestone' link to
create a new milestone.

    >>> test_browser = setupBrowser(auth='Basic test@canonical.com:test')
    >>> test_browser.open('http://launchpad.dev/alsa-utils/trunk')
    >>> test_browser.getLink('Add milestone').click()
    >>> test_browser.url
    'http://launchpad.dev/alsa-utils/trunk/+addmilestone'

    >>> test_browser.open('http://launchpad.dev/ubuntu/hoary')
    >>> test_browser.getLink('Add milestone').click()
    >>> test_browser.url
    'http://launchpad.dev/ubuntu/hoary/+addmilestone'


== Duplicate milestone handling ==

Once authorized, let's create 2 milestones!

    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Add').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1

    >>> test_browser.open('http://launchpad.dev/ubuntu/hoary/+addmilestone')
    >>> test_browser.getControl('Name').value = 'milestone2'
    >>> test_browser.getControl('Add').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
    milestone2

Now let's try to create another one named milestone1.

    >>> test_browser.open('http://launchpad.dev/ubuntu/hoary/+addmilestone')
    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Add').click()
    >>> test_browser.url
    'http://launchpad.dev/ubuntu/hoary/+addmilestone'

    >>> for tag in find_tags_by_class(test_browser.contents, 'message'):
    ...     print tag
    <p class="error message">An error occurred.</p>
    <div class="message">The name milestone1 is already used by a milestone
    in Ubuntu.</div>

Edit now...

First we try to change the name of milestone2 to milestone1, which is
already in use.

    >>> test_browser.open(
    ...     'http://launchpad.dev/ubuntu/+milestone/milestone2/+edit')
    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Change').click()
    >>> test_browser.url
    'http://launchpad.dev/ubuntu/+milestone/milestone2/+edit'
    >>> for tag in find_tags_by_class(test_browser.contents, 'message'):
    ...     print tag
    <p class="error message"> There is a problem with the information you
    entered. Please fix it and try again. </p>
    <div class="message">The name milestone1 is already used by a milestone
    in Ubuntu.</div>

Then we try to change milestone2's name to milestone3.

    >>> test_browser.open(
    ...     'http://launchpad.dev/ubuntu/+milestone/milestone2/+edit')
    >>> test_browser.getControl('Name').value = 'milestone3'
    >>> test_browser.getControl('Change').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
    milestone3

Now we do the same for a product instead of a distro.

First we test the +addmilestone page.  

    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/trunk/+addmilestone')

Once authorized, let's create 2 milestones!

    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Add').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
  
    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/trunk/+addmilestone')
    >>> test_browser.getControl('Name').value = 'milestone2'
    >>> test_browser.getControl('Add').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
    milestone2

Now let's try to create another one named milestone1.

    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/trunk/+addmilestone')
    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Add').click()
    >>> test_browser.url
    'http://launchpad.dev/alsa-utils/trunk/+addmilestone'
    >>> for tag in find_tags_by_class(test_browser.contents, 'message'):
    ...     print tag
    <p class="error message">An error occurred.</p>
    <div class="message">The name milestone1 is already used by a milestone
    in alsa-utils.</div>

Edit now...

First we try to change the name of milestone2 to milestone1, wich is
already in use.

    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/+milestone/milestone2/+edit')
    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Change').click()
    >>> test_browser.url
    'http://launchpad.dev/alsa-utils/+milestone/milestone2/+edit'
    >>> for tag in find_tags_by_class(test_browser.contents, 'message'):
    ...     print tag
    <p class="error message"> There is a problem with the information you
    entered. Please fix it and try again. </p>
    <div class="message">The name milestone1 is already used by a milestone
    in alsa-utils.</div>
    
Then we try to change milestone2's name to milestone3.

    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/+milestone/milestone2/+edit')
    >>> test_browser.getControl('Name').value = 'milestone3'
    >>> test_browser.getControl('Change').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
    milestone3

