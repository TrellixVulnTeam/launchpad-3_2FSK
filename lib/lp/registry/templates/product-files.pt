<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="launchpad"
>

<h1 metal:fill-slot="heading">
  Download project files
</h1>

<body>

<div metal:fill-slot="main"
     tal:define="has_edit context/required:launchpad.Edit">

  <p tal:condition="view/has_download_files">
    <a
    href="/+help/verify-downloads.html" target="help">How do I verify a
    download?</a>
  </p>
  <br />

  <form id="project-downloads" method="POST"
        tal:attributes="action request/URL">

    <div tal:condition="not: view/has_download_files" id="no-downloads">
      <p>No download files exist for this project.</p>
      <p>You might want to check
        <a tal:attributes="href context/fmt:url:code">this project's Bazaar
          branches</a>
        <span tal:condition="context/homepageurl">or its
          <a tal:attributes="href context/homepageurl">home page</a>
        </span>.
      </p>
    </div>

    <div
      tal:repeat="series view/sorted_series_list"
      tal:attributes="id string:series_${series/name}">

      <div tal:condition="not: repeat/series/start" class="portlet-border" />

      <tal:seriesfilesexist condition="series/has_release_files">
        <tal:releases repeat="release series/releases">
          <div tal:condition="not: repeat/release/start" class="portlet-border" />
          <div tal:condition="release/files" class="top-portlet">
            <h2 style="font-size: 1.2em; float:left;">
              <a tal:attributes="href release/fmt:url">
                <span tal:replace="release/name_with_codename" /> release</a>
              from the
              <a tal:attributes="href series/fmt:url"
                 tal:content="series/name">name</a> series released
              <span
                 tal:attributes="title release/datereleased/fmt:datetime"
                 tal:content="release/datereleased/fmt:approximatedate" />
            </h2>

            <div style="clear:both;" />

            <div id="release_information"
               tal:condition="python: release.release_notes or release.changelog">

              <fieldset class="collapsible collapsed" style="padding: 0px;">
                <legend>Release information</legend>

                <div tal:condition="release/release_notes">
                  <strong>Release notes:</strong>
                  <div id="release_notes" style="margin-bottom: 0px;"
                       tal:define="notes release/release_notes/fmt:shorten/800"
                       tal:content="structure notes/fmt:text-to-html">
                    ProductRelease.release_notes
                  </div>
                </div>

                <div tal:condition="release/changelog">
                  <strong>Changelog:</strong>
                  <div id="changelog" style="margin-bottom: 0px;"
                       tal:content="structure release/changelog/fmt:obfuscate-email/fmt:text-to-html">
                    ProductRelease.changelog.
                  </div>
                </div>
              </fieldset>
            </div> <!-- release information -->

            <table class="listing" style="margin-top: 1em;">
              <thead>
                <tr>
                  <th width="35%">File</th>
                  <th width="45%">Description</th>
                  <th>Downloads</th>
                  <th tal:condition="has_edit">Delete</th>
                </tr>
              </thead>
              <tbody>
                <tr tal:repeat="file release/files">
                  <tal:define-vars
                    tal:define="checkbox_index string:${repeat/series/index}_${repeat/release/index}_${repeat/file/index}">
                    <tal:release-file
                      metal:use-macro="file/@@+macros/detailed_display" />
                  </tal:define-vars>
                </tr>
              </tbody>
              <tfoot tal:condition="release/total_downloads">
                <tr>
                  <th colspan="2" style="padding-top: 1em; text-align: right;">
                    Total downloads:
                  </th>
                  <td style="border: none; text-align: center;">
                    <span tal:replace="release/total_downloads/fmt:intcomma" />
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
          <div tal:condition="not: release/total_downloads"
               style="margin-top: 2em;">
          </div>

          <div style="float:right"
               tal:define="link release/menu:context/add_file"
               tal:condition="link/enabled">
            <a tal:replace="structure link/fmt:link" />
          </div>
          <div style="clear:both" />
        </tal:releases>
        <br />

      </tal:seriesfilesexist>

    </div>
    <input tal:condition="python: has_edit and view.has_download_files"
        type="submit"
        name="delete_files"
        value="Delete Files" />

  </form>
</div>
</body>
</html>
