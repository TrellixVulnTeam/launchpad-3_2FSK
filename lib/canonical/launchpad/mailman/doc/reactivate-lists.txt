= Re-activating mailing lists =

A team administrator may re-activate a previously deactivated mailing list
without the need for approval from a Launchpad administrator.  When the
mailing list is re-activated, all previous settings and subscriptions are
restored.

First, No Privileges Person will create a new team and its mailing list.

    >>> browser = Browser('no-priv@canonical.com:test')
    >>> browser.open('http://launchpad.dev/people/+newteam')
    >>> browser.getControl(name='field.name').value = 'itest-one'
    >>> browser.getControl('Display Name').value = 'ITest One'
    >>> browser.getControl(name='field.subscriptionpolicy').displayValue = [
    ...     'Open Team']
    >>> browser.getControl('Create').click()
    >>> browser.getLink('Configure mailing list').click()
    >>> browser.getControl('Apply for Mailing List').click()

    >>> from canonical.launchpad.mailman.testing import helpers
    >>> from Mailman.Utils import list_names
    >>> list_one = helpers.review_list('itest-one')
    >>> sorted(name for name in list_names() if name.startswith('itest-'))
    ['itest-one']

Give the mailing list a welcome message.

    >>> browser.open('http://launchpad.dev/~itest-one/+mailinglist')
    >>> browser.getControl('Welcome message text').value = (
    ...     'Greetings team one members!')

    >>> from canonical.launchpad.mailman.testing import logwatcher
    >>> serial_watcher = logwatcher.LogWatcher('serial')
    >>> browser.getControl('Save').click()
    >>> serial_watcher.wait()

    >>> from Mailman.MailList import MailList
    >>> mlist = MailList('itest-one', lock=False)
    >>> mlist.welcome_msg
    'Greetings team one members!'

Subscribe Anne to the mailing list so that she can post to after
re-activation.

    # For convenience, don't do this through the web.
    >>> import transaction
    >>> from canonical.launchpad.ftests.mailinglists_helper import new_person
    >>> from canonical.launchpad.ftests import login, logout
    >>> login('foo.bar@canonical.com')
    >>> anne = new_person('Anne')
    >>> from canonical.launchpad.interfaces import IPersonSet
    >>> from zope.component import getUtility
    >>> team_one = getUtility(IPersonSet).getByName('itest-one')
    >>> anne.join(team_one)
    >>> from canonical.launchpad.ftests import sync
    >>> sync(list_one)
    >>> list_one.subscribe(anne)
    >>> logout()
    >>> serial_watcher.resync()
    >>> transaction.commit()
    >>> serial_watcher.wait()
    >>> mlist.Load()
    >>> sorted(mlist.getMembers())
    ['anne.person@example.com', 'aperson@example.org',
     'archive@mail-archive.dev']

Now the team owner deactivates the list.

    >>> serial_watcher.resync()
    >>> browser.getLink('Configure mailing list').click()
    >>> browser.getControl('Deactivate this Mailing List').click()
    >>> serial_watcher.wait()

As far as Mailman is concerned, the mailing list no longer exists.

    >>> sorted(name for name in list_names() if name.startswith('itest-'))
    []

Now the team owner reactivates the list.

    >>> browser.getLink('Configure mailing list').click()
    >>> serial_watcher.resync()
    >>> browser.getControl('Reactivate this Mailing List').click()
    >>> serial_watcher.wait()

Mailman reports that the mailing list exists again.

    >>> sorted(name for name in list_names() if name.startswith('itest-'))
    ['itest-one']

The archive file has been removed.

    >>> from Mailman import mm_cfg
    >>> import os
    >>> backup_file = os.path.join(mm_cfg.VAR_PREFIX,
    ...                            'backups', 'itest-one.tgz')
    >>> os.path.exists(backup_file)
    False

On the Mailman side, the mailing list has the expected welcome message.

    >>> mlist.Load()
    >>> mlist.welcome_msg
    'Greetings team one members!'

Anne is a member of the re-activated mailing list, just as she was before the
list was deactivated.

    >>> sorted(mlist.getMembers())
    ['anne.person@example.com', 'aperson@example.org',
     'archive@mail-archive.dev']
