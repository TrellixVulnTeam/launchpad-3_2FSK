= View to export Vocabularies as  JSON =

This view provides a simple means for AJAX widgets to retrieve vocabulary
entries until vocabularies are integrated into the REST API.

    >>> from canonical.launchpad.interfaces.launchpad import ILaunchpadRoot
    >>> import simplejson
    >>> from urllib import urlencode
    >>> root = getUtility(ILaunchpadRoot)
    >>> def print_json(json):
    ...     data = simplejson.loads(json)
    ...     print simplejson.dumps(data, sort_keys=True, indent=4)
    >>> def create_vocabulary_view(form):
    ...     # The BatchNavigator looks in the query string for GET requests.
    ...     query_string = urlencode(form)
    ...     return create_view(root, '+huge-vocabulary',
    ...                        form=form, query_string=query_string)

The view requires the name of the vocabulary.

    >>> view = create_vocabulary_view({})
    >>> print_json(view())
    Traceback (most recent call last):
    ...
    MissingInputError: ('name', '', None)

Since it is exporting huge vocabularies, it requires a search term.

    >>> form = dict(name='ValidPerson')
    >>> view = create_vocabulary_view(form)
    >>> print_json(view())
    Traceback (most recent call last):
    ...
    MissingInputError: ('search_text', '', None)

The name must be a valid vocabulary.

    >>> form = dict(name='invalid-vocabulary', search_text='foo')
    >>> view = create_vocabulary_view(form)
    >>> print_json(view())
    Traceback (most recent call last):
    ...
    ComponentLookupError: (<...IVocabularyFactory>, 'invalid-vocabulary')

A successful search.

    >>> form = dict(name='ValidPersonOrTeam', search_text='guadamen')
    >>> view = create_vocabulary_view(form)
    >>> print_json(view())
    {
        "entries": [
            {
                "api_uri": "/~guadamen",
                "css": "sprite team",
                "title": "GuadaMen",
                "value": "guadamen"
            }
        ],
        "total_size": 1
    }

Multiple entries.

    >>> form = dict(name='ValidPersonOrTeam', search_text='admin')
    >>> view = create_vocabulary_view(form)
    >>> result = simplejson.loads(view())
    >>> result['total_size']
    7
    >>> len(result['entries'])
    5

Size and offset parameters can be passed in to switch between batches.

    >>> form = dict(name='ValidPersonOrTeam', search_text='admin',
    ...             start='0', batch='1')
    >>> view = create_vocabulary_view(form)
    >>> print_json(view())
    {
        "entries": [
            {
                "api_uri": "/~commercial-admins",
                "css": "sprite team",
                "title": "Commercial Subscription Admins",
                "value": "commercial-admins"
            }
        ],
        "total_size": 7
    }

    >>> form = dict(name='ValidPersonOrTeam', search_text='admin',
    ...             start='1', batch='1')
    >>> view = create_vocabulary_view(form)
    >>> print_json(view())
    {
        "entries": [
            {
                "api_uri": "/~name16",
                "css": "sprite person",
                "description": "foo.bar@canonical.com",
                "title": "Foo Bar",
                "value": "name16"
            }
        ],
        "total_size": 7
    }

Long descriptions will be truncated.

    >>> form = dict(name='Project', search_text='apache')
    >>> view = create_vocabulary_view(form)
    >>> print_json(view())
    {
        "entries": [
            {
                "api_uri": "/apache",
                "css": "sprite project",
                "description": "The Apache projects are characterized by a
                                collaborative, consensus based dev...",
                "title": "Apache",
                "value": "apache"
            }
        ],
        "total_size": 1
    }
