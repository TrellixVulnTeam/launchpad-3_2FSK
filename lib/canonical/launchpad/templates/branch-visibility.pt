<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

<metal:leftportlets fill-slot="portlets_one">
</metal:leftportlets>

<metal:rightportlets fill-slot="portlets_two">
  <div tal:replace="structure context/@@+portlet-details" />
  <div tal:condition="context/project | nothing"
       tal:replace="structure context/project/@@+portlet-details" />
</metal:rightportlets>

<div metal:fill-slot="main">

  <h1>Branch visibility policy</h1>

  <p tal:condition="view/policy/isUsingInheritedPolicy" 
     id="inherited">
    Using inherted policy from
    <strong>
      <a tal:attributes="href view/policy/inherited_policy/context/fmt:url"
         tal:content="view/policy/inherited_policy/context/displayname">
        Project</a></strong>.
  </p>

  <div id="policy-items">
  <p id="default-policy">
    Default branch visibility for all branches in
    <strong tal:content="context/displayname">Project</strong>
    is <strong tal:content="view/default_policy/title">Public</strong>.
  </p>

  <tal:has-policies condition="view/team_policies">
    <p>Except for the following teams:
    </p>
    <ul id="team-policies">
      <li tal:repeat="item view/team_policies">
        <tal:team replace="item/team/displayname"
                  condition="item/team">Team Name</tal:team>:
        <tal:team condition="not: item/team">Everyone</tal:team>
        <tal:policy replace="item/policy/title">Public</tal:policy>
      </li>
    </ul>

  </tal:has-policies>
  </div>

  <div style="padding-left: 1em" id="policy-actions">
  <tal:using-inhertied-policy condition="view/policy/isUsingInheritedPolicy">
      <p>
        <img src="/@@/edit" alt="edit" />
        <a tal:define="inherited_url view/policy/inherited_policy/context/fmt:url"
            tal:attributes="href string:${inherited_url}/+branchvisibility">
          Edit inherited policy
        </a>
      </p>
      <p>
        <img src="/@@/add" alt="add" />
        <a href="+addbranchvisibilitypolicy">Customise policy for
          <tal:displayname replace="context/displayname">Project
          </tal:displayname>
        </a>
      </p>
  </tal:using-inhertied-policy>

  <tal:no-inhertied-policy condition="not: view/policy/isUsingInheritedPolicy">
      <p>
        <img src="/@@/add" alt="add" />
        <a href="+addbranchvisibilitypolicy">Set policy for a team</a>
      </p>

      <tal:can-remove condition="view/can_remove_items">
        <p>
          <img src="/@@/remove" alt="remove" />
          <a href="+removebranchvisibilitypolicy">Remove policy items</a>
        </p>
      </tal:can-remove>

  </tal:no-inhertied-policy>
  </div>

  <p>NOTE: Changing the branch visibility policies for teams does not change
  the visibility of any existing branches.</p>

</div>

</body>
</html>
