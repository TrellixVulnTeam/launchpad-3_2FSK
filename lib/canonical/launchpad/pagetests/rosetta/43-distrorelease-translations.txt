= Translations for DistroSeries =

First, we need to ensure that we can see the distroseries translations
page, and that it has all the data we are expecting, in terms of languages.

  >>> browser.open('http://translations.launchpad.dev/ubuntu/hoary/'
  ...     '+translations')
  >>> 'Translation status by language' in browser.contents
  True
  >>> print browser.getLink('Catalan').url
  http://translations.launchpad.dev/ubuntu/hoary/+lang/ca
  >>> print browser.getLink('Xhosa').url
  http://translations.launchpad.dev/ubuntu/hoary/+lang/xh
  >>> browser.getLink('Afrihili')
  Traceback (most recent call last):
  ...
  LinkNotFoundError

We also should see any personal language that is not already translated, but
which is in the personal pref list. In this example, we tell the system that
our browser speaks Afrihili, and since the user is anonymous the system will
put Afrihili into the list of "preferred languages".

  >>> browser.addHeader('Accept-Language', 'en-us,en;q=0.7,afh;q=0.3')
  >>> browser.open('http://translations.launchpad.dev/ubuntu/hoary/'
  ...     '+translations')
  >>> 'Translation status by language' in browser.contents
  True
  >>> print browser.getLink('Catalan').url
  http://translations.launchpad.dev/ubuntu/hoary/+lang/ca
  >>> print browser.getLink('Xhosa').url
  http://translations.launchpad.dev/ubuntu/hoary/+lang/xh
  >>> print browser.getLink('Afrihili').url
  http://translations.launchpad.dev/ubuntu/hoary/+lang/afh

If we select Croatian, we would expect to see the list of source package
templates, and in the sample data we should have a croatian pofile for
pmount. Note that we should also have an empty pofile (really a dummy
pofile) for evolution-2.2

  >>> browser.open(
  ...     'http://translations.launchpad.dev/ubuntu/hoary/+lang/hr?batch=2')
  >>> 'Croatian' in browser.contents
  True
  >>> 'Programs you can translate' in browser.contents
  True
  >>> print browser.getLink('evolution-2.2').url
  http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/hr/+translate
  >>> print browser.getLink('man').url
  http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/man/hr/+translate

pmount and pkgconf-mozilla are not in this page, because it belongs to the next batch.

  >>> browser.getLink('pkgconf-mozilla')
  Traceback (most recent call last):
  ...
  LinkNotFoundError
  >>> browser.getLink('pmount')
  Traceback (most recent call last):
  ...
  LinkNotFoundError

Let's go to next page.

  >>> browser.getLink('Next').click()

Now, we have the other man and pkgconf-mozilla:

  >>> print browser.getLink('man').url
  http://translations.launchpad.dev/ubuntu/hoary/+source/pmount/+pots/man/hr/+translate
  >>> print browser.getLink('pkgconf-mozilla').url
  http://translations.launchpad.dev/ubuntu/hoary/+source/mozilla/+pots/pkgconf-mozilla/hr/+translate

Let's go to next page.

  >>> browser.getLink('Next').click()

And finally, we will get pmount.

  >>> print browser.getLink('pmount').url
  http://translations.launchpad.dev/ubuntu/hoary/+source/pmount/+pots/pmount/hr/+translate

With its latest translator.

  >>> 'Edgar Bursic' in browser.contents
  True

== Last translator ==

When there's no reviewer and date of review on a last touched PO message
inside a PO file (for example, when it was uploaded from the package), the
last translator is displayed.

  >>> browser.open('http://translations.launchpad.dev/ubuntu/hoary/+lang/de')
  >>> print extract_text(
  ...     find_tag_by_id(browser.contents, "pkgconf-mozilla-time"))
  2005-05-06
  >>> print extract_text(
  ...     find_tag_by_id(browser.contents, "pkgconf-mozilla-person"))
  Helge Kreutzmann

== DummyPOFile ==

There are no translations yet for pmount into Portuguese. Carlos has
decided to start contributing translations to that package.

  >>> browser = setupBrowser(auth='Basic carlos@canonical.com:test')
  >>> browser.open(
  ...     'http://translations.launchpad.dev/ubuntu/hoary/+source/pmount/'
  ...     '+pots/pmount/pt_BR/+translate')

Then he decides that he only wants to filter on untranslated entries (he's
not aware that this translation is actually empty, i.e. there is no such PO
file):

  >>> browser.getControl(name='show', index=1).value = ['untranslated']
  >>> browser.getControl('Filter').click()
  >>> print browser.url
  http://translations.launchpad.dev/ubuntu/hoary/+source/pmount/+pots/pmount/pt_BR/+translate?batch=10&show=untranslated
  >>> '10.' in browser.contents
  True

If everything works out ok, that means that DummyPOFile has actually
returned all untranslated entries.

Now, lets also check that fuzzy entries show up as well.

  >>> browser.getControl(name='show', index=1).value = ['need_review']
  >>> browser.getControl('Filter').click()
  >>> print browser.url
  http://translations.launchpad.dev/ubuntu/hoary/+source/pmount/+pots/pmount/pt_BR/+translate?batch=10&show=need_review
  >>> "There are no messages that match this filtering." in browser.contents
  True

Finally, lets also check that translated entries show up as well.

  >>> browser.getControl(name='show', index=1).value = ['translated']
  >>> browser.getControl('Filter').click()
  >>> print browser.url
  http://translations.launchpad.dev/ubuntu/hoary/+source/pmount/+pots/pmount/pt_BR/+translate?batch=10&show=translated
  >>> "There are no messages that match this filtering." in browser.contents
  True

== Links to filtered pages ==

The DistroRelease per-language overview page shows different statistics:
a count of untranslated messages, messages with new, unreviewed suggestions,
and a count of messages which had their imported translations changed in
Launchpad.

Looking at the Spanish language overview page, we can see that there are
15 untranslated, 1 unreviewed and 1 changed in LP Evolution translations
(all numbers repeated as hidden 'sortkey' values).

    >>> browser.open('http://translations.launchpad.dev/ubuntu/hoary/+lang/es')
    >>> evolution_line = find_tag_by_id(browser.contents, 'evolution-2.2')
    >>> print extract_text(evolution_line)
    evolution-2.2
    ...
    15 1 1
    ...

The template title points to the general translate page:

    # We are not using browser.getLink because there is no unique way to
    # get all of the relevant links, and we don't want to pollute the
    # page template with too many IDs useful only for testing.
    >>> all_links = evolution_line.findAll('a')
    >>> base_href = browser.url
    >>> unfiltered = all_links[0]
    >>> print extract_text(unfiltered)
    evolution-2.2
    >>> print extract_link_from_tag(unfiltered, base_href)
    http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate

The number of untranslated entries points to the same page, which now show
only untranslated items. When we follow this link, the filtering combo box
has the right filter preselected.

    >>> untranslated = all_links[1]
    >>> print extract_text(untranslated)
    15
    >>> untranslated_link = extract_link_from_tag(untranslated, base_href)
    >>> browser.open(untranslated_link.encode('UTF-8'))
    >>> browser.url
    'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=untranslated'
    >>> print browser.getControl(name='show', index=1).value
    ['untranslated']

Similarly, the number of unreviewed entries points to the translation page
with the 'with new suggestions' filter selected.

    >>> unreviewed = all_links[2]
    >>> print extract_text(unreviewed)
    1
    >>> unreviewed_link = extract_link_from_tag(unreviewed, base_href)
    >>> browser.open(unreviewed_link.encode('UTF-8'))
    >>> browser.url
    'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=new_suggestions'
    >>> print browser.getControl(name='show', index=1).value
    ['new_suggestions']

The number of updated entries points to the translation page with the
'changed in Launchpad' filter selected.

    >>> updated = all_links[3]
    >>> print extract_text(updated)
    1
    >>> updated_link = extract_link_from_tag(updated, base_href)
    >>> browser.open(updated_link.encode('UTF-8'))
    >>> browser.url
    'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=changed_in_launchpad'
    >>> print browser.getControl(name='show', index=1).value
    ['changed_in_launchpad']
