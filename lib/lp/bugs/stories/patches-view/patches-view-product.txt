We have a view listing patches attached to bugs that target a given
product.  At first, the product is new and has no bugs.

    >>> def make_thing(factory_method, **thing_args):
    ...    login('foo.bar@canonical.com')
    ...    result = factory_method(**thing_args)
    ...    transaction.commit()
    ...    logout()
    ...    return result

    >>> product1 = make_thing(factory.makeProduct, name='patchy-product-1')

We don't see any patches when we open the patches view.

    >>> def show_patches_view(expected_contents):
    ...     for tag in find_tags_by_class(
    ...         expected_contents, 'listing'):
    ...         print extract_text(tag)

    >>> user_browser.open('http://bugs.launchpad.dev/patchy-product-1/+patches')
    >>> show_patches_view(user_browser.contents)
    Bug Importance Status Patch Age

After the product has a bug, it still doesn't show up in the patches
view, because that bug has no patch attachments.

    >>> bug1 = make_thing(
    ...     factory.makeBug, title="bug1 title", product=product1)
    >>> user_browser.open('http://bugs.launchpad.dev/patchy-product-1/+patches')
    >>> show_patches_view(user_browser.contents)
    Bug Importance Status Patch Age

After we add a non-patch attachment to that bug, the patches view
still shows no patches.

    >>> non_patch_attachment = make_thing(factory.makeBugAttachment, bug=bug1)
    >>> user_browser.open('http://bugs.launchpad.dev/patchy-product-1/+patches')
    >>> show_patches_view(user_browser.contents)
    Bug Importance Status Patch Age

After we add a patch attachment that's one day old, we should see it
in the patches view.

    >>> patch_submitter = make_thing(
    ...    factory.makePerson, name="patchy-person",
    ...    displayname="Patchy Person")
    >>> patch_attachment = make_thing(factory.makeBugAttachment,
    ...                               comment="comment about patch",
    ...                               filename="patch1.diff",
    ...                               owner=patch_submitter,
    ...                               description="description of patch",
    ...                               bug=bug1, is_patch=True)
    >>> 
    >>> user_browser.open('http://bugs.launchpad.dev/patchy-product-1/+patches')
    >>> show_patches_view(user_browser.contents)
    Bug                                 Importance   Status    Patch Age
    Bug #16: bug1 title                  Undecided     New     ...second...
    From: Patchy Person
    Link: patch1.diff description of patch
