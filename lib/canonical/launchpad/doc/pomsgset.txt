POMsgSet
========

A POMsgSet represents a concrete msgset translation from a POFile.

It's linked with a POTMsgSet that has the English strings that are being
translated.

Get the PO msgid we will be working with.

  >>> from canonical.launchpad.database import POMsgSet, POMsgID, Language
  >>> from canonical.launchpad.database import POTemplate
  >>> pomsgid = POMsgID.byMsgid('evolution addressbook')

Carlos is the one that will do the uploads.

  >>> from zope.component import getUtility
  >>> from canonical.launchpad.interfaces import IPersonSet
  >>> carlos = getUtility(IPersonSet).getByName('carlos')

Now find the po template.

  >>> upstream_evo = POTemplate.get(1)
  >>> upstream_evo.productseries is not None
  True

  >>> upstream_evo.productseries.product.name
  u'evolution'

We will be working in Catalan (ca).

We need the right POMsgSet. We'll get the PO File, then, create the needed
po msgset there.

  >>> upstream_pofile = upstream_evo.getOrCreatePOFile('ca')
  >>> upstream_pomsgset = upstream_pofile.createMessageSetFromText(
  ...     u'evolution addressbook')

Show that there are no active translations and no suggestions.

  >>> upstream_pomsgset.active_texts
  [None]
  >>> upstream_pomsgset.published_texts
  [None]
  >>> list(upstream_pomsgset.getSuggestedSubmissions(0))
  []

And the fuzzy flags should also be disabled

  >>> upstream_pomsgset.isfuzzy
  False
  >>> upstream_pomsgset.publishedfuzzy
  False

Let's add a fuzzy translation.

  >>> upstream_pomsgset.updateTranslationSet(carlos, { 0: u'foo' }, fuzzy=True, published=True)

Now it should appear as active and as published.

  >>> upstream_pomsgset.active_texts
  [u'foo']
  >>> upstream_pomsgset.published_texts
  [u'foo']

And also, the fuzzy flag should be set in both cases.

  >>> upstream_pomsgset.isfuzzy
  True
  >>> upstream_pomsgset.publishedfuzzy
  True

Now let's think that upstream removed that translation completely...

  >>> upstream_pomsgset.updateTranslationSet(carlos, { 0: ''}, fuzzy=False, published=True)

The active text should still have it as we never remove anything from Rosetta if upstream does it

  >>> upstream_pomsgset.active_texts
  [u'foo']

But the published one should disapper

  >>> upstream_pomsgset.published_texts
  [None]

And same with the fuzzy flags.

  >>> upstream_pomsgset.isfuzzy
  True
  >>> upstream_pomsgset.publishedfuzzy
  False
