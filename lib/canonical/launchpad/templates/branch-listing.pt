<div
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
>
  <form method="get" name="filter" id="filter_form"
        style="padding-bottom: 0.5em"
        tal:attributes="action context/request/URL">
    <label for="field.lifecycle">
      Branches with status:
    </label>
    <tal:lifecycle-selector replace="structure context/view/widgets/lifecycle"/>
    <tal:sort-by replace="structure context/view/widgets/sort_by"
                 condition="context/view/widgets/sort_by|nothing"/>
    <label tal:attributes="for context/view/widgets/hide_dormant/name"
           tal:condition="context/view/widgets/hide_dormant|nothing"
           style="font-weight: normal">
      <tal:hide-dormant replace="structure context/view/widgets/hide_dormant"/>
      Hide dormant branches
    </label>
    <noscript>
      <input type="submit" value="Filter"/>
    </noscript>
  </form>

<script type="text/javascript">
function submit_filter() {
  getElement('filter_form').submit();
}

function hookUpFilterSubmission () {
  connect('field.lifecycle', 'onchange', submit_filter);
  if (getElement('field.sort_by')) {
    connect('field.sort_by', 'onchange', submit_filter);
  }
  if (getElement('field.hide_dormant')) {
    connect('field.hide_dormant', 'onchange', submit_filter);
  }
}
function show_commit(id) {
  var div = document.getElementById('branch-log-' + id);
  if (div) {
    div.style.display = "block";
  }
}
function hide_commit(id) {
  var div = document.getElementById('branch-log-' + id);
  if (div) {
    div.style.display = "none";
  }
}
registerLaunchpadFunction(hookUpFilterSubmission);
</script>

  <tal:needs-batch condition="context/multiple_pages">
    <div id="branch-batch-links">
      <tal:navigation replace="structure context/@@+navigation-links-upper" />
    </div>
  </tal:needs-batch>

  <table tal:attributes="class context/table_class" id="branchtable">
    <thead>
      <tr>
        <th colspan="2">Name</th>
        <th>Status</th>
        <th tal:condition="context/show_column/date_created|nothing">
          Registered
        </th>
        <th tal:condition="context/show_column/product|nothing">
          Project
        </th>
        <th>Last Commit</th>
      </tr>
    </thead>
    <tbody>
      <tr tal:repeat="branch context/branches"
          tal:attributes="
              class python:branch.is_development_focus and 'highlighted' or 'unhighlighted'">
        <td>
          <a tal:attributes="href branch/fmt:url;
                             title branch/displayname"
             tal:content="branch/unique_name">
               Name
          </a>
          <em tal:condition="branch/is_development_focus">&nbsp;Current development focus</em>
        </td>
        <td align="right" style="padding-right: 5px">
          <tal:badges replace="structure branch/badges:small"/>
        </td>
        <td>
          <span tal:condition="not:context/multiple_pages"
                tal:content="branch/lifecycle_status/sortkey"
                class="sortkey">23</span>
          <span tal:content="branch/lifecycle_status/title"
                tal:attributes="
                  class string:branchstatus${branch/lifecycle_status/name}">
                  Status</span>
        </td>
        <td tal:condition="context/show_column/date_created|nothing">
          <span class="sortkey"
                tal:content="branch/date_created/fmt:datetime">
            2005-02-12 13:45 EST
          </span>
          <span tal:attributes="title branch/date_created/fmt:datetime"
                tal:content="branch/since_created/fmt:approximateduration">
            sometime
            </span> ago
        </td>
        <td tal:condition="context/show_column/product|nothing">
          <a tal:condition="branch/product"
             tal:attributes="href branch/product/fmt:url"
             tal:content="branch/product/name">
               Project
          </a>
        </td>

        <tal:no_commit condition="not: branch/last_commit">
          <tal:comment condition="nothing">
            In order to keep column sorting, just have the
            message in the last column.
          </tal:comment>
          <td>
            <em>
              <metal:no-revision-message
                use-macro="branch/@@+macros/no-revision-message" />
            </em>
          </td>
        </tal:no_commit>

        <tal:has_commit condition="branch/last_commit">
          <td tal:attributes="onmouseover string:show_commit(${branch/id});
                              onmouseout string:hide_commit(${branch/id});">
            <span class="sortkey"
                  tal:content="branch/revision_date/fmt:datetime">
              2005-02-12 13:45 EST
            </span>
            <tal:comment replace="nothing">
              sabdfl - let's keep the approximateduration here rather than
              using the standard approximatedate
            </tal:comment>
            <div class="lastCommit">
              <tal:browsable-code condition="not: branch/private">
                <a tal:attributes="href branch/revision_codebrowse_link"
                   tal:content="branch/revision_count">1234</a>.
              </tal:browsable-code>
              <tal:not-browsable-code condition="branch/private"
                                      replace="branch/revision_count">
                1243
              </tal:not-browsable-code>
              <span tal:attributes="title branch/revision_date/fmt:datetime"
                    tal:content="branch/elapsed_time/fmt:approximateduration">
                sometime</span> ago by
              <tal:known-person condition="branch/revision_author/person">
                <tal:person-link
                    replace="structure branch/revision_author/person/fmt:link"/>
              </tal:known-person>
              <tal:unknown-person
                  condition="not: branch/revision_author/person">
                <strong>
                  <tal:person-text
                      tal:replace="branch/revision_author/name_without_email">
                    John Doe
                  </tal:person-text>
                  <tal:person-only-email
                      condition="not: branch/revision_author/name_without_email">
                    <tal:not-anonymous condition="context/view/user">
                      <tal:person-text
                          tal:replace="branch/revision_author/email">
                        doe.john@example.com
                      </tal:person-text>
                    </tal:not-anonymous>
                    <tal:anonymous condition="not:context/view/user">
                      &lt;email address hidden&gt;
                    </tal:anonymous>
                  </tal:person-only-email>
                </strong>
              </tal:unknown-person>
              <tal:revision-log replace="branch/revision_log/fmt:shorten/40"/>
            </div>
            <div class="popupTitle"
                 tal:attributes="id string:branch-log-${branch/id};
                                 onmouseover string:hide_commit(${branch/id});"
                 tal:content="structure branch/revision_log/fmt:text-to-html">
            </div>
          </td>
        </tal:has_commit>
      </tr>
      <tr tal:condition="not:context/batch/total">
        <td tal:attributes="colspan context/column_count">
          <div id="no-branch-message"
               tal:content="structure context/view/no_branch_message" />
        </td>
      </tr>
    </tbody>
  </table>

  <tal:navigation replace="structure context/@@+navigation-links-lower" />

</div>
