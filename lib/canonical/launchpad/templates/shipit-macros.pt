<metal:quantity_widgets define-macro="quantity_widgets">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:

    :widgets_matrix: A matrix in which each row contains a ShipItFlavour and
                     one quantity widget for each ShipItArchitecture that we
                     ship CDs. These widgets should always be ordered according
                     to their architectures, and the order should be 
                     the same as in view/ordered_architectures.

    :view/ordered_architectures: A list of ShipItArchitecture objects in the
                                 order they should be diplayed in the UI.
  </tal:comment>

  <table tal:attributes="cols view/ordered_architectures/count:len"
         style="width: auto; margin-left: 0">
    <tr>
      <thead>
        <th>&nbsp;</th>
        <tal:headers repeat="arch view/ordered_architectures">
          <th tal:content="arch/title" />
        </tal:headers>
      </thead>
    </tr>
    <tr tal:repeat="row widgets_matrix">
      <tal:block repeat="cell row">
      <tal:comment replace="nothing">
        We need to save the widget with this nocall: here because if we
        don't do that, our dear zope will turn it into a string for us.
      </tal:comment>
      <tal:save-widget define="widget nocall:cell">

        <tal:is-header condition="repeat/cell/start">
          <th tal:content="cell" />
        </tal:is-header>
        <tal:is-not-header condition="not: repeat/cell/start">
          <td style="text-align: center">
            <tal:block condition="cell">
              <span metal:use-macro="context/@@+shipit-macros/display_raw_widget" />
            </tal:block>
            <span tal:condition="not: cell">n/a</span>
          </td>
        </tal:is-not-header>

      </tal:save-widget>
      </tal:block>
    </tr>
  </table>

</metal:quantity_widgets>


<metal:display_widget define-macro="display_widget">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
        :widget: The widget that's going to be rendered.
  </tal:comment>

  <th>
    <label
      tal:condition="widget/label"
      tal:attributes="for widget/name"
      tal:content="string:${widget/label}:"
    >Label:</label>
  </th>
  <td>
    <span metal:use-macro="context/@@+shipit-macros/display_raw_widget" />
  </td>
</metal:display_widget>


<metal:display_raw_widget define-macro="display_raw_widget">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
        :widget: The widget that's going to be rendered.
  </tal:comment>

  <div tal:attributes="class python:error and 'error' or None"
       tal:define="error widget/error">
    <span tal:replace="structure widget" />
    <span tal:condition="widget/required"
          class="fieldRequired"
          title="Required">(Required)</span>
    <div tal:condition="error" tal:content="structure error" />
  </div>
</metal:display_raw_widget>


<metal:shipping_details define-macro="shipping_details">
  <tal:comment replace="nothing">
    This macro expects the view to have the following widgets:
      recipientdisplayname_widget
      organization_widget
      addressline1_widget
      addressline2_widget
      city_widget
      province_widget
      postcode_widget
      country_widget
      phone_widget
  </tal:comment>

    <tr>
      <tal:block tal:define="widget nocall:view/recipientdisplayname_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/organization_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/addressline1_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/addressline2_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/city_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/province_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/postcode_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/country_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
    <tr>
      <tal:block tal:define="widget nocall:view/phone_widget">
        <span metal:use-macro="context/@@+shipit-macros/display_widget" />
      </tal:block>
    </tr>
</metal:shipping_details>


<metal:previous_requests define-macro="previous_requests">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
        :user: The logged in user.
  </tal:comment>

  <ul>
    <li tal:repeat="pastorder user/pastShipItRequests">
      <span tal:replace="pastorder/getTotalCDs" /> CDs requested in
      <span tal:replace="pastorder/daterequested/fmt:date" />.
      <span tal:condition="pastorder/cancelled">This request was
        cancelled, so no CDs were shipped.</span>
      <tal:notcancelled tal:condition="not: pastorder/cancelled">
        <tal:shipped condition="pastorder/shipment">
          <span tal:replace="pastorder/getTotalApprovedCDs" />
          CDs approved and sent to the shipping company in
          <span tal:replace="pastorder/shipment/shippingrun/datecreated/fmt:date" />.
          <strong>Please note requests usually take from 4 to 6 weeks to
            deliver, depending on the country of shipping.</strong>
        </tal:shipped>
        <tal:not-shipped condition="not: pastorder/shipment">
          <span tal:condition="pastorder/isDenied">This request was
            not approved, so no CDs were shipped.</span>
        </tal:not-shipped>
      </tal:notcancelled>
    </li>
  </ul>
</metal:previous_requests>


<metal:meta-master define-macro="meta-master">
<metal:doctype define-slot="doctype"><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"></metal:doctype>

<head>
    <title tal:content="CONTEXTS/fmt:pagetitle">Launchpad</title>
    <!-- Launchpad style sheet -->
    <style type="text/css"
        media="screen">@import url(/@@/launchpad.css);</style>
    <!-- Launchpad JS code -->
    <script type="text/javascript" src="/@@/launchpad.js"></script>
    <script type="text/javascript" src="/@@/sorttable.js"></script>

    <metal:extra-head define-slot="extra-head" />

    <metal:block define-slot="head_epilogue"></metal:block>
</head>

  <body>
    <div id="pageWrapper">

      <div id="mastWrapper">
        <div id="masthead">
           <metal:logo define-slot="header-logo" />
           <div id="search">
            <tal:block condition="request/lp:person">
              <form action="/+logout" class="login" method="POST">
                Logged in as <span tal:replace="request/lp:person/displayname" />
                  &ndash;
                <input type="submit" value="Log Out" />
              </form>
            </tal:block>

            <tal:block condition="not: request/lp:person">
              Not logged in &#8212;
              <a href="/">
                Log In / Register
              </a>
            </tal:block>
          </div>
        </div>
      </div>
    </div>

    <div class="visualClear body">
      <tal:maintenance replace="structure context/@@+maintenancemessage" />
      <tal:notifications define="notifications request/notifications"
                         condition="notifications">
        <metal:notifications
          use-macro="context/@@+main-template-macros/notifications" />
      </tal:notifications>

      <metal:block define-slot="body">
      </metal:block>
    </div>

    <div class="visualClear">&nbsp;</div>

    <metal:footer define-slot="footer" />

</body>
</metal:meta-master>
