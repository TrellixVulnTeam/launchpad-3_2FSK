<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="malone"
>
<body>

<metal:leftportlets fill-slot="portlets_one">
  <div tal:replace="structure context/@@+portlet-latestbugs|nothing" />
</metal:leftportlets>

<metal:heading fill-slot="pageheading">
  <h1>Report a new bug</h1>
</metal:heading>

<div metal:fill-slot="main">

 <metal:not_uses_malone
    use-macro="context/@@+filebug-macros/not_uses_malone" />

 <tal:uses_malone tal:condition="view/contextUsesMalone">

   <div metal:use-macro="context/@@launchpad_form/form">
    <table class="form" metal:fill-slot="widgets">
      <tal:product_widget
          tal:define="widget nocall:view/widgets/product|nothing"
          tal:condition="widget">
        <metal:widget metal:use-macro="context/@@launchpad_form/widget_row" />
      </tal:product_widget>

      <tal:bugtarget
          tal:define="widget nocall:view/widgets/bugtarget|nothing"
          tal:condition="widget">
        <metal:widget metal:use-macro="context/@@launchpad_form/widget_row" />
      </tal:bugtarget>

      <tal:hidden_tags tal:replace="structure view/widgets/tags/hidden" />

      <tr>
        <td colspan="2">
          <p>
        Please describe the bug in a few words, for example, "weather
        applet crashes on logout":
          </p>
        </td>
      </tr>
      <tal:title_widget tal:define="widget nocall:view/widgets/title">
        <metal:widget metal:use-macro="context/@@launchpad_form/widget_row" />
      </tal:title_widget>
    </table>

    <div class="actions" metal:fill-slot="buttons">
      <input tal:replace="structure view/actions/field.actions.search/render" />
    </div>
  </div>

  <p class="discreet">
    <small>
      This guided form will try to help you find out whether your bug
      has already been reported. You may prefer the
      <a href="#" tal:attributes="href view/advanced_filebug_url">complicated bug filing form</a>.
    </small>
  </p>

    <tal:most-common-bugs condition="view/most_common_bugs">
      <h2>Most Frequently Reported Bugs</h2>

      <table class="listing" id="most-common-bugs">
        <thead>
          <tr><th colspan="2">Summary</th></tr>
        </thead>
        <tbody>
          <tr tal:repeat="bug view/most_common_bugs"
              tal:attributes="title bug/description/fmt:shorten/150"
              title="bug description goes here">
            <td class="amount" tal:content="bug/id" width="10%">1</td>
            <td>
              <a href="#"
                 tal:content="bug/title"
                 tal:attributes="href bug/fmt:url">
                 Firefox doesn't work
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </tal:most-common-bugs>
  </tal:uses_malone>

  <tal:is-project condition="view/contextIsProject">

    <p class="informational message"
      condition="not: view/required:launchpad.Edit"
    >
      There are no projects registered for
      <span tal:replace="context/displayname">project displayname</span>
      that use Launchpad to track bugs.
    </p>

    <tal:admin-warning condition="view/required:launchpad.Edit">
      <p tal:condition="not: context/products" class="warning message">
        There are no projects registered for
        <span tal:replace="context/displayname">project displayname</span>.
        <br />
        You need to <a href="+newproduct">register another project that is
        part of <tal:project replace="context/displayname" /></a> or
        associate an existing project with it.
      </p>
    </tal:admin-warning>

    <tal:has-products condition="context/products">

      <tal:plural condition="python:context.products.count() > 1">
        <p>
          There are <tal:count replace="context/products/count" /> projects
          registered as part of <tal:project replace="context/displayname" />
          but none of them use Launchpad as their bug tracker.
        </p>
        <p>
          However, it may be possible for you to file a bug against a
          specific project in a source package with which it is registered
          or in an external bug tracker.
        </p>
        <p>
          The projects that are part of
          <tal:project replace="context/displayname" />
          are listed below, along with
          the source packages with which they are registered and their
          external bug trackers.  If you can't find an appropriate place
          to file your bug, please try contacting the administrator of
          <tal:project replace="context/displayname" />.
        </p>
      </tal:plural>
      <tal:singular condition="python:context.products.count() == 1">
        <p>
          There is 1 project registered as part of
          <tal:project replace="context/displayname">Project</tal:project>
          but it does not use Launchpad as its bug tracker.
        </p>
        <p>
          The details of the project are shown below, along with any source
          packages with which it is registered and its external bug tracker,
          if it uses one. If you can't find an appropriate place to file
          your bug, please contact the administrator of
          <tal:project replace="context/displayname">Project</tal:project>.
      </tal:singular>
      <ul tal:repeat="product context/products">
        <li>
          <img src="/@@product" tal:replace="structure product/image:icon" />
          <strong>
            <a tal:attributes="href product/fmt:url"
                tal:content="product/displayname"
            >
              Sample Product
            </a></strong>

          <ul id="product-bug-options">
            <tal:external-tracker
                define="bugtracker product/getExternalBugTracker">

              <li tal:condition="bugtracker">
                External bug tracker:
                <a tal:attributes="href bugtracker/baseurl"
                    tal:content="bugtracker/title">
                  Bug Tracker
                </a>.
              </li>

              <li tal:condition="not: bugtracker">
                 <tal:product replace="product/displayname">
                   Project
                 </tal:product>
                 does not use an external bug tracker.
              </li>
            </tal:external-tracker>

            <tal:packages define="packages product/distrosourcepackages">

              <li tal:condition="packages">
                <ul class="source package" tal:repeat="package packages">
                  <li>
                    <a tal:attributes="href package/fmt:url">
                      <span tal:replace="package/distribution/displayname" />
                      <span tal:replace="package/sourcepackagename" />
                    </a>
                    (<a
                       tal:attributes="href string:${package/fmt:url}/+filebug"
                     >File a bug here</a>)
                  </li>
                </ul>
              </li>

              <li tal:condition="not: packages">
                <tal:product replace="product/displayname">
                  Project
                </tal:product>
                is not registered with any source packages.
              </li>

            </tal:packages>
          </ul>
        </li>
      </ul>

    </tal:has-products>

 </tal:is-project>

</div>

</html>
