= Searching Questions in Multiple Languages =

By default, only questions written in English or one of the user
preferred languages are listed and searched.

== Anonymous searching ==

For example, a user who isn't logged in will only see questions written
in English, in one of the language configured in his browser,
or inferred from GeoIP information. In this example, only English
questions will be shown.

    >>> anon_browser.open('http://launchpad.dev/distros/ubuntu/+questions')

    >>> from BeautifulSoup import BeautifulSoup
    >>> soup = BeautifulSoup(anon_browser.contents)
    >>> for question in soup.fetch('td', 'question'):
    ...     print question.first('a').renderContents()
    Continue playing after shutdown
    Play DVDs in Totem
    mailto: problem in webpage
    Installation of Java Runtime Environment for Mozilla
    Slow system

    # Since we have more than 5 results, some of them are in the second batch.
    >>> anon_browser.getLink('Next').click()
    >>> soup = BeautifulSoup(anon_browser.contents)
    >>> for question in soup.fetch('td', 'question'):
    ...     print question.first('a').renderContents()
    Installation failed

The questions match the Person's preferred language settings, or in
the case of the anonymous user, the prefferred languages in the 
request made by the browser

    >>> anon_browser.getControl('All Languages').selected
    False
    >>> anon_browser.getControl('English (en)').selected
    True

If the user selects the 'All Languages' option, then all questions,
whatever the language they are written in are displayed:

    >>> anon_browser.getControl('All Languages').selected = True
    >>> anon_browser.getControl('Search').click()
    >>> soup = BeautifulSoup(anon_browser.contents)
    >>> for question in soup.fetch('td', 'question'):
    ...     question.first('a').renderContents()
    'Problema al recompilar kernel con soporte smp (doble-n\xc3\xbacleo)'
    'Continue playing after shutdown'
    'Play DVDs in Totem'
    'mailto: problem in webpage'
    'Installation of Java Runtime Environment for Mozilla'

    # Since we have more than 5 results, some of them are in the second batch.
    >>> anon_browser.getLink('Next').click()
    >>> soup = BeautifulSoup(anon_browser.contents)
    >>> for question in soup.fetch('td', 'question'):
    ...     question.first('a').renderContents()
    'Slow system'
    'Installation failed'

But if the user configures his browser to accept Spanish, then all
languages will be displayed and the 'All Languages' control will
not appear:

    >>> anon_browser.addHeader('Accept-Language', 'es')
    >>> anon_browser.open('http://launchpad.dev/distros/ubuntu/+questions')

    >>> anon_browser.getControl('All Languages')
    Traceback (most recent call last):
      ...
    LookupError...

    >>> soup = BeautifulSoup(anon_browser.contents)
    >>> for question in soup.fetch('td', 'question'):
    ...     question.first('a').renderContents()
    'Problema al recompilar kernel con soporte smp (doble-n\xc3\xbacleo)'
    'Continue playing after shutdown'
    'Play DVDs in Totem'
    'mailto: problem in webpage'
    'Installation of Java Runtime Environment for Mozilla'

    # Since we have more than 5 results, some of them are in the second batch.
    >>> anon_browser.getLink('Next').click()
    >>> soup = BeautifulSoup(anon_browser.contents)
    >>> for question in soup.fetch('td', 'question'):
    ...     question.first('a').renderContents()
    'Slow system'
    'Installation failed'


== Authenticated searching ==

Authenticated users without preferred languages will see a search
form with the same language search options as the anonymous user.

    >>> user_browser.open('http://launchpad.dev/distros/ubuntu/+questions')
    >>> user_browser.getControl('All Languages').selected
    False
    >>> user_browser.getControl('English (en)').selected
    True
    
Users that have configured their preferred languages may choose to
see questions for all languages, their preferred languages, or
their preferred languages and English (the site's language).

    >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
    >>> browser.open('http://launchpad.dev/distros/ubuntu/+questions')
    >>> browser.getControl('All Languages').selected
    False
    >>> language_control = browser.getControl(name='field.languages')
    >>> for label in language_control.displayOptions:
    ...     # \xa0 appears regardless of creating the labels as 
    ...     # unicode or ascii, and changine the encoding during
    ...     # print or assignment operations.
    ...     label
    '\xa0All Languages'
    '\xa0English (en), Spanish (es), Catalan (ca)'
    '\xa0Spanish (es), Catalan (ca)'
    >>> browser.getControl(name='field.languages').options
    ['All', 'Preferred', 'User']
    
By choosing the preferred languages option, the user can exclude 
all other languages including English from the questions displayed.

    >>> browser.getControl(name='field.languages').value = ['User']
    >>> browser.getControl('Search').click()
    >>> content = find_main_content(browser.contents)
    >>> for question in content.fetch('td', 'question'):
    ...     question.first('a').renderContents()
    'Problema al recompilar kernel con soporte smp (doble-n\xc3\xbacleo)'


= Multiple Request Languages in Latest Questions =

The portlet that lists the latest questions involving a person displays
all the questions, whatever the user preferred languages. (Since this
portlet is there to give an idea of activity, it also advertise
multi-language activity. Besides this avoids misleading the user by
showing no questions when there could be in other languages.)

    >>> browser.open('http://launchpad.dev/~carlos')
    >>> portlet = find_portlet(
    ...    browser.contents, 'Latest questions')
    >>> for link in portlet.fetch('a'):
    ...    link.renderContents()
    'Problema al recompilar kernel con soporte smp (doble-n\xc3\xbacleo)'
