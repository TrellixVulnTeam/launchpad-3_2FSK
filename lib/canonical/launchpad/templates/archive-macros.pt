<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  omit-tag="">

<metal:source_package_list define-macro="source-package-list">
  <tal:comment replace="nothing">
    Presents a table listing all the published source packages for an
    archive.
  </tal:comment>

  <div style="padding-top: 1em;" tal:define="batch view/search_results">

    <tal:navigation_top
        replace="structure view/batchnav/@@+navigation-links-upper" />

    <table class="listing" id="packages_list" tal:condition="batch">
      <thead>
        <tr class="archive_package_row">
        <th colspan="2">Source</th>
        <th tal:condition="context/owner/isTeam">Uploader</th>
        <th>Published</th>
        <th>Status</th>
        <th>Series</th>
        <th>Section</th>
        <th>Build Status</th>
        </tr>
      </thead>
      <tbody>
        <tal:non_selectable repeat="publishing batch"
                   replace="structure publishing/@@+listing-archive-detailed"
                   condition="not:view/selectable_sources">
        </tal:non_selectable>
        <tal:selectable condition="view/selectable_sources">
          <tal:each_term define="widget nocall:view/widgets/selected_sources"
                         repeat="term widget/vocabulary">
            <tal:block
              define="pub term/value"
              replace="structure pub/@@+listing-archive-detailed-selectable" />
          </tal:each_term>
        </tal:selectable>
      </tbody>
    </table>

    <tal:navigation_bottom
        replace="structure view/batchnav/@@+navigation-links-lower" />

    <div id="empty-result"
            tal:define="name_filter view/specified_name_filter|nothing"
            tal:condition="not: batch">
      No matching package for '<tal:name_filter replace="name_filter" />'.
    </div>

  </div>

</metal:source_package_list>

<metal:package_copy_request_list define-macro="package-copy-request-list">
  <tal:comment replace="nothing">
    Presents a table listing all the package copy requests for a copy
    archive.
  </tal:comment>
  <tal:block define="requests view/package_copy_requests">
    <p tal:condition="not: requests">
      There are currently no requests to copy packages into this archive.
    </p>
    <tal:request_list tal:condition="requests">
      <table id="package-requests"
        tal:attributes="summary string:Package copy requests for ${context/name}">
        <thead>
          <tr>
            <th>Copied from</th>
            <th>Series</th>
            <th>Requested by</th>
            <th>When Requested</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="request requests">
            <td tal:define="archive request/source_archive">
              <a tal:attributes="href archive/fmt:url"
                 tal:content="archive/title" 
                 tal:condition="archive/is_ppa" />
              <tal:archive_title replace="archive/title" 
                                 condition="not: archive/is_ppa" />
            </td>
            <td>
              <tal:distroseries 
                  replace="request/source_distroseries/displayname" />-<tal:src_pocket
                  replace="request/source_pocket/name/fmt:lower" />
              <tal:component condition="request/source_component">
               (<tal:src_component_name
                  replace="request/source_component/name" />)
              </tal:component>
            </td>
            <td><a tal:attributes="href request/requester/fmt:url"
                   tal:content="request/requester/displayname" /></td>
            <td tal:content="request/date_created/fmt:approximatedate" />
            <td tal:content="request/status/name/capitalize" />
          </tr>
        </tbody>
      </table>
    </tal:request_list>
  </tal:block>
</metal:package_copy_request_list>

<metal:package_counters define-macro="package-counters">

  <tal:comment replace="nothing">
    Presents package counters for a defined IArchive.
    :archive: targeted IArchive.
  </tal:comment>

  <div>
    <ul id="package_counters">
      <li id="source_counter">
         <tal:source_count_text replace="archive/@@+index/source_count_text" />
         (<tal:sources_size
            replace="archive/sources_size/fmt:bytes" />)</li>
      <li id="binary_counter">
         <tal:binary_count_text replace="archive/@@+index/binary_count_text" />
         (<tal:binaries_size
            replace="archive/binaries_size/fmt:bytes" />)</li>
      <li id="total_size">
         Estimated archive size:
         <tal:estimated_size
           replace="archive/estimated_size/fmt:bytes" /></li>
    </ul>
  </div>

</metal:package_counters>

<metal:build_status_summary define-macro="build-status-summary">

  <tal:comment replace="nothing">
    Present the build pie chart for the context IArchiveRebuild.
    :archive: targetted IArchive.
  </tal:comment>

  <table id="build-count-table"
         summary="An overview of the build status for this archive."
         tal:define="build_counters view/build_counters">
    <thead>
      <tr>
        <th>Total builds:</th>
        <td class="total" tal:content="view/build_counters/total">100</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th>Failed</th>
        <td class="failed" tal:content="build_counters/failed">100</td>
      </tr>
      <tr>
        <th>Pending</th>
        <td class="pending" tal:content="build_counters/pending">100</td>
      </tr>
      <tr>
        <th>Superseded</th>
        <td class="superseded" tal:content="build_counters/superseded">100</td>
      </tr>
      <tr>
        <th>Succeeded</th>
        <td class="succeeded" tal:content="build_counters/succeeded">100</td>
      </tr>
    </tbody>
  </table>
</metal:build_status_summary>

<metal:package_filter_form define-macro="package-filter-form">
  <tal:comment replace="nothing">
    Present the filtering form used on a few archive pages.
  </tal:comment>

  <form class="package-search-filter" action="" method="GET">
    <label for="name">Package name contains:</label>
    <input id="field.name_filter" title="Package Name" size="20"
            type="text" name="field.name_filter"
            tal:attributes="value request/field.name_filter|nothing"/>
    <tal:status_filter
        replace="structure view/plain_status_filter_widget" /> in
    <tal:series_filter
        replace="structure view/plain_series_filter_widget" />
    <input type="submit" value="Filter" />
  </form>

</metal:package_filter_form>

</tal:root>
