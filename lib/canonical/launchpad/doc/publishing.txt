SourcePackagePublishingHistory
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This class provides public access to publishing records via a SQL view.

 >>> from canonical.launchpad.database import SourcePackagePublishingHistory

Select a publishing record from the sampledata (pmount is a
interesting one):

 >>> spph = SourcePackagePublishingHistory.get(8)
 >>> spph.sourcepackagerelease.name, spph.distrorelease.name
 (u'pmount', u'hoary')

Verify if the object follows its interface contracts:

 >>> from zope.interface.verify import verifyObject
 >>> from canonical.launchpad.interfaces import (
 ...     ISourcePackageRelease, IDistroRelease,
 ...     ISourcePackagePublishingHistory,
 ...     ISourcePackage,
 ...     IDistributionSourcePackageRelease)

 >>> verifyObject(ISourcePackagePublishingHistory, spph)
 True

 XXX cprov 20060322: None of the attributes below pass verifyObject().
 So, they claim to implement some thing they don't really have. Most
 of the problems are related with bad interface inheritance.

 >>> IDistroRelease.providedBy(spph.distrorelease)
 True

 >>> ISourcePackageRelease.providedBy(spph.sourcepackagerelease)
 True

 >>> ISourcePackageRelease.providedBy(spph.supersededby)
 True

 >>> IDistributionSourcePackageRelease.providedBy(
 ...     spph.meta_sourcepackagerelease)
 True

 >>> IDistributionSourcePackageRelease.providedBy(spph.meta_supersededby)
 True

 >>> ISourcePackage.providedBy(spph.meta_sourcepackage)
 True


Check how the ISourcePackagePublishingHistory and IArchivePublisher objects
fit together. IArchivePublisher interface grants to a single
publication record the ability to publish its contents.

It results in a more granular way to perform actions in the package
archive, because instead of driven by the whole group of files that needs
to be published in the archive filesystem (old way), it will be driven
by a much smaller and similar set of files that are contained in a
single publication record.

See canonical/launchpad/tests/test_publishing.py for run-time times.

 >>> from canonical.launchpad.database import SourcePackagePublishingHistory
 >>> from canonical.launchpad.interfaces import (
 ...     IArchivePublisher, IArchiveSafePublisher,
 ...     ISourcePackageFilePublishing, IArchiveFilePublisher,
 ...     ISecureSourcePackagePublishingHistory)

Retrive any SourcePackagePublishingHistory entry.

 >>> spph = SourcePackagePublishingHistory.get(10)

SourcePackagPublishingHistory implements both interfaces properly:

 >>> verifyObject(ISourcePackagePublishingHistory, spph)
 True
 >>> verifyObject(IArchivePublisher, spph)
 True

IArchivePublisher.files are the SourcePackageFilePublishing records
contained in this publication record. Each instance also implements
IArchiveFilePublishing.

 >>> any_pub_file = spph.files[-1]
 >>> ISourcePackageFilePublishing.providedBy(any_pub_file)
 True
 >>> verifyObject(IArchiveFilePublisher, any_pub_file)
 True

 >>> [pub_file.libraryfilealias.filename for pub_file in spph.files]
 [u'alsa-utils_1.0.8-1ubuntu1.dsc']


'secure_record' returns a ISecureSourcePackagePublishing instance
corresponding to this publication. This instance implements
IArchiveSafePublisher.

 >>> sspph = spph.secure_record
 >>> ISecureSourcePackagePublishingHistory.providedBy(sspph)
 True
 >>> verifyObject(IArchiveSafePublisher, sspph)
 True
 >>> sspph.embargo
 False

Symetric behaviour is offered for BinaryPackagePublishing,
BinaryPackageFile and ISecureBinaryPackagePublishingHistory

 >>> from canonical.launchpad.database import BinaryPackagePublishingHistory
 >>> from canonical.launchpad.interfaces import (
 ...     IBinaryPackagePublishingHistory, IBinaryPackageFilePublishing,
 ...     ISecureBinaryPackagePublishingHistory)

 >>> bpph = BinaryPackagePublishingHistory.get(15)

 >>> IBinaryPackagePublishingHistory.providedBy(bpph)
 True
 >>> verifyObject(IArchivePublisher, bpph)
 True

 >>> sbpph = bpph.secure_record
 >>> ISecureBinaryPackagePublishingHistory.providedBy(sbpph)
 True
 >>> verifyObject(IArchiveSafePublisher, sbpph)
 True
 >>> sbpph.embargo
 False

 >>> any_file = bpph.files[-1]
 >>> IBinaryPackageFilePublishing.providedBy(any_file)
 True
 >>> verifyObject(IArchiveFilePublisher, any_file)
 True

 >>> [pub_file.libraryfilealias.filename for pub_file in bpph.files]
 [u'mozilla-firefox_0.9_i386.deb']
