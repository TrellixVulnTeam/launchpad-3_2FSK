<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_side"
  i18n:domain="launchpad"
>

<body>

<metal:block fill-slot="head_epilogue">
  <tal:devmode condition="devmode">
    <tal:archive_js define="lp_js string:${icingroot}/build">
      <script type="text/javascript"
              tal:attributes="src string:${lp_js}/soyuz/base.js"></script>
    </tal:archive_js>
  </tal:devmode>
</metal:block>

<tal:side metal:fill-slot="side">
    <tal:menu replace="structure view/@@+global-actions" />

    <tal:involved replace="structure context/@@+get-involved" />

    <tal:current define="current context/currentrelease">
    <div class="portlet" id="latest-release" tal:condition="current">
      <h2>Latest release</h2>
      <dl>
        <dt>Version:</dt>
          <dd><a tal:content="current/version"
                 tal:attributes="href current/fmt:url">3.2.1-3</a>
          </dd>
        <dt>Uploaded by:</dt>
          <dd><a tal:replace="structure current/creator/fmt:link">Foo Bar</a></dd>
        <dt>On date:</dt>
          <dd tal:content="current/dateuploaded/fmt:datetime"/>
      </dl>
    </div>
    </tal:current>

    <tal:subscribers
      replace="structure context/@@+portlet-structural-subscribers"/>
</tal:side>

<tal:main metal:fill-slot="main">
  <p class="error message"
     tal:condition="view/errors"
     tal:content="view/error_count" />
  <p class="error message"
     tal:repeat="form_wide_error view/form_wide_errors"
     tal:content="structure form_wide_error">
     Schema validation errors.
  </p>
  <p class="error message"
     tal:define="error python:view.getFieldError('packaging')"
     tal:condition="error"
     tal:content="structure error">
     Field specific error for the hidden packaging field.
  </p>

  <div class="top-portlet" id="bugs-and-questions-summary"
       tal:define="newbugs context/new_bugtasks/count;
                   open_questions view/open_questions/count">
    This package has
    <a tal:attributes="href view/menu:overview/new_bugs/url">
      <strong class="bugs-stat">
        <tal:newbugs content="newbugs"/> new bug<tal:plural content="string:s" condition="python: newbugs!=1"/>
      </strong>
    </a>
    and
    <a tal:attributes="href view/menu:overview/open_questions/url">
    <strong class="answers-stat">
      <tal:openq content="open_questions"/> open question<tal:plural content="string:s" condition="python: open_questions!=1"/>.
      </strong>
    </a>
  </div>

  <div class="yui-g">

    <div class="yui-u first" tal:define="current context/currentrelease">
      <div class="portlet" tal:condition="current" id="current">
        <h2>Package information</h2>
        <div class="two-column-list">
          <dl>
            <dt>Maintainer:</dt>
            <dd>
               <a tal:replace="structure current/maintainer/fmt:link">Foo Bar</a>
            </dd>
          </dl>
          <dl>
            <dt>Urgency:<sup>*</sup></dt>
            <dd tal:content="current/urgency/title"/>
          </dl>
          <dl>
            <dt>Component:<sup>*</sup></dt>
            <dd tal:content="current/component/name"/>
          </dl>
          <dl>
            <dt>Architectures:<sup>*</sup></dt>
            <dd tal:content="current/architecturehintlist"/>
          </dl>
        </div>
        <p style="font-size: 80%;">
          <sup>*</sup>actual publishing details may vary in this distribution, these are just the package defaults.
        </p>
      </div><!--portlet-->
      <div class="portlet" tal:condition="not: current" id="current">
        There is no current release for this source package in
        <span tal:replace="context/distribution/displayname">ubuntu</span>.
      </div>
    </div><!--yui-u-->

    <div class="yui-u">
      <div class="portlet" id="upstream">
        <tal:project define="project context/upstream_product">
          <div tal:condition="project">
            <h2>Upstream</h2>
            <div style="float:left; padding:0 1em 1em 0;">
              <a
                tal:attributes="href project/fmt:url"
                tal:content="structure project/image:logo" />
            </div>
            <div> 
              <a 
                tal:attributes="href project/fmt:url"
                tal:content="project/displayname" />
            </div>
            <div tal:content="structure project/summary" />
          </div>
          <tal:noproject condition="not: project">
              This package is not linked to an upstream product.
          </tal:noproject>
        </tal:project>
      </div><!--portlet -->
    </div><!--yui-u -->

  </div><!--yui-g -->


  <div class="yui-u"
       tal:define="archive context/latest_overall_publication/archive|nothing">

    <table class="listing" id="packages_list">
      <tal:rows repeat="row view/version_table">

      <tal:title_row condition="row/title_row">
      <tr class="section-heading shaded" style="vertical-align: middle">
        <td colspan="3">
          <img tal:replace="structure context/distribution/image:icon"/>
          <a tal:attributes="href row/series_package/fmt:url"
             tal:content="row/distroseries/title"/>
          (<span tal:replace="row/distroseries/status/title/lower"/>)
          <div style="float:right;">
            <a tal:condition="not: row/packaging"
               tal:replace="structure row/series_package/menu:overview/set_upstream/fmt:link"/>
            <tal:has_packaging condition="row/packaging">
              <img tal:replace="structure row/packaging/productseries/image:icon"/>
              <a tal:replace="structure row/packaging/productseries/fmt:link"/>
              <form style="display: inline"
                    method="POST"
                    tal:condition="row/hidden_packaging_field"
                    tal:attributes="action request/URL;
                                    id row/delete_packaging_form_id">
                <tal:hidden replace="structure row/hidden_packaging_field" />
                <tal:action replace="structure view/renderDeletePackagingAction" />
              </form>
              <a tal:attributes="
                href row/series_package/menu:overview/edit_packaging/url;
                title string:Edit upsteam link">
                <img src="/@@/edit"/>
              </a>
            </tal:has_packaging>
          </div><!--float right-->
        </td>
      </tr>
      </tal:title_row>

      <tal:package_row condition="row/data_row">
      <tal:define define="pubid row/publication/id">

      <tr class="archive_package_row">
        <td style="white-space: nowrap">
          <a class="expander"
             tal:attributes="id string:pub${pubid}-expander;
                             href string:${archive/fmt:url}/+sourcepub/${pubid}/+listing-archive-extra">
            <img style="padding-right:0.5em;" src="/@@/treeCollapsed"
                 alt="Show details" title="Show details"
                 tal:attributes="id string:pub${pubid}-arrow"/>
          </a>
          <a tal:attributes="href row/version">
            <img src="/@@/package-source" />
            <tal:version content="row/version"/>
          </a>
        </td>
        <td>
          <tal:pockets content="row/pockets/lower"/>
          (<tal:component content="row/component"/>)
        </td>
        <td>
          <tal:last_published condition="row/published_since">
            <span tal:replace="row/published_since/fmt:approximateduration"/>
            ago
          </tal:last_published>
          <tal:not_published
               condition="not: row/published_since"
               content="string:(not published)"/>
        </td>
      </tr>
      <tr tal:attributes="id string:pub${pubid}" style="display: none">
        <td colspan="3">
          <div class="package-details"
               tal:attributes="id string:pub${pubid}-container" />
        </td>
      </tr>

      </tal:define>
      </tal:package_row>

      <tal:blank_row condition="row/blank_row">
        <tr><td colspan="3" style="padding-bottom: 1em; border-top: 0" /></tr>
      </tal:blank_row>

      </tal:rows>
    </table>
    <script
       tal:content="string:LP.client.cache['archive_context_url'] = '${archive/fmt:url}';"></script>
    <metal:js use-macro="archive/@@+macros/expandable-table-js"/>

    <p style="float:right; padding-top:1em">
      <a href="+publishinghistory">See full publishing history</a>
    </p>

  </div>

  <div class="yui-u">
  <div class="portlet"
       tal:define="ppa_versions view/related_ppa_versions"
       tal:condition="ppa_versions" id="related-ppa-versions">
    <div id="slide-trigger">
      <div class="widget-hd">
        Other versions of '<span tal:replace="context/name" />' in untrusted
        archives.
      </div>
    </div>
    <div class="widget-bd">
      <p>The following <strong>unsupported</strong> and
         <strong>untrusted</strong> Personal Archives (PPAs) provide
         packages of
         '<span tal:replace="context/name" />':</p>
      <dl id="ppa_packaging">
        <tal:definition tal:repeat="ppa_version ppa_versions">
          <dt>
            <a tal:attributes="href ppa_version/archive/fmt:url">
              <img tal:replace="structure ppa_version/archive/image:icon" />
              <span tal:replace="ppa_version/archive/displayname">
                Super trusted PPA
              </span>
            </a> owned by
            <a tal:replace="structure ppa_version/archive/owner/fmt:link">
              Joe Dodgy
            </a>
          </dt>
          <dd>
            Versions:
            <span tal:replace="ppa_version/versions">
              Hoary (1.0.1), Feisty (2.0.1)
            </span>
          </dd>
        </tal:definition>
      </dl>

      <p>You can also search for
         <a tal:attributes="href view/further_ppa_versions_url">
           more untrusted versions of
           '<span tal:replace="context/name" />'</a>.
      </p>
    </div>
<script type="text/javascript">
YUI({
        base: '../../lib/yui/current/build/',
        filter: 'raw'
    }).use('node', 'event', 'lazr.effects', function(Y) {

    // XXX Michael Nelson 20090702 bug=340497 This slider
    // needs an integration test.
    // Collapse the body of the slider widget initially.
    Y.get('#related-ppa-versions .widget-bd').addClass('lazr-closed');

    // Ensure that the widget header uses the correct sprite icon
    // and gets the styling for javascript actions applied.
    var widget_header = Y.get('#related-ppa-versions .widget-hd');
    widget_header.addClass('sprite');
    widget_header.addClass('treeCollapsed');
    widget_header.addClass('js-action');

    var slide;
    Y.on('click', function(e) {
        if (!slide) {
            slide = Y.lazr.effects.slide_out('#related-ppa-versions .widget-bd');
            widget_header.replaceClass('treeCollapsed', 'treeExpanded');
        } else {
            slide.set('reverse', !slide.get('reverse'));
            widget_header.toggleClass('treeExpanded');
            widget_header.toggleClass('treeCollapsed');
        }
        slide.stop();
        slide.run();

    }, '#slide-trigger');
});
</script>

  </div>
  </div>

</tal:main>

</body>
</html>
