<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="malone"
>

  <body>
    <div metal:fill-slot="main" class="tab-bugs"
         tal:define="batchnav view/batchedPatchTasks;
                     batch batchnav/currentBatch">

  <form class="lesser" name="sort" method="get"
        tal:attributes="action string:${context/fmt:url}/+patches">
    <select name="orderby" id="orderby" size="1"
            tal:define="orderby request/orderby|string:-importance">
      <option
        value="-importance"
        tal:attributes="selected python:orderby == '-importance'"
      >by importance</option>
      <option
        value="status"
        tal:attributes="selected python:orderby == 'status'"
      >by status</option>
      <option
        tal:condition="view/shouldShowTargetName"
        tal:attributes="selected python:orderby == 'targetname'"
        value="targetname"
      >by package</option>
      <option
        value="datecreated"
        tal:attributes="selected python:orderby == 'datecreated'"
      >oldest first</option>
      <option
        value="-datecreated"
        tal:attributes="selected python:orderby == '-datecreated'"
      >newest first</option>
    </select>
    <input type="submit" value="sort" id="sort-button">
  </form>

    <table class="listing"><thead>
             <tr>
               <th style="padding-right: 1em;"
                   >Bug</th>
               <th style="padding-right: 1em;"
                   >Importance</th>
               <th style="padding-right: 1em;"
                   >Status</th>
               <th style="padding-right: 1em;"
                   tal:condition="view/shouldShowTargetName"
                   >Package</th>
               <th style="padding-right: 1em;"
                   >Patch Age</th>
             </tr>
           </thead>
           <tr tal:repeat="patch_task batch">
             <td style="padding-right: 1em;"
              ><a tal:replace="structure patch_task/bug/fmt:link" /></td>
             <td style="padding-right: 1em;"
                 tal:content="patch_task/importance/title"
                 tal:attributes="class string:importance${patch_task/importance/name}"></td>
             <td style="padding-right: 1em;"
                 tal:content="patch_task/status/title"
                 tal:attributes="class string:status${patch_task/status/name}"></td>
             <td style="padding-right: 1em;"
                 tal:condition="view/shouldShowTargetName"
                 ><a tal:attributes="href patch_task/target/fmt:url"
                     tal:content="patch_task/target/name"
                  ></a></td>
             <td style="padding-right: 1em;"
                 tal:define="p python:view.youngest_patch(patch_task.bug);
                             age python:view.patch_age(p)"
                 tal:attributes="id string:patch-cell-${repeat/patch_task/index}"
                  ><a tal:attributes="href p/libraryfile/http_url"
                      tal:content="age/fmt:approximateduration/use-digits"
                  ></a>
               <div class="popupTitle"
                    tal:attributes="id string:patch-popup-${repeat/patch_task/index};">
                <p tal:define="submitter p/message/owner"
                   ><strong>From:</strong>
                    <a tal:replace="structure submitter/fmt:link"></a><br/>
                    <strong>Link:</strong>
                    <a tal:attributes="href p/libraryfile/http_url"
                       tal:content="p/libraryfile/filename"
                       ></a></p>
                <p tal:content="string:${p/title}"></p>
               </div>
               <script type="text/javascript" tal:content="string:
                 YUI().use('base', 'node', 'event', function(Y) {
                   Y.on('domready', function(e) {
                     var cell_id = '#patch-cell-${repeat/patch_task/index}';
                     var target_id = '#patch-popup-${repeat/patch_task/index}';
                     var elt = Y.get(cell_id);
                     elt.on('mouseover', function(e) {
                        Y.get(target_id).setStyle('display', 'block');
                      });
                     elt.on('mouseout', function(e) {
                        Y.get(target_id).setStyle('display', 'none');
                      });
                   });
                 });"/>
             </td>
             </tr></table>
    <div tal:replace="structure batchnav/@@+navigation-links-lower" />
    </div><!-- main -->
  </body>
</html>
