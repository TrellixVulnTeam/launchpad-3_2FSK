<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="launchpad">
  <body>

    <metal:block fill-slot="head_epilogue">
      <style type="text/css">
        .distroseries-localdiff-search-filter input[type="radio"] {
          margin-left: 0;
        }
      </style>
    </metal:block>

    <tal:heading metal:fill-slot="heading">
      <h1 tal:content="view/label">Package differences between ...</h1>
    </tal:heading>


    <div class="top-portlet" metal:fill-slot="main"
      tal:define="differences view/cached_differences;
                  series_name context/displayname;
                  can_perform_sync view/canPerformSync;">
      <p><tal:replace replace="structure view/explanation/escapedtext" /></p>

      <tal:distroseries_localdiff_search_form
        tal:condition="view/has_differences">
        <metal:package_filter_form
          use-macro="context/@@+macros/distroseries-localdiff-search-form" />
      </tal:distroseries_localdiff_search_form>


      <div metal:use-macro="context/@@launchpad_form/form">

      <div tal:condition="differences/batch" metal:fill-slot="widgets">
        <tal:navigation_top
          replace="structure differences/@@+navigation-links-upper" />
          <table class="listing">
          <thead>
            <tr>
              <th>Source</th>
              <th tal:condition="python: not(view.has_unique_parent) and view.show_parent_version">
                Parent
              </th>
              <th tal:condition="view/show_parent_version">
                <tal:one_parent condition="view/has_unique_parent">
                  <tal:replace replace="view/unique_parent/displayname" /> version
                </tal:one_parent>
                <tal:multiple_parents condition="not: view/has_unique_parent">
                  Parent version
                </tal:multiple_parents>
              </th>
              <th tal:condition="view/show_derived_version">
                <tal:replace replace="series_name" /> version</th>
              <th tal:condition="view/show_parent_packagesets">
                Parent package-sets
              </th>
              <th tal:condition="view/show_packagesets">
                Package-sets
              </th>
               <th>Last uploaded</th>
              <th>Latest comment</th>
            </tr>
          </thead>
          <tbody>
            <tal:difference repeat="difference differences/batch">
            <tr tal:define="parent_source_pub difference/parent_source_pub;
                            source_pub difference/source_pub;
                            diff_id difference/id;
                            src_name difference/source_package_name/name;"
                tal:attributes="class src_name">

              <td>
                <input tal:condition="can_perform_sync"
                  name="field.selected_differences" type="checkbox"
                  tal:attributes="
                    value diff_id;
                    id string:field.selected_differences.${diff_id}"/>

                <a tal:attributes="href difference/fmt:url"
                   class="js-action toggle-extra"
                   tal:content="src_name">Foo</a>
              </td>
              <td tal:condition="python: not(view.has_unique_parent) and view.show_parent_version">
                <a tal:attributes="href difference/parent_series/fmt:url"
                   tal:content="difference/parent_series/displayname"
                   class="parent-name">Warty</a>
              </td>
              <td tal:condition="view/show_parent_version">
                <a tal:condition="difference/parent_source_package_release"
                   tal:attributes="href difference/parent_source_package_release/fmt:url"
                   class="parent-version">
                   <tal:replace
                        replace="difference/parent_source_version"/></a>
                <span tal:condition="not: difference/parent_source_package_release"
                      class="parent-version"
                      tal:content="difference/parent_source_version">
                </span>
              </td>

              <td tal:condition="view/show_derived_version">
                <a tal:condition="difference/source_package_release"
                   tal:attributes="href difference/source_package_release/fmt:url"
                   class="derived-version">
                   <tal:replace
                        replace="difference/source_version"/></a>
                <span tal:condition="not: difference/source_package_release"
                    class="derived-version"
                    tal:content="difference/source_version">
                </span>
              </td>

              <td tal:condition="view/show_parent_packagesets"
                  class="parent-packagesets">
                <tal:replace replace="difference/@@/parent_packagesets_names"/>
              </td>

              <td tal:condition="view/show_packagesets"
                  class="packagesets">
                <tal:replace replace="difference/@@/packagesets_names" />
              </td>

              <td>
                <tal:parent condition="not: view/show_derived_version">
                  <tal:published condition="parent_source_pub">
                    <span tal:attributes="title parent_source_pub/datepublished/fmt:datetime"
                          tal:content="parent_source_pub/datepublished/fmt:approximatedate">2005-09-16</span>
                    <tal:signer condition="parent_source_pub/sourcepackagerelease/uploader">
                      by <a tal:replace="structure parent_source_pub/sourcepackagerelease/uploader/fmt:link">Steph Smith</a>
                    </tal:signer>
                  </tal:published>
                  <tal:not-published condition="not:parent_source_pub">
                    <span tal:content="difference/parent_source_version" />
                  </tal:not-published>
                </tal:parent>
                <tal:derived condition="view/show_derived_version">
                  <tal:published condition="parent_source_pub">
                    <span tal:attributes="title source_pub/datepublished/fmt:datetime"
                          tal:content="source_pub/datepublished/fmt:approximatedate">2005-09-16</span>
                    <tal:signer condition="source_pub/sourcepackagerelease/uploader">
                      by <a tal:replace="structure source_pub/sourcepackagerelease/uploader/fmt:link">Steph Smith</a>
                    </tal:signer>
                  </tal:published>
                  <tal:not-published condition="not:source_pub">
                    <span tal:content="difference/source_version" />
                  </tal:not-published>
                </tal:derived>
              </td>

              <tal:comment replace="nothing">
                XXX: GavinPanella 2011-04-14 bug=760733: In
                TestDistroSeriesLocalDifferences.test_queries, this
                cell needs 1 QUERY per row: MessageChunk
              </tal:comment>
              <td>
                <tal:comment tal:define="comment difference/latest_comment"
                             tal:condition="comment">
                  <span tal:replace="comment/body_text/fmt:shorten/50">I'm on this.</span>
                  <br /><span class="greyed-out greylink"><span
                      tal:replace="comment/comment_date/fmt:approximatedate">2005-09-16</span>
                  by <a tal:replace="structure
                      comment/comment_author/fmt:link">joesmith</a></span>
                </tal:comment>
              </td>

            </tr>

            </tal:difference>
          </tbody>
        </table>
        <tal:navigation_bottom
          replace="structure differences/@@+navigation-links-lower" />
         <tal:selectable_differences_end
               define="widget nocall:view/widgets/selected_differences;
                       field_name widget/context/__name__;
                       error python:view.getFieldError(field_name);">
          <input tal:attributes="name string:${widget/name}-empty-marker"
                 type="hidden" value="1" />
          <div class="error message" tal:condition="error"
               tal:content="structure error">Error message</div>
           </tal:selectable_differences_end>
      </div>
    </div>
<script type="text/javascript">
LPS.use('lp.registry.distroseriesdifferences_details', function(Y) {
  diff_module = Y.lp.registry.distroseriesdifferences_details

  Y.on('domready', diff_module.setup_expandable_rows);
});
</script>

    </div>

  </body>
</html>
