First we test that the name12 user can visit his edithackergotchi page

  >>> print http(r"""
  ... GET /people/name12/+edithackergotchi HTTP/1.1
  ... Authorization: Basic dGVzdEBjYW5vbmljYWwuY29tOnRlc3Q=
  ... """)
  HTTP/1.1 200 Ok
  ...Edit Image...
  ...Hackergotchi...
  ...


Testing the upload of a 16x16 image.

  >>> import canonical.launchpad
  >>> import os.path
  >>> data_file_name = os.path.join(
  ...     os.path.dirname(canonical.launchpad.__file__),
  ...     'pagetests/standalone/mypng.png')

  >>> icon = open(data_file_name).read()

  >>> print http(r"""
  ... POST /people/name12/+edithackergotchi HTTP/1.1
  ... Authorization: Basic dGVzdEBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------75081443203208152087282358
  ... 
  ... 
  ... 
  ... -----------------------------75081443203208152087282358
  ... Content-Disposition: form-data; name="field.hackergotchi"; filename="gnome-dev-floppy.png"
  ... Content-Type: image/png
  ... 
  ... %s^M
  ... -----------------------------75081443203208152087282358
  ... Content-Disposition: form-data; name="FORM_SUBMIT"
  ... 
  ... Continue
  ... -----------------------------75081443203208152087282358--
  ... """ % icon)
  HTTP/1.1 303 See Other
  ...
  Location: http://localhost:9000/people/name12
  ...



After the upload we should be redirected to the overview
page; we then check if the hackergotchi is there.

  >>> print http(r"""
  ... GET /people/name12 HTTP/1.1
  ... Accept-Language: en-us,en;q=0.5
  ... Authorization: Basic dGVzdEBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Referer: http://localhost:9000/people/name12/+edithackergotchi
  ... """)
  HTTP/1.1 200 Ok
  Content-Length: ...
  Content-Type: text/html;charset=utf-8
  <BLANKLINE>
  ...
  <BLANKLINE>
    <div class="highlighted" style="font-size: 80%;">
      <img...
           src="http://localhost:58000/35/35/gnome-dev-floppy.png" />
  <BLANKLINE>
  ...




Testing the upload of a big 21239 bytes image file.

  >>> data_file_name = os.path.join(
  ...     os.path.dirname(canonical.launchpad.__file__),
  ...     'pagetests/standalone/big.png')

  >>> icon = open(data_file_name).read()

  >>> print http(r"""
  ... POST /people/name12/+edithackergotchi HTTP/1.1
  ... Authorization: Basic dGVzdEBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------75081443203208152087282358
  ... 
  ... 
  ... 
  ... -----------------------------75081443203208152087282358
  ... Content-Disposition: form-data; name="field.hackergotchi"; filename="gnome-dev-floppy.png"
  ... Content-Type: image/png
  ... 
  ... %s^M
  ... -----------------------------75081443203208152087282358
  ... Content-Disposition: form-data; name="FORM_SUBMIT"
  ... 
  ... Continue
  ... -----------------------------75081443203208152087282358--
  ... """ % icon)
  HTTP/1.1 200 Ok
  ...
  ...<p class="portalMessage">An error occured.</p>...
  ...



Testing the upload of a wide 192x192 image file.

  >>> data_file_name = os.path.join(
  ...     os.path.dirname(canonical.launchpad.__file__),
  ...     'pagetests/standalone/wide.png')

  >>> icon = open(data_file_name).read()
  
  >>> print http(r"""
  ... POST /people/name12/+edithackergotchi HTTP/1.1
  ... Authorization: Basic dGVzdEBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------191893153320867125371338229898
  ... 
  ... -----------------------------191893153320867125371338229898
  ... Content-Disposition: form-data; name="field.hackergotchi"; filename="wide.png"
  ... Content-Type: image/png
  ... 
  ... %s
  ... -----------------------------191893153320867125371338229898
  ... Content-Disposition: form-data; name="FORM_SUBMIT"
  ... 
  ... Continue
  ... -----------------------------191893153320867125371338229898--
  ... """ % icon)
  HTTP/1.1 200 Ok
  ...
  ...An error occured...
  ...




Testing the upload of a file that is not a image.
  
  
  >>> print http(r"""
  ... POST /people/name12/+edithackergotchi HTTP/1.1
  ... Authorization: Basic dGVzdEBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------10224279862908137151495771256
  ... 
  ... -----------------------------10224279862908137151495771256
  ... Content-Disposition: form-data; name="field.hackergotchi"; filename="msg.txt"
  ... Content-Type: text/plain
  ... 
  ... -----BEGIN PGP MESSAGE-----
  ... Version: GnuPG v1.2.5 (GNU/Linux)
  ... 
  ... hQEOA5ph9yyMtmo2EAQAhApcdZiE6L096McapzDwAb/5ki+atQtFuiAkyukcqdR/
  ... A2S+Y3wxo+UcjQIdaMmqS+D2uXkdc0f8eleiWeF6wSh21va1RgSeAmC/tSLllUaq
  ... mWtI3o0wF9b002tIjMUd6folU+nv9N6YptgG6wzB3Fc/hw1vtsxTctW4cgZOt88D
  ... /07hsPQylFjQQ4cQJlklKz05um0ZspxsJ1UzAH47uW89adAOf9tMilzkLI4CTXuC
  ... x/QmcblfOfXiMF8Dy6SVvZWk3ahDdxtsJ8zbMI4WPzRI7yz4Ied05jK4lG0gOIpF
  ... A5t+UkBvYfsMM4CvQPG5EGj6UY55FckXOc2PZ1iQeebU0sDDAdj71QevH5UW0lg5
  ... kUpNqNLg86M9035k/XhJiPh027ANGcutQtGBPst4FtF6KMnRTqd38NaXfHYIeaY/
  ... uRcDB5aw5KyyJIR+a8N5WznouVquSrSlsB5PXj2GTIk67R0HQrevVBhM+o2KcDyJ
  ... kYDBBsWdH3QCbYqnZ0VvLAD5OdKvYG26QPY6ijHVL14IqYOQC4/yHFilQhaxnxG5
  ... QZLw2zugH5YwvV7ShbB4N10Sb9THLu2pfIVFQ55zh+rhDsAQNr9sFcezSJFx1rcr
  ... Uih2AKp/srma6jJSU+2SGEsitoxiEhimk09F39aXPJNi9SZAf41yc/fcqONH7Ubf
  ... 9HJijpkieZhq3cIPNp8EQ3MfBOUIboooy8DVoflRBa55jJiurgJhBzDWCvUvIci0
  ... Yhi9k/ueB9ym00w/eWfJS35XPO9jsGyStoeAY2V0eZnSe9as9CKWEtnyg84YO0K9
  ... hEIHdUKb/b+XRIT+vwFYCBQ77oNLg9Pfr0izcRY0kaFRJa9DB2GR
  ... =n7J4
  ... -----END PGP MESSAGE-----
  ... 
  ... -----------------------------10224279862908137151495771256
  ... Content-Disposition: form-data; name="FORM_SUBMIT"
  ... 
  ... Continue
  ... -----------------------------10224279862908137151495771256--
  ... """)
  HTTP/1.1 200 Ok
  ...
  ...An error occured...
  ...


