= Announcements =

Projects can publish a list of news and announcements on Launchpad. The list
is available as a portlet on the project home page, as well as on a
dedicated batched page showing all announcements, and as an RSS/Atom news
feed.

== Making an announcement ==

If you are not logged in, you don't see the link to make an announcement.

    >>> anon_browser.open('http://launchpad.dev/apache/')
    >>> anon_browser.getLink('Make announcement')
    Traceback (most recent call last):
    ...
    LinkNotFoundError

Logged in users can only see it if they have launchpad.Edit on the pillar.

    >>> nopriv_browser = setupBrowser(auth="Basic no-priv@canonical.com:test")
    >>> nopriv_browser.open('http://launchpad.dev/apache/')
    >>> nopriv_browser.getLink('Make announcement')
    Traceback (most recent call last):
    ...
    LinkNotFoundError

    >>> priv_browser = setupBrowser(auth="Basic mark@hbd.com:test")
    >>> priv_browser.open('http://launchpad.dev/apache/')
    >>> link = priv_browser.getLink('Make announcement')
    >>> print link.text
    Make announcement

When there are no announcements for a project, there should be no "Latest
news" portlet:

    >>> "Latest news" not in priv_browser.contents
    True

Following the action link takes you to a form where you can make the
announcement:

    >>> link.click()
    >>> priv_browser.getControl('Headline').value = (
    ...     'Apache announcement headline')
    >>> priv_browser.getControl('Summary').value = (
    ...     'Apache announcement summary')
    >>> priv_browser.getControl('URL').value = (
    ...     'http://apache.org/announcement/rocking/')
    >>> priv_browser.getControl('Make announcement').click()

Making the announcement takes the user back to the main page for the
project.

    >>> print priv_browser.url
    http://launchpad.dev/apache

And now there is news, so we see the "Latest news" portlet.

    >>> "Latest news" not in priv_browser.contents
    False

We'll repeat the process for Tomcat, an IProduct that is part of the Apache
project, but this time we won't specify a URL, and we will specify a date
the announcement was made:

    >>> priv_browser.open('http://launchpad.dev/tomcat/')

Because Tomcat is part of the Apache group, it picks up on the Apache
announcement so there is a "Latest news" portlet:

    >>> "Latest news" not in priv_browser.contents
    False
    >>> priv_browser.getLink('Make announcement').click()
    >>> priv_browser.getControl('Headline').value = (
    ...     'Tomcat announcement headline')
    >>> priv_browser.getControl('Summary').value = (
    ...     'Tomcat announcement summary')
    >>> priv_browser.getControl('specific date and time').click()
    >>> priv_browser.getControl(
    ...     name='field.publication_date.announcement_date').value = (
    ...          '2006-12-24 09:00:00')
    >>> priv_browser.getControl('Make announcement').click()
    >>> print priv_browser.url
    http://launchpad.dev/tomcat
    >>> "Latest news" not in priv_browser.contents
    False

We'll repeat the process for Derby, an IProduct that is part of the Apache
project, but this time we won't specify a URL, and we'll make the
announcement immediately:

    >>> priv_browser.open('http://launchpad.dev/derby')
    >>> "Latest news" in priv_browser.contents
    True
    >>> priv_browser.getLink('Make announcement').click()
    >>> priv_browser.getControl('Headline').value = (
    ...     'Derby announcement headline')
    >>> priv_browser.getControl('Summary').value = (
    ...     'Derby announcement summary')
    >>> priv_browser.getControl('Make announcement').click()
    >>> print priv_browser.url
    http://launchpad.dev/derby
    >>> "Latest news" in priv_browser.contents
    True

We'll repeat the process for Jokosher, an IProduct that is not part of any
project, but this time we won't specify a URL, and we will specify a date
in the future when the announcement will be made:

    >>> priv_browser.open('http://launchpad.dev/jokosher/')
    >>> "Latest news" not in priv_browser.contents
    True
    >>> priv_browser.getLink('Make announcement').click()
    >>> priv_browser.getControl('Headline').value = (
    ...     'Jokosher announcement headline')
    >>> priv_browser.getControl('Summary').value = (
    ...     'Jokosher announcement summary')
    >>> priv_browser.getControl('specific date and time').click()
    >>> priv_browser.getControl(
    ...     name='field.publication_date.announcement_date').value = (
    ...          '2021-12-24 09:00:00')
    >>> priv_browser.getControl('Make announcement').click()
    >>> print priv_browser.url
    http://launchpad.dev/jokosher
    >>> "Latest news" not in priv_browser.contents
    False

And again for Kubuntu, an IDistribution, but this time we won't
specify a date for the announcement at all:

    >>> priv_browser.open('http://launchpad.dev/kubuntu/')
    >>> "Latest news" not in priv_browser.contents
    True
    >>> priv_browser.getLink('Make announcement').click()
    >>> priv_browser.getControl('Headline').value = (
    ...     'Kubuntu announcement headline')
    >>> priv_browser.getControl('Summary').value = (
    ...     'Kubuntu announcement summary')
    >>> priv_browser.getControl('some time in the future').click()
    >>> priv_browser.getControl('Make announcement').click()
    >>> print priv_browser.url
    http://launchpad.dev/kubuntu
    >>> "Latest news" not in priv_browser.contents
    False

== Listings ==

There is a listing page, +announcements, for each pillar that has
announcements. We will verify that the page is present and that it works as
expected.

First, let's make sure the page is useful when there are no announcements!

    >>> anon_browser.open('http://launchpad.dev/netapplet/+announcements')
    >>> 'no announcements for this project' in anon_browser.contents
    True

Now, let's look at the announcements we created earlier.

First, lets take a look at Kubuntu. The announcement we made there was to be
published "some time in the future" so it should not be visible to a user
who is not logged in:

    >>> anon_browser.open('http://launchpad.dev/kubuntu/+announcements')
    >>> 'no announcements for this project' in anon_browser.contents
    True
    >>> 'Kubuntu announcement' in anon_browser.contents
    False

However, if we log in, then we should see the announcement, ready to be
edited or published:

    >>> priv_browser.open('http://launchpad.dev/kubuntu/+announcements')
    >>> 'no announcements for this project' in priv_browser.contents
    False
    >>> 'Kubuntu announcement' in priv_browser.contents
    True

Since this announcement has no confirmed publishing date, we should see an
alert to that effect:

    >>> 'No publishing date set' in priv_browser.contents
    True

We can publish this announcement immediately.

    >>> priv_browser.getLink('Publish now!').click()
    >>> priv_browser.url
    'http://launchpad.dev/kubuntu/+announceme.../+publish'
    >>> radio = priv_browser.getControl(name="field.publication_date.action")
    >>> radio.value = ['immediately']
    >>> priv_browser.getControl('Publish').click()

Doing so takes us back to the list of announcements.

    >>> priv_browser.url
    'http://launchpad.dev/kubuntu/+announcements'

And since the announcement has been made, the great unwashed can now see it
too:

    >>> anon_browser.open('http://launchpad.dev/kubuntu/+announcements')
    >>> 'no announcements' in anon_browser.contents
    False
    >>> 'Kubuntu announcement' in anon_browser.contents
    True


Now let's check the announcement listings on products and projects.

First, we made an announcement for Jokosher, which is to be made in the
future.

Anonymous users should not see it.

    >>> anon_browser.open('http://launchpad.dev/jokosher/+announcements')
    >>> 'no announcements for this project' in anon_browser.contents
    True
    >>> 'Jokosher announcement' in anon_browser.contents
    False

However, we should see it if we have admin permissions for Jokosher:

    >>> priv_browser.open('http://launchpad.dev/jokosher/+announcements')
    >>> 'no announcements for this project' in priv_browser.contents
    False
    >>> 'Jokosher announcement' in priv_browser.contents
    True

Now, let's take a look at announcements on the Apache project.

We made three relevant announcements:

  1. On apache, published immediately
  2. On Tomcat, published at a date in the past
  3. On Derby, published immediately

Since a project publishes all the news for itself and for each of the
projects that are part of it, all three should be visible to the public
on Apache's announcements page:

    >>> anon_browser.open('http://launchpad.dev/apache/+announcements')
    >>> 'no announcements for this project' in anon_browser.contents
    False
    >>> 'Apache announcement headline' in anon_browser.contents
    True
    >>> 'Tomcat announcement headline' in anon_browser.contents
    True
    >>> 'Derby announcement headline' in anon_browser.contents
    True

Let's take a look at the Tomcat page. We should see the Tomcat announcement,
and the Apache (group) announcement, but not the Derby announcement:

    >>> anon_browser.open('http://launchpad.dev/tomcat/+announcements')
    >>> 'no announcements for this project' in anon_browser.contents
    False
    >>> 'Apache announcement headline' in anon_browser.contents
    True
    >>> 'Tomcat announcement headline' in anon_browser.contents
    True
    >>> 'Derby announcement headline' in anon_browser.contents
    False

