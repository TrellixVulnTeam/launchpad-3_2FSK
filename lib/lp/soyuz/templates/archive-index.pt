<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
  >
<body>
    <metal:block fill-slot="head_epilogue">
      <tal:devmode condition="devmode">
        <tal:archive_js define="lp_js string:${icingroot}/build">
          <script type="text/javascript"
                  tal:attributes="src string:${lp_js}/soyuz/base.js">
          </script>
          <script type="text/javascript"
                  tal:attributes="src string:${lp_js}/soyuz/lp_dynamic_dom_updater.js">
          </script>
          <script type="text/javascript"
                  tal:attributes="src string:${lp_js}/soyuz/update_archive_build_statuses.js">
          </script>
        </tal:archive_js>
      </tal:devmode>
      <script type="text/javascript" id="repository-size-update"
              tal:condition="view/archive_url">
YUI().use('io-base', 'lazr.anim', 'node', 'soyuz-base',
          'soyuz.update_archive_build_statuses', function(Y) {


/*
 * Update the page based on the XHR response.
 */
function doUpdate(transaction_id, response, args) {
    args.container.set('innerHTML', response.responseText);
}


/*
 * Communicate the update has failed and allow the user to retry
 * the operation.
 */
function informFailure(transaction_id, response, args) {
    function retry_handler (e) {
        e.preventDefault();
        dispatchUpdate();
    };

    var failure_message = Y.soyuz.makeFailureNode(
        'Failed to fetch repository size ...', retry_handler);

    args.container.set('innerHTML', '');
    args.container.appendChild(failure_message);

    var anim = Y.lazr.anim.red_flash({
        node: failure_message
        });
    anim.run();
}


/*
 * Communicate an update is in progress and fire the XHR.
 */
function dispatchUpdate () {
    in_progress_message = Y.soyuz.makeInProgressNode(
        'Fetching repository size ...')

    var container = Y.get('#package-counters td');
    container.set('innerHTML', '');
    container.appendChild(in_progress_message);

    var uri = '+repository-size';
    var xhr_config = {
        on: {
            success: doUpdate,
            failure: informFailure
        },
        arguments: {
            'container': container
        }
    };

    Y.io(uri, xhr_config);
}

Y.on("domready", dispatchUpdate);
});
      </script>
      <style type="text/css" media="screen, print">
tr#package-counters p{
    margin-bottom: 3.4em;
}
      </style>
    </metal:block>

    <div metal:fill-slot="main"
         tal:define="archive_active view/has_sources;
                     archive_label  view/archive_label;"
         tal:attributes="class string:archive">

      <tal:privacy replace="structure context/@@+portlet-privacy" />

      <h1 tal:condition="context/enabled"
          tal:replace="structure view/displayname_edit_widget">
        PPA for user
      </h1>
      <h1 tal:condition="not: context/enabled"
          tal:content="CONTEXTS/fmt:pagetitle"
          class="disabled">
        PPA for user
      </h1>

      <p tal:condition="not: context/enabled"
         style="clear: right;" class="warning message">
        This archive has been disabled.
      </p>

      <div class="actions" style="float:right;">
        <tal:edit
          define="link context/menu:context/edit"
          condition="link/enabled"
          replace="structure link/render" />
        <tal:administer
          define="link context/menu:context/admin"
          condition="link/enabled"
          replace="structure link/render" />
        <tal:manage-subscribers
          define="link context/menu:context/manage_subscribers"
          condition="link/enabled"
          replace="structure link/render" />
      </div>

      <div tal:define="archive context"
           tal:condition="archive_active"
           id="build-status-summary">
        <h2>
          <tal:archive_label replace="archive_label" /> build status
        </h2>

        <metal:build-status-summary
            use-macro="archive/@@+macros/build-status-summary" />

        <div class="actions">
          <tal:builds
            define="link context/menu:context/builds"
            condition="link/enabled"
            replace="structure link/render" />
        </div>

      </div>

      <div id="description" tal:condition="context/description">
        <fieldset>
          <legend>Description</legend>
          <tal:archive-description condition="context/description"
             replace="structure context/description/fmt:text-to-html" />
        </fieldset>
      </div>

      <table id="archive-details-table">
        <tbody>
          <tr id="upload-hint"
              tal:condition="context/required:launchpad.Append">
            <th>Upload packages:</th>
            <td>
              <tt>dput ppa:<tal:owner-name
                  replace="context/owner/name" />/<tal:ppa-name
                  replace="context/name" /> &lt;source.changes&gt;</tt>
              (<a href="https://help.launchpad.net/Packaging/PPA/Uploading"
                 >Read about uploading</a>)
            </td>
          </tr>
          <tr id="package-counters" tal:condition="view/archive_url">
            <th>Repository disk usage:</th>
            <td>
                <p class="discreet">
                  Package counters and estimated archive size temporarily
                  unavailable.
                </p>
            </td>
          </tr>
          <tr id="archive-dependencies" tal:condition="archive_active">
            <th>Build dependencies:</th>
            <td>
              <ul>
                <li tal:repeat="dependency context/dependencies">
                  <a tal:attributes="href dependency/dependency/fmt:url"
                     tal:content="dependency/title" />
                  (included <span
                   tal:replace="dependency/date_created/fmt:displaydate" />)
                </li>
             </ul>
             <div class="actions">
               <tal:edit-dependencies
                 define="link context/menu:context/edit_dependencies"
                 condition="link/enabled"
                 replace="structure link/fmt:link-icon" />
             </div>
            </td>
          </tr>
          <tr id="signing-key"
              tal:define="signing_key context/signing_key"
              tal:condition="signing_key">
            <th>Signing key:</th>
            <td>
              <a tal:attributes="href signing_key/keyserverURL">
                <code tal:content="signing_key/displayname"
                  >1024R/23456789</code>
              </a>
              (<a href="/+help/soyuz/ppa-sources-list.html"
                  target="help">What is this?</a>)
            </td>
          </tr>
          <tr id="install-hint" tal:condition="view/archive_url">
            <th>Install packages:</th>
            <td>
              <p>Copy the lines below and add them to your system's software
                 sources. (<a href="/+help/soyuz/ppa-sources-list.html"
                             target="help">Read about installing</a>)</p>
              <tal:entries replace="structure view/sources_list_entries" />
            </td>
          </tr>
        </tbody>
      </table>

      <tal:package-copy-request-list tal:condition="context/is_copy">
        <metal:package-copy-request-list
            use-macro="context/@@+macros/package-copy-request-list" />
      </tal:package-copy-request-list>

      <p tal:condition="not: archive_active">
        This <tal:archive_label replace="archive_label" /> does not contain
        any packages yet. Find more information about how to upload
        packages in the <a href="https://help.launchpad.net/Packaging/PPA"
        >PPA help page</a>
      </p>

      <tal:active_archive condition="archive_active">

      <div class="actions" style="clear:right;float:right;">
        <tal:copy
          define="link context/menu:context/copy"
          condition="link/enabled"
          replace="structure link/render" />
        <tal:delete
          define="link context/menu:context/delete"
          condition="link/enabled"
          replace="structure link/render" />
      </div>

      <metal:package_filter_form
              use-macro="context/@@+macros/package-filter-form" />

      <metal:package-list
          use-macro="context/@@+macros/source-package-list" />

      </tal:active_archive>

    </div> <!--main -->

  </body>
</html>
