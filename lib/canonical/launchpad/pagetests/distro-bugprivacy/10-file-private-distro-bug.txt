Foo Bar files a security (private) bug on Ubuntu Linux. He gets
redirected to the bug page.

    >>> browser.addHeader("Authorization", "Basic foo.bar@canonical.com:test")
    >>> browser.open("http://launchpad.dev/distros/ubuntu/+filebug")

Ubuntu has no security contact, so the Ubuntu maintainer, Ubuntu Team,
will be subscribed instead.

    >>> print browser.contents
    <!DOCTYPE...
    ...The maintainer of...Ubuntu...Ubuntu Team...will be notified...
    ...

    >>> browser.getControl(name="packagename_option").value = ["choose"]
    >>> browser.getControl(name="field.packagename").value = "evolution"
    >>> browser.getControl(name="field.title").value = "a private bug"
    >>> browser.getControl(name="field.comment").value = "secret info"
    >>> browser.getControl(
    ...     "This bug is a security vulnerability").selected = True
    >>> browser.getControl("Submit Bug Report").click()

    >>> print browser.url
    http://launchpad.dev/distros/ubuntu/+source/evolution/+bug/11

    >>> print browser.contents
    <!DOCTYPE...
    ...Security-related bugs are by default...private...

Foo Bar sees the private bug he filed.

    >>> browser.open("http://launchpad.dev/distros/ubuntu/+bugs")
    >>> print browser.contents
    <!DOCTYPE...
    ...
    ...Ubuntu Linux...
    ...<a...>...11...</a>...

Foo Bar and the Ubuntu Team are subscribed to the bug.

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.ftests import login, logout
    >>> from canonical.launchpad.interfaces import IBugSet

    >>> login("foo.bar@canonical.com")

    >>> bug = getUtility(IBugSet).get(11)

    >>> sorted(subscriber.name for subscriber in bug.getDirectSubscribers())
    [u'name16', u'ubuntu-team']

    >>> logout()

Now let's set an Ubuntu security team, and see how the filebug page and
subscriptions differ.

    >>> browser.open("http://launchpad.dev/distros/ubuntu/+securitycontact")
    >>> browser.getControl("Security Contact").value = "name12"
    >>> browser.getControl("Change").click()

    >>> browser.open("http://launchpad.dev/distros/ubuntu/+filebug")

    >>> print browser.contents
    <!DOCTYPE...
    ...The security contact for...Ubuntu...Sample Person...will be notified...
    ...

    >>> browser.getControl(name="packagename_option").value = ["choose"]
    >>> browser.getControl(name="field.packagename").value = "evolution"
    >>> browser.getControl(name="field.title").value = "a private bug"
    >>> browser.getControl(name="field.comment").value = "secret info"
    >>> browser.getControl(
    ...     "This bug is a security vulnerability").selected = True
    >>> browser.getControl("Submit Bug Report").click()

    >>> print browser.url
    http://launchpad.dev/distros/ubuntu/+source/evolution/+bug/12

Now only the reporter and /security contact/ are subscribed.

    >>> login("foo.bar@canonical.com")

    >>> bug = getUtility(IBugSet).get(12)

    >>> sorted(subscriber.name for subscriber in bug.getDirectSubscribers())
    [u'name12', u'name16']

    >>> logout()
