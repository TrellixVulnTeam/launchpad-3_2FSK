<tal:do-this-first condition="view/processForm" />
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

  <metal:leftportlets fill-slot="portlets_one">
    <div tal:replace="structure context/@@+portlet-details" />
  </metal:leftportlets>

  <metal:rightportlets fill-slot="portlets_two">
    <div tal:replace="structure context/@@+portlet-actions" />
  </metal:rightportlets>

  <div metal:fill-slot="main">
  
    <tal:block condition="view/standardShipItRequests">

      <tal:block condition="not: view/currentRequest">
        <h1>How many CDs would you like?</h1> 

        <p>Since shipping will often be more than the cost of the CDs, please
        feel free to request multiple CDs to give away and share with
        friends.</p>
      </tal:block>

      <tal:block condition="view/currentRequest">
        <h1>Your current ShipIt request</h1>

        <table cols="2">
          <tr>
            <td align="right"><strong>Date Requested:</strong></td>
            <td tal:content="view/currentRequest/daterequested/fmt:date" />
          </tr>
          <tr>
            <td align="right"><strong>Status:</strong></td>
            <td>
              <span tal:condition="view/currentRequest/approved">
                Approved
              </span>
              <span tal:condition="not: view/currentRequest/approved">
                Waiting for approval
              </span>
          </tr>
          <tr tal:condition="view/currentRequest/quantityx86">
            <td align="right"><strong>X86 CDs:</strong></td>
            <td tal:content="view/currentRequest/quantityx86" />
          </tr>
          <tr tal:condition="view/currentRequest/quantityamd64">
            <td align="right"><strong>AMD64 CDs:</strong></td>
            <td tal:content="view/currentRequest/quantityamd64" />
          </tr>
          <tr tal:condition="view/currentRequest/quantityppc">
            <td align="right"><strong>PowerPC CDs:</strong></td>
            <td tal:content="view/currentRequest/quantityppc" />
          </tr>
        </table>

        <div class="form controls">
          <form name="cancelrequest" action="" method="POST">
            <input type="submit" value="Cancel Request" name="cancelrequest"
                   class="formControls"/>
          </form>
        </div>

      </tal:block>
        
      <tal:block condition="view/errorMessages">
        <p class="portalMessage">There are errors in the form data. Please see the
        messages below.</p>
      </tal:block>
      <br />

      <tal:block condition="not: view/currentRequest">
        <p>These CDs come in three types. Choose:</p>

        <ul>
        <li><strong>Intel/x86</strong> to run on almost all PCs. This
        includes most machines with Intel/AMD/etc type processors and
        computers that can also run Microsoft Windows. Choose this if
        you are unsure.</li>

        <li><strong>PowerPC</strong> to run on Apple Macintosh
        G3, G4, and G5 computers including iBooks and PowerBooks.</li> 

        <li><strong>AMD64</strong> to run on computers based on the
        AMD64 or EM64T architecture (e.g., Athlon64, Opteron, EM64T
        Xeon). Most CPUs made by AMD require an Intel/x86 CD. Only
        specialized 64bit CPUs require this special architecture.</li>
        </ul>

        <br />
      </tal:block>

      <tal:block condition="view/errorMessages">
        <p class="portalMessage" tal:repeat="msg view/errorMessages" 
           tal:content="msg" />
      </tal:block>

      <h2>Request Details</h2>

      <form name="shipit" action="" method="POST">

      <table cols="2">
        <tr>
          <td>
            <label>
              <input type="radio" name="requesttype" value="standard" 
                     onClick="javascript: updateWidgets()"
                     tal:attributes="checked not:view/isCustomRequest" />
              Standard request
            </label>
            <div style="margin: 0em 2em">
              <div>The standard requests are more likely to be approved than 
                custom ones, so unless you have special requirements, you 
                should choose a standard one.
              </div>
              <select name="standardrequest" class="listing">
                <tal:block tal:condition="view/selectedRequest|nothing">
                  <option tal:repeat="request view/standardShipItRequests"
                          tal:attributes="
                            value request/id;
                            selected python: view.selectedRequest == request.id"
                          tal:content="request/description">
                    Request description
                  </option>
                </tal:block>
                <tal:block tal:condition="not: view/selectedRequest|nothing">
                  <option tal:repeat="request view/standardShipItRequests"
                          tal:attributes="value request/id; selected request/isdefault"
                          tal:content="request/description">
                    Request description
                  </option>
                </tal:block>
              </select>
            </div>
                      
          </td>
        </tr>
        <tr>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            <label>
              <input type="radio" name="requesttype" value="custom"
                     onClick="javascript: updateWidgets()"
                     tal:attributes="checked view/isCustomRequest"/>
              Custom request
            </label>

            <div style="margin: 0em 2em">
            <table>
              <tr>
                <td align="right"><strong>Intel/x86:</strong></td>
                <td>
                  <tal:block tal:condition="view/isCustomRequest">
                    <input tal:attributes="value view/quantityx86" 
                           type="text" size="5" align="right" 
                           name="quantityx86" />
                  </tal:block>
                  <tal:block tal:condition="not: view/isCustomRequest">
                    <input type="text" size="5" align="right" 
                           name="quantityx86" />
                  </tal:block>
                </td>
                <td align="right"><strong>PowerPC:</strong></td>
                <td>
                  <tal:block tal:condition="view/isCustomRequest">
                    <input tal:attributes="value view/quantityppc" 
                           type="text" size="5" align="right" 
                           name="quantityppc" />
                  </tal:block>
                  <tal:block tal:condition="not: view/isCustomRequest">
                    <input type="text" size="5" align="right" 
                           name="quantityppc" />
                  </tal:block>
                </td>
                <td align="right"><strong>AMD64:</strong></td>
                <td>
                  <tal:block tal:condition="view/isCustomRequest">
                    <input tal:attributes="value view/quantityamd64" 
                           type="text" size="5" align="right" 
                           name="quantityamd64">
                  </tal:block>
                  <tal:block tal:condition="not: view/isCustomRequest">
                    <input type="text" size="5" align="right" 
                           name="quantityamd64" />
                  </tal:block>
                </td>
              </tr>
              <tr>
                <td colspan="6">
                </td>
              </tr>
              <tr>
                <td colspan="6">
                    <strong>Reason for custom request:</strong>
                    <textarea name="reason" rows="2"
                              tal:content="view/reason|nothing" />
                </td>
              </tr>
            </table>
            </div>
          </td>
        </tr>
      </table>

      <h1>Contact Information</h1>

      <table>
        <tr>
          <td align="right"><strong>Organization:</strong></td>
          <td>
            <input tal:attributes="value view/organization|context/organization" type="text"
                   name="organization" size="30" />
          </td>
        </tr>
        <tr>
          <td align="right"><strong>Address:</strong></td>
          <td>
            <input tal:attributes="value view/addressline1|context/addressline1" type="text"
                   name="addressline1" size="30" maxlength="30"/>
            <span class="formHelp">(required)</span>
          </td>
        </tr>
        <tr>
          <td align="right"></td>
          <td>
            <input tal:attributes="value view/addressline2|context/addressline2" type="text"
                   name="addressline2" size="30" maxlength="30" />
          </td>
        </tr>
        <tr>
          <td align="right"><strong>City/Town/etc:</strong></td>
          <td>
            <input tal:attributes="value view/city|context/city" type="text"
                   name="city" size="30" maxlength="30" />
            <span class="formHelp">(required)</span>
          </td>
        </tr>
        <tr>
          <td align="right"><strong>State/etc:</strong></td>
          <td>
            <input tal:attributes="value view/province|context/province" type="text"
                   name="province" size="30" maxlength="30" />
          </td>
        </tr>
        <tr>
          <td align="right"><strong>Postcode:</strong></td>
          <td>
            <input tal:attributes="value view/postcode|context/postcode" type="text"
                   name="postcode" size="12" maxlength="12" />
            <span id="postcode-required" class="formHelp">(required)</span>
          </td>
        </tr>
        <tr>
          <td align="right"><strong>Country:</strong></td>
          <td>
            <span tal:replace="structure view/country_widget" />
          </td>
        </tr>
        <tr>
          <td align="right"><strong>Phone:</strong></td>
          <td>
            <input tal:attributes="value view/phone|context/phone" type="text"
                   name="phone" size="16" maxlength="16" />
          </td>
        </tr>
      </table>

      <div style="text-align: right">
        <tal:block condition="not: view/currentRequest">
          <input type="submit" value="Request CDs" name="newrequest"
                 class="formControls"/>
        </tal:block>

        <tal:block condition="view/currentRequest">
          <input type="submit" value="Change Request Details" 
                 class="formControls" name="changerequest" />
        </tal:block>
      </div>

      </form>

      <tal:block condition="view/currentRequest">
        <p>These CDs come in three types:</p>

        <ul>
        <li><strong>Intel/x86</strong> to run on almost all PCs. This
        includes most machines with Intel/AMD/etc type processors and
        computers that can also run Microsoft Windows. Choose this if
        you are unsure.</li>

        <li><strong>PowerPC</strong> to run on Apple Macintosh
        G3, G4, and G5 computers including iBooks and PowerBooks.</li> 

        <li><strong>AMD64</strong> to run on computers based on the
        AMD64 or EM64T architecture (e.g., Athlon64, Opteron, EM64T
        Xeon). Most CPUs made by AMD require an Intel/x86 CD. Only
        specialized 64bit CPUs require this special architecture.</li>
        </ul>

        <br />
      </tal:block>
      <script type="text/javascript">
        function updateWidgets() {
          var form = document.forms['shipit'];
          state = (form.requesttype[0].checked == false);
          form.standardrequest.disabled = state;
          form.quantityx86.disabled = ! state;
          form.quantityppc.disabled = ! state;
          form.quantityamd64.disabled = ! state;
          form.reason.disabled = ! state;
          // XXX: would be nice to focus quantityx86 and standardrequest
        }
      updateWidgets();
      //</script>

    </tal:block>

    <tal:block condition="not: view/standardShipItRequests">
      <h1>ShipIt is not yet open for new orders</h1>
    </tal:block>

  </div>

</body>
</html>
