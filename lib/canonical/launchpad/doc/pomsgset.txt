POMsgSet
========

A POMsgSet represents a concrete msgset translation from a POFile.

It's linked with a POTMsgSet that has the English strings that are being
translated.

Get the PO msgid we will be working with.

  >>> from canonical.launchpad.database import POMsgSet, POMsgID, Language
  >>> from canonical.launchpad.database import POTemplate
  >>> pomsgid = POMsgID.byMsgid('evolution addressbook')

Carlos is the one that will do the uploads.

  >>> from zope.component import getUtility
  >>> from canonical.launchpad.interfaces import IPersonSet
  >>> carlos = getUtility(IPersonSet).getByName('carlos')

Now find the po template.

  >>> upstream_evo = POTemplate.get(1)
  >>> upstream_evo.productseries is not None
  True

  >>> upstream_evo.productseries.product.name
  u'evolution'

We will be working in Catalan (ca).

We need the right POMsgSet. We'll get the PO File, then, create the needed
po msgset there.

  >>> upstream_pofile = upstream_evo.newPOFile('ca')
  >>> upstream_pomsgset = upstream_pofile.createMessageSetFromText(
  ...     u'evolution addressbook')

Show that there are no active translations and no suggestions.

  >>> upstream_pomsgset.active_texts
  [None]
  >>> upstream_pomsgset.published_texts
  [None]
  >>> list(upstream_pomsgset.getSuggestedSubmissions(0))
  []

And the fuzzy flags should also be disabled

  >>> upstream_pomsgset.isfuzzy
  False
  >>> upstream_pomsgset.publishedfuzzy
  False

Let's add a fuzzy translation.

  >>> upstream_pomsgset.updateTranslationSet(carlos, { 0: u'foo' }, fuzzy=True, published=True)

Now it should appear as active and as published.

  >>> upstream_pomsgset.active_texts
  [u'foo']
  >>> upstream_pomsgset.published_texts
  [u'foo']

And also, the fuzzy flag should be set in both cases.

  >>> upstream_pomsgset.isfuzzy
  True
  >>> upstream_pomsgset.publishedfuzzy
  True

Now let's think that upstream removed that translation completely...

  >>> upstream_pomsgset.updateTranslationSet(carlos, { 0: ''}, fuzzy=False, published=True)

The active text should still have it as we never remove anything from Rosetta if upstream does it

  >>> upstream_pomsgset.active_texts
  [u'foo']

But the published one should disapper

  >>> upstream_pomsgset.published_texts
  [None]

And same with the fuzzy flags.

  >>> upstream_pomsgset.isfuzzy
  True
  >>> upstream_pomsgset.publishedfuzzy
  False

We use a DummyPOMsgSet when we don't have a POMsgSet for a given POFile and
POTMsgSet. First we'll get a DummyPOFile:

>>> pt_BR_dummypofile = upstream_evo.getDummyPOFile('pt_BR')

We get a POMsgSet and verify it's a singular form:

>>> pt_BR_dummypomsgset = pt_BR_dummypofile.getPOMsgSet(u'evolution addressbook')
>>> pt_BR_dummypomsgset.potmsgset.getPOMsgIDs().count()
1

>>> pt_BR_dummypomsgset.pluralforms
1
>>> pt_BR_dummypomsgset.active_texts
[None]

Using another dummy pofile we'll get a POMsgset that's not a
singular form: 

>>> apa_dummypofile = upstream_evo.getDummyPOFile('apa')
>>> apa_dummypomsgset = apa_dummypofile.getPOMsgSet(u'%d contact')

We don't know anything about pluralforms for this language, so we fall back to
the most common case:

>>> print apa_dummypomsgset.pofile.language.pluralforms
None
>>> print apa_dummypomsgset.pofile.pluralforms
None
>>> apa_dummypomsgset.pluralforms
2
>>> apa_dummypomsgset.active_texts
[None, None]

We can guess the pluralforms for this language thru IPOFile.pluralforms:

>>> apa_dummypomsgset.pofile.pluralforms = 4 
>>> apa_dummypomsgset.pluralforms
4
>>> apa_dummypomsgset.active_texts
[None, None, None, None]

Or thru ILanguage.pluralforms:

>>> ru_dummypofile = upstream_evo.getDummyPOFile('ru')
>>> ru_dummypomsgset = ru_dummypofile.getPOMsgSet(u'%d contact')

>>> print ru_dummypomsgset.pofile.language.pluralforms
3
>>> ru_dummypomsgset.pluralforms
3
>>> ru_dummypomsgset.active_texts
[None, None, None]
