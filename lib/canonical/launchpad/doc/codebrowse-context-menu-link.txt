= Bazaar Branch Browser Links =

We run a code browsing service at http://codebrowse.launchpad.net for
branches that are hosted or mirrored by Launchpad.  A link to the
codebrowse page for a branch is included in the actions menu on the
branch page.

Lets look at the link for one of the registered branches:

    >>> from zope.component import getUtility, queryAdapter
    >>> from canonical.launchpad.interfaces import IBranchSet
    >>> from canonical.launchpad.webapp.interfaces import IContextMenu

    >>> branch = getUtility(IBranchSet).get(1)
    >>> print branch.unique_name
    ~name12/firefox/main

    >>> def getBrowseLink(branch):
    ...     menu = queryAdapter(branch, IContextMenu)
    ...     for link in menu.iterlinks():
    ...         if link.name == 'browse':
    ...             return link
    ...     raise AssertionError('No browse link found')

    >>> link = getBrowseLink(branch)
    >>> print link.text
    Browse code
    >>> print link.url
    http://codebrowse.launchpad.dev/~name12/firefox/main
    >>> print link.enabled
    False

For this branch, the link is disabled because no revisions have been
published:

    >>> print branch.last_mirrored_id
    None

Log in the owner of the branch to allow launchpad.Edit so the user can
set the last_mirrored_id.

    >>> login('test@canonical.com')

When the branch is published by the branch puller, last_mirrored_id is
set to a non-NULL value.  When this occurs, the browse link is
enabled:

    >>> branch.revision_count = 42
    >>> link = getBrowseLink(branch)
    >>> print link.enabled
    True
