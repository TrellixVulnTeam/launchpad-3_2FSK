<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="malone"
>

<metal:block fill-slot="head_epilogue">
<script type="text/javascript">
function show_patch(id) {
    var div = document.getElementById('patch-row-' + id);
    if (div) {
        div.style.display = "block";
    }
}
function hide_patch(id) {
    var div = document.getElementById('patch-row-' + id);
    if (div) {
        div.style.display = "none";
    }
}
</script>
</metal:block>

  <body>
    <div metal:fill-slot="main" class="tab-bugs"
         tal:define="batchnav view/batchedPatchTasks;
                     batch batchnav/currentBatch">

  <form class="lesser" name="sort" method="get"
        tal:attributes="action string:${context/fmt:url}/+patches">
    <metal:widget use-macro="context/@@+bugtarget-macros-search/sortwidget" />
    <input type="submit" value="sort" id="sort-button">
  </form>

    <table class="listing"><thead>
             <tr>
               <th style="padding-right: 1em;"
                   >Bug</th>
               <th style="padding-right: 1em;"
                   >Importance</th>
               <th style="padding-right: 1em;"
                   >Status</th>
               <th style="padding-right: 1em;"
                   tal:condition="view/shouldShowTargetName"
                   >Package</th>
               <th style="padding-right: 1em;"
                   >Patch Age</th>
             </tr>
           </thead>
           <tr tal:repeat="patch_task batch">
             <td style="padding-right: 1em;"
              ><a tal:replace="structure patch_task/bug/fmt:link" /></td>
             <td style="padding-right: 1em;"
                 tal:content="patch_task/importance/title"
                 tal:attributes="class string:importance${patch_task/importance/name}"></td>
             <td style="padding-right: 1em;"
                 tal:content="patch_task/status/title"
                 tal:attributes="class string:status${patch_task/status/name}"></td>
             <td style="padding-right: 1em;"
                 tal:condition="view/shouldShowTargetName"
                 ><a tal:attributes="href patch_task/target/fmt:url"
                     tal:content="patch_task/target/name"
                  ></a></td>
             <td style="padding-right: 1em;"
                 tal:define="p python:view.youngest_patch(patch_task.bug);
                             age python:view.patch_age(p)"
                 tal:attributes="onmouseover string:show_patch(${repeat/patch_task/index});
                                 onmouseout string:hide_patch(${repeat/patch_task/index});"
              ><a tal:attributes="href p/libraryfile/http_url"
                  tal:content="age/fmt:approximateduration/use-digits"
                  ></a>
               <div class="popupTitle"
                    tal:attributes="id string:patch-row-${repeat/patch_task/index};
                                    onmouseover string:hide_patch(${repeat/patch_task/index});">
                <p tal:define="submitter p/message/owner"
                   ><strong>From:</strong>
                    <a tal:replace="structure submitter/fmt:link"></a><br/>
                    <strong>Link:</strong>
                    <a tal:attributes="href p/libraryfile/http_url"
                       tal:content="p/libraryfile/filename"
                       ></a></p>
                <p tal:content="string:${p/title}"></p>
               </div>
             </td>
             </tr></table>
    <div tal:replace="structure batchnav/@@+navigation-links-lower" />
    </div><!-- main -->
  </body>
</html>
