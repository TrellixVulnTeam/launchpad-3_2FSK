= Submissions to the hardware database =

Submissions to the hardware database are done at the following URL:

    >>> browser.open('http://launchpad.dev/hwdb/submit-hardware-data')

All form fields must be filled with valid values.

    >>> from StringIO import StringIO
    >>> submit_data = {
    ...     'Date Created:': '2007-01-01',
    ...     'Format Version:': ['VERSION_1'],
    ...     'Unique Submission ID:': 'unique id 1',
    ...     'Email address:': 'test@canonical.com',
    ...     'Distribution:': 'ubuntu',
    ...     'Distribution Release:': '5.04',
    ...     'Processor Architecture:': 'x86',
    ...     'System name:': 'Fujitsu CY26',
    ... }
    >>> submit_data_checkboxes = {
    ...     'Private Submission': False,
    ...     'Contactable': False,
    ...     'Data from Live CD': False
    ... }
    >>> submit_file = StringIO('some data')
    >>> def fill_form(
    ...     browser, submit_data, submit_data_checkboxes, filedata, filename):
    ...     for label in submit_data.keys():
    ...         control = browser.getControl(label)
    ...         control.value = submit_data[label]
    ...     for label in submit_data_checkboxes.keys():
    ...         control = browser.getControl(label)
    ...         control.selected = submit_data_checkboxes[label]
    ...     if filedata is not None:
    ...         filedata.seek(0)
    ...         control = browser.getControl('Submission data:')
    ...         control.add_file(filedata, 'text/plain', filename)
    >>> fill_form(
    ...     browser, submit_data, submit_data_checkboxes, submit_file,
    ...     'test.txt')
    >>> browser.getControl('Upload').click()

For easy error checks by the HWDB client, an extra header is added, if the
data has successfully been uploaded.

    >>> print browser.headers
    Status: 200 Ok
    Content-Length: ...
    Content-Type: text/html;charset=utf-8
    Set-Cookie: launchpad_tests=...
    X-Launchpad-Hwdb-Submission: OK data stored
    ...

Human users get a message too.

    >>> for tag in find_tags_by_class(
    ...     browser.contents, 'informational message'):
    ...     print tag
    <div class="informational message">Thank you for your submission.</div>

If fields are not set, the response contains a header explaining this
error.

    >>> submit_data['Unique Submission ID:'] = 'unique id 2'
    >>> for field in ('Date Created:', 'Distribution Release:', 
    ...               'Distribution:', 'Email address:', 
    ...               'Processor Architecture:', 'System name:', 
    ...               'Unique Submission ID:'):
    ...     wrong_data = submit_data.copy()
    ...     del wrong_data[field]
    ...     browser.open('http://launchpad.dev/hwdb/submit-hardware-data')
    ...     fill_form(
    ...         browser, wrong_data, submit_data_checkboxes, submit_file,
    ...         'test.txt')
    ...     browser.getControl('Upload').click()
    ...     print "--- missing field", field
    ...     print browser.headers
    --- missing field Date Created:
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Date_created: Error - Required input is missing.
    ...
    --- missing field Distribution Release:
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Distrorelease: Error - Required input is missing.
    ...
    --- missing field Distribution:
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Distribution: Error - Required input is missing.
    ...
    --- missing field Email address:
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Emailaddress: Error - Required input is missing.
    ...
    --- missing field Processor Architecture:
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Architecture: Error - Required input is missing.
    ...
    --- missing field System name:
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-System: Error - Required input is missing.
    ...
    --- missing field Unique Submission ID:
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Submission_id: Error - Required input is missing.
    ...

The file with the test data must also be provided.

    >>> browser.open('http://launchpad.dev/hwdb/submit-hardware-data')
    >>> fill_form(
    ...     browser, wrong_data, submit_data_checkboxes, None, 'test.txt')
    >>> browser.getControl('Upload').click()
    >>> print browser.headers
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Submission_data: Error - Required input is missing.
    ...
 
If a submission uses an already existing submission ID, the submission 
is rejected and an explaining header is added to the response.

    >>> wrong_data = submit_data.copy()
    >>> wrong_data['Unique Submission ID:'] = 'unique id 1'
    >>> browser.open('http://launchpad.dev/hwdb/submit-hardware-data')
    >>> fill_form(
    ...     browser, wrong_data, submit_data_checkboxes, submit_file,
    ...     'test.txt')
    >>> browser.getControl('Upload').click()
    >>> print browser.headers
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Submission_id: Error - Submission ID already exists.
    ...

The field "Date Created" must contain a valid timestamp.

    >>> wrong_data = submit_data.copy()
    >>> wrong_data['Date Created:'] = 'no timestamp'
    >>> browser.open('http://launchpad.dev/hwdb/submit-hardware-data')
    >>> fill_form(
    ...     browser, wrong_data, submit_data_checkboxes, submit_file,
    ...     'test.txt')
    >>> browser.getControl('Upload').click()
    >>> print browser.headers
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Date_created: Error - Invalid datetime data
    ...

The field "Submission ID" may contain only ASCII characters.

    >>> wrong_data = submit_data.copy()
    >>> wrong_data['Unique Submission ID:'] = u'wrong id \xc0'.encode('utf8')
    >>> browser.open('http://launchpad.dev/hwdb/submit-hardware-data')
    >>> fill_form(
    ...     browser, wrong_data, submit_data_checkboxes, submit_file,
    ...     'test.txt')
    >>> browser.getControl('Upload').click()
    >>> print browser.headers
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Submission_id: Error - Invalid textual data
    ...

The field "Email address:" musr contain a valid email address.

    >>> wrong_data = submit_data.copy()
    >>> wrong_data['Email address:'] = 'no email'
    >>> browser.open('http://launchpad.dev/hwdb/submit-hardware-data')
    >>> fill_form(
    ...     browser, wrong_data, submit_data_checkboxes, submit_file,
    ...     'test.txt')
    >>> browser.getControl('Upload').click()
    >>> print browser.headers
    Status: 200 Ok
    ...
    X-Launchpad-Hwdb-Submission-Emailaddress: Error - no email isn't a valid email address.
    ...
