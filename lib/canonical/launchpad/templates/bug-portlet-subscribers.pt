<div
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  class="portlet"
  id="portlet-subscribers"
  metal:define-macro="custom"
>
  <div class="section" tal:define="context_menu context/menu:context"
       metal:define-slot="heading">
    <div tal:content="structure context_menu/subscription/render" />
    <div tal:content="structure context_menu/addsubscriber/render" />
  </div>
  <a id="subscribers-content-link"
     tal:attributes="href context/fmt:url/+bug-portlet-subscribers-content" />
  <script type="text/javascript">
    YUI().use('io', 'node', function(Y) {
      Y.on('contentready', function() {
        var portlet = Y.get('#portlet-subscribers');
        portlet.set('innerHTML',
                    portlet.get('innerHTML') +
                    '<' + 'div id="subscribers-portlet-spinner"' +
                    '     style="text-align: center">' +
                    '<img src="/@@/spinner" /><' + '/div>');
      }, '#portlet-subscribers');

      Y.on('domready', function() {
        var portlet = Y.get('#portlet-subscribers');

        function remove_spinner() {
          portlet.removeChild(Y.get('#subscribers-portlet-spinner'));
        }

        function on_success(transactionid, response, arguments) {
          remove_spinner();
          portlet.set('innerHTML',
                      portlet.get('innerHTML') + response.responseText);
        }

        var config = {on: {success: on_success,
                           failure: remove_spinner}};
        var url = Y.get('#subscribers-content-link').getAttribute('href');
        var request = Y.io(url, config);
      });
    });
  </script>
</div>
