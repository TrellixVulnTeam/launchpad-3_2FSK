<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="context/@@main_template/master"
  i18n:domain="launchpad"
>
  <body>
    <metal:portlets fill-slot="portlets">
      <div tal:replace="structure context/@@+portlet-details" />
      <div tal:replace="structure context/@@+portlet-binaries"
           tal:condition="context/binarypackages"/>
    </metal:portlets>

    <div metal:fill-slot="main">
        
      <h1 tal:content="CONTEXTS/fmt:pagetitle">PPA for user</h1>

      <div class="informational message"
           tal:condition="view/user_can_retry_build">
         <p> You can <a href="+retry">retry</a> this build if you think
             the failure was transient. Be aware that the previous
             build log and timestamps will be purged.</p>
      </div>

      <div id="build-details" style="padding-top: 1em;">

      <table>
        <tbody>

          <tr>
            <th>Changes file:</th>
            <td tal:condition="context/changesfile">
              <a tal:attributes="href context/changesfile/http_url"
                 tal:content="context/changesfile/filename">CHANGESFILE</a>
            </td>
            <td tal:condition="not:context/changesfile">
              <i>not available</i>
            </td>
          </tr>

          <tr>
            <th>Archive:</th>
            <td tal:condition="context/archive/purpose/enumvalue:PPA">
              <a tal:attributes="href context/archive/fmt:url">
               <span tal:replace="context/archive/owner/displayname"/> PPA
              </a>
            </td>
            <td tal:condition="not: context/archive/purpose/enumvalue:PPA">
               <span tal:replace="context/distribution/name"/> archive
            </td>
          </tr>

          <tr>
            <th>Component:</th>
            <td tal:content="context/current_component/name"/>
          </tr>

          <tr>
            <th>Status:</th>
            <td>
              <span tal:replace="context/buildstate/title" />
            </td>
          </tr>

          <tr tal:condition="context/dependencies">
            <th>Dependencies:</th>
            <td tal:content="context/dependencies" />
          </tr>

          <tr>
            <th>Queued:</th>
            <td
              tal:attributes="title context/datecreated/fmt:datetime"
              tal:content="context/datecreated/fmt:approximatedate" />
          </tr>

          <tal:buildstart
            define="estimated_buildstart context/estimated_buildstart"
            condition="estimated_buildstart">

            <tr tal:condition="python:estimated_buildstart.year == 1970">
              <th>Estimated build start:</th>
              <td
               tal:attributes="title estimated_buildstart/fmt:datetime">
                Not available
              </td>
            </tr>

            <tr tal:condition="python:estimated_buildstart.year != 1970">
              <th>Estimated build start:</th>
              <td
               tal:attributes="title estimated_buildstart/fmt:datetime"
               tal:content="estimated_buildstart/fmt:approximatedate">
                3 hours
              </td>
            </tr>

          </tal:buildstart>

          <tal:not_built condition="not: context/was_built">
            <tal:buildqueue condition="context/buildqueue_record"
                            define="bq context/buildqueue_record">
              <tal:bq_not_started condition="not: bq/builder">
                <tr>
                  <th>Build score:</th>
                  <td><span tal:replace="bq/lastscore"/></td>
                </tr>
              </tal:bq_not_started>
              <tal:bq_started condition="bq/buildstart">
                <tr>
                  <th>Started:</th>
                  <td
                    tal:attributes="title bq/buildstart/fmt:datetime"
                    tal:content="bq/buildstart/fmt:approximatedate" />
                </tr>
                <tr>
                  <th>Builder:</th>
                  <td> <a tal:content="bq/builder/title"
                          tal:attributes="href bq/builder/fmt:url"/></td>
                </tr>
              </tal:bq_started>
            </tal:buildqueue>
          </tal:not_built>

          <tal:built condition="context/was_built">
            <tr>
              <th>Started:</th>
              <td tal:condition="context/buildduration">
                <span
                  tal:define="start context/calculated_buildstart"
                  tal:attributes="title start/fmt:datetime"
                  tal:content="start/fmt:approximatedate" />
              </td>
              <td tal:condition="not: context/buildduration">
                 <i>not available</i>
              </td>
            </tr>

            <tr>
              <th>Builder:</th>
              <td tal:condition="context/builder">
                <a tal:content="context/builder/title"
                   tal:attributes="href context/builder/fmt:url"/>
              </td>
              <td tal:condition="not: context/builder">
                 <i>not available</i>
              </td>
            </tr>
          </tal:built>

          <tr>
            <th>Build log:</th>
            <td tal:condition="context/buildlog">
              <a tal:attributes="href context/buildlog/http_url"
                 tal:content="context/buildlog/filename">BUILDLOG</a>
            </td>
            <td tal:condition="not: context/buildlog">
              <i>not available</i>
            </td>
          </tr>

          <tr>
            <th>Finished:</th>
            <td tal:condition="context/datebuilt">
              <span
                tal:attributes="title context/datebuilt/fmt:datetime"
                tal:content="context/datebuilt/fmt:approximatedate"/>
              <tal:duration condition="context/buildduration">
                (took <span tal:replace="
                     context/buildduration/fmt:approximateduration"/>)
              </tal:duration>
            </td>
            <td tal:condition="not: context/datebuilt">
               <i>not available</i>
            </td>
          </tr>

        </tbody>
      </table>
      </div>

    </div>
  </body>
</html>

