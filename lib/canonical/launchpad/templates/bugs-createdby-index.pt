<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@malone_template/master"
      i18n:domain="malone">

<body>

<div metal:fill-slot="main" tal:define="owner python:request.get('owner', '')">

  <h1 tal:condition="owner">Bugs created by <span tal:content="request/owner">someone</span></h1>
  <h1 tal:condition="python: not owner">All Bugs</h1>
  <form method="GET" action="">
    <b>Show bugs for:</b>
    <select name="owner" onclick="form.submit()">
      <option value="" tal:attributes="selected python:not owner">All Users</option>
      <option tal:repeat="p view/getAllPeople"
              tal:content="p/name"
              tal:attributes="selected python:p.name == owner">someone</option>
    </select>
  </form>
  <table class="listing rowNavigation">
    <tr>
      <th>Bug</th>
      <th>Title</th>
      <th>Source Package/Product Assignment</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Severity</th>
      <th>Date Created</th>
      <th tal:condition="not:owner">Owner</th>
    </tr>
    <tr tal:repeat="bug view/getBugs"
        tal:attributes="onclick string:window.location='${bug/id}';">
      <span tal:define="sp_assignments bug/packageassignment;
                        p_assignments bug/productassignment">
        <td valign="top" align="center" tal:content="bug/id">$Bug.title</td>
        <td valign="top">
          <a tal:content="bug/title" tal:attributes="href bug/id">title</a>
        </td>
        <td valign="top">
          <div tal:repeat="spa sp_assignments"
               tal:content="python: '(s) ' + spa.sourcepackage.sourcepackagename.name"></div>
          <div tal:repeat="pa p_assignments"
               tal:content="python: '(p) ' + pa.product.title"></div>
        </td>
        <td valign="top">
          <div tal:repeat="spa sp_assignments"
               tal:content="spa/bugstatus/lp:BugAssignmentStatus"></div>
          <div tal:repeat="pa p_assignments"
               tal:content="pa/bugstatus/lp:BugAssignmentStatus"></div>
        </td>
        <td valign="top" nowrap>
          <div tal:repeat="spa sp_assignments"
               tal:content="spa/priority/lp:BugPriority"></div>
          <div tal:repeat="pa p_assignments"
               tal:content="pa/priority/lp:BugPriority"></div>
        </td>
        <td valign="top" nowrap>
          <div tal:repeat="spa sp_assignments"
               tal:content="spa/severity/lp:BugSeverity"></div>
          <div tal:repeat="pa p_assignments"
               tal:content="pa/severity/lp:BugSeverity"></div>
        </td>
        <td valign="top" tal:content="python:bug.datecreated.strftime('%d %b %y')" nowrap>date</td>
        <td valign="top" tal:condition="not:owner" tal:content="bug/owner/name"></td>
      </span>
    </tr>
  </table>

<!--
  <h2>Source Package Bug Assignments</h2>
  <table class="listing rowNavigation">
    <tr>
      <th>Bug</th>
      <th>Title</th>
      <th>Source Package</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Severity</th>
      <th>Date Created</th>
      <th tal:condition="not:owner">Owner</th>
    </tr>
    <span tal:repeat="bug view/getBugsAssignedToSourcePackages">
      <tr tal:repeat="bugass bug/packageassignment" tal:attributes="onclick string:window.location='${bug/id}';">
        <td tal:content="bug/id">$Bug.title</td>
        <td><a tal:content="bug/title"
               tal:attributes="href bug/id">title</a></td>
        <td tal:content="bugass/sourcepackage/sourcepackagename/name">libneon</td>
        <td tal:content="bugass/bugstatus/lp:BugAssignmentStatus">New</td>
        <td tal:content="bugass/priority/lp:BugPriority">High</td>
        <td tal:content="bugass/severity/lp:BugSeverity">Critical</td>
        <td tal:content="python:bug.datecreated.strftime('%d %b %y')">date</td>
        <td tal:condition="not:owner" tal:content="bug/owner/name"></td>
      </tr>
    </span>
  </table>

  <h2>Product Bug Assignments</h2>
  <table class="listing rowNavigation">
    <tr>
      <th>Bug</th>
      <th>Title</th>
      <th>Product</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Severity</th>
      <th>Date Created</th>
      <th tal:condition="not:owner">Owner</th>
    </tr>
    <span tal:repeat="bug view/getBugsAssignedToProducts">
      <tr tal:repeat="bugass bug/productassignment"
          tal:attributes="onclick string:window.location='${bug/id}';">
        <td tal:content="bug/id">$Bug.title</td>
        <td><a tal:content="bug/title"
               tal:attributes="href bug/id">title</a></td>
        <td tal:content="bugass/product/title">libneon</td>
        <td tal:content="bugass/bugstatus/lp:BugAssignmentStatus">Deferred</td>
        <td tal:content="bugass/priority/lp:BugPriority">Low</td>
        <td tal:content="bugass/severity/lp:BugSeverity">Low</td>
        <td tal:content="python:bug.datecreated.strftime('%d %b %y')">date</td>
        <td tal:condition="not:owner" tal:content="bug/owner/name"></td>
      </tr>
    </span>
  </table>
-->

  <input type="submit" value="Add" onclick="window.open('+new','_top')" />

</div>

</body>
</html>
