<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  omit-tag="">
<script type="text/javascript"
        tal:condition="view/allow_pending_license">
//<![CDATA[
function license_chosen() {
  document.getElementById('license_pending').checked = false;
  document.getElementById('license_complete').checked = true;
}

function unset_licenses() {
  var checkboxes = document.getElementsByName('field.licenses');
  for (var i = 0; i < checkboxes.length; i++) {
    checkboxes[i].checked = false;
  }
}
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
YUI().use('node', 'lazr.effects', function(Y) {
    Y.on('domready', function() {
        function make_slider(cfg) {
            var table_name = '#' + cfg.which;
            var target_name = table_name + '-expand';
            var arrow_name = target_name + '-arrow';
            var target = Y.get(target_name);

            // Initialize the slider state.
            var table = Y.get(table_name);
            if (Y.Lang.isValue(table)) {
                // 2009-06-15 BarryWarsaw: For some reason nobody can explain,
                // this is required for animations to work properly.  Without
                // this, nothing happens!
                table.setStyle('display', 'block');

                // The table starts either collapsed or expanded.  The
                // animation lives on the link target.
                if (cfg.in) {
                    target.slide = Y.lazr.effects.slide_in(table_name);
                }
                else {
                    target.slide = Y.lazr.effects.slide_out(table_name);
                }
                target.slide.stop();
                target.slide.run();
                
                // This event handler toggles the arrow state once the
                // animation is complete.  drawer_closed is an undocumented
                // attribute used by lazr-js, and recommended by mars.
                target.slide.on('end', function() {
                    var src;
                    if (this.drawer_closed) {
                        src = '/@@/treeCollapsed';
                    }
                    else {
                        src = '/@@/treeExpanded';
                    }
                    Y.get(arrow_name).setAttribute('src', src);
                });
            }

            // This is the event handler for clicking on the link or arrow.
            // It runs the slide animation, toggling between forward and
            // reverse.
            Y.on('click', function(e) {
                e.preventDefault();
                target.slide.set('reverse', !target.slide.get('reverse'));
                target.slide.stop();
                target.slide.run();
            }, target_name);
        }
        make_slider({which: 'recommended'});
        make_slider({which: 'more', in: true});
        make_slider({which: 'deprecated', in: true});
        make_slider({which: 'special', in: true});

        // Set a click event handler for the div containing all the
        // license checkbox.  When any license checkbox is selected, the
        // "I haven't specified the license yet" radio button is set to
        // "This project consists of code licensed under:".  However note
        // that the pending-div only shows up if the project has never
        // selected a license.  In other cases, there's an "I don't know yet"
        // choice in the "Other choices" license section.
        var license_pending = Y.get('#license_pending');
        if (Y.Lang.isValue(license_pending)) {
            license_pending.on('click', reveal_details);

            var div = Y.get('#pending-div');
            if (Y.Lang.isValue(div)) {
                div.setAttribute('onclick', 'license_chosen()');
            }
        }

        // When Other/Proprietary or Other/Open Source is chosen, the
        // license_info widget is displayed.
        var other_com = Y.get(Y.DOM.byId('field.licenses.25'));
        var other_os = Y.get(Y.DOM.byId('field.licenses.26'));
        var details = Y.get('#license-details');

        function reveal_details(e) {
            if (other_com.get('checked') || other_os.get('checked')) {
                if (!details.hasClass('lazr-opened')) {      
                    Y.lazr.effects.slide_out(details).run();
                }
            }
            else {
                if (!details.hasClass('lazr-closed')) {
                    Y.lazr.effects.slide_in(details).run();
                }
            }
        }
        other_com.on('click', reveal_details);
        other_os.on('click', reveal_details);

        // Pre-reveal license_info widget.
        reveal_details(true);
    });
});
//]]>
</script>
<div style="color: black">

  Select the license(s) under which you release your project.
  <div tal:condition="view/allow_pending_license"
       tal:define="is_empty not:view/_getFormInput">
    <input id="license_pending" name="license_status" type="radio"
           tal:attributes="checked is_empty"
            onClick="unset_licenses()" />
    <label for="license_pending">I haven't specified the license yet</label>
    <br/>

    <input id="license_complete" name="license_status" type="radio"
          tal:attributes="checked not:is_empty" />
    <label for="license_complete">
      This project consists of code licensed under:
    </label>
  </div>

  <div id="pending-div" style="padding-left: 20px">
    <a href="" id="recommended-expand" class="js-action">
      <img id="recommended-expand-arrow"
           src="/@@/treeExpanded"
           title="Recommended open source licenses"
           alt="Recommended open source licenses"/>
      Recommended open source licenses
    </a>
    <input tal:replace="structure view/recommended" />
    <a href="" id="more-expand" class="js-action">
      <img id="more-expand-arrow"
           src="/@@/treeCollapsed"
           title="More open source licenses"
           alt="More open source licenses"/>
      More open source licenses
    </a>
    <input tal:replace="structure view/more" />
    <div tal:condition="view/show_deprecated">
      <a href="" id="deprecated-expand" class="js-action">
        <img id="deprecated-expand-arrow"
             src="/@@/treeCollapsed"
             title="Deprecated licenses"
             alt="Deprecated licenses"/>
        Deprecated licenses
      </a>
      <input tal:replace="structure view/deprecated" />
    </div>
    <a href="" id="special-expand" class="js-action">
      <img id="special-expand-arrow"
           src="/@@/treeCollapsed"
           title="Other choices"
           alt="Other choices"/>
      Other choices
    </a>
    <input tal:replace="structure view/special" />
    <div id="license-details" style="margin-top: 10px">
      <label for="field.license_info">License details:</label>
      <input tal:replace="structure view/license_info_widget" />
      <p class="formHelp">Additional license details are required.
      Please include the URL to the license, its text, or other
      detailed information.</p>
   </div>
  </div>
  <p>
    Launchpad.net is free to use for software projects that share
    their source code and comply with these
    <a tal:define="config modules/canonical.config/config"
       tal:attributes="href config/commercial/licensing_policy_url">
      licensing policies.
    </a>
    <br/>
    <a href="mailto:feedback@launchpad.net">Contact us</a>
    if your project uses a proprietary license.
  </p>
</div>
</tal:root>
