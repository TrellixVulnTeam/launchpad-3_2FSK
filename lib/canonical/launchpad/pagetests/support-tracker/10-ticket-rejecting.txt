Rejecting and Reopening
=======================

Support contacts and administrators can reject a support request.
This should be done when the request isn't an actual support request,
for example, if the request is a duplicate or spam.

No Privileges Pesron isn't a support contact or administrator, so he
doesn't have access to that feature.

    (We can't use user_browser here because he is Firefox's registrant.)
    >>> browser.addHeader('Authorization', 'Basic no-priv@canonical.com:test')
    >>> browser.open('http://launchpad.dev/products/firefox/+ticket/2')
    >>> browser.getLink('Reject Request')
    Traceback (most recent call last):
      ...
    LinkNotFoundError...

Even when trying to access the page directly, he will be redirected back
to the ticket page with a notification message:

    >>> browser.open(
    ...     'http://launchpad.dev/products/firefox/+ticket/2/+reject')
    >>> browser.url
    '.../+ticket/2'
    >>> from BeautifulSoup import BeautifulSoup
    >>> soup = BeautifulSoup(browser.contents)
    >>> print soup.first('div', 'error message').renderContents()
    Only support contacts and administrators can reject a request.

To reject the request, the user clicks on the 'Reject Request' link.

    >>> admin_browser.open('http://launchpad.dev/products/firefox/+ticket/2')
    >>> admin_browser.getLink('Reject Request').click()
    >>> admin_browser.getControl('Reject').click()

He needs to enter a message explaining the rejection:

    >>> soup = BeautifulSoup(admin_browser.contents)
    >>> print soup.first('div', 'message').renderContents()
    You must provide an explanation message.

Entering an explanation message and clicking the 'Reject' button,
will reject the ticket.

    >>> admin_browser.getControl('Message').value = (
    ...     """Rejecting because it's a duplicate of bug #1.""")
    >>> admin_browser.getControl('Reject').click()

Once the ticket is rejected, a confirmation message is shown;

    >>> soup = BeautifulSoup(admin_browser.contents)
    >>> print soup.first('div', 'informational message').renderContents()
    You have rejected this request.

its status is changed to 'Invalid';

    >>> print soup.first('b', text='Status:').next.strip()
    Invalid

and the rejection message is added to the ticket board.

    >>> print soup.fetch('div', 'boardCommentBody')[-1].renderContents()
    <p>Rejecting because it's a duplicate of <a...>bug #1</a>.</p>
