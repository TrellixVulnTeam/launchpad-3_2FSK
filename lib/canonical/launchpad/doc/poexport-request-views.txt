
PO Export Request Browser Views
-------------------------------

  >>> from canonical.launchpad.ftests.harness import \
  ...     LaunchpadFunctionalTestSetup
  >>> LaunchpadFunctionalTestSetup().setUp()

Check there are no requests in the database to start with.

  >>> from canonical.launchpad.database import POExportRequest
  >>> POExportRequest.select().count()
  0

Here's our user who's going to request some PO files.

  >>> from canonical.launchpad.database import Person
  >>> person = Person.get(13)

Here's thing PO template they're going to request some files from.

  >>> from canonical.launchpad.database import POTemplate
  >>> context = POTemplate.get(1)

Here's the request from the user.

  >>> class DummyRequest:
  ...     pass

  >>> request = DummyRequest()
  >>> request.method = 'POST'
  >>> request.form = {
  ...     'what': 'some',
  ...     'potemplate': True,
  ...     'es': True,
  ...     'format': 'PO',
  ... }

And here's the view processing that request.

  >>> from canonical.launchpad.browser.potemplate import POTemplateExportView
  >>> class DummyView(POTemplateExportView):
  ...     def __init__(self):
  ...         self.context = context
  ...         self.request = request
  ...         self.user = person
  ...         self.form_processed = False

  >>> view = DummyView()
  >>> view.processForm()
  >>> view.form_processed
  True

Check that the request has been added to the DB.

  >>> for request in POExportRequest.select(
  ...         orderBy=['person', 'potemplate', 'pofile']):
  ...     things = [
  ...         request.person.displayname,
  ...         request.potemplate.potemplatename.name]
  ...     if request.pofile:
  ...         things.append(request.pofile.language.englishname)
  ...     print things
  [u'Carlos Perell\xf3 Mar\xedn', u'evolution-2.2', u'Spanish']
  [u'Carlos Perell\xf3 Mar\xedn', u'evolution-2.2']

Now forget that that request happened.

  >>> LaunchpadFunctionalTestSetup().tearDown()
  >>> LaunchpadFunctionalTestSetup().setUp()

See, no requests!

  >>> POExportRequest.select().count()
  0

Let's request a PO file instead this time.

  >>> from canonical.launchpad.database import POFile
  >>> context = POFile.get(1)

Here's our new request.

  >>> request = DummyRequest()
  >>> request.method = 'POST'
  >>> request.form = {'format': 'PO'}

Here's that request getting processed.

  >>> from canonical.launchpad.browser.pofile import POExportView
  >>> class DummyView(POExportView):
  ...     def __init__(self):
  ...         self.context = context
  ...         self.request = request
  ...         self.user = person

  >>> view = DummyView()
  >>> view.processForm()
  >>> view.form_processed
  True

And there it is.

  >>> POExportRequest.select().count()
  1

  >>> LaunchpadFunctionalTestSetup().tearDown()

