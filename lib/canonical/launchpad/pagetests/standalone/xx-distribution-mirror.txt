
  First of all we'll create a new mirror for the Ubuntu distribution...

  >>> print http(r"""
  ... GET /distros/ubuntu/+newmirror HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... """)
  HTTP/1.1 200 Ok
  ...

  ... but every mirror must have at least one of HTTP, FTP or Rsync URL, and
  the form will raise an error message if this is not provided by the user.

  >>> print http(r"""
  ... POST /distros/ubuntu/+newmirror HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------11222539801864242759854287358
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.name"
  ... 
  ... mymirror
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.displayname"
  ... 
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.description"
  ... 
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.speed"
  ... 
  ... 1Mb per second
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.speed-empty-marker"
  ... 
  ... 1
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.country"
  ... 
  ... 9
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.country-empty-marker"
  ... 
  ... 1
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.content"
  ... 
  ... Archive
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.content-empty-marker"
  ... 
  ... 1
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.http_base_url"
  ... 
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.ftp_base_url"
  ... 
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.rsync_base_url"
  ... 
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.pulse_type"
  ... 
  ... Push
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.pulse_type-empty-marker"
  ... 
  ... 1
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.pulse_source"
  ... 
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.enabled.used"
  ... 
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="field.official_candidate.used"
  ... 
  ... 
  ... -----------------------------11222539801864242759854287358
  ... Content-Disposition: form-data; name="FORM_SUBMIT"
  ... 
  ... Continue
  ... -----------------------------11222539801864242759854287358--
  ... """)
  HTTP/1.1 200 Ok
  ...
  ...All mirrors require at least one URL (HTTP, FTP or Rsync)...
  ...

  
  Also, any mirror with a pulse_type of PULL, must specify a pulse_source.

  >>> print http(r"""
  ... POST /distros/ubuntu/+newmirror HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------115502639214818065081276638001
  ... 
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.name"
  ... 
  ... mymirror
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.displayname"
  ... 
  ... 
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.description"
  ... 
  ... 
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.speed"
  ... 
  ... 1Mb per second
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.speed-empty-marker"
  ... 
  ... 1
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.country"
  ... 
  ... 9
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.country-empty-marker"
  ... 
  ... 1
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.content"
  ... 
  ... Archive
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.content-empty-marker"
  ... 
  ... 1
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.http_base_url"
  ... 
  ... http://my.mirror.com/pub
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.ftp_base_url"
  ... 
  ... 
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.rsync_base_url"
  ... 
  ... 
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.pulse_type"
  ... 
  ... Pull
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.pulse_type-empty-marker"
  ... 
  ... 1
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.pulse_source"
  ... 
  ... 
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.enabled.used"
  ... 
  ... 
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="field.official_candidate.used"
  ... 
  ... 
  ... -----------------------------115502639214818065081276638001
  ... Content-Disposition: form-data; name="FORM_SUBMIT"
  ... 
  ... Continue
  ... -----------------------------115502639214818065081276638001--
  ... """)
  HTTP/1.1 200 Ok
  ...
  ...You have choosen 'Pull' as the pulse type but have not...
  ...


  Now we provide everything that we need and the mirror is created just fine.

  >>> print http(r"""
  ... POST /distros/ubuntu/+newmirror HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------1666515360919918511589873832
  ... 
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.name"
  ... 
  ... mymirror
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.displayname"
  ... 
  ... 
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.description"
  ... 
  ... 
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.speed"
  ... 
  ... 1Mb per second
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.speed-empty-marker"
  ... 
  ... 1
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.country"
  ... 
  ... 9
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.country-empty-marker"
  ... 
  ... 1
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.content"
  ... 
  ... Archive
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.content-empty-marker"
  ... 
  ... 1
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.http_base_url"
  ... 
  ... http://my.mirror.com/pub
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.ftp_base_url"
  ... 
  ... 
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.rsync_base_url"
  ... 
  ... 
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.pulse_type"
  ... 
  ... Push
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.pulse_type-empty-marker"
  ... 
  ... 1
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.pulse_source"
  ... 
  ... 
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.enabled.used"
  ... 
  ... 
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="field.official_candidate.used"
  ... 
  ... 
  ... -----------------------------1666515360919918511589873832
  ... Content-Disposition: form-data; name="FORM_SUBMIT"
  ... 
  ... Continue
  ... -----------------------------1666515360919918511589873832--
  ... """)
  HTTP/1.1 303 See Other
  Content-Length: 0
  ...
  Location: http://localhost:9000/distros/ubuntu/+mirror/mymirror


  >>> print http(r"""
  ... GET /distros/ubuntu/+mirror/mymirror HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... """)
  HTTP/1.1 200 Ok
  ...
  ...mymirror...
  ...
  ...This mirror has no registered Arch Releases...
  ...This mirror has no registered Source Releases...
  ...


  Now the mirror's owner mark it as enabled and as a candidate for being
  official.

  >>> print http(r"""
  ... POST /distros/ubuntu/+mirror/mymirror/+edit HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------122658562518459659403293498
  ... 
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.name"
  ... 
  ... mymirror
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.displayname"
  ... 
  ... 
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.description"
  ... 
  ... 
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.http_base_url"
  ... 
  ... http://my.mirror.com/pub
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.ftp_base_url"
  ... 
  ... 
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.rsync_base_url"
  ... 
  ... 
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.speed"
  ... 
  ... 1Mb per second
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.speed-empty-marker"
  ... 
  ... 1
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.country"
  ... 
  ... 9
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.country-empty-marker"
  ... 
  ... 1
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.content"
  ... 
  ... Archive
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.content-empty-marker"
  ... 
  ... 1
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.pulse_type"
  ... 
  ... Push
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.pulse_type-empty-marker"
  ... 
  ... 1
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.pulse_source"
  ... 
  ... 
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.enabled.used"
  ... 
  ... 
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.enabled"
  ... 
  ... on
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.official_candidate.used"
  ... 
  ... 
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="field.official_candidate"
  ... 
  ... on
  ... -----------------------------122658562518459659403293498
  ... Content-Disposition: form-data; name="UPDATE_SUBMIT"
  ... 
  ... Change
  ... -----------------------------122658562518459659403293498--
  ... """)
  HTTP/1.1 303 See Other
  Content-Length: 0
  ...

  
  But that's not enough to make a mirror official, as we can see in the
  details portlet.

  >>> print http(r"""
  ... GET /distros/ubuntu/+mirror/mymirror HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... """)
  HTTP/1.1 200 Ok
  ...
  ...<b>Not Official</b>...
  ...


  To make a mirror official, one has to go to the +admin page, and the mirror
  owner found out that, so he'll try to make his mirror official by manually
  entering the URL in his web browser, but he won't have access to that page.

  >>> print http(r"""
  ... GET /distros/ubuntu/+mirror/mymirror/+admin HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... """)
  HTTP/1.1 403 Forbidden
  ...


  Now one of the mirror administrators goes and make this an official mirror.

  >>> print http(r"""
  ... POST /distros/ubuntu/+mirror/mymirror/+admin HTTP/1.1
  ... Authorization: Basic bWFya0BoYmQuY29tOnRlc3Q=
  ... Content-Type: multipart/form-data; boundary=---------------------------152768659419116023661563519383
  ... 
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.name"
  ... 
  ... mymirror
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.displayname"
  ... 
  ... 
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.description"
  ... 
  ... 
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.http_base_url"
  ... 
  ... http://my.mirror.com/pub
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.ftp_base_url"
  ... 
  ... 
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.rsync_base_url"
  ... 
  ... 
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.speed"
  ... 
  ... 1Mb per second
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.speed-empty-marker"
  ... 
  ... 1
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.country"
  ... 
  ... 9
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.country-empty-marker"
  ... 
  ... 1
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.content"
  ... 
  ... Archive
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.content-empty-marker"
  ... 
  ... 1
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.pulse_type"
  ... 
  ... Push
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.pulse_type-empty-marker"
  ... 
  ... 1
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.pulse_source"
  ... 
  ... 
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.enabled.used"
  ... 
  ... 
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.official_approved.used"
  ... 
  ... 
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="field.official_approved"
  ... 
  ... on
  ... -----------------------------152768659419116023661563519383
  ... Content-Disposition: form-data; name="UPDATE_SUBMIT"
  ... 
  ... Change
  ... -----------------------------152768659419116023661563519383--
  ... """)
  HTTP/1.1 303 See Other
  Content-Length: 0
  ...
  Location: http://localhost:9000/distros/ubuntu/+mirror/mymirror


  And in the mirror's main page we can now see that it's an official mirror.

  >>> print http(r"""
  ... GET /distros/ubuntu/+mirror/mymirror HTTP/1.1
  ... Authorization: Basic bm8tcHJpdkBjYW5vbmljYWwuY29tOnRlc3Q=
  ... """)
  HTTP/1.1 200 Ok
  ...
  ...<b>Official</b>...
  ...

