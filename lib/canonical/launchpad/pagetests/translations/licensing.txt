= Translations Relicensing =

When Karl visits +translate page for the first time, he is sent
to a form to indicate whether he agrees to license his translations
under the revised BSD license.

    >>> browser = setupBrowser(auth='Basic karl@canonical.com:test')
    >>> browser.open('http://translations.launchpad.dev/alsa-utils/trunk/'
    ...              '+pots/alsa-utils/es/+translate')
    >>> browser.url
    'http://translations.launchpad.dev/~karl/+licensing?back_to=...'

Karl realises that he is not on the translate page, he can see that
that this page has information about relicensing.

    >>> print browser.title
    Translations licensing
    >>> print extract_text(find_main_content(browser.contents))
    Sorry to interrupt...

Karl is asked whether he wants to license his translations.

    >>> radiobuttons = browser.getControl(name='field.allow_relicensing')

The default choice is to permit relicensing.

    >>> radiobuttons.value
    ['BSD']

Karl chooses "no".

    >>> radiobuttons.value = ['REMOVE']
    >>> browser.getControl("Confirm").click()

Karl sees a notice that his translations will be removed in the near
future.

    >>> get_feedback_messages(browser.contents)
    [u'We respect your choice. Your translations will be removed...']

He's also forwarded back to the Spanish alsa-utils translations page.

    >>> browser.url
    'http://translations.launchpad.dev/...+pots/alsa-utils/es/+translate'

However, this page is now read-only for Karl, and there are no textareas
nor input boxes available.

    >>> main_content = find_tag_by_id(browser.contents, 'messages_to_translate')
    >>> for textarea in main_content.findAll('textarea'):
    ...     print 'Found textarea:\n%s' % textarea

    >>> for input in main_content.findAll('input'):
    ...     print 'Found input:\n%s' % input

Karl is also denied submitting a POST request.

    >>> print http(r"""
    ... POST /alsa-utils/trunk/+pots/alsa-utils/es/+translate HTTP/1.1
    ... Host: translations.launchpad.dev
    ... """)
    HTTP/1.1 500 Internal Server Error
    ...
    ...UnexpectedFormData: Anonymous users or users who are not accepting
    our licensing terms cannot do POST submissions...

Karl changes his mind. He returns to the licensing page.

    >>> browser.open('http://translations.launchpad.dev/~karl/')
    >>> browser.getLink('Translations licensing').click()
    >>> browser.url
    'http://translations.launchpad.dev/~karl/+licensing'
    >>> print browser.title
    Translations licensing

Karl sees that the current value is 'no', which he set before.

    >>> radiobuttons = browser.getControl(name='field.allow_relicensing')
    >>> print radiobuttons.value
    ['REMOVE']

He changes it again.

    >>> radiobuttons.value = ['BSD']
    >>> browser.getControl("Confirm").click()

    >>> get_feedback_messages(browser.contents)
    [u'Thank you for BSD-licensing your translations.']

Karl can now browse to a +translate page without being forwarded.

    >>> browser.open('http://translations.launchpad.dev/alsa-utils/trunk/'
    ...              '+pots/alsa-utils/es/+translate')
    >>> browser.url
    'http://.../alsa-utils/trunk/+pots/alsa-utils/es/+translate'
    >>> browser.title
    'Translating alsa-utils in alsa-utils trunk into Spanish'


== Permissions ==

If another logged-in user comes across Karl's translations page, he sees
no link to change Karl's licensing choice.

    >>> user_browser.open('http://translations.launchpad.dev/~karl/')
    >>> user_browser.getLink('Translations licensing')
    Traceback (most recent call last):
    ...
    LinkNotFoundError

Typing in the URL directly doesn't work either.

    >>> user_browser.open(
    ...     'http://translations.launchpad.dev/~karl/+licensing')
    Traceback (most recent call last):
    ...
    Unauthorized: ...
