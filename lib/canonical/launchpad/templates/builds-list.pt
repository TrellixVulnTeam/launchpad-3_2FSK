<div class="builds_list" tal:condition="not: view/setupBuildList">

  <tal:batch define="batch view/complete_builds">

     <form name="build_records_state" action="" method="GET">
          <label for="build_state">Show builds which are:</label>
          <select id="build_state" name="build_state" size="1">
            <option tal:attributes="selected python: view.state == 'all'"
                    value="all">All Builds</option>

            <option tal:attributes="selected python: view.state == 'built'"
                    value="built">Successfully Built</option>

            <option tal:attributes="selected python: view.state == 'building'"
                    value="building">Building</option>

            <option tal:condition="view/showBuilderInfo"
                    tal:attributes="selected python: view.state == 'pending'"
                    value="pending">Pending Build</option>

            <option tal:attributes="selected python: view.state == 'failed'"
                    value="failed">Failed Build</option>

            <option tal:attributes="selected python: view.state == 'depwait'"
                    value="depwait">Waiting Dependency</option>

            <option tal:attributes="selected python: view.state == 'chrootwait'"
                    value="chrootwait">Waiting Chroot</option>

            <option tal:attributes="selected python: view.state == 'superseded'"
                    value="superseded">Superseded</option>

          </select>
          <tal:searchname condition="view/searchName">
            <label for="build_text">with names containing:</label>

            <input id="build_text" title="Package Name" size="20"
                   type="text" name="build_text"
                   tal:attributes="value view/text"/>
          </tal:searchname>

          <input type="submit" value="Update" />
     </form>

     <tal:navigation
          tal:condition="batch"
          replace="structure view/batchnav/@@+navigation-links" />

  <table class="listing" tal:condition="batch">
    <tbody>
      <tal:batch repeat="complete_build batch">
        <tal:build define="build complete_build/build">
        <tr>
          <td class="left icon">
            <img tal:attributes="
              alt build/buildstate/name;
              src build/build_icon
            " />
          </td>
          <td>
            <a tal:attributes="href build/fmt:url">
              <span tal:replace="build/title">NAME</span>
            </a>
          </td>
        </tr>
        <tr class="secondary">
          <td></td>
          <td>
            Requested
            <tal:requested
              content="build/datecreated/fmt:datetime"
            />
            in pocket <tal:buildpocket
              content="build/pocket/name"
            />
          </td>
        </tr>
        <tr class="secondary" tal:condition="build/dependencies">
          <td></td>
          <td>
	    Missing Dependencies
            <tal:dependencies
              content="build/dependencies"
            />
          </td>
        </tr>
        <tr class="secondary" tal:condition="build/was_built">
          <td></td>
          <td>
            Built
            <tal:built content="build/datebuilt/fmt:datetime" />
            <tal:builder condition="view/showBuilderInfo">
              by
              <a
                tal:condition="build/builder"
                tal:content="build/builder/title"
                tal:attributes="href build/builder/fmt:url"
                title="Information about this build machine"
              />
              <tal:unknownbuilder condition="not: build/builder">
                unknown build machine
              </tal:unknownbuilder>
            </tal:builder>
            in
            <tal:time content="build/buildduration/fmt:approximateduration" />
            <tal:log condition="build/buildlog">
              &mdash;
              <a tal:attributes="href build/buildlog/url">log</a>
            </tal:log>
          </td>
        </tr>
        <tr class="secondary" tal:condition="not: build/was_built">
          <td></td>
          <tal:buildqueue condition="complete_build/buildqueue_record">
            <td tal:condition="not: complete_build/buildqueue_record/builder">
              Pending
              (<span tal:replace="complete_build/buildqueue_record/lastscore"
             />)
            </td>
            <td tal:condition="complete_build/buildqueue_record/builder">
              Building on
              <a tal:content="complete_build/buildqueue_record/builder/name"
                 tal:attributes="href complete_build/buildqueue_record/builder/fmt:url"
               />
            </td>
          </tal:buildqueue>
          <tal:no_buildqueue condition="not: complete_build/buildqueue_record">
            <td>Build not initialized yet.</td>
          </tal:no_buildqueue>
        </tr>
      </tal:build>
      </tal:batch>
    </tbody>
  </table>

      <div tal:condition="not: batch">
        No <span tal:replace="view/state" /> builds for
        <span tal:replace="context/title" />.
      </div>

      <tal:navigation
           tal:condition="batch"
           replace="structure view/batchnav/@@+navigation-links" />

  </tal:batch>
</div>
