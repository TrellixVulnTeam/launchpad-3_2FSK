<table class="summary">
  <tr>
    <th>Filed here by:</th>
    <td><a tal:replace="structure context/owner/fmt:link">Foo Bar</a></td>
  </tr>
  <tr>
    <th>When:</th>
    <td>
      <span
        tal:attributes="title context/datecreated/fmt:datetime"
        tal:content="context/datecreated/fmt:approximatedate">2006-12-13</span>
    </td>
  </tr>
  <tr tal:condition="context/date_confirmed">
    <th>Confirmed:</th>
    <td>
      <span
        tal:attributes="title context/date_confirmed/fmt:datetime"
        tal:content="context/date_confirmed/fmt:approximatedate">2006-12-13</span>
    </td>
  </tr>
  <tr tal:condition="context/date_assigned">
    <th>Assigned:</th>
    <td>
      <span
        tal:attributes="title context/date_assigned/fmt:datetime"
        tal:content="context/date_assigned/fmt:approximatedate">2006-12-13</span>
    </td>
  </tr>
  <tr tal:condition="context/date_inprogress">
    <th>Started work:</th>
    <td>
      <span
        tal:attributes="title context/date_inprogress/fmt:datetime"
        tal:content="context/date_inprogress/fmt:approximatedate">2006-12-13</span>
    </td>
  </tr>
  <tr tal:condition="context/date_closed">
    <th>Completed:</th>
    <td>
      <span
        tal:attributes="title context/date_closed/fmt:datetime"
        tal:content="context/date_closed/fmt:approximatedate">2006-12-13</span>
    </td>
  </tr>
</table>
<tal:process define="status view/process_form" />
<form
  action="#"
  tal:attributes="action string:${context/fmt:url}/+editstatus"
  method="post"
  enctype="multipart/form-data">
  <p
    tal:define="errors view/errors|nothing"
    tal:condition="errors"
    class="error message"
    i18n:translate=""
  >
    There are
    <strong
      tal:content="view/errors/count:len"
      i18n:name="num_errors"
    >6</strong>
    problems with the information you entered.  Please fix them and try again.
  </p>
  <p
    tal:define="errors view/errors|nothing"
    tal:condition="errors"
    tal:repeat="error errors"
    tal:content="error"
    class="error message"
  >Individual error.</p>

  <p tal:condition="not: context/required:launchpad.Edit" class="error message">
    You are not the bug assignee nor the maintainer of
    <tal:context replace="context/targetname">project</tal:context>,
    and therefore cannot edit this bug's status.
  </p>
  <div class="field">
    <table>
      <tal:distrotask
        condition="python:context.distribution or context.distrorelease"
      >
        <tr>
          <td>
            <label
              tal:attributes="for view/sourcepackagename_widget/name"
              tal:content="view/sourcepackagename_widget/label"
            >Source package name</label>
          </td>
        </tr>
        <tr>
          <td
            tal:content="structure view/sourcepackagename_widget"
            style="white-space: nowrap;"
          />
        </tr>
      </tal:distrotask>
      <tal:upstreamtask condition="python:context.product">
        <tr tal:condition="view/product_widget">
          <td colspan="2">
            <label
              tal:attributes="for view/product_widget/name"
              tal:content="view/product_widget/label"
            >Upstream project</label>
          </td>
        </tr>
        <tr tal:condition="view/product_widget">
          <td colspan="2" tal:content="structure view/product_widget" nowrap />
        </tr>
      </tal:upstreamtask>
    </table>
    <table>
      <tr>
        <td>
          <label
            tal:attributes="for view/status_widget/name"
            tal:content="view/status_widget/label"
          >Status</label>
        </td>
        <td>
          <label
            tal:attributes="for view/importance_widget/name"
            tal:content="view/importance_widget/label"
          >Importance</label>
        </td>
        <td tal:condition="view/milestone_widget">
          <label
            tal:attributes="for view/milestone_widget/name"
            tal:content="view/milestone_widget/label"
          >Target</label>
        </td>
      </tr>
      <tr>
        <td tal:content="structure view/status_widget" />
        <td title="Editable only by the maintainer or bug contact of the project">
          <img tal:condition="not:view/userCanEditImportance" src="/@@/locked" />
          <span tal:content="structure view/importance_widget" />
        </td>
        <td tal:condition="view/milestone_widget"
            title="Editable only by the maintainer or bug contact of the project">
          <img tal:condition="not:view/userCanEditMilestone" src="/@@/locked" />
          <span tal:content="structure view/milestone_widget" />
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label
            tal:attributes="for view/assignee_widget/name"
            tal:content="view/assignee_widget/label"
          />
        </td>
      </tr>
      <tr>
        <td nowrap tal:content="structure view/assignee_widget" colspan="2" />
      </tr>
    </table>
    <table tal:condition="not:context/target_uses_malone">
      <tr>
        <td>
          <label
            tal:attributes="for view/bugwatch_widget/name"
            style="white-space: nowrap"
          >Remote Watch</label>
        </td>
      </tr>
      <tr>
        <td nowrap tal:content="structure view/bugwatch_widget" colspan="2" />
      </tr>
      <tr>
        <td class="formHelp" colspan="2">
        The information about this bug in Launchpad is
        automatically pulled daily from the remote bug.
        <tal:has_bugwatch tal:condition="context/bugwatch">
          <tal:has_been_pulled 
              tal:condition="context/bugwatch/lastchecked">
            This information was last pulled
            <b
              tal:attributes="title context/bugwatch/lastchecked/fmt:datetime"
              tal:content="context/bugwatch/lastchecked/fmt:displaydate">
              3 minutes ago
            </b>.
          </tal:has_been_pulled>
          <tal:has_not_been_pulled 
              tal:condition="not:context/bugwatch/lastchecked">
            This information hasn't been pulled yet.
          </tal:has_not_been_pulled>
        </tal:has_bugwatch>
        </td>
      </tr>
    </table>
  </div>
  <div class="field">
    <label tal:attributes="for string:${view/prefix}.comment_on_change">Comment on most recent change</label>
    <div style="margin-top: 5px">
      <i tal:content="python:context.statusexplanation or '(none)'" />
    </div>
  </div>
  <div class="field">
    <div>
      <label  tal:attributes="for string:${view/prefix}.comment_on_change">Comment on this change (optional)</label>
      <textarea
        cols="62"
        rows="4"
        tal:content="request/comment_on_change|nothing"
        tal:attributes="id string:${view/prefix}.comment_on_change;
                        name string:${view/prefix}.comment_on_change"
      ></textarea>
    </div>
    <div tal:condition="python:not context.bug.isSubscribed(view.user)">
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe"
               value="Subscribe" />
        E-mail me about changes to this bug report
      </label>
    </div>
  </div>
  <div class="actions" tal:condition="context/required:launchpad.Edit">
    <input
      type="submit"
      name="FORM_SUBMIT"
      value="Save Changes"
      i18n:attributes="value submit-button"
    />
  </div>
</form>
