Only the bug contact can edit Importance.

    >>> from zope.component import getUtility
    >>> from zope.testbrowser.testing import Browser

    >>> from canonical.database.sqlbase import flush_database_updates
    >>> from canonical.launchpad.ftests import login, logout
    >>> from canonical.launchpad.interfaces import (
    ...     IPersonSet, IProductSet, IDistributionSet)

    >>> login("foo.bar@canonical.com")

    >>> personset = getUtility(IPersonSet)
    >>> no_priv = personset.getByName("no-priv")
    >>> firefox = getUtility(IProductSet).getByName("firefox")
    >>> ubuntu = getUtility(IDistributionSet).getByName("ubuntu")

    >>> logout()

    >>> def user_sees_importance_widget(user, url):
    ...     browser = Browser()
    ...     browser.addHeader(
    ...         "Authorization", "Basic %s:test" %
    ...         user.preferredemail.email)
    ...     browser.open(url)
    ...     try:
    ...         browser.getControl("Importance")
    ...     except LookupError:
    ...         return False
    ...     else:
    ...         return True

For a product.

    >>> user_sees_importance_widget(
    ...     user=no_priv,
    ...     url="http://localhost:9000/products/firefox/+bug/1/+editstatus")
    False

    >>> login("foo.bar@canonical.com")
    >>> firefox.bugcontact = no_priv
    >>> flush_database_updates()
    >>> logout()

    >>> user_sees_importance_widget(
    ...     user=no_priv,
    ...     url="http://localhost:9000/products/firefox/+bug/1/+editstatus")
    True

For a distribution.

    >>> user_sees_importance_widget(
    ...     user=no_priv,
    ...     url="http://localhost:9000/distros/ubuntu/+source/mozilla-firefox/+bug/1/+editstatus")
    False

    >>> login("foo.bar@canonical.com")
    >>> ubuntu.bugcontact = no_priv
    >>> flush_database_updates()
    >>> logout()

    >>> user_sees_importance_widget(
    ...     user=no_priv,
    ...     url="http://localhost:9000/distros/ubuntu/+source/mozilla-firefox/+bug/1/+editstatus")
    True

Unless the context doesn't have a bug contact, in which case the
Importance can be edited only by users with launchpad.Edit permission on
the context.

So, the owner of Firefox, Sample Person, can't see the widget to change
Importance:

    >>> print firefox.owner.name
    name12

    >>> login("foo.bar@canonical.com")
    >>> sample_person = personset.getByName("name12")
    >>> logout()

    >>> user_sees_importance_widget(
    ...     user=sample_person,
    ...     url="http://localhost:9000/products/firefox/+bug/1/+editstatus")
    False

But when we remove the bugcontact, Sample Person will get an edit widget
for Importance:

    >>> login("foo.bar@canonical.com")
    >>> firefox.bugcontact = None
    >>> flush_database_updates()
    >>> logout()

    >>> user_sees_importance_widget(
    ...     user=sample_person,
    ...     url="http://localhost:9000/products/firefox/+bug/1/+editstatus")
    True

For a distribution.

sabdfl is in the team which is the Ubuntu registrant, but can't
currently see the Importance widget:

    >>> print ubuntu.owner.name
    ubuntu-team

    >>> login("foo.bar@canonical.com")
    >>> sabdfl = personset.getByName("sabdfl")
    >>> sabdfl.inTeam(ubuntu.owner)
    True
    >>> logout()

    >>> user_sees_importance_widget(
    ...     user=sabdfl,
    ...     url="http://localhost:9000/distros/ubuntu/+source/mozilla-firefox/+bug/1/+editstatus")
    False

    >>> login("foo.bar@canonical.com")
    >>> ubuntu.bugcontact = None
    >>> flush_database_updates()
    >>> logout()

    >>> user_sees_importance_widget(
    ...     user=sabdfl,
    ...     url="http://localhost:9000/distros/ubuntu/+source/mozilla-firefox/+bug/1/+editstatus")
    True
