<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="launchpad">
<body>

<head>
  <tal:block metal:fill-slot="head_epilogue">
    <script type="text/javascript">
      LPJS.use('node', 'event', 'lp.app.widgets.expander', function(Y) {
          Y.on('domready', function() {
            Y.all('[class=expandable]').each(function(e) {
              var expander_icon = e.one('[class=expander]');
              var widget_body = e.one('[class=listing]');
              var expander = new Y.lp.app.widgets.expander.Expander(
                  expander_icon, widget_body);
              expander.setUp(true);
            })
          })
        });
    </script>
  </tal:block>
</head>

<div metal:fill-slot="main">

  <div tal:repeat="pair view/work_item_containers">
  <div tal:define="date python: pair[0]; containers python: pair[1]">
    <h2 tal:content="date/fmt:date" />

    <p>
      There are <span tal:replace="python: view.workitem_counts[date]" />
      Blueprint work items and
      <span tal:replace="python: view.bugtask_counts[date]" /> Bugs due
      in <span tal:content="date/fmt:date" /> which are assigned to members
      of this team.
    </p>

    <ul>
      <li tal:repeat="container containers"
          style="margin-left: 1em; max-width: 90%" >
        <tal:bp_workitems condition="container/spec">
          <div class="expandable">
            <div style="margin-bottom: 0.5em; ">
              <a href="#" class="expander">&nbsp;</a>
              <strong>
                <a tal:replace="structure container/spec/fmt:link" />,
              </strong>
              <span class="lesser">
                from <a tal:replace="structure container/target/fmt:link" />,
                assigned to <span tal:replace="structure container/assignee_link" />.
              </span>
            </div>
            <table class="listing" style="margin-left: 3em">
              <thead>
                <tr>
                  <th>Description</th>
                  <th>Assignee</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr tal:repeat="item container/items">
                  <td tal:content="item/title/fmt:shorten/120" />
                  <td tal:content="structure item/assignee/fmt:link" />
                  <td tal:content="item/status/title" />
                </tr>
              </tbody>
            </table>
          <div>
        </tal:bp_workitems>

        <tal:bugtasks condition="not: container/spec">
          <div class="expandable">
            <p>
              <a href="#" class="expander">&nbsp;</a>
              <span class="sprite bug-undecided" />
              <strong>Bugs targeted to a milestone on this date.</strong>
            </p>
            <table class="listing" width="70%" style="margin-left: 3em">
              <thead>
                <tr>
                  <th>Description</th>
                  <th>Target</th>
                  <th>Assignee</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr tal:repeat="item container/items">
                  <td tal:content="structure item/_bugtask/fmt:link" />
                  <td tal:content="structure item/target/fmt:link" />
                  <td tal:content="structure item/assignee/fmt:link" />
                  <td tal:content="item/status/title" />
                </tr>
              </tbody>
            </table>
          </div>
        </tal:bugtasks>
      </li>
    </ul>
  </div>
  </div>
</div>

</body>
</html>
