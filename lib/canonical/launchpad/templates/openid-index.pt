<tal:root
    xmlns:tal="http://xml.zope.org/namespaces/tal"
    xmlns:metal="http://xml.zope.org/namespaces/metal"
    xmlns:i18n="http://xml.zope.org/namespaces/i18n"
    i18n:domain="launchpad">

<tal:not-logged-in condition="not:view/account">
  <tal:block replace="structure context/@@+standalone-login" />
</tal:not-logged-in>

<tal:logged-in condition="view/account">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
    lang="en"
    metal:use-macro="context/@@main_template/master">
  <body>
    <div metal:fill-slot="main">
      <p>Logged in as <tal:user replace="view/account/displayname" />
      (<a href="+edit">edit</a>)</p>

      <p>
        <form action="+logout" method="post">
          <input type="hidden" name="loggingout" value="1" />
          <input type="submit" name="logout" value="Log Out" />
        </form>
      </p>

      <tal:visited-sites define="rps view/account/recently_authenticated_rps"
                         condition="rps/count">
      <h3>Recently authenticated sites</h3>

      <table class="listing">
        <thead>
          <tr>
            <th>Site</th>
            <th>First authenticated</th>
            <th>Last authenticated</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="authenticated_rp rps">
            <td tal:content="authenticated_rp/trust_root" />
            <td tal:content="authenticated_rp/date_created/fmt:date" />
            <td tal:content="authenticated_rp/date_last_used/fmt:date" />
          </tr>
        </tbody>
      </table>
      </tal:visited-sites>
    </div>
  </body>
</html>
</tal:logged-in>

</tal:root>
