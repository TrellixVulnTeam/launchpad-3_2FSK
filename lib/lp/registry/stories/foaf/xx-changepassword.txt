==================
Changing passwords
==================

No Privileges Person wants to change his password.

    >>> user_browser.open('http://launchpad.dev/~no-priv/+changepassword')

He accidentally uses an illegal character in the new password.

    >>> user_browser.getControl('Current password').value = 'test'
    >>> user_browser.getControl('New password').value = 'tésté'
    >>> user_browser.getControl(name='field.password_dupe').value = 'tésté'
    >>> user_browser.getControl('Change Password').click()
    >>> print_feedback_messages(user_browser.contents)
    There is 1 error.
    The password provided contains non-ASCII characters.

No Priv tries again, but this time he enters the wrong password!

    >>> user_browser.getControl('Current password').value = 'wrong'
    >>> user_browser.getControl('New password').value = 'test'
    >>> user_browser.getControl(name='field.password_dupe').value = 'test'
    >>> user_browser.getControl('Change Password').click()
    >>> print_feedback_messages(user_browser.contents)
    There is 1 error.
    The provided password doesn't match your current password.

He uses an illegal character in his current password, which is also the wrong
password.

    >>> user_browser.getControl('Current password').value = 'ééé'
    >>> user_browser.getControl('New password').value = 'test'
    >>> user_browser.getControl(name='field.password_dupe').value = 'test'
    >>> user_browser.getControl('Change Password').click()
    >>> print_feedback_messages(user_browser.contents)
    There is 1 error.
    The provided password doesn't match your current password.

And finally he uses a legal password, containing only ascii characters.

    >>> user_browser.getControl('Current password').value = 'test'
    >>> user_browser.getControl('New password').value = 'abc'
    >>> user_browser.getControl(name='field.password_dupe').value = 'abc'
    >>> user_browser.getControl('Change Password').click()
    >>> print user_browser.url
    http://launchpad.dev/~no-priv
    >>> print_feedback_messages(user_browser.contents)
    Password changed successfully

Now, No Priv logs in with his new password.

    >>> anon_browser.open('http://launchpad.dev/+login')
    >>> anon_browser.getControl('E-mail address:', index=0).value = (
    ...     'no-priv@canonical.com')
    >>> anon_browser.getControl('Password:').value = 'abc'
    >>> anon_browser.getControl('Log In').click()
    >>> print anon_browser.url
    http://launchpad.dev
    >>> print extract_text(find_main_content(anon_browser.contents))
    20 projects,
    ...
