<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  omit-tag="">
<tal:do-this-first tal:content="view/process_form" />
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/freeform" 
  i18n:domain="launchpad"
>
  <head metal:fill-slot="head_epilogue">
    <meta name="robots" content="noindex" />
  </head>
  <body>
    <tal:comment condition="nothing">
      This page handles cases in this order:
      1.  already logged in and shouldn't be here
      2.  just logged in successfully
      3.  just applied for registration successfully
      4.  might want to log in
          4a. didn't try to log in last time
          4b. just tried to log in and failed
      5.  might want to register
          5a. didn't try to register last time
          5b. just tried to register and failed.
      The usual case is 4 + 5.

      See also launchpad-restictedlogin.pt, which also uses
      these numbers in comments.
    </tal:comment>
    <div metal:fill-slot="main" class="freeform">

      <!-- 1. already logged in and shouldn't be here: -->
      <tal:block condition="request/lp:person">

        <!-- 2. just logged in successfully: -->
        <p tal:condition="view/login_success">
          You are now logged in as <strong
          tal:content="request/lp:person/browsername">Person Name</strong>.
        </p>

        <tal:block condition="not: view/login_success">
          <h1>You&#8217;re already logged in</h1>
          <p>
            You are already logged in as
            <strong tal:content="request/lp:person/browsername">person
            name</strong>.  If this is not you, please
            <a href="/+logout">log out now</a>.
          </p>
        </tal:block>
      </tal:block>

      <tal:block condition="not: request/lp:person">

        <tal:block condition="not: view/login_success">

          <!-- 3. just registered successfully: -->
          <tal:registered condition="view/registration_success">
            <h1>Registration mail sent</h1>
            <p id="address">
              Instructions on completing your registration have been sent to
              <strong><code tal:content="view/email"
                >email@domain.com</code></strong>.
            </p>
            <p>
              If you don&rsquo;t receive the instructions within a few
              minutes, it might be because:
            </p>
            <ul>
              <li>
                <p>
                  Your mail provider uses &ldquo;greylisting&rdquo; to reduce
                  spam. If so, you&rsquo;ll need to wait an hour or two
                  for the message to arrive.
                </p>
              </li>
              <li>
                <p>
                  Your mail provider mistakenly blocks messages from Launchpad.
                  Try signing up using a service like
                  <a href="http://gmail.com/">Gmail</a> or
                  <a href="http://mail.yahoo.com/">Yahoo Mail</a>.
                  If that works, complain to your usual mail provider.
                </p>
              </li>
              <li>
                <p>
                  If neither of those work, Launchpad might be broken somehow.
                  Let us know on the <a href=
                  "https://lists.canonical.com/mailman/listinfo/launchpad-users"
                  >launchpad-users mailing list</a> (requires subscription).
                </p>
              </li>
            </ul>
          </tal:registered>

          <tal:block condition="not: view/registration_success">
            <!-- 4a. didn't try to log in last time: -->
            <h1 tal:condition="not: view/login_error">
              Already registered?
            </h1>
            <!-- 4b. just tried to log in and failed: -->
            <div tal:condition="view/login_error">
              <h1>Your login was unsuccessful</h1>
              <p class="error message" tal:content="view/login_error" />
            </div>
            <!-- 4. might want to log in: -->
            <p>
              To log in, enter your e-mail address
              and Launchpad password.
            </p>
            <form name="login" method="POST">
              <table>
                <tr>
                  <th>
                    <label for="email">E-mail address:</label>
                  </th>
                  <td>
                    <input type="text"
                      name="loginpage_email"
                      id="email"
                      size="30"
                      tal:attributes="value request/email | nothing"
                    />
                    <script>
                    <!--
                        document.forms['login'].loginpage_email.focus();
                    //-->
                    </script>
                  </td>
                </tr>
                <tr>
                  <th><label for="password">Password:</label></th>
                  <td>
                    <input
                      type="password"
                      id="password"
                      name="loginpage_password"
                    />
                  </td>
                </tr>
                <tr>
                  <th></th>
                  <td>
                    <div>
                      <input
                        type="submit"
                        name="loginpage_submit_login"
                        value="Log In" />
                      [<a href="/+forgottenpassword">Forgotten your password?</a>]
                    </div>
                  </td>
                </tr>
              </table>
              <!-- Preserve extra query parameters as hidden fields. -->
              <tal:replacement tal:replace="structure view/preserve_query" />
            </form>
            <!-- 5a. didn't try to register last time: -->
            <h1 tal:condition="not: view/registration_error">
              Not registered yet? 
            </h1>
            <!-- 5b. just tried to register and failed: -->
            <tal:block condition="view/registration_error">
              <h1>Your registration was unsuccessful</h1>
              <p class="error message"
                 tal:content="structure view/registration_error" />
            </tal:block>
            <!-- 5. might want to register: -->
            <p>
              Launchpad will e-mail you to check your address
              and give instructions on how to complete
              registration. 
              We will never disclose, share, or sell your
              personal information, nor send you e-mail not
              directly related to Launchpad.
            </p>
            <form name="join" method="POST">
              <input type="hidden" name="redirection_url"
                     tal:condition="not: request/form/redirection_url|nothing"
                     tal:attributes="value view/getRedirectionURL" />
              <table>
                <tr>
                  <th>
                    <label for="registeremail">E-mail address:</label>
                  </th>
                  <td>
                    <input type="text" size="30" name="loginpage_email"
                      id="registeremail"
                      tal:attributes="value view/email|nothing"
                    />
                  </td>
                </tr>
                <tr>
                  <th></th>
                  <td>
                    <input
                      type="submit"
                      name="loginpage_submit_registration"
                      value="Register" />
                  </td>
                </tr>
              </table>
              <!-- Preserve extra query parameters as hidden fields. -->
              <tal:replacement tal:replace="structure view/preserve_query" />
            </form>
          </tal:block>
        </tal:block>
      </tal:block>
    </div>
  </body>
</html>
</tal:root>
