<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
>

<body>

<div metal:fill-slot="main">
  <div id="packages">

  <tal:maintained-packages
    define="sourcepackagereleases view/getLatestMaintainedPackagesWithStats"
    condition="sourcepackagereleases">

  <h1>Maintained packages</h1>

  <tal:size replace="view/PACKAGE_LIMIT"/> Most recently uploaded packages
  <table class="listing">
    <thead>
      <tr>
        <th>Name</th>
        <th>Uploaded to</th>
        <th>Version</th>
        <th>When</th>
        <th>Failures</th>
        <th>Bugs</th>
        <th>Questions</th>
      </tr>
    </thead>
    <tbody>
    <div metal:use-macro="template/macros/sourcepackagerelease-rows" />
    </tbody>
  </table>
  </tal:maintained-packages>

  <tal:uploaded-packages
    define="sourcepackagereleases view/getLatestUploadedButNotMaintainedPackagesWithStats"
    condition="sourcepackagereleases">

  <h1>Uploaded packages</h1>

  <tal:size replace="view/PACKAGE_LIMIT"/> Most recently uploaded packages
  <table class="listing">
    <thead>
      <tr>
        <th>Name</th>
        <th>Uploaded to</th>
        <th>Version</th>
        <th>When</th>
        <th>Failures</th>
        <th>Bugs</th>
        <th>Questions</th>
      </tr>
    </thead>

    <div metal:use-macro="template/macros/sourcepackagerelease-rows" />
  </table>
  </tal:uploaded-packages>

  <tal:ppa-packages
    define="sourcepackagereleases view/getLatestUploadedPPAPackagesWithStats"
    condition="sourcepackagereleases">

  <h1>PPA packages</h1>

  <tal:size replace="view/PACKAGE_LIMIT"/> Most recently uploaded packages
  <table class="listing">
    <thead>
      <tr>
        <th>Name</th>
        <th>Uploaded to</th>
        <th>Version</th>
        <th>When</th>
        <th>Failures</th>
        <th>Bugs</th>
        <th>Questions</th>
      </tr>
    </thead>

    <div metal:use-macro="template/macros/sourcepackagerelease-ppa-rows" />
  </table>
  </tal:ppa-packages>

  </div>

  <div id="projects">
    <a name="projects" />
    <h1>Related projects</h1>

    <p tal:condition="view/tooManyRelatedProjectsFound"
      class="informational message">
      <span tal:replace="view/related_projects_count" /> projects are related
      to <span tal:replace="context/displayname" />. Displaying only the first
      <span tal:replace="view/max_results_to_display" />:
    </p>

    <table tal:condition="view/relatedProjects"
           tal:define="pillarnames view/relatedProjects"
           class="listing"
           id="related-projects">
      <thead>
        <tr>
          <th>Name</th>
          <th>Bugs</th>
          <th>Blueprints</th>
          <th>Questions</th>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="pillarname pillarnames">
          <td>
            <a tal:attributes="href pillarname/pillar/fmt:url"
               tal:content="pillarname/pillar/title">
            </a>
          </td>
          <td style="text-align: right">
            <a tal:attributes="href string:${pillarname/pillar/fmt:url}/+bugs"
               tal:content="python: pillarname.pillar.open_bugtasks.count()">
            </a>
          </td>
          <td style="text-align: right">
            <a tal:attributes="href string:${pillarname/pillar/fmt:url}/+specs"
               tal:content="python: pillarname.pillar.specifications().count()">
            </a>
          </td>
          <td style="text-align: right">
            <a tal:attributes="href string:${pillarname/pillar/fmt:url}/+questions"
               tal:content="python: pillarname.pillar.searchQuestions().count()">
            </a>
          </td>
        </tr>
      </tbody>
    </table>
    <p tal:condition="not: view/relatedProjects">
      <span tal:replace="context/title">Foo Bar</span>
      doesn't own or drive any projects.
    </p>
  </div>

</div>

<metal:macros fill-slot="bogus">
<metal:macro define-macro="sourcepackagerelease-rows">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
    :sourcepackagereleases: A list of SourcePackageRelease objects
  </tal:comment>
  <tr tal:repeat="sourcepackagerelease sourcepackagereleases">
  <tal:block define="spr sourcepackagerelease;
                     distroseries spr/upload_distroseries">
    <td>
      <a tal:attributes="href string:${distroseries/distribution/fmt:url}/+source/${spr/name}"
         class="distrosrcpackage"
         tal:content="spr/sourcepackagename/name">
      </a>
    </td>
    <td>
      <a tal:attributes="href string:${distroseries/fmt:url}/+source/${spr/name}"
         class="distroseriessrcpackage"
         tal:content="distroseries/fullseriesname">
      </a>
    </td>
    <td>
      <a tal:attributes="href string:${distroseries/distribution/fmt:url}/+source/${spr/name}/${spr/version}"
         class="distrosrcpackagerelease"
         tal:content="spr/version">
      </a>
    </td>
    <td
      tal:attributes="title spr/dateuploaded/fmt:datetime"
      tal:content="spr/dateuploaded/fmt:approximatedate">
      2005-10-24
    </td>
    <td>
      <tal:block condition="spr/needs_building">
          Not yet built
      </tal:block>
      <tal:block condition="not: spr/needs_building">
          <tal:block repeat="build spr/failed_builds">
             <a tal:attributes="href build/fmt:url"
                tal:content="build/distroarchseries/architecturetag" />
          </tal:block>
          <tal:block condition="not: spr/failed_builds">
             None
          </tal:block>
      </tal:block>
    </td>
    <td style="text-align: right">
      <a tal:attributes="href string:${spr/distrosourcepackage/fmt:url}/+bugs"
         tal:content="spr/open_bugs">
      </a>
    </td>
    <td style="text-align: right">
      <a tal:attributes="href string:${spr/sourcepackage/fmt:url}/+questions"
         tal:content="spr/open_questions">
      </a>
    </td>
  </tal:block>
  </tr>
</metal:macro>

<metal:macro define-macro="sourcepackagerelease-ppa-rows">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
    :sourcepackagereleases: A list of SourcePackageRelease objects
  </tal:comment>
  <tr tal:repeat="sourcepackagerelease sourcepackagereleases"
      class="ppa_row">
  <tal:block define="spr sourcepackagerelease;
                     distroseries spr/upload_distroseries;
                     ppa spr/upload_archive">
    <td tal:content="spr/sourcepackagename/name">
      iceweasel
    </td>
    <td>
      <a tal:attributes="href ppa/fmt:url" tal:content="ppa/title" /> -
      <a class="distroseries" tal:attributes="href distroseries/fmt:url"
         tal:content="distroseries/fullseriesname" />
    </td>
    <td tal:content="spr/version">
      1.0
    </td>
    <td
      tal:attributes="title spr/dateuploaded/fmt:datetime"
      tal:content="spr/dateuploaded/fmt:approximatedate">
      2005-10-24
    </td>
    <td>
      <tal:block condition="spr/needs_building">
          Not yet built
      </tal:block>
      <tal:block condition="not: spr/needs_building">
          <tal:block repeat="build spr/failed_builds">
             <a tal:attributes="href build/fmt:url"
                tal:content="build/distroarchseries/architecturetag" />
          </tal:block>
          <tal:block condition="not: spr/failed_builds">
             None
          </tal:block>
      </tal:block>
    </td>
    <td style="text-align: right">-</td>
    <td style="text-align: right">-</td>
  </tal:block>
  </tr>
</metal:macro>
</metal:macros>

</body>
</html>
