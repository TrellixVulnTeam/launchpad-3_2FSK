<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="context/@@main_template/master"
  i18n:domain="launchpad"
>

  <head>
    <metal:head_epilogue fill-slot="head_epilogue">
      <script type="text/javascript">
        function disableSubmitButton() {
          var form = document.forms['shipit'];
          form.FORM_SUBMIT.disabled = true;
        }
      //</script>
    </metal:head_epilogue>
  </head>
<body>

<div metal:fill-slot="body">

<tal:shipit-is-open condition="view/is_open" define="user view/user">

  <p class="informational message"
     tal:define="status view/process_status"
     tal:condition="status"
     tal:content="structure status" />

  <div class="error message"
    tal:repeat="top_of_page_error view/top_of_page_errors"
    tal:content="structure top_of_page_error">
    Schema validation errors.
  </div>

  <tal:current_request condition="view/current_order">
    <h1>Current Request Details</h1>
    <ul>
      <tal:block repeat="requested_cds view/current_order/getAllRequestedCDs">
        <li tal:condition="requested_cds/quantity">
          <strong tal:content="requested_cds/description" />
        </li>
      </tal:block>
    </ul>
    <div>
      <form name="cancelrequest" action="" method="post">
        <input type="hidden" name="order"
               tal:attributes="value view/current_order/id" />

        <input type="submit" value="Cancel Request" name="cancel"
               class="formControls"/>
      </form>
    </div>
  </tal:current_request>

  <tal:pastrequests condition="user/pastShipItRequests">
    <h1>Shipped/Cancelled requests</h1>

    <metal:pastrequests use-macro="context/@@+shipit-macros/previous_requests" />
  </tal:pastrequests>

  <tal:has-current-order condition="view/current_order">
    <h1 tal:condition="view/currentOrderContainsCDsOfThisFlavour">
      Change your current request
    </h1>

    <h1 tal:condition="not: view/currentOrderContainsCDsOfThisFlavour">
      Request an extra CD
    </h1>
  </tal:has-current-order>

  <tal:no-current-order condition="not: view/current_order">
    <tal:no-prerelease condition="not: view/prerelease_mode">
      <tal:standard-request condition="not:view/should_show_custom_request">
        <p class="informational message">
        We can send you a CD free of charge, but it will take from
        six to ten weeks to deliver, so you may prefer to
        <a tal:attributes="href view/download_url">download the CD image</a>
        and record it yourself.
        </p>
      </tal:standard-request>
    </tal:no-prerelease>
    <tal:prerelease condition="view/prerelease_mode">
      <p class="informational message">
        Ubuntu <span tal:replace="view/series/title" /> has not been released
        yet, but we'll record your request and send you a CD as soon as that
        happens. Note that delivery will take from six to ten weeks once
        it is sent.
      </p>
    </tal:prerelease>
  </tal:no-current-order>

  <p tal:condition="view/should_show_custom_request">
    Delivery of special requests can take from
    <strong>twelve to sixteen weeks</strong>. For quicker processing, choose a
    <a tal:attributes="href view/standard_order_page">standard option</a>
    instead.
  </p>

  <tal:is-server condition="view/flavour/enumvalue:SERVER">
    <p>
      Different <span tal:replace="view/flavour/title" /> CDs are made
      for different types of computer:
    </p>

    <ul>
      <li>
        <strong>Server</strong> Edition for x86 based servers (including
        Intel Pentium, Intel Xeon and AMD Athlon).
      </li>

      <li>
        <strong>64-bit Server</strong> Edition for AMD64 and Intel64 based
        servers (including AMD Opteron and Intel EM64T Xeon).
      </li>
    </ul>
  </tal:is-server>

  <tal:custom-request condition="view/should_show_custom_request">

    <div class="warning message">
      <p>
        While we will consider all requests, due to extremely high
        demand we may choose to send a smaller number of CDs, or refuse
        your request altogether.
      </p>
      <p>
        Requesting a smaller number of CDs or a
        <a tal:attributes="href view/standard_order_page">standard option</a>
        will increase your chances of having the request approved.
        Remember, you can reuse the CDs!
      </p>
    </div>
  </tal:custom-request>

  <!-- Without using setTimeout() to disable the submit button it'll be
  disabled before the browser generates the request, which will cause the
  request to not contain the name/value of the button.
  -->
  <form name="shipit" action="" method="post"
        accept-charset="UTF-8"
        onsubmit="javascript: window.setTimeout('disableSubmitButton()', 1);">

  <table class="headers-right-aligned">
  <tbody>
  <tr tal:condition="not: view/should_show_custom_request">
    <th style="vertical-align: top;">I would like:</th>
    <td tal:define="selected_id view/selected_standardrequest">

      <div id="standard-options">
        <div tal:repeat="request_type view/standardShipItRequests">
          <label>
            <input type="radio" name="ordertype"
              tal:attributes="value request_type/id;
                              checked python:request_type.id == selected_id" />
            <span tal:content="request_type/description" />
          </label>
        </div>

        <p>You can make a <a tal:attributes="href view/custom_order_page">
        special request</a>
        for different quantities, but note this will take longer to process
        and may not be approved at all.
        </p>
      </div>
    </td>
  </tr>

  <tal:special-request-fields condition="view/should_show_custom_request">
    <tr>
      <th><strong>I would like &nbsp;</strong></th>
      <td tal:condition="not: view/flavour/enumvalue:SERVER">
        <span tal:replace="structure view/ubuntu_quantityx86_widget" />
        CDs.
        <div class="error"
             tal:condition="view/ubuntu_quantityx86_widget/error">
          <div class="message"
               tal:content="view/ubuntu_quantityx86_widget/error">
            Error message
          </div>
        </div>
      </td>

      <td tal:condition="view/flavour/enumvalue:SERVER">
        <span tal:replace="structure view/ubuntu_quantityx86_widget" />
        <strong>32-bit CDs</strong> and
        <span tal:replace="structure view/ubuntu_quantityamd64_widget" />
        <strong>64-bit CDs</strong>.
        <div class="error"
             tal:condition="view/ubuntu_quantityx86_widget/error">
          <div class="message"
               tal:content="view/ubuntu_quantityx86_widget/error">
            Error message
          </div>
        </div>
        <div class="error"
             tal:condition="view/ubuntu_quantityamd64_widget/error">
          <div class="message"
               tal:content="view/ubuntu_quantityamd64_widget/error">
            Error message
          </div>
        </div>
      </td>
    </tr>

    <tr>
      <td>&nbsp;</td>
      <td>
        <br />
        <div tal:define="widget nocall:view/reason_widget">
          <label>Why are you requesting these CDs?</label>
          <div style="color: #999; font-size: smaller">
            (Your answer must be in English)
          </div>
          <span metal:use-macro="context/@@launchpad_widget_macros/display_raw_widget" />
        </div>

        <input type="hidden" name="custom" value="1" />

      </td>
    </tr>
  </tal:special-request-fields>

  <metal:shipping_details use-macro="context/@@+shipit-macros/shipping_details" />

  <tr>
    <td></td>
    <td>
      <p>
        Please double-check your address
        before submitting your request.
      </p>
    </td>
  </tr>
  <tr>
    <td></td>
    <td>

      <tal:current_request condition="view/current_order">
        <input tal:condition="view/currentOrderContainsCDsOfThisFlavour"
               type="submit" value="Change Request" name="FORM_SUBMIT"
               class="formControls"/>

        <input tal:condition="not: view/currentOrderContainsCDsOfThisFlavour"
               type="submit" value="Request More CDs" name="FORM_SUBMIT"
               class="formControls"/>
      </tal:current_request>

      <tal:no_current_request condition="not: view/current_order">
        <input type="submit" value="Submit Request" name="FORM_SUBMIT"
               class="formControls"/>
      </tal:no_current_request>

    </td>
  </tr>
  </tbody>
  </table>

  </form>

</tal:shipit-is-open>

<tal:shipit-is-closed condition="not: view/is_open">
  <h1>ShipIt is currently closed</h1>

  <p class="informational message">We'll be back in a few days, shipping
  <span tal:replace="view/flavour/title" />
  <span tal:replace="view/series/title" /> CDs.
  </p>

  <tal:pastrequests condition="view/user/pastShipItRequests"
                    define="user view/user">
    <h2>Shipped/Cancelled requests</h2>

    <metal:pastrequests use-macro="context/@@+shipit-macros/previous_requests" />
  </tal:pastrequests>
</tal:shipit-is-closed>

</div>
</body>
</html>

