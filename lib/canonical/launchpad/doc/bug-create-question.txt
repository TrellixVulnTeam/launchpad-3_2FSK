Bugs can be converted into questions when a person ascertains that
that is the nature of the issue. The bug's target must be adaptable
to IQuestionTarget and must use Launchpad track bugs.

    >>> from zope.interface.verify import verifyObject
    >>> from canonical.launchpad.interfaces import (
    ...     CreateBugParams, IBugSet, IBugTaskSet, IDistributionSet,
    ...     IDistributionSourcePackage, IDistroSeries, IPersonSet,
    ...     IProductSet, IProductSeries, IQuestionTarget,
    ...     ISourcePackageNameSet)

Some parts of the IQuestionTarget interface are only accessible
to a registered user. No Privileges Person will create the bugs,
Sample Person will play the role of bug contact.

    >>> no_priv = getUtility(IPersonSet).getByName('no-priv')
    >>> sample_person = getUtility(IPersonSet).getByName('name12')
    >>> login('test@canonical.com')

A Firefox bug in Debian cannot be converted to a question because the
Distribution does not use Launchpad to track bugs.

    >>> firefox_bug = getUtility(IBugSet).get(8)
    >>> firefox_package = firefox_bug.bugtasks[0].target
    >>> IQuestionTarget.providedBy(firefox_package)
    True
    >>> firefox_bug.bugtasks[0].target_uses_malone
    False

    >>> firefox_bug.createQuestionFromBug(firefox_package, sample_person)
    Traceback (most recent call last):
    ...
    AssertionError: debian official_malone must be True.

Jokosher does use Launchpad to track bugs; its bugs can be converted
to questions.

    >>> login('no-priv@canonical.com')

    >>> jokosher = getUtility(IProductSet)['jokosher']
    >>> bug_params = CreateBugParams(
    ...     title="Print is broken", comment="blah blah blah", owner=no_priv)
    >>> bug_params.setBugTarget(product=jokosher)
    >>> jokosher_bug = getUtility(IBugSet).createBug(bug_params)
    >>> jokosher_bugtask = jokosher_bug.bugtasks[0]
    >>> jokosher_bugtask.status.title
    'New'
    >>> jokosher.official_malone
    True
    >>> IQuestionTarget.providedBy(jokosher)
    True

    # The view uses the context as the QuestionTarget, but any object
    # that provides IQuestionTarget will suffice.
    # eg. bug.createQuestionFromBug(self.context, self.user)
    >>> login('test@canonical.com')
    >>> question = jokosher_bug.createQuestionFromBug(jokosher, sample_person)

    >>> question.target == jokosher
    True
    >>> question.owner == jokosher_bug.owner
    True
    >>> question.title == jokosher_bug.title
    True
    >>> question.description == jokosher_bug.description
    True
        
    >>> question.owner.displayname
    u'No Privileges Person'
    >>> question.title
    u'Print is broken'
    >>> question.description
    u'blah blah blah'

Once converted to a question, the bugtask status is Invalid.

    >>> jokosher_bugtask.status.title
    'Invalid'
    >>> jokosher_bugtask.statusexplanation
    u'This is not a bug. It is a question.'

The question is automatically linked to the original bug.

    >>> [question.title for question in jokosher_bug.questions]
    [u'Print is broken']

Subscribers to the bug are not notify that the bug is now invalid
because the issue does not, nor did it ever, concern the bug contacts.
The question owner (the bug owner) is informed by email that he asked
a question.

    >>> from canonical.launchpad.tests.mail_helpers import pop_notifications
    >>> notifications = pop_notifications()
    >>> len(notifications)
    1
    
    >>> notifications[0]['To']
    'no-priv@canonical.com'
    
    >>> notifications[0]['Subject']
    '[Question #15]: Print is broken'

A bug can only be converted to a question once.

    >>> question = jokosher_bug.createQuestionFromBug(jokosher, sample_person)
    Traceback (most recent call last):
    ...
    AssertionError: This bug was already converted to question #...    

In the rare instance where a bug has more than one bugtask, the status
for both bugtasks is set to Invalid. When a bug is really a question,
it is a question for all bugtasks; a bug cannot be a question in one
location and a bug in another.

    >>> login('no-priv@canonical.com')

    >>> ubuntu = getUtility(IDistributionSet)['ubuntu']
    >>> bug_params = CreateBugParams(
    ...     title="Print is borked", comment="blah blah blah", owner=no_priv)
    >>> bug_params.setBugTarget(distribution=ubuntu)
    >>> ubuntu_bug = getUtility(IBugSet).createBug(bug_params)

    >>> evo_ubuntu = getUtility(ISourcePackageNameSet)['evolution']
    >>> evo_bugtask = getUtility(IBugTaskSet).createTask(
    ...     bug=ubuntu_bug, distribution=ubuntu, sourcepackagename=evo_ubuntu,
    ...     owner=no_priv)
    >>> bugtasks = ubuntu_bug.bugtasks
    >>> len(bugtasks)
    2

    >>> ['%s: %s' % (bt.target.name, bt.status.title) for bt in bugtasks]
    [u'ubuntu: New', u'evolution: New']

    >>> login('test@canonical.com')
    
    >>> question = ubuntu_bug.createQuestionFromBug(ubuntu, sample_person)
    >>> question.title
    u'Print is borked'
    >>> question.target.name
    u'ubuntu'

    >>> ['%s: %s' % (bt.target.name, bt.status.title) for bt in bugtasks]
    [u'ubuntu: Invalid', u'evolution: Invalid']
    >>> [bt.statusexplanation for bt in bugtasks]
    [u'This is not a bug. It is a question.',
     u'This is not a bug. It is a question.']
