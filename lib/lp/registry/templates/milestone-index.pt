<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
>

<body>
  <div metal:fill-slot="main" tal:define="
    specs view/specifications;
    bugtasks view/bugtasks;
    milestone_menu view/milestone/menu:context;
    release_menu view/release/menu:context|Nothing;
    has_edit context/required:launchpad.Edit">

    <h1>
      <tal:title tal:content="view/milestone/title"  />
      <a tal:condition="context/required:launchpad.Edit"
        tal:attributes="href view/milestone/fmt:url/+delete"
        title="Delete this milestone"
        ><img src="/@@/trash-icon"
           alt="Delete this milestone" title="Delete this milestone" /></a>
      <a tal:replace="structure milestone_menu/edit/fmt:icon" />
    </h1>

    <table id="Release-details" style="margin-bottom: 1em;">
      <tr>
        <th>Project:</th>
        <td><tal:link replace="structure view/milestone/target/fmt:link" /></td>
      </tr>
      <tr>
        <th>Series:</th>
        <td><a tal:attributes="href view/milestone/series_target/fmt:url"
          tal:content="view/milestone/series_target/displayname"
          tal:condition="view/milestone/series_target" /></td>
      </tr>
      <tr>
        <th>Release version:</th>
        <td><span tal:replace="context/name" /></td>
      </tr>
      <tr>
        <th>Release code name:</th>
        <td><span tal:replace="view/milestone/code_name" /></td>
      </tr>
      <tr>
        <th>Expected:</th>
        <td><span
          tal:attributes="title context/dateexpected/fmt:datetime"
          tal:content="context/dateexpected/fmt:approximatedate" />
          &nbsp; <a tal:replace="structure milestone_menu/create_release/fmt:icon-link"
            >Release this milestone</a>
          </td>
      </tr>
      <tal:has_release condition="view/release">
      <tr>
        <th>Released:</th>
        <td><span
          tal:attributes="title view/release/datereleased/fmt:datetime"
          tal:content="view/release/datereleased/fmt:approximatedate" />
          &nbsp; <a tal:condition="view/release/required:launchpad.Edit"
            tal:attributes="href view/release/fmt:url/+delete"
            title="Delete this release"
            ><img src="/@@/remove"
               alt="Delete this release" title="Delete this release" /></a>
          <a tal:replace="structure release_menu/edit/fmt:icon" />
          </td>
      </tr>
      <tr>
        <th>Registrant:</th>
        <td><tal:registrant replace="structure view/release/owner/fmt:link"/></td>
      </tr>
      <tr>
        <th>When:</th>
        <td><span
          tal:attributes="title view/release/datecreated/fmt:datetime"
          tal:content="view/release/datecreated/fmt:approximatedate" /></td>
      </tr>
      </tal:has_release>
    </table>

    <tal:no_release condition="not: view/release">
      <p tal:condition="not: context/active">
        <img src="/@@/info"/> This is an inactive milestone.
      </p>
    </tal:no_release>

    <div id="description" tal:condition="view/milestone/summary">
      <fieldset>
        <legend>Summary</legend>
        <p class="documentDescription"
          tal:content="structure view/milestone/summary/fmt:text-to-html">
            Milestone.summary goes here. This should be quite short,
            just a single paragraph of text really, giving a summary of
            this release highlights.
        </p>
      </fieldset>
    </div>

    <tal:has_release condition="view/release">
      <form method="POST"
            tal:attributes="action request/URL">

        <h2 style="margin-top: 2em;">Download files for this release</h2>

        <table id="downloads" class="listing">
          <thead>
            <tr>
              <th>File</th>
              <th>Downloads</th>
              <th>Description</th>
              <th tal:condition="has_edit" width="10%">Delete</th>
            </tr>
          </thead>
          <tbody>
            <tr tal:repeat="file view/release/files">
              <tal:define-lfa define="lfa file/libraryfile">
              <td>
                <img alt="download icon" src="/@@/download" />
                <strong><a
                  tal:attributes="href python:view.fileURL(file.libraryfile, view.release)"
                  tal:content="file/libraryfile/filename"
                  >filename</a></strong>
                (<a tal:attributes="href python:view.md5URL(file.libraryfile)"
                >md5</a><tal:signature condition="file/signature">,
                <a tal:attributes="href python:view.fileURL(file.signature)">
                sig</a></tal:signature>)
              </td>
              <td>
                <tal:downloaded condition="lfa/hits">
                  <span tal:replace="lfa/hits/fmt:commify" />
                  <span class="lesser">
                    (Last downloaded
                    <strong tal:content="lfa/last_downloaded/fmt:approximateduration" />
                    ago)
                </tal:downloaded>
                <tal:not-downloaded condition="not:lfa/hits">
                  -
                </tal:not-downloaded>
              </td>
              <td tal:content="file/description">Installer for i386</td>
              <td tal:condition="has_edit"
                  align="center">
                <input type="checkbox"
                       tal:define="cbnum string:${repeat/file/index}"
                       tal:attributes="value file/libraryfile/id;
                                       name string:checkbox_${cbnum}" />
              </td>
              </tal:define-lfa>
            </tr>
          </tbody>
        </table>

        <div style="margin-top: .4em;" tal:condition="has_edit">
          <div style="float:right">
            <input type="submit" name="delete_files" value="Delete Files"
              tal:condition="view/release/files"/>
          </div>
          <div
            tal:define="link release_menu/add_file"
            tal:condition="link/enabled">
            <a tal:replace="structure link/render">Add a file</a>
          </div>
        </div>
      </form>

      <h2 style="margin-top: 2em;">Release notes
        <a tal:replace="structure release_menu/edit/fmt:icon" /></h2>

      <div id="release_notes"
        tal:content="structure view/release/release_notes/fmt:text-to-html"
        tal:condition="view/release/release_notes">
        ProductRelease.release_notes go here.
      </div>

      <p tal:condition="not: view/release/release_notes">
        <em>This release does not have release notes.</em>
      </p>

      <h2 style="margin-top: 2em;">Changelog</h2>

      <fieldset class="collapsible collapsed" style="padding: 0px;"
        tal:condition="view/release/changelog">
        <legend>View the full changelog</legend>
        <div id="changelog" style="margin-bottom: 0px;"
          tal:content="structure view/release/changelog/fmt:obfuscate-email/fmt:text-to-html">
          ProductRelease.changelog go here.
        </div>
        <div style="margin-top: -0.5em;">
          <a
          tal:attributes="href release_menu/edit/url">Edit the changelog</a> &nbsp; <a tal:replace="structure release_menu/edit/fmt:icon" /></div>
      </fieldset>

      <p tal:condition="not: view/release/changelog">
        <em>This release does not have a changelog.</em> &nbsp; <a tal:replace="structure release_menu/edit/fmt:icon" />
      </p>
    </tal:has_release>

  <p style="margin-top: 2em; font-size: 120%">
    <span id="specification-count" style="color: #3594bb;"
      tal:content="structure view/specification_count_text">2</span>
    <tal:and condition="view/has_bugs_or_specs">and</tal:and>
    <span id="bug-count" style="color: #9f2b33;"
      tal:content="structure view/bugtask_count_text">2</span>
    targeted
  </p>

  <tal:has_specs condition="specs">
    <table class="listing sortable" id="milestone_specs"
      style="margin-bottom: 2em;">
      <thead>
        <tr>
          <th colspan="2">Blueprint</th>
          <th style="width: 14em"
            tal:condition="view/is_project_milestone">
            Product
          </th>
          <th style="width: 9em;">Priority</th>
          <th style="width: 14em;">Assignee</th>
          <th style="width: 10em;">Delivery</th>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="spec specs">
          <td class="icon left">
            <span tal:content="structure spec/image:icon" />
          </td>
          <td>
            <a tal:content="spec/title/fmt:shorten/60"
               tal:attributes="
                   href spec/fmt:url;
                   title spec/name">Foo Bar Baz</a>
            <img src="/@@/info" alt="Informational"
                 tal:condition="spec/informational" />
          </td>
          <td tal:condition="view/is_project_milestone">
              <span class="sortkey" tal:content="spec/product/displayname" />
              <a tal:attributes="href spec/milestone/fmt:url"
                 tal:content="spec/product/displayname" />
          </td>
          <td>
            <span class="sortkey" tal:content="spec/priority/sortkey" />
            <span tal:content="spec/priority/title"
                  tal:attributes="
                  class string:specpriority${spec/priority/name}">High</span>
          </td>
          <td>
            <a tal:condition="spec/assignee"
               tal:replace="structure spec/assignee/fmt:link" />&nbsp;
          </td>
          <td>
            <span class="sortkey"
                  tal:content="spec/implementation_status/sortkey" />
            <span tal:content="spec/implementation_status/title"
                  tal:attributes="
                  class string:specdelivery${spec/implementation_status/name}">
              Deployment
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </tal:has_specs>

  <tal:has_bugtasks condition="bugtasks">
    <table class="listing sortable" id="milestone_bugtasks">
      <thead>
        <tr>
          <th colspan="4">Bug report</th>
          <th style="width: 14em"
            tal:condition="view/is_project_milestone">
            Product
          </th>
          <th style="width: 9em;">Importance</th>
          <th style="width: 14em;">Assignee</th>
          <th style="width: 10em;">Status</th>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="bugtask bugtasks">
          <td class="icon left">
            <span class="sortkey" tal:content="bugtask/bug/id" />
            <span tal:content="structure bugtask/image:icon" />
          </td>
          <td tal:content="string:#${bugtask/bug/id}" class="amount">12345</td>
          <td>
            <a tal:attributes="href bugtask/bug/fmt:url"
               tal:content="bugtask/bug/title/fmt:shorten/65">
               Bug Title Here
            </a>
          </td>
          <td style="width: 33px; padding-right: 5px;">
            <img src="/@@/info" tal:replace="structure bugtask/image:badges" />
          </td>
          <td tal:condition="view/is_project_milestone">
            <span class="sortkey" tal:content="bugtask/target/displayname" />
            <a tal:attributes="href bugtask/milestone/fmt:url"
               tal:content="bugtask/target/displayname" />
          </td>
          <td>
            <span class="sortkey" tal:content="bugtask/importance/sortkey" />
            <span tal:content="bugtask/importance/title"
                  tal:attributes="
                  class string:importance${bugtask/importance/name}">High</span>
          </td>
          <td>
            <a tal:condition="bugtask/assignee"
               tal:replace="structure bugtask/assignee/fmt:link" />&nbsp;
          </td>
          <td>
            <span class="sortkey" tal:content="bugtask/status/sortkey" />
            <span
                tal:content="bugtask/status/title"
                tal:attributes="
                class string:status${bugtask/status/name}">High</span>
          </td>
        </tr>
      </tbody>
    </table>
  </tal:has_bugtasks>

  <tal:neither_bugs_nor_specs condition="not: view/has_bugs_or_specs">
    <p>
      There are no feature specifications or bug tasks targeted to this
      milestone. The project's maintainer, driver, or bug supervisor
      can target specifications and bug tasks to this milestone to track
      the things that are expected to be completed for the release.
    </p>
  </tal:neither_bugs_nor_specs>

  <div style="margin-top: .4em;">
    <a tal:replace="structure milestone_menu/subscribe/fmt:link-icon">Subcribe</a>
  </div>


  <h2 style="margin-top: 2em;">Related milestones and releases</h2>

  <ul>
    <li>
      <a tal:attributes="
        href view/milestone/target/fmt:url/+milestones">All milestones for the
        <tal:project replace="view/milestone/target/displayname" /> project</a>
    </li>
    <li tal:condition="view/milestone/series_target">
      <a tal:attributes="
        href view/milestone/series_target/fmt:url">All releases for the
        <tal:project replace="view/milestone/target/displayname" />
        <tal:project replace="view/milestone/series_target/displayname" /> series</a>
    </li>
  </ul>

  <tal:has_release condition="view/release">
    <p style="clear: both"
      tal:define="link release_menu/download"
      tal:condition="link/enabled">
      <a tal:replace="structure link/render">Download RDF metadata</a>
    </p>
  </tal:has_release>
</div>
</body>
</html>
