<tal:root
   xmlns:tal="http://xml.zope.org/namespaces/tal"
   xmlns:metal="http://xml.zope.org/namespaces/metal"
   omit-tag="">

  <metal:macro define-macro="comment-display">
    <tal:comment condition="nothing">
      This macro requires the following defined variables:
      comment - the code review comment
      show_expander - show the expand contract link
      show_link - if the expander actually does anything
      display_style - the display style for the primary div
    </tal:comment>

    <div tal:attributes="style display_style; id id;"
         tal:define="expand view/is_long_message|nothing">
      <div class="boardCommentDetails">
        <tal:show-expander condition="show_expander"
                           define="show_link view/is_long_message|nothing">
          <tal:no-link condition="not: show_link">
            <img tal:attributes="src expander_link" />
          </tal:no-link>
          <tal:link condition="show_link">
            <a href="#" tal:attributes="href comment/fmt:url;
                                        onclick string:return switchDisplay('${expanded_id}','${contracted_id}')">
            <img tal:attributes="src expander_link" /></a>
          </tal:link>
        </tal:show-expander>
        <tal:voted tal:condition="comment/vote">
          <strong tal:content="comment/vote/title"
                  tal:condition="comment/vote"
                  /><tal:colon condition="not: comment/vote_tag"
                  >:</tal:colon>
          <tal:has-tag condition="comment/vote_tag">
            &mdash;
            <strong tal:content="comment/vote_tag"
                    tal:condition="comment/vote_tag" />:
          </tal:has-tag>
        </tal:voted>
        <tal:subject replace="comment/message/subject" />
      </div>
      <div class="boardCommentBody">
        <tal:message replace="structure message/fmt:nice_pre" />
        <tal:short-message-view condition="view/message_summary|nothing">
          <tal:long-message condition="view/is_long_message">
            (<a tal:attributes="href comment/fmt:url;
            onclick string:return switchDisplay('${expanded_id}','${contracted_id}')"
            tal:content="expander_text">full message</a>)
          </tal:long-message>
        </tal:short-message-view>
      </div>
    </div>
  </metal:macro>

</tal:root>
