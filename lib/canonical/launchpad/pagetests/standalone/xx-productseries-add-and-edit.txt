Test to add a product series

  >>> browser.addHeader('Authorization', 'Basic test@canonical.com:test')
  >>> browser.open('http://launchpad.dev/products/firefox/+addseries')

  >>> 'Register another product series' in browser.contents
  True

After checking that the page +addseries is there, we try to add a new series.

  >>> browser.getControl('Name').value = 'stable'
  >>> browser.getControl('Summary').value = 'Product series add testing'
  >>> browser.getControl('Branch').value = '~sabdfl/firefox/release-0.9.2'
  >>> browser.getControl('Add Series').click()

Now we are redirected to the Overview page of the product series we just added

  >>> browser.url
  'http://launchpad.dev/products/firefox/stable'

  >>> print browser.contents
  <!DOCTYPE...
  ...
  <h1>Series overview</h1>
  ...
  ...Product series add testing...
  ...
  <a href="http://launchpad.dev/people/sabdfl/+branch/firefox/release-0.9.2">Mozilla Firefox 0.9.2</a>
  ...


Now we test if we can edit the new added release series. First we check if we
can reach the +edit page.

  >>> browser.getLink('Change Series Details').click()
  >>> browser.url
  'http://launchpad.dev/products/firefox/stable/+edit'

Then we edit the information about the release series. First we try to use a
name already in use and a branch for a product other than Firefox:

  >>> browser.getControl('Name').value = '1.0'
  >>> browser.getControl('Summary').value = (
  ...   'Testing the edit of productseries')
  >>> browser.getControl('Branch').value = '~carlos/evolution/2.0'
  >>> browser.getControl('Change').click()

We'll get a nice error message for the two problems:

  >>> print browser.contents
  <!DOCTYPE...
  ...
  ...1.0 is already in use by another series...
  ...
  ...~carlos/evolution/2.0... is not a branch of ...Mozilla Firefox...
  ...


We now change it to a unique name, and pick a branch of firefox:

  >>> browser.getControl('Name').value = 'unstable'
  >>> browser.getControl('Branch').value = '~name12/firefox/main'
  >>> browser.getControl('Change').click()

  >>> browser.url
  'http://launchpad.dev/products/firefox/unstable'

We test if the edited product release is there:

  >>> print browser.contents
  <!DOCTYPE...
  ...
  <h1>Series overview</h1>
  ...
  ...Testing the edit of productseries...
  ...
  <a href="http://launchpad.dev/people/name12/+branch/firefox/main">Mozilla Firefox Mainline</a>
  ...

And if we try to add another series with the same name to same product, we
should get a nice error message.

  >>> browser.open('http://launchpad.dev/products/firefox/+addseries')

  >>> browser.getControl('Name').value = 'unstable'
  >>> browser.getControl('Summary').value = 'Another series with the same name'
  >>> browser.getControl('Add Series').click()

  >>> message = 'unstable is already in use by another series' 
  >>> message in browser.contents
  True


Similarly, if we try to add a series with a branch already set as a
series branch, we get a nice error message:

  >>> browser.getControl('Name').value = 'mainline'
  >>> browser.getControl('Branch').value = '~name12/firefox/main'
  >>> browser.getControl('Add Series').click()
  >>> print browser.contents
  <!DOCTYPE...
  ...
  ...~name12/firefox/main... is already the branch for ...unstable...
  ...
