We will test that we can add a distro release.

  >>> from zope.testbrowser import Browser
  >>> from mechanize import LinkNotFoundError
  >>> browser = Browser()

First, we test that the link to add distro releases is not there
when we are not logged in.

  >>> browser.open("http://localhost:9000/distros/ubuntu")
  >>> try:
  ...     browser.getLink("Add Release")
  ... except LinkNotFoundError:
  ...     print "LinkNotFoundError"
  LinkNotFoundError
  
and that going directly to the page redirects to login

  >>> browser.open("http://localhost:9000/distros/ubuntu/+addrelease")
  >>> browser.url
  'http://localhost:9000/distros/ubuntu/+addrelease/+login'

Now we will try as Mark Shuttleworth on Debian, where he is the owner.
This time we expect to be able to see the link and the page.

  >>> browser = Browser()
  >>> browser.addHeader("Authorization",
  ...                   "Basic mark@hbd.com:test")

  >>> browser.open("http://localhost:9000/distros/debian")
  >>> browser.getLink("Add Release").click()
  >>> browser.url
  'http://localhost:9000/distros/debian/+addrelease'  

OK, let's test as Foo Bar, who is an administrator.

  >>> browser = Browser()
  >>> browser.addHeader("Authorization",
  ...                   "Basic foo.bar@canonical.com:test")

  >>> browser.open("http://localhost:9000/distros/ubuntu")
  >>> browser.getLink("Add Release").click()
  >>> browser.url
  'http://localhost:9000/distros/ubuntu/+addrelease'  

Now, lets fill out this form and add a release.

  >>> browser.getControl(name="field.name").value = 'fidgety'
  >>> browser.getControl("Display name").value = 'Fidgety'
  >>> browser.getControl("Title").value = 'Fidgety Fairy'
  >>> browser.getControl("Summary").value = 'The Fidgety Fairy release'
  >>> browser.getControl("Description").value = 'Fidgety Fairy description'
  >>> browser.getControl("Version").value = '5.12'
  >>> browser.getControl("Parent Release").value = ['ubuntu/hoary']
  >>> browser.getControl("Add").click()
  >>> browser.url
  'http://localhost:9000/distros/ubuntu/fidgety'

