<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_side"
  i18n:domain="launchpad"
>

<metal:block fill-slot="head_epilogue">
  <style type="text/css">
    .binary-build .indent {
      padding-left: 2em;
    }
  </style>
  <script type="text/javascript"
          tal:content="string:
    LPS.use('lp.app.picker', function(Y) {
        Y.log('using stuff');
        Y.on('load', function(e) {

           Y.log('loading stuff');

           var config = {
              header: 'Change owner',
              step_title: 'Search',
           };

           config.save = function(result) {
               Y.log(result);
           };
           Y.log('create the picker');

           Y.lp.app.picker.addPickerPatcher(
               'UserTeamsParticipationPlusSelf',
               LP.client.cache['context']['self_link'],
               'owner_link',
               'recipe-owner',
               false,
               false,
               config);
           //var picker = Y.lp.app.picker.create(
           //    'UserTeamsParticipationPlusSelfVocabulary', config);
           Y.log('created the picker');

            var logged_in = LP.client.links['me'] !== undefined;
            if (logged_in) {
            }
        }, window);
    });
  "/>
</metal:block>

<body>

<tal:registering metal:fill-slot="registering">
  Created by
    <tal:registrant replace="structure context/registrant/fmt:link" />
  on
    <tal:created-on replace="structure context/date_created/fmt:date" />
  and last modified on
    <tal:last-modified replace="structure context/date_last_modified/fmt:date" />
</tal:registering>


<metal:side fill-slot="side">
  <div tal:replace="structure context/@@+global-actions" />
</metal:side>

<div metal:fill-slot="main">
  <div class="yui-g first">
    <div class="yui-u first">
      <div class="portlet">
        <h2>Description</h2>
        <tal:description replace="context/description" />
      </div>
    </div>
    <div class="yui-u">
      <div class="portlet">
        <h2>Recipe information</h2>
        <div class="two-column-list">
          <dl id="build_daily">
            <dt>Build schedule:</dt>
            <dd tal:condition="context/build_daily">
              Built daily
            </dd>
            <dd tal:condition="not:context/build_daily">
              Built on request
            </dd>
          </dl>

          <dl id="owner">
            <dt>Owner:</dt>
            <dd>
              <span id="recipe-owner">
                <span class="yui3-activator-data-box">
                  <tal:owner replace="structure context/owner/fmt:link" />
                </span>
                <button class="lazr-btn yui3-activator-act yui3-activator-hidden"
                        tal:condition="context/required:launchpad.Edit">
                  Edit
                </button>
                <div class="yui3-activator-message-box yui3-activator-hidden" />
              </span>
          </dl>
          <dl id="base-branch">
            <dt>Base branch:</dt>
            <dd tal:content="structure context/base_branch/fmt:link" />
          </dl>
          <dl id="debian-version">
            <dt>Debian version:</dt>
            <dd tal:content="context/deb_version_template" />
          </dl>
          <dl id="daily_build_archive">
            <dt>Daily build archive:</dt>
            <dd tal:content="structure context/daily_build_archive/fmt:link"
                tal:condition="context/daily_build_archive">
            </dd>
            <dd tal:condition="not: context/daily_build_archive">None</dd>
          </dl>

          <dl id="distros">
            <dt>Distribution series:</dt>
            <dd>
              <ul>
                  <li tal:repeat="curseries context/distroseries"
                      tal:content="structure curseries/fmt:link" />
              </ul>
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>
  <div class="yui-g">
    <div class="portlet">
      <h2>Latest builds</h2>
        <table class="listing" style='margin-bottom: 1em;'>
          <thead>
            <tr>
              <th>Status</th>
              <th>When complete</th>
              <th>Distribution series</th>
              <th>Archive</th>
            </tr>
          </thead>
          <tbody>
            <tal:recipe-builds repeat="build view/builds">
              <tal:build-view define="buildview nocall:build/@@+index">
            <tr>
              <td>
                <span tal:replace="structure build/image:icon" />
                <a tal:content="buildview/status"
                   tal:attributes="href build/fmt:url"></a>
              </td>
              <td>
                <tal:date replace="buildview/date/fmt:displaydate" />
                <tal:estimate condition="buildview/estimate">
                  (estimated)
                </tal:estimate>

                <tal:build-log define="file build/log"
                               tal:condition="file">
                  <a class="sprite download"
                     tal:attributes="href build/log_url">buildlog</a>
                  (<span tal:replace="file/content/filesize/fmt:bytes" />)
                </tal:build-log>
              </td>
              <td>
                <tal:distro
                replace="structure build/distroseries/fmt:link:mainsite" />
              </td>
              <td>
                <tal:archive replace="structure build/archive/fmt:link"/>
              </td>
            </tr>
            <tal:binary-builds repeat="binary buildview/binary_builds">
              <tr tal:define="binaryview nocall:binary/@@+index"
                  class="binary-build">
                <td class="indent">
                  <span tal:replace="structure binary/image:icon"/>
                  <a tal:content="binary/source_package_release/title"
                     tal:attributes="href binary/fmt:url">package - version</a>
                </td>
                <td>
                  <tal:date replace="binaryview/date/fmt:displaydate" />
                  <tal:estimate condition="binaryview/estimate">
                    (estimated)
                  </tal:estimate>

                  <tal:build-log define="file binary/log"
                                 tal:condition="file">
                    <a class="sprite download"
                       tal:attributes="href binary/log_url">buildlog</a>
                    (<span tal:replace="file/content/filesize/fmt:bytes" />)
                  </tal:build-log>
                </td>
                <td class="indent">
                  <a class="sprite distribution"
                     tal:define="archseries binary/distro_arch_series"
                     tal:attributes="href archseries/fmt:url"
                     tal:content="archseries/architecturetag">i386</a>
                </td>
              </tr>
            </tal:binary-builds>
            </tal:build-view>
            </tal:recipe-builds>
          </tbody>
        </table>
        <p tal:condition="not: view/builds">
          This recipe has not been built yet.
        </p>
        <tal:request replace="structure context/menu:context/request_builds/fmt:link" />
      </div>
      <div class='portlet'>
        <h2>Recipe contents</h2>
        <pre tal:content="context/recipe_text" />
      </div>
    </div>
  </div>
</body>
</html>
