<<<<<<< TREE
The configuration defines two domains, one for the main Launchpad site
and one for the Blueprint site.

    >>> from canonical.config import config
    >>> config.launchpad.main_hostname
    'launchpad.dev,localhost'
    >>> config.launchpad.blueprint_hostname
    'blueprint.launchpad.dev'

LaunchpadBrowserFactory chooses the right request and publication to
use by looking at the Host header. If we pass in the main Launchpad
site host name, MainLaunchpadPublication will be chosen.

    >>> from canonical.launchpad.webapp.servers import LaunchpadBrowserFactory
    >>> environment = {'HTTP_HOST': 'launchpad.dev'}
    >>> factory = LaunchpadBrowserFactory()
    >>> factory.canHandle(environment)
    True

    >>> from canonical.publication import MainLaunchpadPublication
    >>> request_factory, publication_factory = factory()
    >>> publication_factory is MainLaunchpadPublication
    True

The Host header can contain a port number as well. At the moment it's
ignored, so we can pass in any port and it will still work.

    >>> environment = {'HTTP_HOST': "launchpad.dev:1234"}
    >>> factory = LaunchpadBrowserFactory()
    >>> factory.canHandle(environment)
    True

    >>> from canonical.publication import MainLaunchpadPublication
    >>> request_factory, publication_factory = factory()
    >>> publication_factory is MainLaunchpadPublication
    True

If we pass in the Blueprint host name, BlueprintPublication will be
chosen.

    >>> environment = {'HTTP_HOST': 'blueprint.launchpad.dev'}
    >>> factory = LaunchpadBrowserFactory()
    >>> factory.canHandle(environment)
    True

    >>> from canonical.publication import BlueprintPublication
    >>> from canonical.launchpad.webapp.servers import (
    ...     BlueprintBrowserRequest, ApplicationServerSettingRequestFactory)
    >>> request_factory, publication_factory = factory()
    >>> type(request_factory) is ApplicationServerSettingRequestFactory
    True
    >>> request_factory.requestfactory is BlueprintBrowserRequest
    True
    >>> publication_factory is BlueprintPublication
    True

If we pass in the XMLRPC host name, the LaunchpadXMLRPCRequest will be
chosen.

    >>> environment = {'HTTP_HOST': config.launchpad.xmlrpc_hostname}
    >>> factory = LaunchpadBrowserFactory()
    >>> factory.canHandle(environment)
    True

    >>> from canonical.launchpad.webapp.servers import LaunchpadXMLRPCRequest
    >>> request_factory, publication_factory = factory()
    >>> publication_factory is MainLaunchpadPublication
    True
    >>> request_factory.requestfactory is LaunchpadXMLRPCRequest
    True

If the given host name isn't one of the configured host names,
canHandle returns False.

    >>> environment = {'HTTP_HOST': 'not-configured'}
    >>> factory = LaunchpadBrowserFactory()
    >>> factory.canHandle(environment)
    False

If there is no Host header, the default publication factory will be
returned.

    >>> environment = {}
    >>> factory = LaunchpadBrowserFactory()
    >>> factory.canHandle(environment)
    True

    >>> from canonical.publication import LaunchpadBrowserPublication
    >>> request_factory, publication_factory = factory()
    >>> publication_factory is LaunchpadBrowserPublication
    True
