= Karam for branch related activity =

We want people to register their branches on Launchpad, and also to
link their branches to bugs and specs, so we give them some karma for
it.

    >>> from canonical.launchpad.database.karma import KarmaCategory
    >>> code_category = KarmaCategory.byName('code')
    >>> code_karma_actions = code_category.karmaactions
    >>> sorted([action.title for action in code_karma_actions])
    [u'Branch linked to a blueprint',
     u'Branch linked to a bug',
     u'New branch registered',
     u'Revision added']

    >>> from canonical.launchpad.ftests.karma import KarmaAssignedEventListener
    >>> karma_helper = KarmaAssignedEventListener(show_person=True)
    >>> karma_helper.register_listener()

== Registering branches ==

Karma is added for registering a branch.

    >>> login('test@canonical.com')
    >>> from canonical.launchpad.testing import LaunchpadObjectFactory
    >>> factory = LaunchpadObjectFactory()
    >>> fooix = factory.makeProduct(name='fooix')
    >>> eric = factory.makePerson(name='eric')
    >>> branch = factory.makeBranch(owner=eric, product=fooix)
    Karma added: action=branchcreated, product=fooix, person=eric

However, no karam is added for junk branches.

    >>> junk_branch = factory.makeBranch(
    ...     owner=eric, product=None, explicit_junk=True)


== Linking bugs and branches ==

The registrant of a bug branch link gets karma for linking them.

    >>> bug = factory.makeBug(product=fooix)
    >>> bug_branch = bug.addBranch(branch, eric)
    Karma added: action=bugbranchcreated, product=fooix, person=eric

As long as it is not a junk branch.

    >>> bug_branch = bug.addBranch(junk_branch, eric)


== Linking blueprints and branches ==

The registrant of a blueprint branch link gets karma for linking them.

    >>> blueprint = factory.makeBlueprint(product=fooix)
    >>> blueprint.linkBranch(branch, eric)

But again, not for junk branches.

    >>> blueprint.linkBranch(junk_branch, eric)
