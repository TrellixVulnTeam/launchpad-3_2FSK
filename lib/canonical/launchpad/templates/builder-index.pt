<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

<metal:block fill-slot="head_epilogue">
    <meta http-equiv="refresh" content="300">
</metal:block>

<metal:leftportlets fill-slot="portlets_one">
    <div tal:replace="structure context/@@+portlet-details" />
</metal:leftportlets>


<div metal:fill-slot="main">

      <div tal:define="job context/currentjob">

      <h2>Current status</h2>

      <table class="listing">
        <tr class="thead">
          <th>Build</th>
          <th>Created</th>
          <th>Started</th>
          <th colspan="2">Duration So Far</th>
        </tr>
        <tr tal:condition="job">
          <td>
            <a tal:attributes="href job/build/fmt:url">
               <img alt="[package]" src="/++resource++package-binary" />
               <span tal:replace="job/build/title">NAME</span>
            </a>
          </td>
          <td tal:content="job/build/datecreated/fmt:datetime">CREATED</td>
          <td tal:content="job/buildstart/fmt:datetime">STARTED</td>
          <td>
            <img alt="[progress]" src="/++resource++progress" />
            <span tal:replace="job/buildduration/fmt:approximateduration" />
          </td>
        </tr>

        <tr tal:condition="not: job">
          <td>&#8212;</td>
          <td>&#8212;</td>
          <td>&#8212;</td>
          <td>&#8212;</td>
          <td>&#8212;</td>
          <td>
            <img alt="[idle]" src="/++resource++idle" />
            <span tal:replace="context/status">STATUS</span>
          </td>
        </tr>

        <tal:block condition="job">
        <tr tal:condition="job/logtail">
          <td tal:content="structure job/logtail/fmt:nice_pre" colspan="5">
              Things are crashing and burning all over the place.</td>
        </tr>
        </tal:block>

      </table>

      </div>

      <div tal:define="builds view/lastBuilds">

      <h2>Recently completed</h2>

      <tal:navigation
           replace="structure view/batchnav/@@+navigation-links"
           tal:condition="view/batch"/>

      <table class="listing">
        <tr class="thead">
            <th>Build</th>
            <th>Created</th>
            <th>Started</th>
            <th>Result</th>
            <th>Build log</th>
            <th>Duration</th>
        </tr>
        <tr tal:repeat="build builds">
            <td>
              <a tal:attributes="href build/fmt:url">
                 <img alt="[package]" src="/++resource++package-binary" />
                 <span tal:replace="build/title">NAME</span>
              </a>
            </td>
            <td tal:content="build/datecreated/fmt:datetime">CREATED</td>
            <td tal:content="build/datebuilt/fmt:datetime">BUILT</td>
            <td>
              <img tal:attributes="alt build/buildstate/name; 
                                   src build/build_icon" />
            </td>
            <td>
              <a tal:attributes="href build/buildlog/url">
                 <img alt="[BuildLog]" src="/++resource++info" />
              </a>
            </td>
            <td>
               <span tal:replace="build/buildduration/fmt:approximateduration"
               >4 minutes</span>     
            </td>
        </tr>
      </table>

      <tal:navigation
           replace="structure view/batchnav/@@+navigation-links"
           tal:condition="view/batch"/>

      </div>

      <p class="discreet">Last updated <span tal:replace="view/now"/></p>

    </div>
  </body>
</html>
