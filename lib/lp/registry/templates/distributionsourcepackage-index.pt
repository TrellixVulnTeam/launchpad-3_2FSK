<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="context/@@main_template/master"
  i18n:domain="launchpad"
>

<body>

  <metal:portlets fill-slot="portlets">
    <div tal:replace="structure context/@@+portlet-structural-subscribers" />
    <div tal:replace="structure context/@@+portlet-latestbugs" />
    <div tal:replace="structure context/@@+portlet-latestquestions" />
  </metal:portlets>

<div metal:fill-slot="main">

  <h1>
    &ldquo;<span tal:replace="context/name" />&rdquo; source package in
    <span tal:replace="context/distribution/displayname" />
  </h1>

  <p class="error message"
     tal:condition="view/errors"
     tal:content="view/error_count" />
  <p class="error message"
     tal:repeat="form_wide_error view/form_wide_errors"
     tal:content="structure form_wide_error">
     Schema validation errors.
  </p>
  <p class="error message"
     tal:define="error python:view.getFieldError('packaging')"
     tal:condition="error"
     tal:content="structure error">
     Field specific error for the hidden packaging field.
  </p>

  <h2>Published versions and upstream associations</h2>

  <table id="packaging" class="listing">
    <thead>
      <tr>
        <th colspan="5">
          <span tal:replace="context/distribution/displayname" /> version
        </th>
        <th>Upstream version</th>
      </tr>
    </thead>
    <tbody>
      <tr tal:repeat="row view/version_listing">
        <td><span tal:condition="row/series"
                  tal:content="row/series/name">hoary</span></td>
        <td><span tal:condition="row/series"
                  tal:content="row/series/status/name/fmt:lower" /></td>
        <td><span tal:condition="row/package"
                  tal:content="row/package/component/name/fmt:lower" /></td>
        <td tal:content="row/pocket">release</td>
        <td><a tal:content="row/package/version"
               tal:attributes="href row/package/fmt:url">2.2.1-1</a>
        </td>
        <td>
          <tal:distroseries_row condition="row/series">
            <span tal:condition="row/packaging"
                  tal:replace="row/packaging/productseries/title" />
            <tal:no_direct condition="not: row/packaging">
              None defined
            </tal:no_direct>
            <a tal:attributes="
               href string:${row/sourcepackage/fmt:url}/+edit-packaging"
               title="Edit upstream association">
              <img src="/@@/edit" />
            </a>
            <form tal:condition="row/packaging_field"
                  style="display: inline"
                  action=""
                  method="POST"
                  tal:attributes="action request/URL;
                                  id row/delete_packaging_form_id">
              <tal:hidden replace="structure row/packaging_field" />
              <tal:action
                  replace="structure view/renderDeletePackagingAction" />
            </form>
          </tal:distroseries_row>
        </td>
      </tr>
    </tbody>
  </table>
  <p style="text-align: right">
    <a href="+publishinghistory">See full publishing history...</a>
  </p>

  <div tal:define="ppa_versions view/latest_published_ppa_versions"
       tal:condition="ppa_versions" id="related-ppa-versions">
    <div class="widget-hd" id="slide-trigger">
      Other versions of '<span tal:replace="context/name" />' in untrusted
      archives.
    </div>
    <div class="widget-bd">
      <p>The following <strong>unsupported</strong> and 
         <strong>untrusted</strong> Personal Archives (PPAs) provide
         the most recently uploaded packages of
         '<span tal:replace="context/name" />':</p>
      <dl id="ppa_packaging">
        <tal:definition tal:repeat="ppa_version ppa_versions">
          <dt>
            <a tal:attributes="href ppa_version/archive/fmt:url">
              <img tal:replace="structure ppa_version/archive/image:icon" />
              <span tal:replace="ppa_version/archive/displayname">
                Super trusted PPA
              </span>
            </a> owned by
            <a tal:replace="structure ppa_version/archive/owner/fmt:link">
              Joe Dodgy
            </a>
          </dt>
          <dd>
            Versions:
            <span tal:replace="ppa_version/versions">
              Hoary (1.0.1), Feisty (2.0.1)
            </span>
          </dd>
        </tal:definition>
      </dl>

      <p>You can also search for
         <a tal:attributes="href view/further_ppa_versions_url">
           more untrusted versions of
           '<span tal:replace="context/name" />'</a>.
      </p>
    </div>
<script type="text/javascript">
YUI({
        base: '../../lib/yui/current/build/',
        filter: 'raw'
    }).use('node', 'event', 'lazr.effects', function(Y) {

    // Collapse the body of the slider widget initially.
    Y.get('#related-ppa-versions .widget-bd').addClass('lazr-closed');

    // Ensure that the widget header uses the correct sprite icon
    // and gets the styling for javascript actions applied.
    var widget_header = Y.get('#related-ppa-versions .widget-hd');
    widget_header.addClass('sprite');
    widget_header.addClass('treeCollapsed');
    widget_header.addClass('js-action');

    var slide;
    Y.on('click', function(e) {
        if (!slide) {
            slide = Y.lazr.effects.slide_out('#related-ppa-versions .widget-bd');
            widget_header.replaceClass('treeCollapsed', 'treeExpanded');
        } else {
            slide.set('reverse', !slide.get('reverse'));
            widget_header.toggleClass('treeExpanded');
            widget_header.toggleClass('treeCollapsed');
        }
        slide.stop();
        slide.run();

    }, '#slide-trigger');
});
</script>

  </div>

  <h2>Version history</h2>

  <tal:block
    repeat="dspr view/releases"
    replace="structure dspr/@@+changes">
  </tal:block>

</div>
</body>
</html>
