<metal:page define-macro="buglisting">
  <tal:tag condition="view/assign_to_milestones|nothing"/>
  <form name="bugtask_search" action="" method="GET"
     tal:define="listing_columns view/task_columns;
                 task_batch_navigator view/search;
                 mass_edit_allowed python: 'select' in listing_columns and 
                                           view.is_maintainer">

    <p>
      <label tal:content="view/searchtext_widget/label">
        Bug id or text:
      </label>
      <tal:searchtext content="structure view/searchtext_widget" />
      <input type="submit" name="search" value="Search" />
      <input
          tal:condition="not:view/advanced"
          type="submit" name="advanced" value="Advanced" />
      <input
          tal:condition="view/advanced"
          type="submit" name="simple_submit" value="Simple" />
      <input type="hidden"
          name="advanced" tal:attributes="value request/advanced|nothing" />
    </p>

    <table metal:use-macro="context/@@+bugtask-macros-tableview/batched-table" />

    <div tal:condition="mass_edit_allowed">
      <tal:milestone condition="context/context/milestones|nothing">
        <tal:block content="structure view/milestone_assignment_widget" />
        <input type="submit" name="assign_to_milestone" 
               value="Assign to Milestone" />
      </tal:milestone>
    </div>

    <tal:search-defaults condition="not:view/advanced">
        <input type="hidden" name="status" value="10" />
        <input type="hidden" name="status" value="20" />
        <input type="hidden" name="assignee" value="all" />
    </tal:search-defaults>

    <tal:block condition="view/advanced">
      <h2>Advanced Search Criteria</h2>
      <div class="row">
        <div class="field">
          <table width="67%">

            <tr>
              <td tal:condition="view/status_widget|nothing">
                <label tal:attributes="for view/status_widget/name"
                       tal:content="view/status_widget/label">
                  Status:
                </label>
              </td>
              <td tal:condition="view/severity_widget|nothing">
                <label tal:attributes="for view/severity_widget/name"
                       tal:content="view/severity_widget/label">
                  Severity:
                </label>
              </td>
              <td tal:condition="view/attachmenttype_widget|nothing">
                <label tal:attributes="for view/attachmenttype_widget/name"
                       tal:content="view/attachmenttype_widget/label">
                  Attachment:
                </label>
              </td>
              <td tal:condition="python: view.assignee_widget or
                                         view.statusexplanation_widget">
                <label tal:attributes="for view/assignee_widget/name"
                       tal:condition="view/assignee_widget|nothing"
                       tal:content="view/assignee_widget/label">
                  Assignee:
                </label>
              </td>
            </tr>

            <tr>
              <td tal:condition="view/status_widget"
                  tal:content="structure view/status_widget" />
              <td tal:condition="view/severity_widget"
                  tal:content="structure view/severity_widget" />
              <td tal:condition="view/attachmenttype_widget"
                  tal:content="structure view/attachmenttype_widget" />
              <td tal:condition="python: view.assignee_widget or
                                         view.statusexplanation_widget">

                <tal:block condition="view/assignee_widget">
                  <tal:block content="structure view/assignee_widget" /><br />
                  <tal:block content="structure view/unassigned_widget" />
                  <label style="font-weight: normal;"
                      tal:attributes="for view/unassigned_widget/name"
                      tal:content="structure view/unassigned_widget/label">
                    show only unassigned bugs
                  </label>
                  <br />
                  <tal:block content="structure view/include_dupes_widget" />
                  <label style="font-weight: normal;"
                      tal:attributes="for view/include_dupes_widget/name"
                      tal:content="structure view/include_dupes_widget/label">
                    include duplicate bugs
                  </label>
                  <br /><br />
                </tal:block>

                <tal:block condition="view/statusexplanation_widget">
                  <label
                      tal:attributes="for view/statusexplanation_widget/name"
                      tal:content="view/statusexplanation_widget/label">
                    Status notes:
                  </label>
                  <br />
                  <tal:block content="structure view/statusexplanation_widget" />
                </tal:block>

              </td>
              <td tal:condition="view/milestone_widget|nothing"
                  tal:content="structure view/milestone_widget" />
            </tr>

            <tr>
              <td>
              <input type="submit" name="search" value="Search" />
              </td>
            </tr>

          </table>
        </div>
      </div>
    </tal:block>

  </form>
</metal:page>
