The current database  policy determines what Stores are retrieved by default

    >>> from canonical.launchpad.webapp.adapter import (
    ...     get_store_name, StoreSelector)
    >>> from canonical.launchpad.webapp.interfaces import (
    ...     ALL_STORES, AUTH_STORE, DEFAULT_FLAVOR, MAIN_STORE,
    ...     MASTER_FLAVOR, SLAVE_FLAVOR)
    >>> def show_defaults(policy):
    ...     policy.beforeTraversal()
    ...     for store_name in ALL_STORES:
    ...         default_store = StoreSelector.get(store_name, DEFAULT_FLAVOR)
    ...         print '%s defaults to %s' % (
    ...             store_name, get_store_name(default_store))
    ...     policy.afterCall()

    >>> from canonical.launchpad.webapp.dbpolicy import (
    ...     MasterDatabasePolicy, SlaveDatabasePolicy,
    ...     LaunchpadDatabasePolicy, SSODatabasePolicy)
    >>> from canonical.launchpad.webapp.servers import LaunchpadTestRequest
    >>> request = LaunchpadTestRequest(SERVER_URL='http://localhost')

    >>> show_defaults(MasterDatabasePolicy(request))
    main defaults to launchpad-main-master
    auth defaults to launchpad-auth-master

    >>> show_defaults(SlaveDatabasePolicy(request))
    main defaults to launchpad-main-slave
    auth defaults to launchpad-auth-slave

    >>> show_defaults(LaunchpadDatabasePolicy(request))
    main defaults to launchpad-main-slave
    auth defaults to launchpad-auth-slave

    >>> show_defaults(SSODatabasePolicy(request))
    main defaults to sso-main-slave
    auth defaults to sso-auth-master

It is possible for policies to whitelist allowed Stores, disallowing
access to some Stores entirely:

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.webapp.interfaces import IStoreSelector
    >>> policy = SSODatabasePolicy(request)
    >>> policy.beforeTraversal()
    >>> selector = getUtility(IStoreSelector)
    >>> store = selector.get(AUTH_STORE, MASTER_FLAVOR)
    >>> store = selector.get(MAIN_STORE, SLAVE_FLAVOR)
    >>> store = selector.get(AUTH_STORE, SLAVE_FLAVOR)
    Traceback (most recent call last):
    ...
    DisallowedStoreError: ('auth', 'slave')
    >>> store = selector.get(MAIN_STORE, MASTER_FLAVOR)
    Traceback (most recent call last):
    ...
    DisallowedStoreError: ('main', 'master')
    >>> policy.afterCall()
