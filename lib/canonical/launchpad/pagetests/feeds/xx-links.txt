= Link Tags for Atom Feeds =

The little orange icon that appears in browsers to indicate the presence
of an RSS or Atom feed is controlled by adding a <link> tag to the <head>
of the document. We want appropriate pages in launchpad.net to provide
links to corresponding Atom feeds.


== All Announcements on Launchpad ==

The root launchpad.net url will have a link to the Atom feed which
displays the most recent announcements for all the projects.

    >>> from BeautifulSoup import BeautifulSoup
    >>> browser.open('http://launchpad.dev/')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/announcements.atom"
        title="All Announcements" />]

The http://launchpad.dev/+announcements page also displays recent
announcements for all the projects so it should have a link to the same
feed.

    >>> browser.open('http://launchpad.dev/+announcements')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/announcements.atom"
        title="All Announcements" />]

== Single Bug Feed ==

On the page which displays a single bug, there should be a link to the
atom feed for that one bug.

    >>> browser.open('http://bugs.launchpad.dev/firefox/+bug/1')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/bugs/1/bug.atom"
        title="Bug 1 Feed" />]


== Latest Bugs for a Person ==

On the person page on launchpad.net and bugs.launchpad.net, we should
show a link to the atom feed for that person's latest bugs.

    >>> browser.open('http://launchpad.dev/~stevea')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/~stevea/latest-bugs.atom"
        title="Latest Bugs for Steve Alexander" />]
    >>> browser.open('http://bugs.launchpad.dev/~stevea')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/~stevea/latest-bugs.atom"
        title="Latest Bugs for Steve Alexander" />]


== Latest Bugs & Announcements for a Product ==

On the product page on launchpad.net and bugs.launchpad.net, we should
show a link to the atom feed for that product's latest bugs.

An announcements feed link should also be shown on the main product page.

    >>> browser.open('http://launchpad.dev/jokosher')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/jokosher/announcements.atom"
        title="Announcements for Jokosher" />,
     <link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/jokosher/latest-bugs.atom"
        title="Latest Bugs for Jokosher" />]

Only bug feeds should be linked to on bugs.launchpad.net.

    >>> browser.open('http://bugs.launchpad.dev/jokosher')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/jokosher/latest-bugs.atom"
        title="Latest Bugs for Jokosher" />]


== Escaping the title ==

Since the link title attribute contains the displayname of the project,
it must have quotes and html escaped.

    >>> browser.open('http://launchpad.dev/bad-displayname')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/bad-displayname/announcements.atom"
        title="Announcements for Bad displayname&quot;&gt;&lt;script&gt;alert(&quot;h4x0r&quot;)&lt;/script&gt;" />,
     <link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/bad-displayname/latest-bugs.atom"
        title="Latest Bugs for Bad displayname&quot;&gt;&lt;script&gt;alert(&quot;h4x0r&quot;)&lt;/script&gt;" />]

== Latest Bugs for a Project ==

On the project page on launchpad.net and bugs.launchpad.net, we should
show a link to the atom feed for that project's latest bugs.

An announcements feed link should also be shown on the main project page.

    >>> browser.open('http://launchpad.dev/gnome')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/gnome/announcements.atom"
        title="Announcements for GNOME" />,
     <link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/gnome/latest-bugs.atom"
        title="Latest Bugs for GNOME" />]

Only bug feeds should be linked to on bugs.launchpad.net.

    >>> browser.open('http://bugs.launchpad.dev/gnome')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/gnome/latest-bugs.atom"
        title="Latest Bugs for GNOME" />]

The default view for a project on bugs.launchpad.dev is +bugs. The
default bug listing matches the latest-bugs atom feed, but any search
parameters to this view class may cause them to differ. Since the
project uses the same view class for both tasks, we should check
that the code does not display the atom feed link here inappropriately.

    >>> browser.open('http://bugs.launchpad.dev/gnome/+bugs?'
    ...     'search=Search&field.status=New&field.status=Incomplete'
    ...     '&field.status=Confirmed&field.status=Triaged'
    ...     '&field.status=In+Progress&field.status=Fix+Committed')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    []


== Latest Bugs for a Distro ==

On the distro page on launchpad.net and bugs.launchpad.net, we should
show a link to the atom feed for that distro's latest bugs.

An announcements feed link should also be shown on the main distro page.

    >>> browser.open('http://launchpad.dev/ubuntu')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/ubuntu/announcements.atom"
        title="Announcements for Ubuntu" />,
     <link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/ubuntu/latest-bugs.atom"
        title="Latest Bugs for Ubuntu" />]

Only bug feeds should be linked to on bugs.launchpad.net.

    >>> browser.open('http://bugs.launchpad.dev/ubuntu')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/ubuntu/latest-bugs.atom"
        title="Latest Bugs for Ubuntu" />]


== Latest Bugs for a Distroseries ==

On the distroseries page on bugs.launchpad.net, we should
show a link to the atom feed for that distroseries' latest bugs.

    >>> browser.open('http://bugs.launchpad.dev/ubuntu/hoary')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/ubuntu/hoary/latest-bugs.atom"
        title="Latest Bugs for Hoary" />]


== Latest Bugs for a Product Series ==

On the product series page on bugs.launchpad.net, we should
show a link to the atom feed for that product series' latest bugs.

    >>> browser.open('http://bugs.launchpad.dev/firefox/1.0')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/firefox/1.0/latest-bugs.atom"
        title="Latest Bugs for 1.0" />]


== Latest Bugs for a Source Package ==

On the source package page on bugs.launchpad.net, we should
show a link to the atom feed for that source package's latest bugs.

    >>> browser.open('http://bugs.launchpad.dev/ubuntu/+source/cnews')
    >>> soup = BeautifulSoup(browser.contents)
    >>> soup.head.findAll('link', type='application/atom+xml')
    [<link rel="alternate" type="application/atom+xml"
        href="http://feeds.launchpad.dev/ubuntu/+source/cnews/latest-bugs.atom"
        title="Latest Bugs for cnews in ubuntu" />]
