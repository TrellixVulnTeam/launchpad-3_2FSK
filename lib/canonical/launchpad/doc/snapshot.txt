Snapshots of results set
------------------------

Launchpad adds special Snapshot support for attributes that are result
set. Since for comparison purpose we are actually interested in the actual
result set before the modifciation, we snapshot these as a shortlist.

    >>> from lazr.lifecycle.snapshot import Snapshot

    >>> from canonical.launchpad.database.product import Product
    >>> class SQLFoo:
    ...     active_products= True
    ...
    ...     @property
    ...     def products(self):
    ...         if self.active_products:
    ...             return Product.selectBy(active=True, orderBy='id')
    ...         else:
    ...             return Product.select(orderBy='id')

    >>> sqlfoo = SQLFoo()
    >>> snapshot = Snapshot(sqlfoo, names=['products'])
    >>> products = sqlfoo.products
    >>> snapshot.products == list(products)
    True

You can still effectively compare snapshot and real object. We use the
active_products gimmick here to change the results dynamically, and then
check to see that the diff we get is actually sane:

    >>> sqlfoo.active_products = False
    >>> products = sqlfoo.products
    >>> snapshot.products == list(products)
    False
    >>> diff = set(products) - set(snapshot.products)
    >>> diff == set(Product.selectBy(active=False, orderBy='id'))
    True


