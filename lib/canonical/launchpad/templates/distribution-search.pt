<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

<metal:leftportlets fill-slot="portlets_one">
  <div tal:replace="structure context/@@+portlet-details" />
</metal:leftportlets>

<div metal:fill-slot="main">

  <h1>Source Packages in <span tal:replace="context/title" /></h1>

  <form name="search" method="GET">
    <div>
      <label for="text">
        Show <span tal:replace="context/title" /> packages containing:
      </label>
    </div>
    <input type="text"
      name="text"
      size="35"
      tal:attributes="value request/text|nothing" />

    <input type="submit" value="Search"
        tal:condition="not: view/searchrequested" />
    <input type="submit" value="Search Again"
        tal:condition="view/searchrequested" />
  </form>

  <div tal:condition="view/searchrequested">

    <ul class="sources" tal:condition="view/searchresults">
      <li tal:repeat="dsp view/searchresults">
        <a tal:attributes="href dsp/fmt:url; 
                           title dsp/title"
           tal:content="dsp/title"/>
        <ul>
        <li tal:repeat="pubrec dsp/publishing_history">  
	  <a tal:content="pubrec/distrorelease/name" 
             tal:attributes="href pubrec/meta_sourcepackage/fmt:url;
                             title pubrec/meta_sourcepackage/title"/>
          (<span tal:replace="pubrec/section/name"/>):
	  <a tal:content="pubrec/meta_sourcepackagerelease/version" 
             tal:attributes="href pubrec/meta_sourcepackagerelease/fmt:url;
                             title pubrec/meta_sourcepackagerelease/title"/>

          <div style="font-size: 80%;"
               tal:define="meta_binaries 
                           pubrec/sourcepackagerelease/meta_binaries">

            <tal:has_bin condition="meta_binaries">
               Binary Packages:
               <tal:binaries repeat="bin meta_binaries">
                <a tal:content="string: ${bin/name}"
                   tal:attributes="href bin/fmt:url; title bin/title"/>
              </tal:binaries>
            </tal:has_bin>

            <tal:has_no_bin condition="not:meta_binaries">
              <i>This package has no binaries</i>
            </tal:has_no_bin>

          </div> 
        </li>
        </ul>
      </li>
    </ul>

    <tal:no_matches condition="not: view/searchresults">

      <img src="/++resource++alert" />
      <i>No packages matching '<span tal:replace="view/text">amarok</span>'
      are published in
      <span tal:replace="context/displayname">ubuntu</span>.</i>

    </tal:no_matches>

  </div>

</div>

</body>

</html>
