Check the behaviour of the initialise_from_parent script. It basically
calls IDistroRelease.initialiseFromParent method with experimental extra
checks and tasks.

We need to create an initialisable DistroRelease as a child of Ubuntu
Hoary (we do it inside the ubuntutest distribution to avoid conflicts
with other tests)

  >>> from canonical.launchpad.interfaces import IDistributionSet
  >>> from canonical.launchpad.ftests import login

  >>> login("foo.bar@canonical.com")
  >>> distribution_set = getUtility(IDistributionSet)
  >>> ubuntutest = distribution_set['ubuntutest']
  >>> ubuntu = distribution_set['ubuntu']
  >>> hoary = ubuntu['hoary']

  XXX cprov 20060529: new distrorelease should be provided by IDistribution
  This maybe affected by derivation design and is documented in bug
  #49133

  >>> from canonical.launchpad.interfaces import IDistroReleaseSet
  >>> distrorelease_set = getUtility(IDistroReleaseSet)
  >>> foobuntu = distrorelease_set.new(ubuntutest, 'foobuntu', 'FooBuntu',
  ...                                  'The Foobuntu', 'yeck', 'doom',
  ...                                  '888', hoary, hoary.owner)

  >>> import transaction
  >>> transaction.commit()


  >>> import subprocess
  >>> import os
  >>> import sys
  >>> from canonical.config import config

  >>> script = os.path.join(config.root, "scripts", "ftpmaster-tools",
  ...                       "initialise-from-parent.py")
  >>> process = subprocess.Popen([sys.executable, script, "-vv",
  ...                             "-d", "ubuntutest", "foobuntu"],
  ...                            stdout=subprocess.PIPE,
  ...                            stderr=subprocess.PIPE,)
  >>> stdout, stderr = process.communicate()
  >>> process.returncode
  0
  >>> print stderr
  DEBUG   Acquiring lock
  DEBUG   Initialising connection.
  DEBUG   Check empty mutable queues in parentrelease
  DEBUG   Check for no pending builds in parentrelease
  DEBUG   Copying distroarchreleases from parent and setting nominatedarchindep.
  DEBUG   initialising from parent, copying publishing records.
  DEBUG   Committing transaction.
  DEBUG   Releasing lock
  <BLANKLINE>


  >>> hoary_pmount = len(hoary.getPublishedReleases('pmount'))
  >>> foobuntu_pmount = len(foobuntu.getPublishedReleases('pmount'))
  >>> foobuntu_pmount == hoary_pmount
  True

  >>> hoary_i386_pmount = len(hoary['i386'].getReleasedPackages('pmount'))
  >>> foobuntu_i386_pmount = len(foobuntu['i386'].getReleasedPackages('pmount'))
  >>> foobuntu_i386_pmount == hoary_i386_pmount
  True


Check if it fails for an already released distrorelease:

  >>> process = subprocess.Popen([sys.executable, script, "-vv",
  ...                             "breezy-autotest"],
  ...                            stdout=subprocess.PIPE,
  ...                            stderr=subprocess.PIPE,)
  >>> stdout, stderr = process.communicate()
  >>> process.returncode
  1
  >>> print stderr
  DEBUG   Acquiring lock
  DEBUG   Initialising connection.
  DEBUG   Check empty mutable queues in parentrelease
  DEBUG   Check for no pending builds in parentrelease
  DEBUG   Copying distroarchreleases from parent and setting nominatedarchindep.
  Traceback (most recent call last):
  ...
  AssertionError: Can not copy distroarchreleases from parent, there are already distroarchrelease(s) initialised for this release.
  <BLANKLINE>
