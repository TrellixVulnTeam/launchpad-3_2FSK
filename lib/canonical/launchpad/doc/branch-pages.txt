= Branch Pages =

== BranchView ==

BranchView is the general class for displaying Branches.

>>> from zope.component import getView
>>> from zope.publisher.browser import TestRequest
>>> from canonical.launchpad.interfaces import IBranchSet
>>> branchset = getUtility(IBranchSet)
>>> gterm = branchset[15]
>>> pushed = branchset[25]
>>> gterm_view = getView(gterm, '+index', TestRequest())
>>> pushed_view = getView(pushed, '+index', TestRequest())

Each branch is associated to an URL on the Supermirror, that includes the name
of the owner and product of the branch.

>>> gterm_view.supermirror_url()
u'http://bazaar.launchpad.net/~name12/gnome-terminal/main'

The branch view generates an appropriate notice when a branch is missing a
title or summary.

>>> from canonical.launchpad.interfaces import IProductSet
>>> gterm_product = getUtility(IProductSet).getByName('gnome-terminal')
>>> from canonical.launchpad.interfaces import IPersonSet
>>> ddaa = getUtility(IPersonSet).getByName('ddaa')

>>> new = branchset.new('ok', ddaa, gterm_product, None,
...     title='something', summary='something')
>>> view = getView(new, '+index', TestRequest())
>>> view.missing_title_or_summary_text() is None
True

>>> new = branchset.new('no_title', ddaa, gterm_product, None,
...     title=None, summary='something')
>>> view = getView(new, '+index', TestRequest())
>>> view.missing_title_or_summary_text()
'(this branch has no title)'

>>> new = branchset.new('no_title', ddaa, gterm_product, None,
...     title='something', summary=None)
>>> view = getView(new, '+index', TestRequest())
>>> view.missing_title_or_summary_text()
'(this branch has no summary)'

>>> new = branchset.new('no_title_or_summary', ddaa, gterm_product, None,
...     title=None, summary=None)
>>> view = getView(new, '+index', TestRequest())
>>> view.missing_title_or_summary_text()
'(this branch has neither title nor summary)'

== BranchEditView ==

When a branch has a URL, the user is allowed to modify it. Check that the
'url' field is present in the edit form.

>>> gterm.url is not None
True
>>> view = getView(gterm, '+edit', TestRequest())
>>> view.fieldNames
[u'url', u'title', u'summary', u'home_page', u'author', u'whiteboard']

When a branch's URL is null, the user is not allowed to set it.

>>> no_url = branchset.new('no_url', ddaa, gterm_product, None)
>>> no_url.url is None
True
>>> view = getView(no_url, '+edit', TestRequest())
>>> view.fieldNames
[u'title', u'summary', u'home_page', u'author', u'whiteboard']

Thus, a branch cannot change between being a pull branch and a push branch
through the web interface.

