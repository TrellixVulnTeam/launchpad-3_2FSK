<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

<metal:leftportlets fill-slot="portlets_one">
  <div tal:replace="structure context/@@+portlet-details" />
</metal:leftportlets>

<metal:rightportlets fill-slot="portlets_two">
    <div tal:replace="structure context/@@+portlet-calendar" />
</metal:rightportlets>

<div metal:fill-slot="main">

  <h1>Package Maintenance Report</h1>

  <tal:maintained-packages condition="context/maintainedPackages">
    <h2>Maintained packages</h2>

    <ul>
      <li tal:repeat="sourcepackagereleasesbyname view/maintainedPackagesByPackageName">
        <label tal:content="sourcepackagereleasesbyname/name" />

        <tal:block define="
            table_id string:maintained;
            sourcepackagereleases sourcepackagereleasesbyname/releases">
          <div metal:use-macro="template/macros/sourcepackagerelease-table" />
        </tal:block>
      </li>
      <br />
    </ul>
  </tal:maintained-packages>

  <tal:uploaded-packages condition="context/uploadedButNotMaintainedPackages">
    <h2>Uploaded packages</h2>

    <ul>
      <li tal:repeat="sourcepackagereleasesbyname view/uploadedButNotMaintainedPackagesByPackageName">
        <label tal:content="sourcepackagereleasesbyname/name" />

        <tal:block define="
            table_id string:uploaded;
            sourcepackagereleases sourcepackagereleasesbyname/releases">
          <div metal:use-macro="template/macros/sourcepackagerelease-table" />
        </tal:block>
      </li>
      <br />
    </ul>
  </tal:uploaded-packages>

</div>

<metal:macros fill-slot="bogus">
<metal:macro define-macro="sourcepackagerelease-table">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
    :sourcepackagereleases: A list of SourcePackageRelease objects
    :table_id: The value for the id attribute of the table. This is needed to
    allow sorting based on the table columns.
  </tal:comment>

  <table class="listing sortable" tal:attributes="id table_id">
  <thead>
    <tr>
      <th>Distribution Release</th>
      <th>Version</th>
      <th>Bugs</th>
      <th>Tickets</th>
    </tr>
  </thead>
  <tbody>
    <tr tal:repeat="sourcepackagerelease sourcepackagereleases">
    <tal:block define="spr sourcepackagerelease;
                       distrorelease spr/uploaddistrorelease">
      <td>
        <a tal:attributes="href distrorelease/fmt:url"
           tal:content="distrorelease/fullreleasename">
        </a>
      </td>
      <td>
        <a tal:attributes="href string:${distrorelease/fmt:url}/+source/${spr/name}"
           tal:content="spr/version">
        </a>
      </td>
      <td style="text-align: right">
        <a tal:attributes="href string: ${spr/sourcepackage/fmt:url}/+bugs"
           tal:content="python: view.sourcepackagerelease_open_bugs_count(spr)">
        </a>
      </td>
      <td style="text-align: right">
        <a tal:attributes="href string: ${spr/sourcepackage/fmt:url}/+tickets"
           tal:content="spr/open_tickets_count">
        </a>
      </td>
    </tal:block>
    </tr>
  </tbody>
  </table>
</metal:macro>
</metal:macros>

</body>
</html>
