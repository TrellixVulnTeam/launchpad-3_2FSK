<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
>

<body>

<div metal:fill-slot="main">

      <div tal:condition="view/isPrivate" id="privacy" class="aside private"
      >This report will be private, though you can disclose it later.</div>
      <h1>
        <tal:heading condition="not:view/similar_bugs">
          Report a bug
        </tal:heading>
        <tal:heading condition="view/similar_bugs">
          Is the bug you&rsquo;re reporting one of these?
        </tal:heading>
      </h1>

  <metal:not_uses_malone
      use-macro="context/@@+filebug-macros/not_uses_malone" />

  <tal:uses_malone tal:condition="view/contextUsesMalone">

  <div metal:use-macro="context/@@launchpad_form/form">

    <div metal:fill-slot="extra_info">
      <p tal:condition="not: view/similar_bugs">
        No similar bug reports were found.
      </p>
    </div>

    <metal:widgets metal:fill-slot="widgets">

      <div id="bug_reporting_form" tal:condition="not: view/similar_bugs">
        <table class="form">
          <metal:basic_filebug_widgets
              metal:use-macro="context/@@+filebug-macros/basic_filebug_widgets" />
        </table>
        <div class="actions">
          <input tal:replace="structure view/submit_bug_action/render" />
        </div>
      </div>

      <div tal:condition="view/similar_bugs">

        <tal:similar-bugs condition="view/contextUsesMalone">

          <metal:display-similar-bugs
              use-macro="context/@@+filebug-macros/display_similar_bugs" />

        </tal:similar-bugs>

        <tal:submit-new-bug>
          <div id="bug_reporting_form">
            <a name="form-start" />
            <table class="form">
              <metal:basic_filebug_widgets
                  metal:use-macro="context/@@+filebug-macros/basic_filebug_widgets" />
            </table>
            <div class="actions">
              <input tal:replace="structure view/submit_bug_action/render" />
            </div>
          </div>
        </tal:submit-new-bug>
      </div>

      <script type="text/javascript" tal:condition="view/similar_bugs">
        /*
         * Arrange the bug form for either the state where the user is selecting
         * an existing bug report, or for where they're filing a new bug.
         */
        function arrangeBugForm(event) {
          var no_radiobtn = $('bug-not-already-reported');
          var bugtarget_package_btn = $('field.bugtarget.option.package');

          if (no_radiobtn.checked) {
            showElement('bug_reporting_form');
            // Try to get the whole bug form into view.
            $('field.actions.submit_bug').focus();
            window.location.href = '#form-start';

            if (bugtarget_package_btn != null) {
              if (bugtarget_package_btn.checked) {
                $('field.bugtarget.package').focus();
              } else {
                $('field.comment').focus();
              }
            } else {
              var package_name = $('field.packagename')
              if (package_name != null) {
                package_name.focus();
              } else {
                $('field.comment').focus();
              }
            }
          } else {
            hideElement('bug_reporting_form');
          }

          // Disable "Subscribe to This Bug Report" to avoid accidental use.
          $('field.actions.this_is_my_bug').disabled = no_radiobtn.checked;
        }

        /*
         * On-load, make sure that the 'No' stuff is displayed correctly.
         * We must always work from the data in the form, not just from
         * events. Some browsers (e.g. Firefox) refill the form when a page
         * is refreshed and you don't get onchange/onkeypress events.
         */
        connect(window, 'onload', arrangeBugForm);

        /*
         * Arrange the form if any of the radio buttons are clicked.
         */
        forEach(
          getElementsByTagAndClassName('input', null, 'similar-bugs'),
          function(element) {
            connect(element, 'onclick', arrangeBugForm);
          });
        connect('bug-not-already-reported', 'onclick', arrangeBugForm);
      </script>

    </metal:widgets>

    <div class="actions" metal:fill-slot="buttons">
      <tal:comment replace="nothing">
        This suppresses the normal action buttons.
      </tal:comment>
    </div>

  </div>

  </tal:uses_malone>

</div>

</body>
</html>
