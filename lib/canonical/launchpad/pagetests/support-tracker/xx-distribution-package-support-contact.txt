= Support Contacts for Distribution Source Package =

Support on source packages is handled both by the source package support
contacts as well as the distribution support contacts.

    # Register a Sample Person as support contact for the distribution.
    >>> from zope.component import getUtility
    >>> from canonical.launchpad.ftests import login, logout
    >>> from canonical.launchpad.interfaces import (
    ...     IDistributionSet, ILaunchBag)
    >>> from canonical.database.sqlbase import flush_database_updates
    >>> login('test@canonical.com')
    >>> ubuntu = getUtility(IDistributionSet).getByName('ubuntu')
    >>> ubuntu.addSupportContact(getUtility(ILaunchBag).user)
    True
    >>> flush_database_updates()
    >>> logout()

To reflect this, a user visiting a source package support facet will
see both a porlet listing the support contacts for the source package
and another one listing those of the distribution.

    >>> anon_browser.open(
    ...     'http://launchpad.dev/distros/ubuntu/+source/mozilla-firefox')
    >>> anon_browser.getLink('Support').click()
    >>> portlet = find_portlet(
    ...     anon_browser.contents,
    ...     'Support contacts for mozilla-firefox in ubuntu')
    >>> print portlet.first('div').renderContents()
    <p>
      <i>There are no support contacts.</i>
    </p>
    >>> for support_contact in find_portlet(
    ...     anon_browser.contents, 'Support contacts for Ubuntu').fetch('a'):
    ...     print support_contact.renderContents()
    Sample Person

To register himself as support contact, the user clicks on the
'Support Contact' link. He needs to be login to access that function.

    >>> anon_browser.getLink('Support Contact').click()
    Traceback (most recent call last):
      ...
    Unauthorized: ...

    >>> user_browser.open(
    ...     'http://launchpad.dev/distros/ubuntu/+source/mozilla-firefox/+tickets')
    >>> user_browser.getLink('Support').click()
    >>> user_browser.getLink('Support Contact').click()
    >>> print user_browser.title
    Support contact for Source Package "mozilla-firefox" in Ubuntu Linux

On this page, the user can choose to become a support contact by
clicking a checkbox. All the teams, he's a member of are also displayed
and he can register these teams as well.

    >>> user_browser.getControl(
    ...     "I want to be a support contact for mozilla-firefox").selected
    False
    >>> user_browser.getControl(
    ...     "I want to be a support contact for "
    ...     "mozilla-firefox").selected = True
    >>> user_browser.getControl("Landscape Developers").selected
    False
    >>> user_browser.getControl("Landscape Developers").selected = True

To save his choices, the user clicks on the 'Continue' button and
a message is displayed to confirm the changes:

    >>> user_browser.getControl('Continue').click()
    >>> for message in find_tags_by_class(user_browser.contents, 'message'):
    ...     print message.renderContents()
    You have been added as a support contact for mozilla-firefox in ubuntu.
    Landscape Developers has been added as a support contact for
    mozilla-firefox in ubuntu.

The support contacts porlet for the source package was updated:

    >>> for support_contact in find_portlet(
    ...     user_browser.contents,
    ...     'Support contacts for mozilla-firefox in ubuntu').fetch('a'):
    ...     print support_contact.renderContents()
    Landscape Developers
    Sample Person

To unregister as support contact, the same page is used. Instead this
time, we unselect the checkboxes:

    >>> user_browser.getLink('Support Contact').click()
    >>> user_browser.getControl(
    ...     "I want to be a support contact for mozilla-firefox").selected
    True
    >>> user_browser.getControl(
    ...     "I want to be a support contact for "
    ...     "mozilla-firefox").selected = False

Again a confirmation message is displayed and the support contacts
portlet for the source package is updated.

    >>> user_browser.getControl('Continue').click()
    >>> for message in find_tags_by_class(user_browser.contents, 'message'):
    ...     print message.renderContents()
    You have been removed as a support contact for mozilla-firefox in ubuntu.

    >>> for support_contact in find_portlet(
    ...     user_browser.contents,
    ...     'Support contacts for mozilla-firefox in ubuntu').fetch('a'):
    ...     print support_contact.renderContents()
    Landscape Developers
