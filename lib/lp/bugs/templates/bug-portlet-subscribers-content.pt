<div
  tal:omit-tag=""
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  tal:define="
    bug context/bug|context;
    direct_subscriptions view/getSortedDirectSubscriptions;
    from_dupes_subscriptions view/getSortedSubscriptionsFromDuplicates;
    also_notified_subscribers bug/getAlsoNotifiedSubscribers
  ">
  <div class="section" id="subscribers-direct">
    <h2>Subscribers</h2>
      <div id="subscribers-links">
      <div
        tal:condition="direct_subscriptions"
        tal:repeat="subscription direct_subscriptions"
        tal:attributes="class string:subscriber-${subscription/person/name/fmt:css-id}"
      >
        <metal:subscriber  metal:define-macro="subscriber-row">

            <tal:XXX condition="nothing">
              # XXX: deryck 2009-06-17 bug=388394
              # The float here breaks the green flash
              # and really should be removed.
            </tal:XXX>
            <a
               tal:condition="subscription/person/name|nothing"
               tal:attributes="
                 href subscription/person/fmt:url;
                 title subscription/display_subscribed_by;
                 name subscription/person/fmt:displayname
               "
            >
              <tal:block replace="structure subscription/person/fmt:icon" />
              <tal:block replace="subscription/person/fmt:displayname/fmt:shorten/20" />
            </a>
            <tal:XXX condition="nothing">
              # XXX: deryck 2009-06-17 bug=388394
              # The float here breaks the green flash
              # and really should be removed.
            </tal:XXX>
            <a tal:condition="python: subscription.canBeUnsubscribedByUser(view.user)"
               href="+subscribe"
               tal:attributes="
                 title string:Unsubscribe ${subscription/person/fmt:displayname};
                 id string:unsubscribe-${subscription/person/name/fmt:css-id};
                 class python: view.subscription_class(subscription.person)
               "
            >
              <img class="unsub-icon" src="/@@/remove"
                tal:attributes="id string:unsubscribe-icon-${subscription/person/name/fmt:css-id}" />
            </a>

        </metal:subscriber>
      </div>
      </div>
      <div id="none-subscribers"
        tal:condition="not:direct_subscriptions">None</div>
  </div>
  <div
    tal:condition="from_dupes_subscriptions"
    id="subscribers-from-duplicates"
    class="section"
  >
    <h2>From duplicates</h2>
    <div
      tal:repeat="subscription from_dupes_subscriptions"
      tal:attributes="
        class string:subscriber-${subscription/person/name/fmt:css-id};
        id string:dupe-subscriber-${subscription/person/name/fmt:css-id};
      "
    >
      <metal:subscriber metal:use-macro="template/macros/subscriber-row" />
    </div>
  </div>
  <div
    tal:condition="also_notified_subscribers"
    id="subscribers-indirect"
    class="Section"
  >
    <h2>Also notified</h2>
    <div
      tal:repeat="subscriber also_notified_subscribers"
      tal:content="structure subscriber/fmt:link"
    />
  </div>
</div>
