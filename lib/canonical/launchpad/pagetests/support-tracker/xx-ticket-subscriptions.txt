= Ticket Subscriptions =

Users can subscribe to specific tickets. When they are subscribed they
will receive notifications for any changes to the ticket.

== Subscribing ==

To subscribe, users use the 'Subscribe' link and then confirm that
they want to subscribe by clicking on the 'Subscribe' button.

    >>> user_browser.open(
    ...     'http://launchpad.dev/firefox/+ticket/2')
    >>> link = user_browser.getLink('Subscribe')
    >>> link.url
    '.../+ticket/2/+subscribe'
    >>> link.click()
    >>> print user_browser.title
    Subscription to request #2

    >>> from BeautifulSoup import BeautifulSoup
    >>> soup = BeautifulSoup(user_browser.contents)
    >>> soup.first('h1')
    <h1>Subscribe to request</h1>
    >>> user_browser.getControl('Subscribe').click()

A message confirming that he was subscribed is displayed and the user
name appears in the 'Subscribers' portlet:

    >>> soup = BeautifulSoup(user_browser.contents)
    >>> print soup.first('div', 'informational message').renderContents()
    You have subscribed to this request.

    >>> portlet = soup.first('div', id='ticket-subscribers')
    >>> portlet.first('h2')
    <h2>Subscribers to request #2</h2>
    >>> portlet.first('ul')
    <ul class="people">
      <li>
        <a href="http://launchpad.dev/~name12">Sample Person</a>
      </li>
    </ul>

== Unsubscribing ==

When the user is subscribed to the ticket, the 'Subscribe' link becomes
an 'Unsubscribe' link. To unsubscribe, the user follows that link and
then click on the 'Unsubscribe' button.

    >>> link = user_browser.getLink('Unsubscribe')
    >>> link.url
    '.../+ticket/2/+subscribe'
    >>> link.click()

    >>> soup = BeautifulSoup(user_browser.contents)
    >>> soup.first('h1')
    <h1>Unsubscribe from request</h1>
    >>> user_browser.getControl('Unsubscribe').click()

A confirmation is displayed and the user, which was unsubscribed from
the ticket, doesn't appear anymore in the subscribers portlet:

    >>> soup = BeautifulSoup(user_browser.contents)
    >>> print soup.first('div', 'informational message').renderContents()
    You have unsubscribed from this request.

    >>> portlet = soup.first('div', id='ticket-subscribers')
    >>> portlet.first('p')
    <p>
      <i>No subscribers.</i>
    </p>

== Subscribing While Posting A Message ==

It is also possible to subscribe at the same time than posting a message
on an existing ticket. The user can simply check the 'E-mail me future
discussion about this request' checkbox:

    >>> user_browser.open('http://launchpad.dev/products/firefox/+ticket/6')
    >>> user_browser.getControl('Message').value = (
    ...     "I restarted Firefox and the plug-in still doesn't work.")
    >>> user_browser.getControl(
    ...     'E-mail me future discussion about this request').selected = True
    >>> user_browser.getControl("I'm Still Having This Problem").click()

A notification message is displayed notifying of the subscription:

    >>> for message in find_tags_by_class(user_browser.contents, 'message'):
    ...     print message.renderContents()
    Your request was reopened.
    You have subscribed to this request.

    >>> soup = BeautifulSoup(user_browser.contents)
    >>> portlet = soup.first('div', id='ticket-subscribers')
    >>> for subscriber_link in portlet.findAll('a'):
    ...     print subscriber_link.renderContents()
    Sample Person

When the person is already subscribed to the request, the checkbox
doesn't appear on the page:

    >>> user_browser.getControl('E-mail me future')
    Traceback (most recent call last):
      ...
    LookupError: ...
