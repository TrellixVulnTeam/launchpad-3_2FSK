A person's +editlanguages page
------------------------------

Carlos is a translator who translates things into Spanish with Rosetta.
He is on Rosetta About page and wants to change his preferred languages.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://launchpad.dev/rosetta/+about')
  >>> browser.url
  'http://launchpad.dev/rosetta/+about'

So, he looks for the 'Select Languages...' link, and clicks on that which 
should take him to his +editlanguages page.

  >>> browser.getLink('Select Languages...').click()
  >>> browser.url
  'http://launchpad.dev/people/carlos/+editlanguages'

So far, he has Spanish selected as one of his preferred languages, but not 
Welsh. 

  >>> browser.getControl('Spanish').selected
  True
  >>> browser.getControl('Welsh').selected
  False

Now let's suppose that Carlos decides that he doesn't like Spanish after all,
and that Welsh is a much nicer language. When he adjusts his preferences,
Spanish will no longer be selected, and Welsh will.

  >>> browser.getControl('Spanish').selected = False
  >>> browser.getControl('Welsh').selected = True
  >>> browser.getControl('Save').click()

After he submits the form, he should again be redirected back to Rosetta's
About page, and it should contain notices about the changes he made.

  >>> browser.url
  'http://launchpad.dev/rosetta/+about'
  >>> print browser.contents
  <!DOCTYPE...
  ...Added Welsh to your preferred languages...
  ...Removed Spanish from your preferred languages...

And finally, lets revisit the +editlanguages page to check if the languages
have been properly selected.

  >>> browser.open('http://launchpad.dev/people/carlos/+editlanguages')
  >>> browser.url
  'http://launchpad.dev/people/carlos/+editlanguages'
  >>> browser.getControl('Spanish').selected
  False
  >>> browser.getControl('Welsh').selected
  True


When a user doesn't have a preferred language set, we determine it from the
user's browser headers. If his browser send us any non-utf8 encoded string in 
the Accept-Language header, we won't consider that as a valid language code.

  >>> from zope.testbrowser.testing import Browser
  >>> browser = Browser()
  >>> browser.addHeader('Authorization', 'Basic test@canonical.com:test')
  >>> browser.addHeader('Accept-Language', 'pt_br, Espa\xf1ol')
  >>> browser.open('http://launchpad.dev/people/name12/+editlanguages')

  >>> from BeautifulSoup import BeautifulSoup
  >>> def print_languages(rosetta_pref_page, portlet='preferred'):
  ...     """Print languages listed in the preferred or browser
  ...     languages portlet.
  ...
  ...     portlet keyword argument can be 'preferred' or 'browser'
  ...     """
  ...     soup = BeautifulSoup(rosetta_pref_page)
  ...     lang_portlet = soup.fetchText(
  ...         'Your %s languages' % portlet)[0].parent.parent
  ...     for lang in lang_portlet('li', {'class': 'languages'}):
  ...         print lang.string

  >>> print_languages(browser.contents, portlet='browser')
  Portuguese (Brazil)
