= Demonstrate import of Firefox XPI file =

To import translations into Firefox product, we must first import en-US.xpi
file, which is an equivalent of a PO Template.

Lets start with Firefox product inside trunk revision.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://translations.launchpad.dev/firefox/trunk')
  >>> print browser.url
  http://translations.launchpad.dev/firefox/trunk

Since we still don't have any POTemplates assigned, we must use the general
translations upload link.

  >>> browser.getLink('Upload translations').click()
  >>> print browser.url
  http://translations.launchpad.dev/firefox/trunk/+translations-upload

Get the XPI file we are going to upload.

  >>> from canonical.launchpad.components.ftests import test_xpi_import
  >>> xpifile = test_xpi_import.get_en_US_xpi_file_to_import()

Now, lets upload this file.

  >>> browser.getControl('File:').add_file(
  ...     xpifile, 'application/zip', 'en-US.xpi')
  >>> browser.getControl('Request Upload').click()

  >>> print browser.url
  http://translations.launchpad.dev/firefox/trunk/+translations-upload
  >>> for tag in find_tags_by_class(browser.contents, 'message'):
  ...     print tag.renderContents()
  Thank you for your upload. The file content will be reviewed soon by an
  admin and then imported into Launchpad. You can track its status from the
  <a href="http://translations.launchpad.dev/translations/imports">Translation
  Import Queue</a>

Lets check the import queue to edit this entry and set potemplatename.

  >>> browser.getLink('Translation Import Queue').click()
  >>> print browser.url
  http://translations.launchpad.dev/translations/imports
  >>> 'en-US.xpi' in browser.contents
  True
  >>> browser.getLink(url='imports/3').click()
  >>> print browser.url
  http://launchpad.dev/translations/imports/3

Use 'firefox' as the template name.

  >>> browser.getControl('Template Name').value = 'firefox'
  >>> browser.getControl('Attach').click()
  >>> print browser.url
  http://launchpad.dev/translations/imports
  >>> browser.getControl(name='status-3').value == ['APPROVED']
  True
