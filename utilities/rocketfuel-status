#! /bin/bash

# This script checks each of your branches in your Launchpad repo to see which
# ones have revisions that have not yet landed in trunk.

LP_PROJECT_ROOT=${LP_PROJECT_ROOT:=~/canonical}
LP_BRANCHES_DIR=${LP_BRANCHES_DIR:=lp-branches}
LP_PROJECT_PATH=$LP_PROJECT_ROOT/$LP_BRANCHES_DIR
LP_TRUNK_NAME=${LP_TRUNK_NAME:=trunk}
LP_TRUNK_PATH=$LP_PROJECT_PATH/$LP_TRUNK_NAME

cd $LP_PROJECT_PATH
for branch in *; do
  if [ ${branch} != "$LP_TRUNK_NAME" ] && test -d ${branch} ; then
    echo "Examining ${branch}"
    cd ${branch}
    bzr status --short
    cd $LP_TRUNK_PATH
    bzr missing --theirs-only --line ../${branch} | grep -v "^You are missing"
    cd ..
  fi;
done;
