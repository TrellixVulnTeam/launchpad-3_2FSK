<div class="builds_list" tal:condition="not: view/setupBuildList">
  <tal:batch define="batch view/batchnav/currentBatch">

     <table>
       <tr>
         <th><label>Build state:</label></th>
         <td>
          <form name="build_records_state" action="" method="GET">

          <select name="build_state" size="1">

            <option tal:attributes="selected python: view.state == ''"
                    value="">All</option>

            <option tal:condition="view/showBuilderInfo"
                    tal:attributes="selected python: view.state == 'pending'"
                    value="pending">Pending Build</option>

            <option tal:attributes="selected python: view.state == 'built'"
                    value="built">Successfully Built</option>

            <option tal:attributes="selected python: view.state == 'failed'"
                    value="failed">Failed Build</option>

            <option tal:attributes="selected python: view.state == 'depwait'"
                    value="depwait">Waiting Dependency</option>

            <option tal:attributes="selected python: view.state == 'chrootwait'"
                    value="chrootwait">Waiting Chroot</option>

          </select>

          <input type="submit" value="Update" />

          </form>
         </td>
       </tr>
     </table>

     <tal:navigation
          tal:condition="batch"
          replace="structure view/batchnav/@@+navigation-links" />

  <table class="listing" tal:condition="batch">
    <tbody>
      <tal:batch repeat="build batch">
        <tr>
          <td class="left icon">
            <img tal:attributes="
              alt build/buildstate/name;
              src build/build_icon
            " />
          </td>
          <td>
            <a tal:attributes="href build/fmt:url">
              <span tal:replace="build/title">NAME</span>
            </a>
          </td>
        </tr>
        <tr class="secondary">
          <td></td>
          <td>
            Requested
            <tal:requested
              content="build/datecreated/fmt:datetime"
            />
            in pocket <tal:buildpocket
              content="build/pocket/name"
            />
          </td>
        </tr>
        <tr class="secondary" tal:condition="build/dependencies">
          <td></td>
          <td>
	    Missing Dependencies
            <tal:dependencies
              content="build/dependencies"
            />
          </td>
        </tr>
        <tr class="secondary" tal:condition="build/was_built">
          <td></td>
          <td>
            Built
            <tal:built content="build/datebuilt/fmt:datetime" />
            <tal:builder condition="view/showBuilderInfo">
              by
              <a
                tal:condition="build/builder"
                tal:content="build/builder/title"
                tal:attributes="href build/builder/fmt:url"
                title="Information about this build machine"
              />
              <tal:unknownbuilder condition="not: build/builder">
                unknown build machine
              </tal:unknownbuilder>
            </tal:builder>
            in
            <tal:time content="build/buildduration/fmt:approximateduration" />
            <tal:log condition="build/buildlog">
              &mdash;
              <a tal:attributes="href build/buildlog/url">log</a>
            </tal:log>
          </td>
        </tr>
        <tr class="secondary" tal:condition="not: build/was_built">
          <td></td>
          <td>
            Pending
            (<span
              tal:condition="build/buildqueue_record"
              tal:replace="build/buildqueue_record/lastscore"
            />)
          </td>
        </tr>
      </tal:batch>
    </tbody>
  </table>

      <div tal:condition="not: batch">
        <img src="/@@/alert" />
        No <span tal:replace="view/state" /> builds for
        <span tal:replace="context/title" />.
      </div>

      <tal:navigation
           tal:condition="batch"
           replace="structure view/batchnav/@@+navigation-links" />

  </tal:batch>
</div>
