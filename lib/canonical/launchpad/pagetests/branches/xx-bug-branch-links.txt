= Bug branch links =

It is possible to link bugs and branches from both the bug page and the branch
page.


== From the branch page ==

There is a "Link to bug report" item in the actions menu that is visible
to everybody but which links to a page restricted with the
launchpad.AnyPerson permission.

There is an action link to "Link to bug report" that is visible to all bug
if the user is not logged in, they will be asked to log in.

    >>> anon_browser.open(
    ...     'http://code.launchpad.dev/~name12/gnome-terminal/klingon')
    >>> anon_browser.getLink('Link to bug report').click()
    Traceback (most recent call last):
    ...
    Unauthorized: (...launchpad.AnyPerson')

    >>> def printRelatedBugs(browser):
    ...     tag = find_tag_by_id(browser.contents, 'related-bugs')
    ...     if tag is None:
    ...         print tag
    ...     else:
    ...         print extract_text(tag)

    >>> user_browser.open(
    ...     'http://code.launchpad.dev/~name12/gnome-terminal/klingon')
    >>> printRelatedBugs(user_browser)
    None
    >>> user_browser.getLink('Link to bug report').click()
    >>> user_browser.title
    'Link branch ...Klingon support in GNOME Terminal... to a bug report'

When linking from a branch to a bug, the bug widget is used.  This
requires the user to enter a bug number.

    >>> user_browser.getControl('The bug that is linked to.').value = "10"
    >>> user_browser.getControl('Link').click()
    >>> printRelatedBugs(user_browser)
    Related Bugs
    Bug #10: another test bug (Medium &ndash; New)

Attempting to link to the same bug again gives an error.

    >>> user_browser.getLink('Link to bug report').click()
    >>> user_browser.getControl('The bug that is linked to.').value = "10"
    >>> user_browser.getControl('Link').click()
    >>> for message in get_feedback_messages(user_browser):
    ...     print message
    There is 1 error.
    Bug #10 is already linked to this branch

The bug-branch link is also shown on the bug page.

    >>> anon_browser.open(
    ...     'http://code.launchpad.dev/~name12/gnome-terminal/klingon')
    >>> anon_browser.getLink('another test bug').click()

    >>> def printBugsBranches(browser):
    ...     tag = find_tag_by_id(browser.contents, 'bug_branch_details')
    ...     if tag is None:
    ...         print tag
    ...     else:
    ...         print extract_text(tag)

    >>> printBugsBranches(anon_browser)
    Related branch                      Developer       Status for this bug
    Klingon support in GNOME Terminal   Sample Person   Fix In Progress


== From the bug page ==

The action link on the bug page is "Add branch".  Again this links to a
page restricted with the launchpad.AnyPerson permission.

    >>> anon_browser.open(
    ...     'http://launchpad.dev/bugs/11')
    >>> anon_browser.getLink('Add branch').click()
    Traceback (most recent call last):
    ...
    Unauthorized: (...launchpad.AnyPerson')

    >>> user_browser.open(
    ...     'http://launchpad.dev/bugs/11')
    >>> printBugsBranches(user_browser)
    None
    >>> user_browser.getLink('Add branch').click()

    >>> user_browser.getControl('Branch').value = (
    ...     "~name12/gnome-terminal/scanned")
    >>> user_browser.getControl('Continue').click()

    >>> printBugsBranches(user_browser)
    Related branch                      Developer       Status for this bug
    ~name12/gnome-terminal/scanned      Sample Person   Fix In Progress

    >>> user_browser.getLink('~name12/gnome-terminal/scanned').click()
    >>> printRelatedBugs(user_browser)
    Related Bugs
    Bug #11: Make Jokosher use autoaudiosink (Undecided &ndash; New)


== Editing the bug status ==

# XXX: TimPenhey 2007-09-11
# Editing bug branch links is only available from the bug page at the moment.
# Initial design from the branch page would be a pencil icon after the
# bug branch hyperlink, but the permission that would control the visibility
# of the pencil is currently too permissive (see lpbug 138805) and would
# indicate to users who should really not be messing with it that they could.
# The UI is not currently very intuitive on the bug side, and should also
# be addressed once the permissions have been tightened.

    >>> user_browser.open(
    ...     'http://launchpad.dev/bugs/11')
    >>> printBugsBranches(user_browser)
    Related branch                      Developer       Status for this bug
    ~name12/gnome-terminal/scanned      Sample Person   Fix In Progress
    >>> user_browser.getLink('Fix In Progress').click()
    >>> print user_browser.title
    Edit branch fix status

Bug branch links have two editable fields:
  * The state of the branch with respect to the bug
  * A whiteboard

    >>> user_browser.getControl('State').value = ['FIXAVAILABLE']
    >>> user_browser.getControl('Whiteboard').value = (
    ...     'This is a fix for the problem and involved:\n'
    ...     ' * Fixing the doodad\n'
    ...     ' * Adjusting the lambda probe')
    >>> user_browser.getControl('Update').click()
    >>> printBugsBranches(user_browser)
    Related branch                      Developer       Status for this bug
    ~name12/gnome-terminal/scanned      Sample Person   Fix Available


== Deleting bug branch links ==

The edit view for the bug branch also now has a delete button to unlink
the bug from the branch.

    >>> user_browser.getLink('Fix Available').click()
    >>> print user_browser.getControl('Whiteboard').value
    This is a fix for the problem and involved:
     * Fixing the doodad
     * Adjusting the lambda probe

    >>> user_browser.getControl('Delete').click()
    >>> printBugsBranches(user_browser)
    None
