<tal:layout define="columns1 default">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  lang="en"
  metal:use-macro="context/@@main_template_2col/master"
  i18n:domain="rosetta"
>
<body>

<metal:leftportlets fill-slot="portlets_one">
  <div tal:replace="structure context/@@+portlet-details" />
  <div tal:replace="structure context/product/@@+portlet-details" />
</metal:leftportlets>

<metal:rightportlets fill-slot="portlets_two">
</metal:rightportlets>

<metal:heading fill-slot="pageheading">
  <h3 tal:content="context/title">Foo Series: main</h3>
  <h1>Upstream source import</h1>
</metal:heading>

<div metal:fill-slot="main">

  <div metal:use-macro="context/@@launchpad_form/form">
    <p metal-fill-slot="extra_info" tal:condition="not:view/has_errors">
      Once you enter the details of the <abbr title="revision control
      system">RCS</abbr> you use for this product series, Launchpad can
      attempt to import that code and publish it as a Bazaar branch.  This
      lets distributors share code with you more efficiently, and also allows
      distributed upstream development.
    </p>

    <metal:formbody fill-slot="widgets">

      <h2>Source import details</h2>

      <fieldset tal:define="selected_rcstype python:view.widgets['rcstype']._getFormValue()">
        <legend>Revision control repository</legend>

        <div class="formHelp">
          Enter details below for only the selected Repository type.
        </div>

        <div>
          <label>
            <input type="radio" name="field.rcstype" value="None"
                   onClick="updateWidgets()"
                   tal:attributes="checked python:selected_rcstype.name == 'NONE'" />
            Do not import branch
          </label>
        </div>

        <fieldset>
          <legend>
            <label>
              <input type="radio" name="field.rcstype" value="CVS"
                   onClick="updateWidgets()"
                   tal:attributes="checked python:selected_rcstype.name == 'CVS'" />
              CVS
            </label>
          </legend>
          <tal:widget define="widget nocall:view/widgets/cvsroot">
            <metal:block use-macro="context/@@launchpad_widget_macros/launchpad_widget_row" />
          </tal:widget>
          <tal:widget define="widget nocall:view/widgets/cvsmodule">
            <metal:block use-macro="context/@@launchpad_widget_macros/launchpad_widget_row" />
          </tal:widget>
          <tal:widget define="widget nocall:view/widgets/cvsbranch">
            <metal:block use-macro="context/@@launchpad_widget_macros/launchpad_widget_row" />
          </tal:widget>
        </fieldset>

        <fieldset>
          <legend>
            <label>
              <input type="radio" name="field.rcstype" value="Subversion"
                   onClick="updateWidgets()"
                   tal:attributes="checked python:selected_rcstype.name == 'SVN'" />
              Subversion
            </label>
          </legend>

          <tal:widget define="widget nocall:view/widgets/svnrepository">
            <metal:block use-macro="context/@@launchpad_widget_macros/launchpad_widget_row" />
          </tal:widget>
        </fieldset>
      </fieldset>

      <fieldset>
        <legend>FTP Details</legend>

        <tal:widget define="widget nocall:view/widgets/releaseroot">
          <metal:block use-macro="context/@@launchpad_widget_macros/launchpad_widget_row" />
        </tal:widget>
        <tal:widget define="widget nocall:view/widgets/releasefileglob">
          <metal:block use-macro="context/@@launchpad_widget_macros/launchpad_widget_row" />
        </tal:widget>
      </fieldset>

      <script type="text/javascript">
        function updateWidgets() {
          /* which rcs type radio button has been selected? */
          var rcstypes = document.getElementsByName('field.rcstype');
          var form = rcstypes[0].form;
          var rcstype = 'None';
          for (var i = 0; i < rcstypes.length; i++) {
            if (rcstypes[i].checked) {
              rcstype = rcstypes[i].value;
              break;
            }
          }
          form['field.cvsroot'].disabled = (rcstype != 'CVS');
          form['field.cvsbranch'].disabled = (rcstype != 'CVS');
          form['field.cvsmodule'].disabled = (rcstype != 'CVS');
          form['field.svnrepository'].disabled = (rcstype != 'Subversion');
        }
        updateWidgets();
      </script>

    </metal:formbody>
  </div>

</div>
</body>
</html>
</tal:layout>
