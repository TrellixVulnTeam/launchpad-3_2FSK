Let's add a task to bug 1.

    >>> browser.addHeader('Authorization', 'Basic test@canonical.com:test')
    >>> browser.open('http://localhost/products/firefox/+bug/1')
    >>> browser.getLink(url='+distrotask').click()
    >>> browser.url
    'http://localhost/products/firefox/+bug/1/+distrotask'

On this page we can add distribution task. We start by adding an Ubuntu
task. Since Ubuntu uses Malone as its bug tracker, the task gets added
and we return to the newly created task's page.

    >>> browser.getControl('Distribution').value = ['ubuntu']
    >>> browser.getControl('Continue').click()
    >>> browser.url
    'http://localhost/distros/ubuntu/+bug/1'

Now let's add a Debian task as well. Since Debian doesn't use Malone,
we add a bug watch as well.

    >>> browser.getLink(url='+distrotask').click()
    >>> browser.url
    'http://localhost/distros/ubuntu/+bug/1/+distrotask'
    >>> browser.getControl(name='field.distribution').value
    ['debian']
    >>> browser.getControl(name='field.link_to_bugwatch').value = True

If we submit the form without specifying a remote bug, we get an error.

    >>> browser.getControl('Continue').click()
    >>> browser.url
    'http://localhost/distros/ubuntu/+bug/1/+distrotask'
    >>> print browser.contents
    <...
    ...Please specify the remote bug number in the remote bug tracker...


If we specify a remote bug, the Debian task gets added an we get
redirected to its page.

    >>> browser.getControl(name='field.remotebug').value = '123'
    >>> browser.getControl('Continue').click()
    >>> browser.url
    'http://localhost/distros/debian/+bug/1'

If we try to add an Ubuntu task together with a bug watch we get an
error, because Ubuntu uses Malone as its bug tracker

    >>> browser.getLink(url='+distrotask').click()
    >>> browser.getControl('Distribution').value = ['ubuntu']
    >>> browser.getControl('Source Package Name').value = 'thunderbird'
    >>> browser.getControl(name='field.link_to_bugwatch').value = True
    >>> browser.getControl('Continue').click()
    >>> browser.url
    'http://localhost/distros/debian/+bug/1/+distrotask'
    >>> print browser.contents
    <...
    ...Ubuntu uses Malone as its bug tracker...

If we uncheck the check box for linking it to a bug watch it will work.

    >>> browser.getControl(name='field.link_to_bugwatch').value = False
    >>> browser.getControl('Continue').click()
    >>> browser.url
    'http://localhost/distros/ubuntu/+source/thunderbird/+bug/1'

We want to make people aware of that they should link bugtasks to bug
watches in order to get automatic status updates. So if we try to add a
Debian task without linking it to a bug watch, we have to confirm that
we really want to do this.

    >>> browser.getLink(url='+distrotask').click()
    >>> browser.getControl('Distribution').value
    ['debian']
    >>> browser.getControl('Source Package Name').value = 'evolution'
    >>> browser.getControl('Continue').click()
    >>> browser.url
    'http://localhost/distros/ubuntu/+source/thunderbird/+bug/1/+distrotask'
    >>> print browser.contents
    <...
    ...Debian doesn't use Malone as its bug tracker...

If we click on "No" we return to the form and can add a bug watch.

    >>> browser.getControl('No').click()
    >>> browser.url
    'http://localhost/distros/ubuntu/+source/thunderbird/+bug/1/+distrotask'
    >>> browser.getControl(name='field.link_to_bugwatch') is not None
    True

However, if we try again, and this time press "Yes", the Debian task
will be added.

    >>> browser.getControl('Continue').click()
    >>> print browser.contents
    <...
    ...Debian doesn't use Malone as its bug tracker...

    >>> browser.getControl('Yes').click()
    >>> browser.url
    'http://localhost/distros/debian/+source/evolution/+bug/1'
