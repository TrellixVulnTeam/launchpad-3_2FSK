= Translation Groups =

    >>> from zope.component import getUtility

    >>> from canonical.launchpad.ftests import login
    >>> login('daf@canonical.com')

Here are various sets of things that we'll need.

    >>> from lp.translations.interfaces.translationgroup import (
    ...     ITranslationGroupSet)
    >>> translation_group_set = getUtility(ITranslationGroupSet)

    >>> from canonical.launchpad.interfaces import IPersonSet
    >>> person_set = getUtility(IPersonSet)

    >>> from canonical.launchpad.interfaces import IProductSet
    >>> product_set = getUtility(IProductSet)

    >>> from lp.translations.interfaces.translator import ITranslatorSet
    >>> translator_set = getUtility(ITranslatorSet)

    >>> from canonical.launchpad.interfaces import ILanguageSet
    >>> language_set = getUtility(ILanguageSet)

    >>> from lp.translations.interfaces.potemplate import IPOTemplateSet
    >>> potemplate_set = getUtility(IPOTemplateSet)

Here are Carlos and No Privileges Person. Carlos manages the translation group
for Evolution, and No Privileges Person is a translator.

    >>> carlos = person_set.getByName('carlos')
    >>> no_priv = person_set.getByName('no-priv')

Here's our translation group.

    >>> group = translation_group_set.new(
    ...     name='foo-translators',
    ...     title='Foo Translators',
    ...     summary='Foo Translators',
    ...     translation_guide_url='https://help.launchpad.net/',
    ...     owner=carlos)

We can access all details of the new TranslationGroup.

    >>> group.title
    u'Foo Translators'
    >>> group.translation_guide_url
    u'https://help.launchpad.net/'
    >>> group.owner.name
    u'carlos'

Let's make it the translation group for Evolution.

    >>> evolution = product_set['evolution']
    >>> evolution.translationgroup = group

Let's only allow translators from that group to translate.

    >>> from lp.translations.interfaces.translationgroup import (
    ...     TranslationPermission)
    >>> evolution.translationpermission = TranslationPermission.CLOSED

No Privileges Person isn't allowed to translate into Welsh.

   >>> series = evolution.getSeries('trunk')
   >>> subset = potemplate_set.getSubset(productseries=series)
   >>> potemplate = subset['evolution-2.2']
   >>> pofile = potemplate.newPOFile('cy')
   >>> pofile.canEditTranslations(no_priv)
   False

Let's add him to the group.

    >>> welsh = language_set['cy']

    >>> no_priv_translator = translator_set.new(
    ...     translationgroup=group,
    ...     language=welsh,
    ...     translator=no_priv)

No Privileges Person *is* allowed to translate into Welsh.

    >>> pofile.canEditTranslations(no_priv)
    True

We can use TranslationGroupSet to check what translation groups a person
is a part of:

    >>> for group in translation_group_set.getByPerson(carlos):
    ...     print group.name
    testing-translation-team

    >>> for group in translation_group_set.getByPerson(no_priv):
    ...     print group.name
    foo-translators

    >>> translators = getUtility(ITranslatorSet)
    >>> for trans in translators.getByTranslator(carlos):
    ...     print trans.language.code
    ...     print trans.translationgroup.name
    ...     print trans.style_guide_url
    es
    testing-translation-team
    None

    >>> for trans in translators.getByTranslator(no_priv):
    ...     print trans.language.code
    ...     print trans.translationgroup.name
    ...     print trans.style_guide_url
    cy
    foo-translators
    None
