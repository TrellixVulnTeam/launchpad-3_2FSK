<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@malone_template/master"
      i18n:domain="bazaar">

<body>

<div metal:fill-slot="main" class="visualPadding"
     tal:define="batch view/batch">

  <h1>Bazaar: Upstream Revision Control Imports</h1>

  <form action="" method="GET">
    <fieldset>
        <legend>Filter Criteria</legend>

        <div class="formControls">
            <input type="text" name="text"
                   tal:attributes="value view/text" size="40">
            <span tal:replace="structure view/sourcestateselector">
                StateSelector
            </span>
            <input type="checkbox" name="ready" id="ready"
                   tal:attributes="checked view/ready">
            <label for="ready">Ready</label>
            <input type="submit" name="search" value="search" />
            <br />
            <!--
            <input type="checkbox" name="sync" id="sync"
                   tal:attributes="checked view/sync">
            <label for="sync">Syncing</label>
            <input type="checkbox" name="process" id="process"
                   tal:attributes="checked view/process">
            <label for="process">Processing approved</label>
            <input type="checkbox" name="tested" id="tested"
                   tal:attributes="checked view/tested">
            <label for="tested">Test successful</label>
            <input type="checkbox" name="assigned" id="assigned"
                   tal:attributes="checked view/assigned">
            <label for="assigned">Assigned</label>
            -->
        </div>

    </fieldset>
  </form>

  <table class="listing rowNavigation" width="100%">
    <tr>
        <th>Project</th>
        <th>Product</th>
        <th>Name</th>
        <th>Title</th>
        <th>Test</th>
        <th>Sync</th>
        <th>Process</th>
        <th>Started</th>
        <th>Finished</th>
    </tr>
    <tr tal:repeat="source batch"
        tal:attributes="onclick string:window.location='${source/name}';">
      <td><span tal:condition="source/product/project"
                tal:content="source/product/project/name">$Project.name</span></td>
      <td tal:content="source/product/name">$Product.name</td>
      <td tal:content="source/name">$SourceSource.name</td>
      <td tal:content="source/title">$SourceSource.title</td>
      <td tal:content="source/autotested">$SourceSource.autotested</td>
      <td tal:content="source/syncingapproved/fmt:date | string: -- ">$SourceSource.syncingapproved</td>
      <td tal:content="source/processingapproved/fmt:date | string: -- ">$SourceSource.processingapproved</td>
      <td tal:content="source/datestarted/fmt:date | string: -- ">$SourceSource.datestarted</td>
      <td tal:content="source/datefinished/fmt:date | string: -- ">$SourceSource.datefinished</td>
    </tr>
    <tr class="batchnav">
      <td class="batchnav" colspan="10"
          tal:define="prev_page_url view/batchnav/prevBatchURL;
                      next_page_url view/batchnav/nextBatchURL">
          <a tal:condition="prev_page_url"
             tal:attributes="href prev_page_url">&laquo; previous</a>
          <span tal:omit-tag=""
                tal:repeat="page_url view/batchnav/batchPageURLs">
            <a href=""
               tal:content="python:page_url.keys()[0]"
               tal:attributes="href python:page_url.values()[0]">[1]</a>
          </span>
          <a tal:condition="next_page_url"
             tal:attributes="href next_page_url">next &raquo;</a>
             <br />
            <small tal:content="python:'displaying sources ' + str(batch.startNumber()) + ' to ' + str(batch.endNumber()) + ' of ' + str(batch.total())"
                   style="float: center;">displaying 1 to 20 of 42</small>
      </td>
    </tr>
  </table>

  * NB: The SourceSource.status flag is not yet implemented, when this is
    done the drop-down listbox will actually work properly, till then it's
    a best guess and STOPPED, DONTSYNC etc do not work :-)

</div>

</body>
</html>
