#!/usr/bin/python2.4
"""Get useful hosting information for a branch.

Usage: get-branch-info <branch_url>
"""

import _pythonpath

import sys

from bzrlib.urlutils import join

from zope.component import getUtility

from canonical.codehosting.vfs import branch_id_to_path
from canonical.config import config
from canonical.launchpad.interfaces.branch import BranchType
from canonical.launchpad.interfaces.branchlookup import IBranchLookup
from canonical.launchpad.scripts import execute_zcml_for_scripts
from canonical.launchpad.webapp.publisher import canonical_url


def main(args):
    branch_url = args[1]
    execute_zcml_for_scripts()
    branch_lookup = getUtility(IBranchLookup)
    branch = branch_lookup.getByUrl(branch_url)
    if branch is None:
        print "Could not find branch at %r" % (branch_url,)
        return
    print branch.bzr_identity
    print
    print 'Unique name:', branch.unique_name
    print 'ID:', branch.id
    print 'Private:', branch.private
    print 'Type:', branch.branch_type
    print 'URL:', canonical_url(branch)
    if branch.url is not None:
        print 'External URL:', branch.url
    branch_path = branch_id_to_path(branch.id)
    if branch.branch_type == BranchType.HOSTED:
        hosted_path = join(
            config.codehosting.hosted_branches_root, branch_path)
        print 'Hosted copy:',  hosted_path
    mirrored_path = join(
        config.codehosting.mirrored_branches_root, branch_path)
    print 'Mirrored copy:', mirrored_path


if __name__ == '__main__':
    main(sys.argv)
