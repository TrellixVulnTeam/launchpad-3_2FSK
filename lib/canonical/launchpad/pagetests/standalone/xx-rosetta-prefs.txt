The Rosetta Preferences Page
----------------------------

Carlos is a translator who translates things into Spanish with Rosetta.
Accordingly, Spanish is selected in his preferences. However, Welsh is not.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://launchpad.dev/rosetta/prefs')

  >>> browser.title
  'Rosetta: Preferences'
  >>> 'Your language preferences' in browser.contents
  True

  >>> es_checkbox = browser.getControl('Spanish')
  >>> es_checkbox
  <ItemControl name='es' type='checkbox' optionValue='on'>
  >>> es_checkbox.selected
  True

  >>> cy_checkbox = browser.getControl('Welsh')
  >>> cy_checkbox
  <ItemControl name='cy' type='checkbox' optionValue='on'>
  >>> cy_checkbox.selected
  False

  >>> from BeautifulSoup import BeautifulSoup
  >>> def print_languages(rosetta_pref_page, portlet='preferred'):
  ...     """Print languages listed in the preferred or browser
  ...     languages portlet.
  ...
  ...     portlet keyword argument can be 'preferred' or 'browser'
  ...
  ...     """
  ...     soup = BeautifulSoup(rosetta_pref_page)
  ...     lang_portlet = soup.fetchText(
  ...         'Your %s languages:' % portlet)[0].parent.parent
  ...     for lang in lang_portlet('li', {'class': 'languages'}):
  ...         print lang.string

  >>> print_languages(browser.contents)
  Catalan
  Spanish

Now let's suppose that Carlos decides that he doesn't like Spanish after all,
and that Welsh is a much nicer language. When he adjusts his preferences,
Spanish will no longer be selected, and Welsh will.

  >>> es_checkbox.click()
  >>> es_checkbox.selected
  False
  >>> cy_checkbox.click()
  >>> cy_checkbox.selected
  True
  >>> browser.getControl('Save').click()

  >>> print_languages(browser.contents)
  Catalan
  Welsh

When a user doesn't have a preferred language set, we determine it from the
user's browser headers. If his browser send us any non-utf8 encoded string in 
the Accept-Language header, we won't consider that as a valid language code.

  >>> user_browser.addHeader('Accept-Language', 'pt_br, Espa\xf1ol')
  >>> user_browser.open('http://launchpad.dev/rosetta/prefs')

  >>> print_languages(user_browser.contents, portlet='browser')
  Portuguese (Brazil)
