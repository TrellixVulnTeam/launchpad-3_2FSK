= Administering requests =

The shipit admins can do any changes they want to a request, as well as create
as many requests as they want.

== Searching for requests and editing them ==

  >>> browser.addHeader('Authorization', 'Basic marilize@hbd.com:test')
  >>> browser.open('http://shipit.ubuntu.dev/requests')
  >>> browser.url
  'http://shipit.ubuntu.dev/requests'

Let's see the two pending requests we have for Feisty CDs.

  >>> browser.getControl(name='statusfilter').value = ['PENDING']
  >>> browser.getControl(name='seriesfilter').value = ['FEISTY']
  >>> browser.getControl('Show').click()
  >>> print browser.contents
  <!DOCTYPE...
  ...2 results...


Now we'll approve request number 12.
  
  >>> browser.getLink('12').click()
  >>> browser.url
  'http://shipit.ubuntu.dev/requests/12'

  >>> browser.getControl('Approve & Continue').click()


When approving/denying/changing a request, we get redirected to the next
request pending approval.

  >>> browser.url
  'http://shipit.ubuntu.dev/requests/13?previous=12&approved=1'
  >>> 'Status: pending' in browser.contents
  True


This request's address is wrong, and Marilize noticed that, so she'll
correct it by going to the /adminrequest page.

  >>> browser.getLink('Edit shipping details').click()
  >>> browser.url
  'http://shipit.ubuntu.dev/adminrequest?order=13'

  >>> browser.getControl('Address:').value = 'Fixed address'
  >>> browser.getControl('Change Request').click()

  >>> browser.url
  'http://shipit.ubuntu.dev/requests/13'
  >>> 'Fixed address' in browser.contents
  True


For this request we'll change the approved quantities before approving.

  >>> browser.getControl(name='field.server_quantityx86approved').value
  '0'
  >>> browser.getControl(name='field.server_quantityx86approved').value = '3'
  >>> browser.getControl('Approve & Continue').click()


And in this case we won't be redirected because there's no more pending
requests.

  >>> browser.url
  'http://shipit.ubuntu.dev/requests/13/'
  
  >>> browser.getControl(name='field.server_quantityx86approved').value
  '3'


Actually, this request should have been denied, let's do it!

  >>> browser.getControl('Deny & Continue').click()
  >>> browser.url
  'http://shipit.ubuntu.dev/requests/13/'
  >>> 'Status: denied' in browser.contents
  True


But, if the shipit admin realizes later that the denied request should have
been approved actually, it's possible to do it.

  >>> browser.url
  'http://shipit.ubuntu.dev/requests/13/'
  >>> browser.getControl('Approve & Continue').click()
  >>> 'Status: denied' in browser.contents
  False
  >>> 'Status: approved' in browser.contents
  True

Another kind of request that shipit admins usually have to look at are the
ones with an address that has been used by other people already.

  >>> browser.open('http://shipit.ubuntu.dev/requests')
  >>> browser.url
  'http://shipit.ubuntu.dev/requests'
  >>> browser.getControl(name='statusfilter').value = ['DUPLICATEDADDRESS']
  >>> browser.getControl(name='seriesfilter').value = ['FEISTY']
  >>> browser.getControl('Show').click()
  >>> print extract_text(find_tag_by_id(browser.contents, 'results-body'))
  20 Somebody Else (mark@hbd.com) 2006-02-01 Bermuda 8 0
    pending special consideration (dupe address)

When looking at requests marked with the DUPLICATEDADDRESS status we can see
the requests made by other users using the same address.

  >>> browser.getLink('20').click()
  >>> browser.url
  'http://shipit.ubuntu.dev/requests/20'
  >>> print extract_text(
  ...     find_tag_by_id(browser.contents, 'dupe-address-reuqests'))
  Date       Recipient            Requested   Approved Status
  2006-02-01 No Privileges Person 10 (Ubuntu) 10       approved (unshipped) 


== Making new requests ==

One other thing that shipit admins can do is to make new requests on behalf
of other people, containing any number of CDs they want, and even including
CDs of the Server edition.

  >>> browser.open('http://shipit.ubuntu.dev/adminrequest')
  >>> browser.url
  'http://shipit.ubuntu.dev/adminrequest'

  >>> browser.getControl(name='field.ubuntu_quantityx86').value = '15'
  >>> browser.getControl(name='field.kubuntu_quantityx86').value = '10'
  >>> browser.getControl(name='field.server_quantityx86').value = '1'
  >>> browser.getControl(name='field.server_quantityamd64').value = '1'

  >>> browser.getControl('Name:').value = 'Guilherme Salgado'
  >>> browser.getControl('Address:').value = 'Rua Clovis Bevilacqua, 145'
  >>> browser.getControl('City/Town/etc:').value = 'Sao Jose dos Campos'
  >>> browser.getControl('Phone:').value = '39414258'
  >>> browser.getControl('Country:').value = ['31']
  >>> browser.getControl('Postcode:').value = '12242790'

  >>> browser.getControl('Request').click()
  >>> browser.url
  'http://shipit.ubuntu.dev/requests/...'

The requests created using the administrative interface are automatically
approved.

  >>> 'Status: approved (unshipped)' in browser.contents
  True
  >>> browser.getControl(name='field.ubuntu_quantityx86approved').value
  '15'
  >>> browser.getControl(name='field.kubuntu_quantityx86approved').value
  '10'
  >>> browser.getControl(name='field.server_quantityx86approved').value
  '1'
  >>> browser.getControl(name='field.server_quantityamd64approved').value
  '1'
