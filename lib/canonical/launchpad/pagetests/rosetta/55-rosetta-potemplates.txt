== Legend and headers display ==

On template overview page, when user is not logged in (and there is no
sufficient GeoIP data), or user has not set his preferred languages,
legend should be hidden from him since he's looking only at the list
of templates.

We are pretending to be coming from 192.168.0.1 so no GeoIP data will
match (otherwise, we'll get a couple of African languages as preferred
languages, and we are testing behaviour when no languages are wanted).
192.168.0.1 is just a random choice of an IP address for which we hold
no GeoIP mappings.

    >>> anon_browser.addHeader('X-Forwarded-For', '192.168.0.1')
    >>> anon_browser.open(
    ...     'http://translations.launchpad.dev/evolution/trunk/+translations')
    >>> find_tag_by_id(anon_browser.contents, 'legend') is None
    True

When looking at a specific template with at least one translation, he
will again see the legend.

    >>> anon_browser.open(
    ...    'http://translations.launchpad.dev/evolution/trunk/+pots/'
    ...    'evolution-2.2')
    >>> find_tag_by_id(anon_browser.contents, 'legend') is None
    False

The same happens for template overview page for packages.

    >>> anon_browser.open(
    ...    'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/'
    ...    '+translations')
    >>> find_tag_by_id(anon_browser.contents, 'legend') is None
    True

And with at least one translation, legend is shown.

    >>> anon_browser.open(
    ...    'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/'
    ...    '+pots/man')
    >>> find_tag_by_id(anon_browser.contents, 'legend') is None
    False

When there are no translations in a single template, legend and
headers will not be shown.

    # To check this, we need to state that this project uses Launchpad for
    # translations.
    >>> admin_browser.open('http://launchpad.dev/netapplet/+edit')
    >>> admin_browser.getControl(
    ...     'Translations for this project are done in Launchpad'
    ...     ).selected = True
    >>> admin_browser.getControl('Change').click()
    >>> anon_browser.open(
    ...     'http://translations.launchpad.dev/netapplet/trunk/+pots/'
    ...     'netapplet')
    >>> find_tag_by_id(anon_browser.contents, 'legend') is None
    True

And likewise for PO template pages for templates without translations
in packages:

    >>> anon_browser.open(
    ...    'http://translations.launchpad.dev/ubuntu/hoary/+source/pmount/'
    ...    '+pots/man')
    >>> find_tag_by_id(anon_browser.contents, 'legend') is None
    True


= The PO Template Views =

Carlos is a translator who translates things into Spanish and Catalan.
When he looks at available translations for Evolution in Hoary, he
should see Catalan in the list.

    >>> browser = setupBrowser(auth='Basic carlos@canonical.com:test')
    >>> browser.open(
    ...     'http://translations.launchpad.dev/ubuntu/hoary/+source/'
    ...     'evolution/+translations')
    >>> 'Catalan' in browser.contents
    True

But also, he doesn't want to see other languages in the list.  So, he
shouldn't see eg. Japanese.

    >>> 'Japanese' in browser.contents
    False

Next, if he chooses to view all the languages, he should see Japanese
among the languages on the page.

    >>> browser.getLink('View Template & All Languages...').click()
    >>> 'Japanese' in browser.contents
    True

So, everything is fine, and Carlos can sleep calmly.

== Links to filtered pages ==

The POTemplate overview page shows different statistics: a count of
untranslated messages, messages with new, unreviewed suggestions, anda count
of messages which had their imported translations changed in Launchpad.

Looking at the POTemplate overview page, we can see that there are
15 untranslated, 1 unreviewed and 1 changed in LP Spanish translations
(all numbers repeated as hidden 'sortkey' values).

    >>> browser.open('http://translations.launchpad.dev/ubuntu/hoary/+source/'+
    ...              'evolution/+pots/evolution-2.2')
    >>> spanish_line = find_tag_by_id(browser.contents, 'evolution-2.2_es')
    >>> print extract_text(spanish_line)
    Spanish
    ...
    15 15 1 1 1 1
    ...

Language title points to the general translate page:

    # We are not using browser.getLink because there is no unique way to
    # get all of the relevant links, and we don't want to pollute the
    # page template with too many IDs useful only for testing.
    >>> all_links = spanish_line.findAll('a')
    >>> base_href = browser.url
    >>> unfiltered = all_links[0]
    >>> print extract_text(unfiltered)
    Spanish
    >>> extract_link_from_tag(unfiltered, base_href)
    u'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate'

The number of untranslated entries points to the same page, which now shows
only untranslated items. When we follow this link, the filtering combo box has
the right filter preselected.

    >>> untranslated = all_links[1]
    >>> print extract_text(untranslated)
    15
    >>> untranslated_link = extract_link_from_tag(untranslated, base_href)
    >>> browser.open(untranslated_link.encode('UTF-8'))
    >>> browser.url
    'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=untranslated'
    >>> print browser.getControl(name='show', index=1).value
    ['untranslated']

Similarly, the number of unreviewed entries points to the translation page
with the 'with new suggestions' filter selected.

    >>> unreviewed = all_links[2]
    >>> print extract_text(unreviewed)
    1
    >>> unreviewed_link = extract_link_from_tag(unreviewed, base_href)
    >>> browser.open(unreviewed_link.encode('UTF-8'))
    >>> browser.url
    'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=new_suggestions'
    >>> print browser.getControl(name='show', index=1).value
    ['new_suggestions']

The number of updated entries points to the translation page with the
'changed in Launchpad' filter selected.

    >>> updated = all_links[3]
    >>> print extract_text(updated)
    1
    >>> updated_link = extract_link_from_tag(updated, base_href)
    >>> browser.open(updated_link.encode('UTF-8'))
    >>> browser.url
    'http://translations.launchpad.dev/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=changed_in_launchpad'
    >>> print browser.getControl(name='show', index=1).value
    ['changed_in_launchpad']

