Editing BugTasks
================

There is currently only one page which deals with editing a bug task,
+editstatus. In order to show how it works, we need to login:

    >>> login('test@canonical.com')

Let's start simple and edit the status of a bug task:

    >>> from zope.component import getView
    >>> from canonical.launchpad.interfaces import IBugSet
    >>> from canonical.launchpad.webapp.servers import LaunchpadTestRequest
    >>> bug_nine = getUtility(IBugSet).get(9)
    >>> ubuntu_thunderbird_task = bug_nine.bugtasks[1]
    >>> ubuntu_thunderbird_task.status.title
    'Confirmed'

    >>> request = LaunchpadTestRequest(
    ...     form={
    ...         'FORM_SUBMIT': '',
    ...         'field.status': 'In Progress',
    ...         'field.severity': ubuntu_thunderbird_task.severity.title,
    ...         'field.field.assignee.option': 'assign_to_nobody',
    ...         'field.sourcepackagename':
    ...             ubuntu_thunderbird_task.sourcepackagename.name})
    >>> edit_view = getView(
    ...     ubuntu_thunderbird_task, '+editstatus-page', request)
    >>> edit_view.process_form()
    >>> ubuntu_thunderbird_task.status.title
    'In Progress'

Now let's edit a bugtask which is linked to a remote bug. The most
important thing to edit is the bug watch, since it controls the status
information about the bug task. To show it how it works we remote the
link temporarily:

    >>> thunderbird_task = bug_nine.bugtasks[0]
    >>> bugzilla_watch = thunderbird_task.bugwatch
    >>> thunderbird_task.bugwatch = None

Now we simulate that the bug watch got updated:

    >>> bugzilla_watch.remotestatus = 'RESOLVED FIXED'

If we now link the bugtask to the bug watch, the bugtask's status will
be set to None:

XXX: We really should update the status from the bug watch, but that's
     not trivial to do at the moment. I will fix this later.
     -- Bjorn Tillenius, 2006-03-01

    >>> from canonical.lp.dbschema import BugTaskStatus
    >>> thunderbird_task.status = BugTaskStatus.UNCONFIRMED
    >>> request = LaunchpadTestRequest(
    ...     form={
    ...         'FORM_SUBMIT': '',
    ...         'field.bugwatch': '6'})
    >>> edit_view = getView(
    ...     thunderbird_task, '+editstatus-page', request)
    >>> edit_view.process_form()
    >>> thunderbird_task.bugwatch == bugzilla_watch
    True
    >>> thunderbird_task.status is None
    True
