<div
  tal:define="comment context;
              remote_bug_comment_class
              python: comment.bugwatch and 'remoteBugComment' or '';
              admin_comment_hidden_class
              python: comment.show_for_admin and 'adminHiddenComment' or ''"
  tal:attributes="class string:boardComment ${remote_bug_comment_class}
                 ${admin_comment_hidden_class}">
  <div class="boardCommentDetails" tal:condition="not: comment/bugwatch">
    <tal:comment_has_owner>
      <tal:comment_owner replace="structure comment/owner/fmt:link" />
    </tal:comment_has_owner>
    wrote
    <span
      tal:attributes="title comment/datecreated/fmt:datetime"
      tal:content="comment/datecreated/fmt:displaydate">
      7 minutes ago
    </span>:
    <a tal:attributes="href comment/fmt:url">
      <strong tal:condition="comment/display_title"
              tal:content="comment/title" />
      (permalink)
    </a>
  </div>

  <div class="boardCommentDetails" tal:condition="comment/bugwatch">
    <img width="14" height="14" src="/@@/bug-remote" alt=""/>
    In
    <a tal:attributes="href comment/bugwatch/url"
       tal:content="comment/bugwatch/title" />,
    <tal:comment_has_owner>
      <tal:comment_owner replace="structure comment/owner/fmt:link" />
    </tal:comment_has_owner>
    wrote
    <span
      tal:attributes="title comment/datecreated/fmt:datetime"
      tal:content="comment/datecreated/fmt:displaydate">
      7 minutes ago
    </span>:
    <a tal:attributes="href comment/fmt:url">
      <strong tal:condition="comment/display_title"
              tal:content="comment/title" />
      (permalink)
    </a>
  </div>

  <div class="boardCommentBody">
    <ul tal:condition="comment/bugattachments" style="margin-bottom: 1em">
      <li tal:repeat="attachment comment/bugattachments">
        <a tal:attributes="href attachment/libraryfile/http_url"
           tal:content="attachment/title" class="sprite download">foo.txt</a>
        (<span
           tal:replace="attachment/libraryfile/content/filesize/fmt:bytes" />,
        <span tal:replace="attachment/libraryfile/mimetype" />)
      </li>
    </ul>

    <div class="bug-comment"
      tal:content="structure
        comment/text_for_display/fmt:obfuscate-email/fmt:email-to-html">
      Comment text.
    </div>
    <p tal:condition="comment/was_truncated">
      <a tal:attributes="href comment/fmt:url">Read more...</a>
    </p>
  </div>
  <div class="boardCommentFooter" tal:condition="comment/show_footer">
    <tal:activity
        define="activity_list comment/activity"
        condition="comment/activity">
      <metal:activity-table
          metal:use-macro="context/@@bugcomment-macros/activity-table" />
    </tal:activity>
    <tal:bugwatch-footer condition="comment/bugwatch">
      <div>
        <table style="width: 100%">
          <tr>
            <td style="text-align: left; vertical-align: middle">
              <tal:reply-link condition="view/user">
                <a tal:attributes="id string:remote_comment_reply_expand_link_${comment/index};
                                   href comment/fmt:url"
                   href="#">
                  <img tal:attributes="id string:remote_comment_reply_tree_icon_${comment/index};
                                       src python: '/@@/tree' + (view.expand_reply_box and 'Expanded' or 'Collapsed')"
                       class="collapseIcon" height="14" width="14" />
                  Reply on <tal:bugtracker replace="comment/bugwatch/bugtracker/title"/>
                </a>
              </tal:reply-link>
            </td>
            <td style="text-align: right; vertical-align: middle">
              <tal:sync-state condition="not: comment/synchronized">
                <img height="14" width="14" src="/@@/bug-remote-comment-synchronizing" />
                Awaiting synchronization
              </tal:sync-state>
            </td>
          </tr>
          <tr tal:condition="view/user">
            <td colspan="2">
              <div tal:attributes="id string:remote_comment_reply_div_${comment/index};
                                   style python: 'display: ' + (view.expand_reply_box and 'block' or 'none')">
                <form tal:attributes="action comment/add_comment_url"
                      name="launchpadform" method="post"
                      enctype="multipart/form-data"
                      accept-charset="UTF-8">
                  <input type="hidden" name="field.bugwatch_id"
                         tal:attributes="value comment/bugwatch/id" />
                  <input type="hidden" name="field.subject"
                         tal:attributes="value comment/bugtask/bug/followup_subject" />
                  <textarea id="field.comment" name="field.comment" rows="10" cols="60"></textarea>
                  <br />
                  <div class="actions">
                    <table style="width: 100%">
                      <tr>
                        <td style="vertical-align: middle">
                          <input type="submit" id="field.actions.save"
                                 name="field.actions.save" value="Save Changes" class="button" />
                        </td>
                        <td style="text-align: right; vertical-align: middle">
                          Your comment will be sent to <a tal:replace="structure comment/bugwatch/fmt:external-link" />
                        </td>
                      </tr>
                    </table>
                  </div>
                </form>
              </div>
            </td>
          </tr>
        </table>
      </div>
      <script type="text/javascript"
              tal:condition="view/user"
              tal:content="string:connectRemoteCommentReply(${comment/index});" />
    </tal:bugwatch-footer>
  </div>
</div>
