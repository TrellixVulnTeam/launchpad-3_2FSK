<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  omit-tag="">
<tal:do-this-first tal:content="view/processForm" />
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="launchpad"
>
  <body>
    <div metal:fill-slot="main">
      <h1 tal:condition="not: view/dupe">No account found to merge</h1>
      <tal:duplicate condition="view/dupe">
        <tal:block tal:condition="not: view/form_processed">
          <h1>Merge accounts</h1>

      <tal:email_visible condition="not: view/email_hidden">
      <p>
        The account <code tal:content="view/dupe/name">foo</code>,
        which you&#8217;re trying to merge,
        has more than one registered e-mail address.
        To complete the merge, you need to prove that you have access to
        all e-mail addresses registered for this account.
        To do this, select all of them and click <samp>Submit</samp>.
        If you don&#8217;t have access to one or more of these addresses,
        Launchpad will not be able to merge the account into your existing one,
        but any other addresses will be transferred to your account.
      </p>

      <form name="mergerequest" action="" method="POST">
      <input type="hidden" name="dupe" tal:attributes="value request/dupe" />
      <table>
        <tr tal:repeat="email view/dupeemails">
          <td>
            <input type="checkbox" name="selected" checked="checked"
                   tal:attributes="value email/email" />
          </td>
          <td tal:content="email/email">
          </td>
        </tr>
        <tr>
          <td colspan="2" align="right">
            <input type="submit" value="Submit" />
          </td>
        </tr>
      </table>
      </form>
      </tal:email_visible>

      <tal:email_hidden condition="view/email_hidden">
      <p>
        The account <code tal:content="view/dupe/name">foo</code>,
        which you&#8217;re trying to merge,
        has <span tal:replace="view/dupeemails/count" /> registered
        e-mail addresses but they are not publicly visible.
        To complete the merge, you need to prove that you have access to
        all e-mail addresses registered for this account.
      </p>
      <p>
        To do so, click <samp>Submit</samp>.  An email will be sent to each
        address on file for the duplicate account.  You must follow the
        instructions for each email.
        If you don&#8217;t have access to one or more of these addresses,
        Launchpad will not be able to merge the account into your existing one,
        but the addresses you verify will be transferred to your account.
      </p>

      <form name="mergerequest" action="" method="POST">
        <input type="hidden" name="dupe" tal:attributes="value request/dupe" />
        <input type="submit" value="Submit" />
      </form>
      </tal:email_hidden>

    </tal:block>

    <tal:block tal:condition="view/form_processed">
      <h1>Confirmation mail sent</h1>

      <tal:email_visible condition="not: view/email_hidden">
      <p>Individual email messages were sent to:</p>
        <tal:block repeat="email view/notified_addresses">
          <p><strong tal:content="email"/></p>
        </tal:block>
      </tal:email_visible>

      <tal:email_hidden condition="view/email_hidden">
      <p>Individual email messages were sent to the
        <span tal:content="view/dupeemails/count" /> registered
        e-mail addresses for
        <code tal:content="view/dupe/name">foo</code>.
      </p>
      </tal:email_hidden>

      <p>
        Please follow the instructions on each of those messages to complete
        the merge.
      </p>
    </tal:block>

  </tal:duplicate>
</div>

</body>
</html>
</tal:root>
