<tal:process define="status view/process_form" />
<p tal:condition="context/bug/duplicateof" class="informational message">
  This bug is a duplicate of
  <a
    href="#"
    tal:attributes="href context/bug/duplicateof/fmt:url"
  >bug #<tal:bugnum replace="context/bug/duplicateof/id">42</tal:bugnum></a>
</p>
<form
  action="#"
  tal:attributes="action string:${context/fmt:url}/+editstatus"
  method="post"
  enctype="multipart/form-data">
  <p
    tal:define="errors view/errors|nothing"
    tal:condition="errors"
    class="error message"
    i18n:translate=""
  >
    There are
    <strong
      tal:content="view/errors/count:len"
      i18n:name="num_errors"
    >6</strong>
    problems with the information you entered.
    Please fix them and try again.
  </p>
  <p
    tal:define="errors view/errors|nothing"
    tal:condition="errors"
    tal:repeat="error errors"
    tal:content="error"
    class="error message"
  >Individual error.</p>
      

  <p tal:condition="not: context/required:launchpad.Edit" class="error message">
    You are not the assignee, or the maintainer of
    <tal:context replace="context/targetname">product</tal:context>,
    so you cannot edit this bug's status.
  </p>
  <div class="field">
    <table>
      <tal:distrotask
        condition="python:context.distribution or context.distrorelease"
      >
        <tr>
          <td>
            <label
              tal:attributes="for view/sourcepackagename_widget/name"
              tal:content="view/sourcepackagename_widget/label"
            >Source package name</label>
          </td>
        </tr>
        <tr>
          <td
            tal:content="structure view/sourcepackagename_widget"
            style="white-space: nowrap;"
          />
        </tr>
      </tal:distrotask>
      <tal:upstreamtask condition="python:context.product">
        <tr tal:condition="view/product_widget">
          <td colspan="2">
            <label
              tal:attributes="for view/product_widget/name"
              tal:content="view/product_widget/label"
            >Upstream product</label>
          </td>
        </tr>
        <tr tal:condition="view/product_widget">
          <td colspan="2" tal:content="structure view/product_widget" nowrap />
        </tr>
      </tal:upstreamtask>
    </table>
    <table>
      <tr>
        <td>
          <label
            tal:attributes="for view/status_widget/name"
            tal:content="view/status_widget/label"
          >Status</label>
        </td>
        <td>
          <label
            tal:attributes="for view/severity_widget/name"
            tal:content="view/severity_widget/label"
          >Severity</label>
        </td>
        <td>
          <label
            tal:attributes="for view/priority_widget/name"
            tal:content="view/priority_widget/label"
          >Priority</label>
        </td>
        <td tal:condition="view/milestone_widget">
          <label
            tal:attributes="for view/milestone_widget/name"
            tal:content="view/milestone_widget/label"
          >Target</label>
        </td>
      </tr>
      <tr>
        <td tal:content="structure view/status_widget" />
        <td tal:content="structure view/severity_widget" />
        <td tal:content="structure view/priority_widget" />
        <td tal:condition="view/milestone_widget"
            tal:content="structure view/milestone_widget" />
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label
            tal:attributes="for view/assignee_widget/name"
            tal:content="view/assignee_widget/label"
          />
        </td>
      </tr>
      <tr>
        <td nowrap tal:content="structure view/assignee_widget" colspan="2" />
      </tr>
    </table>
    <table tal:condition="not:context/target_uses_malone">
      <tr>
        <td>
          <label
            tal:attributes="for view/bugwatch_widget/name"
            style="white-space: nowrap"
          >Remote Watch</label>
        </td>
      </tr>
      <tr>
        <td nowrap tal:content="structure view/bugwatch_widget" colspan="2" />
      </tr>
      <tr>
        <td class="formHelp" colspan="2">
        The information about this bug in Launchpad is
        automatically pulled daily from the remote bug.
        <tal:has_bugwatch tal:condition="context/bugwatch">
          <tal:has_been_pulled 
              tal:condition="context/bugwatch/lastchecked">
            This information was last pulled 
            <b tal:content="context/bugwatch/lastchecked/fmt:datetime">
              2006-03-01 23:15 UTC
            </b>.
          </tal:has_been_pulled>
          <tal:has_not_been_pulled 
              tal:condition="not:context/bugwatch/lastchecked">
            This information hasn't been pulled yet.
          </tal:has_not_been_pulled>
        </tal:has_bugwatch>
        </td>
      </tr>
    </table>
  </div>
  <div class="field">
    <label for="comment_on_change">Comment on most recent change</label>
    <div style="margin-top: 5px">
      <i tal:content="python:context.statusexplanation or '(none)'" />
    </div>
  </div>
  <div class="field">
    <div tal:attributes="class python:view.comment_on_change_error and 'error' or ''">
      <label for="comment_on_change">Comment on this change (optional)</label>
      <textarea
        cols="62"
        id="comment_on_change"
        name="comment_on_change"
        rows="4"
        tal:content="request/comment_on_change|nothing"
      ></textarea>
      <div
        tal:condition="view/comment_on_change_error"
        class="message"
        tal:content="view/comment_on_change_error"
      >An error on comment on change.</div>
    </div>
  </div>
  <div class="actions" tal:condition="context/required:launchpad.Edit">
    <input
      type="submit"
      name="FORM_SUBMIT"
      value="Save Changes"
      i18n:attributes="value submit-button"
    />
  </div>
</form>
