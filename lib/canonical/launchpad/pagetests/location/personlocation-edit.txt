== Edit person location information ==

The location information is editable by anybody (like a wiki), until the
person provides location data for themselves. At that point it is only
editable by people who have launchpad.Edit on the person, which is that
person and admins.

    >>> import transaction
    >>> from zope.component import getUtility
    >>> from canonical.launchpad.ftests import login, logout
    >>> from canonical.launchpad.interfaces import IPersonSet

First, we make sure that jordi does not have any location information
setup for them in the sample data.

    >>> login('test@canonical.com')
    >>> personset = getUtility(IPersonSet)
    >>> jordi = personset.getByEmail('jordi@ubuntu.com')
    >>> logout()
    >>> jordi.latitude is None
    True
    >>> jordi.time_zone is None
    True

Now, we show that you can see the location edit widgets if you are
anybody logged in.

    >>> nopriv_browser = setupBrowser(auth="Basic no-priv@canonical.com:test")
    >>> nopriv_browser.open('http://launchpad.dev/~jordi/+editlocation')
    >>> find_tag_by_id(nopriv_browser.contents, "field.location.latitude")
    <input class="hiddenType" id="field.location.latitude" name="field.location.latitude" type="hidden" value="" />

Not only can we see the widgets, but anybody logged in can actually provide
new location information.

    >>> nopriv_browser.getControl(name='field.location.latitude').value = '13.0'
    >>> nopriv_browser.getControl(name='field.location.longitude').value = '17.0'
    >>> nopriv_browser.getControl(name='field.location.time_zone').value = ['Europe/Madrid']
    >>> nopriv_browser.getControl('Update').click()
    >>> login('test@canonical.com')
    >>> jordi = personset.getByEmail('jordi@ubuntu.com')
    >>> logout()
    >>> jordi.latitude
    13.0
    >>> jordi.longitude
    17.0
    >>> jordi.time_zone
    u'Europe/Madrid'

If Jordi provides his own location information, then the data is locked, and
random people can no longer edit it.

    >>> jordi_browser = setupBrowser(auth="Basic jordi@ubuntu.com:test")
    >>> jordi_browser.open('http://launchpad.dev/~jordi/+editlocation')
    >>> jordi_browser.getControl(name='field.location.latitude').value = '39.48'
    >>> jordi_browser.getControl(name='field.location.longitude').value = '-0.40'
    >>> jordi_browser.getControl(name='field.location.time_zone').value = ['Europe/Madrid']
    >>> jordi_browser.getControl('Update').click()

    >>> nopriv_browser = setupBrowser(auth="Basic no-priv@canonical.com:test")
    >>> nopriv_browser.open('http://launchpad.dev/~jordi/+editlocation')
    Traceback (most recent call last):
    ...
    Unauthorized:...

Of course, Jordi can continue to edit it:

    >>> jordi_browser = setupBrowser(auth="Basic jordi@ubuntu.com:test")
    >>> jordi_browser.open('http://launchpad.dev/~jordi/+editlocation')
    >>> jordi_browser.getControl(name='field.location.latitude').value
    '39.48'

And so can a Launchpad admin:

    >>> admin_browser.open('http://launchpad.dev/~jordi/+editlocation')
    >>> admin_browser.getControl(name='field.location.latitude').value
    '39.48'
