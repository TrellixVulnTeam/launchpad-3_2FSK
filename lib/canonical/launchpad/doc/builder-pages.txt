= Builder View Classes and Pages =

  >>> from zope.component import getMultiAdapter, getUtility
  >>> from canonical.launchpad.interfaces import IBuilderSet
  >>> from canonical.launchpad.webapp.interfaces import IBatchNavigator
  >>> from canonical.launchpad.webapp.servers import LaunchpadTestRequest

  >>> builder = getUtility(IBuilderSet).get(1)

Get a "mock" request:
  >>> mock_form = {}
  >>> request = LaunchpadTestRequest(form=mock_form)

Let's instantiate the view for +index:

  >>> builder_view = getMultiAdapter((builder, request), name="+index")
  >>> builder_view.now()
  '...'

A view for +history:

  >>> builder_view = getMultiAdapter((builder, request), name="+history")

  setupBuildList, build a batched list of build records and store it
  in view.batch, also store the batch navigator in view.batchnav. it
  simply returns None:

  >>> builder_view.setupBuildList()

As expected we have a 'batched' list with the size requested in
mock_form:

  >>> len(builder_view.batchnav.currentBatch())
  5

Let's instantiate the view for +cancel:

  >>> request = LaunchpadTestRequest(form={'BUILDERID': 1})

  >>> builder_view = getMultiAdapter((builder, request), name="+cancel")

  >>> builder_view.cancelBuildJob()
  '<p>Cancel (1). Not implemented yet</p>'


Let's instantiate the view for +mode:

This page requires launchpad.Edit permission and the builder is owned
by mark. we nee to log in as mark or any other member of admin team

  >>> from canonical.launchpad.ftests import login
  >>> login("foo.bar@canonical.com")

Build an special request containing the fields we want to change:

  >>> request = LaunchpadTestRequest(form={
  ...     'field.manual': 'on',
  ...     'UPDATE_SUBMIT': 'Change'})

Instantiate the correspondent view:

  >>> builder_view = getMultiAdapter((builder, request), name="+mode")

Ensure the previous mode was AUTOMATIC

  >>> builder.manual
  False

Call the update() method of the zope.app.form.EditView class

  >>> builder_view.update()
  u'Updated on ${date_time}'

We've changed the builder mode to MANUAL

  >>> builder.manual
  True


Let's instantiate the view for +edit:

Build an special request containing the fields we want to change:

  >>> request = LaunchpadTestRequest(form={
  ...     'field.processor': builder.processor.name,
  ...     'field.url': builder.url,
  ...     'field.name': u'biscoito',
  ...     'field.title': builder.title,
  ...     'field.description': builder.description,
  ...     'UPDATE_SUBMIT': 'Change'})

Instantiate the correspondent view:

  >>> builder_view = getMultiAdapter((builder, request), name="+edit")

Ensure the previous name

  >>> builder.id, builder.name
  (1, u'bob')

Call the update() method of the zope.app.form.EditView class

  >>> builder_view.update()
  u'Updated on ${date_time}'

We've modified the buildername

  >>> builder.id, builder.name
  (1, u'biscoito')


