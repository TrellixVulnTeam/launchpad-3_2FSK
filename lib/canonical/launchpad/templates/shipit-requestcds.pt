<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

<div metal:fill-slot="body">

  <table>
  <tbody>
  <tr>
  <td width="80%">
  
  <tal:shipit-is-open condition="view/standardShipItRequests">

    <p class="informational message"
       tal:define="status view/process_status"
       tal:condition="status"
       tal:content="status" />

    <div class="error message"
      tal:repeat="top_of_page_error view/top_of_page_errors"
      tal:content="structure top_of_page_error">
      Schema validation errors.
    </div>

    <tal:current_request condition="view/current_order">
      <h1>Current Request Details</h1>
      <ul>
        <tal:block repeat="requested_cds view/current_order/getAllRequestedCDs">
          <li tal:condition="requested_cds/quantity">
            <strong tal:content="requested_cds/description" />
          </li>
        </tal:block>
      </ul>
      <div>
        <form name="cancelrequest" action="" method="POST">
          <input type="hidden" name="order" 
                 tal:attributes="value view/current_order/id" />

          <input type="submit" value="Cancel Request" name="cancel"
                 class="formControls"/>
        </form>
      </div>
    </tal:current_request>

    <tal:pastrequests condition="view/user/pastShipItRequests"
                      define="user view/user">
      <h1>Shipped/Cancelled requests</h1>

      <metal:pastrequests use-macro="context/@@+shipit-macros/previous_requests" />
    </tal:pastrequests>

    <h1 tal:condition="not: view/current_order">Request CDs</h1>
    <h1 tal:condition="view/current_order">Change your current request</h1>

    <p>
      CDs for <span tal:replace="view/flavour/title" />
      6.06 LTS will begin shipping in <strong>early June</strong>.
      Once shipping starts, delivery can take up to six weeks.
    </p>

      <p tal:condition="view/is_edubuntu">
        Edubuntu CDs are available only in the <strong>PC</strong> Edition. 
        This runs on x86-based systems like Intel Pentium and AMD Athlon.
      </p>

    <tal:not-edubuntu condition="not: view/is_edubuntu">
      <p>
        Different <span tal:replace="view/flavour/title" /> CDs are made
        for different types of computer:
      </p>

      <ul>
        <li>
          <strong>PC</strong> Edition, for almost all PCs,
          including x86-based systems like Intel Pentium and AMD
          Athlon. Choose this if you are unsure.
        </li>

        <li>
          <strong>64-bit PC</strong> Edition, for computers
          based on the AMD64 or EM64T architecture (e.g., Athlon64, Opteron,
          EM64T Xeon).
        </li>

        <li tal:condition="not: view/is_kubuntu">
          <strong>Mac</strong> Edition, for Apple Macintosh
          G3, G4, and G5 computers, including iBooks and PowerBooks.
        </li> 
      </ul>
    </tal:not-edubuntu>

    <!-- Without using setTimeout() to disable the submit button it'll be
    disabled before the browser generates the request, which will cause the
    request to not contain the name/value of the button.
    -->
    <form name="shipit" action="" method="post"
          onsubmit="javascript: window.setTimeout('disableSubmitButton()', 1);">

        <table style="margin: 0 auto;">
          <tbody>
            <tr>
              <th>I would like:</th>
              <td

         tal:define="selected_id view/selected_standardrequest">
      <div tal:repeat="request_type view/standardShipItRequests">
        <label>
          <input type="radio" name="ordertype"
            tal:attributes="value request_type/id;
                            checked python:request_type.id == selected_id">
          <span tal:content="request_type/description" />
        </label>
      </div>

              </td>
            </tr>
            <metal:shipping_details
              use-macro="context/@@+shipit-macros/shipping_details"
            />
            <tr>
              <td colspan="2">
                <p>
                  Please double-check your address
                  before submitting your request.
                </p>
              </td>
            </tr>
            <tr>
              <td></td>
              <td>

      <tal:current_request condition="view/current_order">
        <input type="submit" value="Change Request" name="FORM_SUBMIT"
               class="formControls"/>
      </tal:current_request>

      <tal:no_current_request condition="not: view/current_order">
        <input type="submit" value="Request CDs" name="FORM_SUBMIT"
               class="formControls"/>
      </tal:no_current_request>

              </td>
            </tr>
          </tbody>
        </table>

    </form>

  </tal:shipit-is-open>

  <tal:shipit-is-closed condition="not: view/standardShipItRequests">
    <h1>ShipIt is currently closed</h1>

    <tal:pastrequests condition="view/user/pastShipItRequests"
                      define="user view/user">
      <h2>Shipped/Cancelled requests</h2>

      <metal:pastrequests use-macro="context/@@+shipit-macros/previous_requests" />
    </tal:pastrequests>
  </tal:shipit-is-closed>

  </td>
  </tr>
  </table>  

  <script type="text/javascript">
    function disableSubmitButton() {
      var form = document.forms['shipit'];
      form.FORM_SUBMIT.disabled = true;
    }
    function updateWidgets() {
      var form = document.forms['shipit'];
      state = (form.extracds.checked == false);
      document.getElementById("field.reason").disabled = state;
    }
  updateWidgets();
  //</script>

</div>

</body>
</html>

