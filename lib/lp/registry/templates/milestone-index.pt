<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
>

<body>
  <div metal:fill-slot="main" tal:define="
    specs view/specifications;
    bugtasks view/bugtasks;
    milestone_menu view/milestone/menu:context;
    release_menu view/release/menu:context|Nothing;
    has_edit context/required:launchpad.Edit">

    <h1>
      <tal:title tal:content="view/release/title"
        condition="view/release" />
      <tal:title tal:content="context/title"
        condition="not: view/release" />
      <a tal:condition="context/required:launchpad.Edit"
        tal:attributes="href context/fmt:url/+delete"
        title="Delete this release"
        ><img src="/@@/trash-icon" alt="delete" /></a>
      <a tal:replace="structure milestone_menu/edit/fmt:icon" />
    </h1>

    <table id="Release-details">
      <tr>
        <th>Project:</th>
        <td><tal:link replace="structure context/product/fmt:link" /></td>
      </tr>
      <tr>
        <th>Series:</th>
        <td><span tal:replace="context/productseries/name" /></td>
      </tr>
      <tr>
        <th>Release version:</th>
        <td><span tal:replace="context/name" /></td>
      </tr>
      <tr>
        <th>Release code name:</th>
        <td><span tal:replace="view/milestone/code_name" /></td>
      </tr>
      <tr>
        <th>Expected:</th>
        <td><span
          tal:attributes="title context/dateexpected/fmt:datetime"
          tal:content="context/dateexpected/fmt:approximatedate" /></td>
      </tr>
      <tal:has_release condition="view/release">
      <tr>
        <th>Released:</th>
        <td><span
          tal:attributes="title view/release/datereleased/fmt:datetime"
          tal:content="view/release/datereleased/fmt:approximatedate" />
          <a tal:condition="view/release/required:launchpad.Edit"
            tal:attributes="href view/release/fmt:url/+delete"
            title="Delete this release"
            ><img src="/@@/trash-icon" title="Delete this release" /></a>
          <a tal:replace="structure release_menu/edit/fmt:icon" />
          </td>
      </tr>
      <tr>
        <th>Registrant:</th>
        <td><tal:registrant replace="structure view/release/owner/fmt:link"/></td>
      </tr>
      <tr>
        <th>When:</th>
        <td><span
          tal:attributes="title view/release/datecreated/fmt:datetime"
          tal:content="view/release/datecreated/fmt:approximatedate" /></td>
      </tr>
      </tal:has_release>
    </table>

    <tal:no_release condition="not: view/release">
      <p class="informational message" tal:condition="not: context/active">
        This is an inactive milestone.
      </p>
    </tal:no_release>

    <p class="documentDescription"
      tal:content="structure context/summary/fmt:text-to-html"
      tal:condition="context/summary">
        $ProductRelease.summary goes here. This should be quite short,
        just a single paragraph of text really, giving a summary of
        this release highlights.
    </p>

    <tal:has_release condition="view/release">
    <h2>Release notes <a tal:replace="structure release_menu/edit/fmt:icon" /></h2>
    <div id="release_notes"
         tal:content="structure view/release/release_notes/fmt:text-to-html">
        $ProductRelease.release_notes go here.
    </div>

    <p tal:condition="not: view/release/release_notes">
      <em>This release does not have release notes.
        <tal:add-release-notes condition="has_edit">
          You may want to edit it and add release notes, including new
          features and other highlights.
        </tal:add-release-notes></em>
    </p>

    <form method="POST"
          tal:attributes="action request/URL">

      <h2>Download files for this release</h2>

      <table id="downloads" class="listing">
        <thead>
          <tr>
            <th>Download</th>
            <th>Description</th>
            <th tal:condition="has_edit" width="10%">Delete</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="file view/release/files">
            <td>
              <img alt="download icon" src="/@@/download" />
              <strong><a
                tal:attributes="href python:view.fileURL(file.libraryfile)"
                tal:content="file/libraryfile/filename"
                >filename</a></strong>
              (<a tal:attributes="href python:view.md5URL(file.libraryfile)"
              >md5</a><tal:signature condition="file/signature">,
              <a tal:attributes="href python:view.fileURL(file.signature)">
              sig</a></tal:signature>)
            </td>
            <td tal:content="file/description">Installer for i386</td>
            <td tal:condition="has_edit"
                align="center">
              <input type="checkbox"
                     tal:define="cbnum string:${repeat/file/index}"
                     tal:attributes="value file/libraryfile/id;
                                     name string:checkbox_${cbnum}" />
            </td>
          </tr>
        </tbody>
      </table>

      <div tal:condition="has_edit">
        <div style="float:right">
          <input type="submit" name="delete_files" value="Delete Files"
            tal:condition="view/release/files"/>
        </div>
        <div
          tal:define="link release_menu/add_file"
          tal:condition="link/enabled">
          <a tal:replace="structure link/render">Add a file</a>
        </div>
      </div>
    </form>

    <h2>Changelog <a tal:replace="structure release_menu/edit/fmt:icon" /></h2>
    <div id="changelog"
         tal:content="structure view/release/changelog/fmt:obfuscate-email/fmt:text-to-html">
        $ProductRelease.changelog go here.
    </div>

    <p tal:condition="not: view/release/changelog">
      <em>This release does not have a changelog.</em>
    </p>
  </tal:has_release>

  <tal:has_specs condition="specs">

    <h2 id="specification-count" tal:content="view/specification_count_text" />

    <table class="listing sortable" id="milestone_specs">
      <thead>
        <tr>
          <th>Specification</th>
          <th tal:condition="view/is_project_milestone">
            Product
          </th>
          <th>Priority</th>
          <th>Assignee</th>
          <th>Delivery</th>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="spec specs">
          <td>
            <a tal:content="spec/title/fmt:shorten/60"
               tal:attributes="
                   href spec/fmt:url;
                   title spec/name">Foo Bar Baz</a>
            <img src="/@@/info" alt="Informational"
                 tal:condition="spec/informational" />
          </td>
          <td tal:condition="view/is_project_milestone">
              <span class="sortkey" tal:content="spec/product/displayname" />
              <a tal:attributes="href spec/milestone/fmt:url"
                 tal:content="spec/product/displayname" />
          </td>
          <td>
            <span class="sortkey" tal:content="spec/priority/sortkey" />
            <span tal:content="spec/priority/title"
                  tal:attributes="
                  class string:specpriority${spec/priority/name}">High</span>
          </td>
          <td>
            <a tal:condition="spec/assignee"
               tal:replace="structure spec/assignee/fmt:link" />&nbsp;
          </td>
          <td>
            <span class="sortkey"
                  tal:content="spec/implementation_status/sortkey" />
            <span tal:content="spec/implementation_status/title"
                  tal:attributes="
                  class string:specdelivery${spec/implementation_status/name}">
              Deployment
            </span>
          </td>
        </tr>
      </tbody>
    </table>

  </tal:has_specs>

  <tal:has_bugtasks condition="bugtasks">

    <h2 id="bug-count" tal:content="view/bugtask_count_text" />

    <table class="listing sortable" id="milestone_bugtasks">
      <thead>
        <tr>
          <th colspan="3">Report</th>
          <th tal:condition="view/is_project_milestone">
            Product
          </th>
          <th>Importance</th>
          <th>Assignee</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr tal:repeat="bugtask bugtasks">
          <td class="icon left">
            <span class="sortkey" tal:content="bugtask/bug/id" />
            <span tal:content="structure bugtask/image:icon" />
          </td>
          <td tal:content="bugtask/bug/id" class="amount">12345</td>
          <td>
            <a tal:attributes="href bugtask/bug/fmt:url"
               tal:content="bugtask/bug/title/fmt:shorten/65">
               Bug Title Here
            </a>
          </td>
          <td tal:condition="view/is_project_milestone">
            <span class="sortkey" tal:content="bugtask/target/displayname" />
            <a tal:attributes="href bugtask/milestone/fmt:url"
               tal:content="bugtask/target/displayname" />
          </td>
          <td>
            <span class="sortkey" tal:content="bugtask/importance/sortkey" />
            <span tal:replace="bugtask/importance/title">High</span>
          </td>
          <td>
            <a tal:condition="bugtask/assignee"
               tal:replace="structure bugtask/assignee/fmt:link" />&nbsp;
          </td>
          <td>
            <span class="sortkey" tal:content="bugtask/status/sortkey" />
            <span
                tal:content="bugtask/status/title"
                tal:attributes="
                class string:status${bugtask/status/name}">High</span>
          </td>
        </tr>
      </tbody>
    </table>

  </tal:has_bugtasks>

  <tal:neither_bugs_nor_specs condition="not: view/has_bugs_or_specs">
    <h2>No blueprints or bugs targeted</h2>
    <p>
      You do not have any feature specifications or bug tasks targeted
      to this milestone. For any given specification or bug task, you
      can target it to a milestone to keep a handy listing of things you
      want to get done in that milestone.
    </p>
  </tal:neither_bugs_nor_specs>

  <tal:has_release condition="view/release">
    <p style="clear: both"
      tal:define="link release_menu/download"
      tal:condition="link/enabled">
      <a tal:replace="structure link/render">Download RDF metadata</a>
    </p>
  </tal:has_release>
</div> 
</body>
</html>
