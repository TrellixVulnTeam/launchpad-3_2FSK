<!-- Copyright 2009 Canonical Ltd.  This software is licensed under the
     GNU Affero General Public License version 3 (see the file LICENSE).
-->

<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
>
  <body>
    <div metal:fill-slot="head_epilogue">
    <style>
    .dismissed, .dismissed a {
        color: lightgray;
    }
    </style>
    <script type="text/javascript"
      tal:condition="devmode"
      tal:define="lp_js string:${icingroot}/build"
      tal:attributes="src string:${lp_js}/translations/pofile.js"></script>
    <script type="text/javascript">
      registerLaunchpadFunction(insertAllExpansionButtons);

      YUI().use('node', 'cookie', 'anim', 'lp.pofile', function(Y) {

          var hide_notification = function(node) {
              var hide_anim = new Y.Anim({
                  node: node,
                  to: { height: 0,
                        marginTop: 0, marginBottom: 0,
                        paddingTop: 0, paddingBottom: 0 }
              });
              node.setStyle('border', 'none');
              hide_anim.set('duration', 0.4);
              hide_anim.on('end', function(e) {
                  node.setStyle('display', 'none');
              });
              hide_anim.run();
          }

          var updateNotificationBox = function(e) {
              var notice = Y.get('.important-notice-container');
              var balloon = notice.query('.important-notice-balloon');
              var dismiss_notice_cookie = ('translation-docs-for-' +
                                           documentation_cookie);

              // Check the cookie to see if the user has already dismissed
              // the notification box for this session.
              var already_seen = Y.Cookie.get(dismiss_notice_cookie, Boolean);
              if (already_seen) {
                 notice.setStyle('display', 'none');
              }

              var cancel_button = notice.query(
                  '.important-notice-cancel-button');
              // Cancel button starts out hidden.  If user has JavaScript,
              // then we want to show it.
              cancel_button.setStyle('visibility', 'visible');
              cancel_button.on('click', function(e) {
                  e.halt();
                  hide_notification(balloon);
                  Y.Cookie.set(dismiss_notice_cookie, true);
              });
          };

          Y.on('domready', Y.lp.pofile.setupSuggestionDismissal);
          Y.on('domready', updateNotificationBox);
      });
    </script>
    </div>
    <div metal:fill-slot="main">
      <script type="text/javascript"
            tal:condition="view/translation_group"
            tal:content="string:var documentation_cookie =
                            '${view/translation_group/name}' + '_'  +
                            '${context/language/code}';" />
      <script type="text/javascript"
            tal:condition="not:view/translation_group"
            tal:content="string:var documentation_cookie = 'others';" />
      <div>
        <a tal:attributes="href context/potemplate/fmt:url"
           tal:content="context/potemplate/title">
          evolution 2.10 template
        </a>
      </div>

      <tal:form-not-writeable condition="not:view/form_is_writeable">
        <h1>
          Browsing
          <tal:language replace="context/language/englishname">
            Spanish
          </tal:language>
          translation
        </h1>
      </tal:form-not-writeable>
      <tal:form-writeable condition="view/form_is_writeable">
        <h1>
          Translating into
          <tal:language replace="context/language/englishname">
            Spanish
          </tal:language>
        </h1>
      </tal:form-writeable>

        <!-- Documentation links -->
        <tal:documentation condition="view/translation_group">
          <div class="important-notice-container"
               tal:condition="view/has_any_documentation">
            <div class="important-notice-balloon">
              <div class="important-notice-buttons">
                <img class="important-notice-cancel-button" src="/@@/no"
                     alt="Don't show this notice anymore"
                     title="Hide this notice for the duration of this session" />
              </div>
              <img src="/@@/info" alt="Information" />
              <span class="important-notice"
                  tal:condition="view/translation_group/translation_guide_url">
                Before translating, be sure to go through
                <a tal:content="string:${view/translation_group/title}
                                instructions"
                   tal:attributes="href
                        view/translation_group/translation_guide_url">
                  translation instructions</a><!--
             --><tal:has_team
                   condition="view/translation_team"><!--
                  --><tal:has_guidelines
                      tal:condition="view/translation_team/style_guide_url">
                  and <a class="style-guide-url"
                         tal:attributes="
                           href view/translation_team/style_guide_url"
                         tal:content="string:${context/language/englishname}
                                      guidelines">Serbian guidelines</a><!--
               --></tal:has_guidelines><!--
             --></tal:has_team>.
              </span>
              <span class="important-notice"
                  tal:condition="not:view/translation_group/translation_guide_url">
                Before translating, be sure to go through
                <a class="style-guide-url"
                   tal:content="string:${view/translation_team/translator/displayname}
                                guidelines"
                   tal:attributes="href view/translation_team/style_guide_url">
                  Serbian guidelines</a>.
              </span>
            </div>
          </div>
        </tal:documentation>

      <tal:havepluralforms condition="view/has_plural_form_information">

        <!-- Search box -->
        <form id="search_form" method="get" style="float: right;"
              action="+translate">
          <tal:comment condition="nothing">
            the hidden elements
          </tal:comment>
          <input type="hidden" name="batch" value=""
                 tal:attributes="value view/size" />
          <input type="hidden" name="show" value="all" />
          <label for="search_box">Search:</label>
          <input id="search_box" type="text" name="search"
                 title="Enter text to search for"
                 tal:attributes="value view/search_text" />
        </form>

        <!-- View filter and suggestions from alternative language. -->
        <form method="get" style="text-align: left;" action="+translate">
          <!-- the hidden elements -->
          <input type="hidden" name="start" value=""
                 tal:attributes="value view/start" />
          <input type="hidden" name="batch" value=""
                 tal:attributes="value view/size" />

          <tal:comment tal:replace="nothing">
            The 'selected' attribute value in next select means basically
            the following:

            if request.form['show'] == literalvalue:
                return 'selected'
            else:
                return None

            Where 'literalvalue' is 'all', 'untranslated' 'fuzzy' or
            'translated'.
          </tal:comment>

          <p>
            <label>
              Translating
              <tal:XXX tal:replace="nothing">
                # XXX: JeroenVermeulen 2008-06-18 bug=240897: Try doing this
                # the Zope way, with an interface.
              </tal:XXX>
              <select id="show_selector" name="show"
                      title="Choose which items to show">
                <option value="all"
                  tal:attributes="selected
                  request/htmlform:show/selected/all"
                  >
                  all items
                </option>
                <option value="untranslated"
                  tal:attributes="selected
                  request/htmlform:show/selected/untranslated"
                  >
                  untranslated items
                </option>
                <option value="translated"
                  tal:attributes="selected
                  request/htmlform:show/selected/translated"
                  >
                  translated items
                </option>
                <option value="new_suggestions"
                  tal:attributes="selected
                  request/htmlform:show/selected/new_suggestions"
                  >
                  items with new suggestions
                </option>
                <option value="changed_in_launchpad"
                  tal:attributes="selected
                  request/htmlform:show/selected/changed_in_launchpad"
                  >
                  items changed in Launchpad
                </option>
              </select>
            </label>
            <label> using
              <tal:comment replace="nothing">
                Suggestions from this alternative language will be displayed
                as well as suggestions from the translation language. In the
                case where two languages are very similar it will often be
                useful to show the second language as a source of suggestions
                when translating into the first.
              </tal:comment>
              <tal:language-widget
                content="structure view/alternative_language_widget" />
            as a guide</label>
          </p>
          <input type="hidden" name="old_show" value=""
            tal:attributes="value view/show" />
          <input type="submit" value="Change" />
        </form>

        <!-- The translation form. -->
        <tal:block condition="not:view/batchnav/currentBatch">
          <div class="documentDescription">
            There are no messages that match this filtering.
          </div>
        </tal:block>

        <tal:block condition="view/batchnav/currentBatch">
          <form method="POST" action="">
            <!-- the hidden elements -->
            <input type="hidden" name="show" value=""
                   tal:attributes="value view/show" />
            <input type="hidden" name="start" value=""
                   tal:attributes="value view/start" />
            <input type="hidden" name="batch" value=""
                   tal:attributes="value view/size" />
            <input type="hidden" name="lock_timestamp" value=""
                   tal:condition="view/form_is_writeable"
                   tal:attributes="value view/lock_timestamp/isoformat" />
            <table class="listing" style="margin-top: 0.5em;">
              <thead>
                <tr class="results">
                  <td colspan="5">
                    <!-- Paging doodads. -->
                    <tal:navigation replace="structure view/batchnav/@@+navigation-links-upper" />
                  </td>
                </tr>
              </thead>
              <tbody class="greater" id="messages_to_translate">
                <tal:loop repeat="translationmessage_view view/translationmessage_views">
                  <div tal:replace="structure translationmessage_view" />
                </tal:loop>
                <tr tal:condition="view/form_is_writeable">
                  <td colspan="4">
                    Translated so far:
                    <tal:completeness replace="view/completeness" />
                  </td>
                  <td style="text-align: right;">
                    <input type="submit"
                           name="submit_translations"
                           value="Save &amp; Continue"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </form>

          <!-- Paging doodads. -->
          <tal:navigation
            replace="structure view/batchnav/@@+navigation-links-lower" />
        </tal:block>
        <tal:status replace="structure context/@@+access" />
        <tal:contributors replace="structure context/@@+contributors" />
      </tal:havepluralforms>
    </div>
  </body>
</html>
