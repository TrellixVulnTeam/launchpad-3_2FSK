  Let's test the /myrequest page, where users place new requests and/or change
  existing ones.

  First of all, we'll make sure a request is accepted only if all required 
  fields are filled.

  >>> print http(r"""
  ... POST /shipit-ubuntu/++vh++http:shipit.async.com.br:80/++/myrequest HTTP/1.1
  ... Authorization: Basic Zm9vLmJhckBjYW5vbmljYWwuY29tOnRlc3Q=
  ... 
  ... ordertype=1&field.reason=&field.recipientdisplayname=&field.organization=&field.addressline1=&field.addressline2=&field.city=&field.province=&field.postcode=&field.country=&field.country-empty-marker=1&field.phone=&FORM_SUBMIT=Request+CDs""")
  HTTP/1.1 200 Ok
  ...
  ...<title>Your ShipIt Request</title>...
  ...
  ...Please fix the problems below and try again...
  ...
    <th>Name</th>
  ...
      <div>Required input is missing.</div>
  ...
    <th>Address</th>
  ...
      <div>Required input is missing.</div>
  ...
    <th>City/Town/etc</th>
  ...
      <div>Required input is missing.</div>
  ...
    <th>Country</th>
  ...
      <div>Required input is missing.</div>
  ...
    <th>Phone</th>
  ...
      <div>Required input is missing.</div>
  ...


  For some countries like the US, our shipping company requires a postcode, so
  we can't accept a request from the US without a postcode.

  >>> print http(r"""
  ... POST /shipit-ubuntu/++vh++http:shipit.async.com.br:80/++/myrequest HTTP/1.1
  ... Authorization: Basic Zm9vLmJhckBjYW5vbmljYWwuY29tOnRlc3Q=
  ... 
  ... ordertype=1&field.reason=&field.recipientdisplayname=Foo+Bar&field.organization=&field.addressline1=street&field.addressline2=&field.city=city&field.province=state&field.postcode=&field.country=226&field.country-empty-marker=1&field.phone=453523452&FORM_SUBMIT=Request+CDs""")
  HTTP/1.1 200 Ok
  ...
  ...Please fix the problems below and try again...
  ...Shipping to your country requires a postcode, but you didn't provide...
  ...one. Please enter one below...
  ...


  Now we fill in all the required fields and the request is accepted. The
  request is automatically approved because the user can only choose the
  number of CDs from a list of predefined options.

  >>> print http(r"""
  ... POST /shipit-ubuntu/++vh++http:shipit.async.com.br:80/++/myrequest HTTP/1.1
  ... Authorization: Basic Zm9vLmJhckBjYW5vbmljYWwuY29tOnRlc3Q=
  ... 
  ... ordertype=1&field.reason=&field.recipientdisplayname=Foo+Bar&field.organization=&field.addressline1=street&field.addressline2=&field.city=city&field.province=state&field.postcode=42423&field.country=226&field.country-empty-marker=1&field.phone=453523452&FORM_SUBMIT=Request+CDs""")
  HTTP/1.1 200 Ok
  ...
  ...Request accepted. Please note that requests usually take from 4 to 6...
  ...weeks to deliver, depending on the country of shipping...
  ...

  >>> from canonical.launchpad.database import Person
  >>> Person.byName('name16').currentShipItRequest().approved
  True


  If we add a comment asking for more CDs, this request is then marked as
  pending approval and an email is sent to the shipit admins, so they can
  either approve or deny the extra CDs the user requested.

  >>> print http(r"""
  ... POST /shipit-ubuntu/++vh++http:shipit.async.com.br:80/++/myrequest HTTP/1.1
  ... Authorization: Basic Zm9vLmJhckBjYW5vbmljYWwuY29tOnRlc3Q=
  ... 
  ... ordertype=1&field.reason=Yes%2C+I+want+more%21+I%27m+going+to+a+big+Ubuntu+conference+in+Antarctica+and+I%27d+like+to+share+the+love+with+my+friends+%28penguins+and+polar+bears%29.&field.recipientdisplayname=Foo+Bar&field.organization=&field.addressline1=street&field.addressline2=&field.city=city&field.province=state&field.postcode=42423&field.country=226&field.country-empty-marker=1&field.phone=453523452&FORM_SUBMIT=Change+Request""")
  HTTP/1.1 200 Ok
  ...
  ...Request accepted...
  ...

  >>> Person.byName('name16').currentShipItRequest().approved is None
  True

  >>> import email, re
  >>> from canonical.launchpad.mail import stub
  >>> from_addr, to_addrs, raw_msg = stub.test_emails.pop()
  >>> to_addrs
  ['info@shipit.ubuntu.com']


  It's also possible to cancel an existing request.

  >>> print http(r"""
  ... POST /shipit-ubuntu/++vh++http:shipit.async.com.br:80/++/myrequest HTTP/1.1
  ... Authorization: Basic Zm9vLmJhckBjYW5vbmljYWwuY29tOnRlc3Q=
  ... 
  ... order=17&cancel=Cancel+Request""")
  HTTP/1.1 200 Ok
  ...
  ...Request Cancelled...
  ...Shipped/Cancelled requests...
  ...
  ...10 CDs requested in...
  ...

  >>> Person.byName('name16').currentShipItRequest() is None
  True
