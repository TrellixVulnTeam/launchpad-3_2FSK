<tal:do-this-first condition="view/processForm" />
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

  <div metal:fill-slot="body">

  <tal:block condition="view/standardShipItRequests"
             define="order view/order">

    <table>
    <tbody>
    <tr>
    <td width="80%">
  
    <tal:block condition="view/orderIsCancelledOrShipped">
      <h1 tal:condition="order/cancelled">This order was cancelled</h1>
      <h1 tal:condition="order/shipment">This order was already shipped</h1>
    </tal:block>

    <tal:block condition="not: view/orderIsCancelledOrShipped">

      <tal:block condition="view/orderCreated">
        <br />
        <p class="portalMessage">New request
          <tal:block condition="view/userIsShipItAdmin">
            #<span tal:content="order/id" />
          </tal:block>
          accepted.
        </p>
      </tal:block>

      <tal:block condition="view/orderChanged">
        <br />
        <p class="portalMessage">Request changed.</p>
      </tal:block>

      <tal:block condition="view/hasErrorMessages">
        <br />
        <p class="portalErrorMessage">There were errors in your request:
        please see the messages below.</p>
      </tal:block>

    <tal:block condition="view/shouldShowOrderDetails">

      <tal:block condition="not: view/userIsShipItAdmin">
        <h1>Previous requests you made</h1>

        <ul>
          <li tal:repeat="pastorder view/user/pastShipItRequests">
            <span tal:replace="pastorder/daterequested/fmt:date" />:
            <span tal:replace="pastorder/totalCDs" /> CDs 
            <span tal:condition="pastorder/cancelled">(cancelled)</span>
            <span tal:condition="pastorder/shipment">(sent to shipping
              company)</span>
            <span tal:condition="not: pastorder/approved">(denied)</span>
          </li>
        </ul>
           
      </tal:block>

      <tal:block condition="not: order">
        <h1>How many CDs would you like?</h1> 

        <p>Shipping small numbers of CDs costs almost the same as shipping
        one, so please feel free to request multiple CDs to give away and
        share with friends.</p>
      </tal:block>

      <tal:block condition="order">
        <h1>Your current ShipIt request</h1>

        <table cols="2">
          <tr>
            <th>Date Requested:</th>
            <td tal:content="order/daterequested/fmt:date" />
          </tr>
          <tr>
            <th>Status:</th>
            <td>
              <span tal:condition="order/approved">
                Approved
              </span>
              <span tal:condition="not: order/approved">
                Waiting for approval
              </span>
          </tr>
          <tr tal:condition="order/quantityx86">
            <th>PC CDs:</th>
            <td tal:content="order/quantityx86" />
          </tr>
          <tr tal:condition="order/quantityamd64">
            <th>64-bit PC CDs:</th>
            <td tal:content="order/quantityamd64" />
          </tr>
          <tr tal:condition="order/quantityppc">
            <th>Mac CDs:</th>
            <td tal:content="order/quantityppc" />
          </tr>
        </table>

        <div>
          <form name="cancelrequest" action="" method="POST">
            <input type="hidden" name="order" 
                   tal:attributes="value order/id|nothing" />

            <input type="submit" value="Cancel Request" name="cancelrequest"
                   class="formControls"/>
          </form>
        </div>

      </tal:block>
        
      <tal:block condition="not: order">
        <p>Ubuntu CDs are made specifically for various types of
        computers.</p>

        <ul>
          <li>The <strong>PC</strong> Edition will run on almost all PCs.
          This includes most machines with Intel/AMD/etc type processors
          and computers that can also run Microsoft Windows. Choose this
          if you are unsure.</li>

          <li>The <strong>64-bit PC</strong> Edition will run on computers
          based on the AMD64 or EM64T architecture (e.g., Athlon64, Opteron,
          EM64T Xeon).</li>

          <li>The <strong>Mac</strong> Edition will run on Apple Macintosh
          G3, G4, and G5 computers including iBooks and PowerBooks.</li> 
        </ul>

        <br />
      </tal:block>

      <tal:block condition="not: order">
        <h2>Request Details</h2>
      </tal:block>

      <tal:block condition="order">
        <h2>Change Request Details</h2>

        <p>You can change your request details as many times you want, but
        doing so may require your request to be approved again.</p>
      </tal:block>

      <tal:block condition="view/orderFormMessages">
        <p class="portalErrorMessage" tal:repeat="msg view/orderFormMessages"
        tal:content="msg" />
      </tal:block>
      <br />
      </tal:block>

      <form name="shipit" action="" method="POST">
      <tal:block condition="view/shouldShowOrderDetails">

      <table cols="2">
        <tr>
          <td>
            <label>
              <input type="radio" name="ordertype" value="standard" 
                     onClick="javascript: updateWidgets()"
                     tal:attributes="checked not:view/isCustomOrder" />
              Standard request
            </label>
            <div style="margin: 0em 2em">
              <div>The standard requests are more likely to be approved than 
                custom ones, so unless you have special requirements, you 
                should choose a standard one.
              </div>
              <select name="standardrequest" class="listing">
                <tal:block tal:condition="view/selectedOrderType|nothing">
                  <option tal:repeat="request view/standardShipItRequests"
                          tal:attributes="
                            value request/id;
                            selected python: view.selectedOrderType == request.id"
                          tal:content="request/description">
                    Request description
                  </option>
                </tal:block>
                <tal:block tal:condition="not: view/selectedOrderType|nothing">
                  <option tal:repeat="request view/standardShipItRequests"
                          tal:attributes="value request/id; selected request/isdefault"
                          tal:content="request/description">
                    Request description
                  </option>
                </tal:block>
              </select>
            </div>
                      
          </td>
        </tr>
        <tr>
          <td>
          </td>
        </tr>
        <tr>
          <td>
            <label>
              <input type="radio" name="ordertype" value="custom"
                     onClick="javascript: updateWidgets()"
                     tal:attributes="checked view/isCustomOrder"/>
              Custom request
            </label>

            <div style="margin: 0em 2em">
            <table>
              <tr>
                <th>PC:</th>
                <td>
                  <tal:block tal:condition="view/isCustomOrder">
                    <input tal:attributes="value view/quantityx86" 
                           type="text" size="4" align="right" 
                           maxlength="4" name="quantityx86" />
                  </tal:block>
                  <tal:block tal:condition="not: view/isCustomOrder">
                    <input type="text" size="4" align="right" 
                           maxlength="4" name="quantityx86" />
                  </tal:block>
                </td>
                <th>64-bit PC:</th>
                <td>
                  <tal:block tal:condition="view/isCustomOrder">
                    <input tal:attributes="value view/quantityamd64" 
                           type="text" size="4" align="right" 
                           maxlength="4" name="quantityamd64">
                  </tal:block>
                  <tal:block tal:condition="not: view/isCustomOrder">
                    <input type="text" size="4" align="right" 
                           maxlength="4" name="quantityamd64" />
                  </tal:block>
                </td>
                <th>Mac:</th>
                <td>
                  <tal:block tal:condition="view/isCustomOrder">
                    <input tal:attributes="value view/quantityppc" 
                           type="text" size="4" align="right" 
                           maxlength="4" name="quantityppc" />
                  </tal:block>
                  <tal:block tal:condition="not: view/isCustomOrder">
                    <input type="text" size="4" align="right" 
                           maxlength="4" name="quantityppc" />
                  </tal:block>
                </td>
              </tr>
              <tr>
                <td colspan="6">
                </td>
              </tr>
              <tr>
                <td colspan="6">
                    <strong>Reason for custom request, in English:</strong>
                    <span class="formHelp">(required)</span>
                    <textarea name="reason" rows="4"
                              tal:content="view/reason|nothing" />
                </td>
              </tr>
            </table>
            </div>
          </td>
        </tr>
      </table>
      </tal:block>

      <h1>Shipping Address</h1>

      <tal:block condition="view/addressFormMessages">
        <p class="portalErrorMessage" tal:repeat="msg view/addressFormMessages" 
           tal:content="msg" />
        <br />
      </tal:block>

      <table>
        <tr>
          <th>Name:</th>
          <td>
            <input 
              name="recipientdisplayname" size="20" maxlength="20" type="text"
              tal:attributes="value view/recipientdisplayname|
                                    order/recipientdisplayname|
                                    nothing">
            <span class="formHelp">(required)</span>
        </tr>
        <tr>
          <th>Organization:</th>
          <td>
            <input 
              name="organization" size="30" maxlength="30" type="text"
              tal:attributes="value view/organization|order/organization|nothing">
          </td>
        </tr>
        <tr>
          <th>Address:</th>
          <td>
            <input 
              type="text" name="addressline1" size="30" maxlength="30"
              tal:attributes="value view/addressline1|order/addressline1|nothing" />
            <span class="formHelp">(required)</span>
          </td>
        </tr>
        <tr>
          <td align="right"></td>
          <td>
            <input 
              tal:attributes="value view/addressline2|order/addressline2|nothing"
              type="text" name="addressline2" size="30" maxlength="30" />
          </td>
        </tr>
        <tr>
          <th>City/Town/etc:</th>
          <td>
            <input
              tal:attributes="value view/city|order/city|nothing" type="text"
              name="city" size="30" maxlength="30" />
            <span class="formHelp">(required)</span>
          </td>
        </tr>
        <tr>
          <th>State/Province:</th>
          <td>
            <input
              tal:attributes="value view/province|order/province|nothing"
              type="text" name="province" size="30" maxlength="30" />
          </td>
        </tr>
        <tr>
          <th>Postcode:</th>
          <td>
            <input
              tal:attributes="value view/postcode|order/postcode|nothing"
              type="text" name="postcode" size="12" maxlength="12" />
          </td>
        </tr>
        <tr>
          <th>Country:</th>
          <td>
            <span tal:replace="structure view/country_widget" />
            <span class="formHelp">(required)</span>
          </td>
        </tr>
        <tr>
          <th>Phone:</th>
          <td>
            <input 
              tal:attributes="value view/phone|order/phone|nothing"
              type="text" name="phone" size="16" maxlength="16" />
          </td>
        </tr>
      </table>

      <input type="hidden" name="order" 
             tal:attributes="value order/id|nothing" />

      <div style="text-align: right">
        <tal:block condition="not: order">
          <input type="submit" value="Request CDs" name="newrequest"
                 class="formControls"/>
        </tal:block>

        <tal:block condition="order">
          <input type="submit" value="Change Request Details" 
                 class="formControls" name="changerequest" />
        </tal:block>
      </div>

      </form>

      <tal:block condition="view/shouldShowOrderDetails">

      <tal:block condition="order">
        <p>Ubuntu CDs are made specifically for various types of
        computers.</p>

        <ul>
          <li>The <strong>PC</strong> Edition will run on almost all PCs.
          This includes most machines with Intel/AMD/etc type processors
          and computers that can also run Microsoft Windows. Choose this
          if you are unsure.</li>

          <li>The <strong>64-bit PC</strong> Edition will run on computers
          based on the AMD64 or EM64T architecture (e.g., Athlon64, Opteron,
          EM64T Xeon).</li>

          <li>The <strong>Mac</strong> Edition will run on Apple Macintosh
          G3, G4, and G5 computers including iBooks and PowerBooks.</li> 
        </ul>

        <br />
      </tal:block>
      <script type="text/javascript">
        function updateWidgets() {
          var form = document.forms['shipit'];
          state = (form.ordertype[0].checked == false);
          form.standardrequest.disabled = state;
          form.quantityx86.disabled = ! state;
          form.quantityppc.disabled = ! state;
          form.quantityamd64.disabled = ! state;
          form.reason.disabled = ! state;
          // XXX: would be nice to focus quantityx86 and standardrequest
        }
      updateWidgets();
      //</script>

    </tal:block>
    </tal:block>

    </td>
    <td tal:condition="view/userIsShipItAdmin"
        width="20%" style="vertical-align: top;"
        tal:content="structure context/@@+portlet-navigation" />
    </tr>
    </table>  
  </tal:block>

  <tal:block condition="not: view/standardShipItRequests">
    <h1>ShipIt is not yet open for new orders</h1>
  </tal:block>

  </div>

</body>
</html>
