================
Product Set Page
================

Under "/projects" there are several pages for various administration tasks.

The pages are "+review-licenses", "+new", and "+all".

== Review project licenses ==

The page +review-licenses is accessible from the /projects page via
the "Review licenses" link, which is conditionally available
based on permissions.

A member of the Launchpad registry experts team may successfully access the
+review-licenses via the link.

    >>> login('foo.bar@canonical.com')
    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces.launchpad import (
    ...     ILaunchpadCelebrities)
    >>> registry_member = factory.makePerson(
    ...     name='reggie', email='reggie@example.com', password='test')
    >>> celebs = getUtility(ILaunchpadCelebrities)
    >>> registry = celebs.registry_experts
    >>> registry.addMember(registry_member, registry.teamowner)
    >>> logout()

    >>> registry_browser = setupBrowser(
    ...     auth='Basic reggie@example.com:test')
    >>> registry_browser.open(
    ...     'http://launchpad.dev/projects/')
    >>> registry_browser.getLink("Review projects").click()
    >>> registry_browser.url
    'http://launchpad.dev/projects/+review-licenses'
    >>> registry_browser.title
    'Review projects'


Searching from +review_licenses
===============================

The search parameters that filter on a boolean value can
be left unspecified to get results with either value.

    >>> for name in ('active', 'license_reviewed', 'has_zero_licenses',
    ...              'license_info_is_empty'):
    ...     control = registry_browser.getControl(name='field.%s' % name)
    ...     for option in control.displayOptions:
    ...         print option.decode('utf-8').encode('ascii', 'replace'),
    ...     print
    ?(do not filter) ?True ?False
    ?(do not filter) ?True ?False
    ?(do not filter) ?True ?False
    ?(do not filter) ?Empty ?Not Empty

The default form values will search for active projects that have not
been reviewed and that have an Other/Open-Source or Other/Proprietary
license.

    >>> registry_browser.getControl(name='field.active').value
    ['True']
    >>> registry_browser.getControl(name='field.license_reviewed').value
    ['False']
    >>> registry_browser.getControl(name='field.licenses').value
    ['OTHER_PROPRIETARY', 'OTHER_OPEN_SOURCE']

If there are no products that match the search conditions, a warning
message will be displayed.

    >>> registry_browser.getControl(name='field.active').value = ['False']
    >>> registry_browser.getControl(name='search').click()
    >>> find_tags_by_class(registry_browser.contents, 'warning message')
    [<div...No items found with these search options...

If enough projects are found, the results are paginated. A link
is provided for each product pointint to its +review-license page.

    >>> registry_browser.getControl(name='field.active').value = ['True']
    >>> registry_browser.getControl(name='field.licenses').value = []
    >>> registry_browser.getControl(
    ...     name='field.license_info_is_empty').value = ['Empty']
    >>> registry_browser.getControl(name='field.created_before').value = (
    ...     '2007-01-01')
    >>> registry_browser.getControl(name='search').click()
    >>> pagination = find_tags_by_class(registry_browser.contents,
    ...                                 'batch-navigation-index')
    >>> text_in_elements = pagination[0].findAll(text=True)
    >>> print ' '.join(text.strip() for text in text_in_elements)
    1 ... 10 of 14 results
    >>> table = find_tag_by_id(registry_browser.contents, 'product-listing')
    >>> for tr in table.findAll('tr'):
    ...     td_list = tr.findAll('td')
    ...     print td_list[5].a
    <a href="/arch-mirrors/+review-license">Review</a>
    <a href="/bazaar/+review-license">Review</a>
    <a href="/evolution/+review-license">Review</a>
    <a href="/gnome-terminal/+review-license">Review</a>
    <a href="/applets/+review-license">Review</a>
    <a href="/launchpad/+review-license">Review</a>
    <a href="/firefox/+review-license">Review</a>
    <a href="/thunderbird/+review-license">Review</a>
    <a href="/netapplet/+review-license">Review</a>
    <a href="/landscape/+review-license">Review</a>
    >>> registry_browser.getLink('Next').click()
    >>> print registry_browser.url
    http://launchpad.dev/projects/+review-licenses?field...&start=10

Now, we can click on the Review link, which will take us to the
$project/+review-license page. Then clicking on the Change button
will take us back to the page we came from.

    >>> review_link = registry_browser.getLink(
    ...     url='/tomcat/+review-license')
    >>> review_link.text
    'Review'
    >>> review_link.click()
    >>> print registry_browser.url
    http://launchpad.dev/tomcat/+review-license
    >>> registry_browser.getControl(name='field.actions.change').click()
    >>> print registry_browser.url
    http://launchpad.dev/projects/+review-licenses?field...&start=10


Project list shows license status
=================================

The project list will show (Proprietary) next to projects with a
proprietary license, (Unspecified) next to projects without
any license and (Unreviewed) next to projects with an unreviewed
Other/OpenSource license.

First, add a product with a Other/Open Source license.

    >>> user_browser.open('http://launchpad.dev/products/+new')
    >>> user_browser.getControl('URL').value = 'other-open-source'
    >>> user_browser.getControl('Name').value = 'Other-Open-Source Product'
    >>> user_browser.getControl('Title').value = 'title'
    >>> user_browser.getControl('Summary').value = 'summary'
    >>> user_browser.getControl('Continue').click()

    >>> user_browser.getControl(name='field.description').value = 'description'
    >>> user_browser.getControl(name='field.licenses').value = [
    ...     'OTHER_OPEN_SOURCE']
    >>> user_browser.getControl(name='field.license_info').value = 'foo'
    >>> user_browser.getControl('Complete Registration').click()
    >>> print user_browser.url
    http://launchpad.dev/other-open-source

    >>> user_browser.open('http://launchpad.dev/projects/+all')
    >>> div = find_tag_by_id(user_browser.contents, 'product-listing')
    >>> for subdiv in div.next.findNextSiblings('div'):
    ...     pillar = subdiv.find()
    ...     print ''.join(pillar.findAll(text=True))
    ...     print '     ', pillar.get('title')
    Other-Open-Source Product (Unreviewed)
          This project&rsquo;s license has not been reviewed.
    Obsolete Junk
          None
    Launchpad Translations (Unspecified)
          This project&rsquo;s license has not been specified.
    Mega Money Maker (Proprietary)
          This project&rsquo;s license is proprietary.
    Derby
          None


If an open source project adds a proprietary license then the project
will be displayed as proprietary.

    >>> user_browser.open('http://launchpad.dev/other-open-source')
    >>> user_browser.getLink('Change details').click()
    >>> user_browser.getControl(name='field.licenses').value = [
    ...     'OTHER_OPEN_SOURCE', 'OTHER_PROPRIETARY']
    >>> user_browser.getControl('Change').click()
    >>> user_browser.open('http://launchpad.dev/projects/+all')
    >>> div = find_tag_by_id(user_browser.contents, 'product-listing')
    >>> for subdiv in div.next.findNextSiblings('div'):
    ...     pillar = subdiv.find()
    ...     print ''.join(pillar.findAll(text=True))
    ...     print '     ', pillar.get('title')
    Other-Open-Source Product (Proprietary)
          This project&rsquo;s license is proprietary.
    Obsolete Junk
          None
    Launchpad Translations (Unspecified)
          This project&rsquo;s license has not been specified.
    Mega Money Maker (Proprietary)
          This project&rsquo;s license is proprietary.
    Derby
          None


View all projects
=================

The unprivileged user can see "+all".

    >>> user_browser.open('http://launchpad.dev/projects/+all')
    >>> print user_browser.title
    +all : Projects

The commercial user can also view "+all".

    >>> registry_browser.open('http://launchpad.dev/projects/+all')
    >>> print registry_browser.title
    +all : Projects


Create a project
================

The unprivileged user can see "+new".

    >>> user_browser.open('http://launchpad.dev/projects/+new')
    >>> print user_browser.title
    +new : Projects

The commercial user can also view "+new".

    >>> registry_browser.open('http://launchpad.dev/projects/+new')
    >>> print registry_browser.title
    +new : Projects
