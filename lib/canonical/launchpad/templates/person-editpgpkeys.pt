<tal:do-this-first condition="view/form_action" />
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
    i18n:domain="launchpad"
>
  <body>
    <metal:heading fill-slot="pageheading">
      <h1>OpenPGP keys</h1> 
    </metal:heading>

  <metal:leftportlets fill-slot="portlets_one">
  </metal:leftportlets>

  <metal:rightportlets fill-slot="portlets_two">
    <div tal:replace="structure context/@@+portlet-details" />
  </metal:rightportlets>

  <div metal:fill-slot="main">

    <p tal:condition="view/error_message" tal:content="view/error_message"
      class="error message">Error message.</p>
    
    <p tal:condition="view/info_message" tal:content="view/info_message"
      class="informational message">Informational message.</p>
    
    <p>
      Launchpad lets you register OpenPGP keys,
      created by software such as GnuPG.
      These are used to sign <a href="/codeofconduct">codes of conduct</a>,
      and to build and upload packages using <abbr>HCT</abbr>.
    </p>

    <form tal:condition="view/gpgkeysCount" 
          name="gpg_actions" action="" method="POST">
      <input type="hidden" name="action" value="deactivate_gpg" />

      <h2>Valid keys</h2>

      <div tal:repeat="key context/gpgkeys">
        <label>
          <input type="checkbox" name="DEACTIVATE_GPGKEY"
                 tal:attributes="value key/id"/>
          <span tal:replace="key/displayname">KEY</span>
          <tal:block condition="not:key/can_encrypt">(sign only)</tal:block>
        </label>
      </div>
      <div><input type="submit" value="Deactivate Key" /></div>

      <p><dfn>Deactivating</dfn> a key <em>applies only to Launchpad</em>
      and not anywhere else. If you deactivate a key, it
      will automatically deactivate any feature that uses that key, such
      as a signed code of conduct, or the ability to comment on a bug
      report by e-mail.</p>

    </form>

    <form tal:condition="context/pendinggpgkeys" name="gpg_actions" 
          action="" method="POST">
      <input type="hidden" name="action" value="remove_gpgtoken" />

      <h2>Keys pending validation</h2>

      <div>
        <label tal:repeat="fingerprint context/pendinggpgkeys">
          <input type="checkbox" name="REMOVE_GPGTOKEN"
                 tal:attributes="value fingerprint"/>
          <span tal:replace="fingerprint">TOKEN</span>
        </label>
      </div>

      <p>If any of the fingerprints above is not from one of your valid
      keys, please select it and cancel its validation.</p>

      <input type="submit" value="Cancel Validation for Selected Keys" />
    </form>

    <form tal:condition="context/inactivegpgkeys" name="gpg_actions"
          action="" method="POST">
      <input type="hidden" name="action" value="revalidate_gpg" />

      <h2>Deactivated keys</h2>

      <p>If you changed your mind about deactivating a key, you can
      <dfn>revalidate</dfn> it.</p>

      <div tal:repeat="key context/inactivegpgkeys">
        <label>
        <input type="checkbox" name="REVALIDATE_GPGKEY"
               tal:attributes="value key/id"/>
          <span tal:replace="key/displayname">KEY</span>
          <tal:block condition="not:key/can_encrypt">(sign only)</tal:block>
        </label>
      </div>
      <input type="submit" value="Revalidate Key" />
    </form>

    <form name="gpg_actions" action="" method="POST">
      <input type="hidden" name="action" value="claim_gpg" />
      <h2>Importing an OpenPGP key</h2>
      <ol>
        <li>
          Ensure you already have a key. In a terminal window, enter:
          <pre>gpg --list-keys <var>your@e-mail.address</var></pre>
          If you have no key, create one:
          <pre>gpg --gen-key</pre>
        </li>
        <li>
          Ensure the key has been uploaded to a keyserver. To do this:
          <pre>gpg --send-key <var>key-id</var></pre>
        </li>
        <li>
          Enter your key fingerprint. Use:
          <pre>gpg --fingerprint <var>key-id</var></pre>
          <table>
            <tbody>
              <tr>
                <th><label>Fingerprint:</label></th>
                <td><input type="text" name="fingerprint" /></td>
              </tr>
              <tr class="discreet">
                <th>Example:</th>
                <td>
                  <code>27E0 7815 B47C 0397 90D5&nbsp;&nbsp;8589 27D9 A27B F3F9 6058</code>
                </td>
              </tr>
            </tbody>
          </table>
          <p>
            Launchpad will e-mail
            <code tal:content="context/preferredemail/email"/> with instructions
            on finishing the process.
          </p>
          <div><input type="submit" value="Import Key"/></div>
        </li>
      </form>
    </div>
  </body>
</html>
