= Creating new sprints =

We should also be able to create a new sprint. We do this off the Sprints
+new page.

  >>> user_browser.open('http://launchpad.dev/sprints/+new')

  >>> user_browser.title
  'Register a meeting or sprint in Launchpad'

First we'll test the name field validator.

  >>> user_browser.getControl('Name').value = 'LTSponsteroids'
  >>> user_browser.getControl('Title').value = 'LTSP On Steroids'
  >>> summary = 'This is a sprint summary. Some words about the sprint'
  >>> user_browser.getControl('Summary').value = summary
  >>> user_browser.getControl('Driver').value = 'kamion'
  >>> user_browser.getControl('Home Page').value = 'http://www.willy.net'
  >>> user_browser.getControl('Timezone').value = ['UTC']
  >>> user_browser.getControl(
  ...     'Starting Date and Time').value = '10 Oct 2006 09:15'
  >>> user_browser.getControl(
  ...     'Finishing Date and Time').value = '13 Oct 2006 16:00'
  >>> user_browser.getControl('Add Sprint').click()

  >>> for tag in find_tags_by_class(user_browser.contents, 'message'):
  ...     print tag.renderContents()
  There is 1 error.
  <BLANKLINE>
  Invalid name 'LTSponsteroids'. Names must start with a letter or
  number and be lowercase. The characters <samp>+</samp>,
  <samp>-</samp> and <samp>.</samp> are also allowed after the
  first character.
  <BLANKLINE>

Register a sprint with the same name of a existing one also returns a nice
error message

  >>> user_browser.getControl('Name').value = 'ubz'
  >>> user_browser.getControl('Add Sprint').click()

  >>> for tag in find_tags_by_class(user_browser.contents, 'message'):
  ...     print tag.renderContents()
  There is 1 error.
  <BLANKLINE>
  ubz is already in use by another sprint.

Create a new sprint with a finish date before the starting date returns
a error message.

  >>> user_browser.getControl('Name').value = 'ltsponsteroids'
  >>> user_browser.getControl(
  ...     'Starting Date and Time').value = '13 Oct 2006 09:15 '
  >>> user_browser.getControl(
  ...     'Finishing Date and Time').value = '10 Oct 2006 16:00'
  >>> user_browser.getControl('Add Sprint').click()

  >>> for tag in find_tags_by_class(user_browser.contents, 'message'):
  ...     print tag.renderContents()
  There is 1 error.
  <BLANKLINE>
  This event can't start after it ends

Fix the date and try again. We're redirected to the sprint home page
for the new sprint.

  >>> user_browser.getControl(
  ...     'Starting Date and Time').value = '10 Oct 2006 09:15 '
  >>> user_browser.getControl(
  ...     'Finishing Date and Time').value = '13 Oct 2006 16:00'
  >>> user_browser.getControl('Add Sprint').click()

  >>> user_browser.url
  'http://launchpad.dev/sprints/ltsponsteroids'

Since the sprint's timezone was set to UTC, the dates are displayed in
that time zone:

  >>> print find_portlet(user_browser.contents, 'Meeting details')
  <...
  ...Starts:...
  2006-10-10 09:15:00 UTC...
  ...Ends:...
  2006-10-13 16:00:00 UTC...
  ...


Because this is a brand new sprint, it will have no specs, and we should see
a warning to that effect on the page.

  >>> message = 'Nobody has yet proposed any blueprints for discussion'
  >>> message in user_browser.contents
  True


Add a new sprint with a different timezone is also handled correctly.

  >>> user_browser.open('http://launchpad.dev/sprints/+new')
  >>> user_browser.getControl('Name').value = 'africa-sprint'
  >>> user_browser.getControl('Title').value = 'Africa Sprint'
  >>> summary = 'This is a sprint summary. Some words about the sprint'
  >>> user_browser.getControl('Summary').value = summary
  >>> user_browser.getControl('Home Page').value = 'http://www.ubuntu.com'
  >>> user_browser.getControl('Timezone').value = ['Africa/Johannesburg']
  >>> user_browser.getControl(
  ...     'Starting Date and Time').value = '10 Jul 2006 09:15'
  >>> user_browser.getControl(
  ...     'Finishing Date and Time').value = '13 Jul 2006 16:00'
  >>> user_browser.getControl('Add Sprint').click()

  >>> user_browser.url
  'http://launchpad.dev/sprints/africa-sprint'

  >>> print find_portlet(user_browser.contents, 'Meeting details')
  <...
  ...Starts:...
  2006-07-10 09:15:00 SAST...
  ...Ends:...
  2006-07-13 16:00:00 SAST...
  ...

== Sprints icons/emblems ==

When creating a new sprint we can also specify an icon and/or an emblem to the
sprint.

  >>> user_browser.open('http://launchpad.dev/sprints/+new')
  >>> user_browser.getControl('Name').value = 'sprint-with-icon'
  >>> user_browser.getControl('Title').value = 'Iconified Summit'
  >>> summary = 'This is a sprint summary. Some words about the sprint'
  >>> user_browser.getControl('Summary').value = summary
  >>> user_browser.getControl(
  ...     'Starting Date and Time').value = '10 Jul 2016 09:15'
  >>> user_browser.getControl(
  ...     'Finishing Date and Time').value = '13 Jul 2016 16:00'

  >>> from canonical.launchpad.ftests import set_gotchi_and_emblem
  >>> set_gotchi_and_emblem(user_browser)

  >>> user_browser.getControl('Add Sprint').click()
  >>> user_browser.url
  'http://launchpad.dev/sprints/sprint-with-icon'

The uploaded icon and emblem can be seen on the sprint's edit page:

  >>> user_browser.getLink('Edit Details').click()
  >>> user_browser.url
  'http://launchpad.dev/sprints/sprint-with-icon/+edit'

  >>> find_tag_by_id(
  ...     user_browser.contents, 'field.gotchi_current_img').get('src')
  u'.../icon.png'
  >>> find_tag_by_id(
  ...     user_browser.contents, 'field.emblem_current_img').get('src')
  u'.../emblem.png'
