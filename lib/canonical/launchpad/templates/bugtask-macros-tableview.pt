<metal:header define-macro="batched-table">
  <tal:comment replace="nothing">
  This macro expects the following variables defined:
      :task_batch_navigator: an IBatchNavigator
  Optional:
      :listing_columns: a list of strings specifying columns to display
  </tal:comment>

  <table class="listing" width="67%"
         tal:define="tasks task_batch_navigator/batch;
                     default_columns python:['id', 'title', 'status',
                                             'importance'];
                     listing_columns listing_columns|default_columns">

    <thead tal:define="listing_columns listing_columns|default_columns">
      <tr metal:use-macro="context/@@+bugtask-macros-tableview/batching-header" />
      <tr metal:use-macro="context/@@+bugtask-macros-tableview/sortable-header" />
    </thead>
    <tbody>
      <tr tal:repeat="task tasks">
        <metal:item use-macro="context/@@+bugtask-macros-tableview/item" />
      </tr>
    </tbody>
  </table>
</metal:header>

<metal:header define-macro="table">
  <tal:comment replace="nothing">
  This macro expects the following variables defined:
      :tasks: a list of task instances
  Optional:
      :listing_columns: a list of strings specifying columns to display
  </tal:comment>

  <table class="sortable listing" id="bugtask-table" width="67%"
         tal:define="default_columns python:['id', 'product-or-package',
                                             'title', 'status', 'importance'];
                     listing_columns listing_columns|default_columns">
    <thead>
      <tr metal:use-macro="context/@@+bugtask-macros-tableview/header" />
    </thead>
    <tbody>
      <tr tal:repeat="task tasks">
        <metal:item use-macro="context/@@+bugtask-macros-tableview/item" />
      </tr>
    </tbody>
  </table>
</metal:header>

<metal:header define-macro="batching-header">
  <tr class="results">
    <td
      tal:attributes="colspan listing_columns/count:len"
      tal:content="structure task_batch_navigator/@@+navigation-links" />
  </tr>
</metal:header>

<metal:header define-macro="sortable-header">
  <tr>
    <th tal:condition="python:'select' in listing_columns">
      Select
    </th>
    <th tal:condition="python:'id' in listing_columns"
        tal:attributes="class python:view.getSortClass('id')">
      <a href="#" tal:attributes="href python:view.getSortLink('id')">ID</a>
    </th>
    <th tal:condition="python:'title' in listing_columns"
        tal:attributes="class python:view.getSortClass('title')">
       <a href="#" tal:attributes="href python:view.getSortLink('title')">Title</a>
    </th>
    <th tal:condition="python:'package' in listing_columns"
        tal:attributes="class python:view.getSortClass('sourcepackagename')">
      <a href="#" tal:attributes="href python:view.getSortLink('sourcepackagename')">Package</a>
    </th>
    <th tal:condition="python:'product' in listing_columns"
        tal:attributes="class python:view.getSortClass('product')">
      <a href="#" tal:attributes="href python:view.getSortLink('product')">Product</a>
    </th>
    <th tal:condition="python:'importance' in listing_columns"
        tal:attributes="class python:view.getSortClass('importance')">
      <a href="#" tal:attributes="href python:view.getSortLink('importance')">Importance</a>
    </th>
    <th tal:condition="python:'priority' in listing_columns"
        tal:attributes="class python:view.getSortClass('priority')">
      <a href="#" tal:attributes="href python:view.getSortLink('priority')">Priority</a>
    </th>
    <th tal:condition="python:'assignedto' in listing_columns"
        tal:attributes="class python:view.getSortClass('assignee')">
      <a href="#" tal:attributes="href python:view.getSortLink('assignee')">Assignee</a>
    </th>
    <th tal:condition="python:'status' in listing_columns"
        tal:attributes="class python:view.getSortClass('status')">
       <a href="#" tal:attributes="href python:view.getSortLink('status')">Status</a>
    </th>
    <th tal:condition="python:'milestone' in listing_columns"
        tal:attributes="class python:view.getSortClass('milestone')">
       <a href="#" tal:attributes="href python:view.getSortLink('milestone')">Target</a>
    </th>
    <th tal:condition="python:'submittedon' in listing_columns"
        tal:attributes="class python:view.getSortClass('datecreated')">
      <a href="#" tal:attributes="href python:view.getSortLink('datecreated')">Reported</a>
    </th>
    <th tal:condition="python:'submittedby' in listing_columns"
        tal:attributes="class python:view.getSortClass('owner')">
      <a href="#" tal:attributes="href python:view.getSortLink('owner')">Reporter</a>
    </th>
  </tr>
</metal:header>

<metal:header define-macro="header">
  <tr>
    <th tal:condition="python:'select' in listing_columns">
      Select
    </th>
    <th tal:condition="python:'id' in listing_columns">
      ID
    </th>
    <th tal:condition="python:'title' in listing_columns">
       Title
    </th>
    <th tal:condition="python:'package' in listing_columns">
      Package
    </th>
    <th tal:condition="python:'product' in listing_columns">
      Product
    </th>
    <th tal:condition="python:'product-or-package' in listing_columns">
      Target
    </th>
    <th tal:condition="python:'importance' in listing_columns">
      Importance
    </th>
    <th tal:condition="python:'priority' in listing_columns">
      Priority
    </th>
    <th tal:condition="python:'assignedto' in listing_columns">
      Assignee
    </th>
    <th tal:condition="python:'status' in listing_columns">
       Status
    </th>
    <th tal:condition="python:'milestone' in listing_columns">
       Target
    </th>
    <th tal:condition="python:'submittedon' in listing_columns">
      Reported
    </th>
    <th tal:condition="python:'submittedby' in listing_columns">
      Reporter
    </th>
  </tr>
</metal:header>

<metal:header define-macro="item"
    tal:define="package_name string:${task/distribution/name|string:}
                                    ${task/distrorelease/name|string:}
                                    ${task/sourcepackagename/name|string:}">
  <td tal:condition="python:'select' in listing_columns">
    <input type="checkbox" name="task" value=""
           tal:attributes="value task/id" />
  </td>
  <td tal:condition="python:'id' in listing_columns">
      <a tal:attributes="href task/fmt:url"
         tal:content="string:#${task/bug/id}"
         style="text-decoration: underline">42</a>
  </td>
  <td tal:condition="python:'title' in listing_columns"
       tal:content="task/bug/title">
       title
  </td>
  <td tal:condition="python:'package' in listing_columns"
      tal:content="python:package_name and package_name or '(none)'">
       (none)
  </td>
  <td tal:condition="python:('product' in listing_columns) and task.product"
      tal:content="task/product/name_with_project"
      style="white-space: nowrap" >
      [project] product
  </td>
  <td tal:condition="python:'product-or-package' in listing_columns">

    <span tal:condition="package_name"
          tal:content="python:package_name and package_name or '(none)'">
       (none)
    </span>

    <span tal:condition="task/product"
          tal:content="task/product/name_with_project"
          style="white-space: nowrap" >
      [project] product
    </span>

  </td>
  <td tal:condition="python:'importance' in listing_columns"
      tal:content="task/importance/title"
      tal:attributes="class string:importance${task/importance/title}">
      Medium
  </td>
  <tal:priority condition="python:'priority' in listing_columns">
    <td tal:condition="task/priority"
        tal:content="task/priority/title"
        tal:attributes="class string:priority${task/priority/title}">
      High
    </td>
    <td tal:condition="not:task/priority">
      &mdash;
    </td>
  </tal:priority>
  <td tal:condition="python:'assignedto' in listing_columns">
    <a tal:condition="task/assignee"
       tal:attributes="href task/assignee/fmt:url"
       tal:content="task/assignee/browsername">
      somebody
    </a>
    <span tal:condition="not: task/assignee">
    -
    </span>
  </td>
  <td tal:condition="python:'status' in listing_columns"
       tal:content="task/status/title"
       tal:attributes="class string:status${task/status/title}">
       New
  </td>
  <td tal:condition="python:'milestone' in listing_columns"
       tal:content="task/milestone/name|string:-">
       milestone
  </td>
  <td tal:condition="python:'submittedon' in listing_columns"
       tal:content="task/datecreated/fmt:date">
       date
  </td>
  <td tal:condition="python:'submittedby' in listing_columns"
       tal:content="task/owner/browsername|string:-">
       name
  </td>
</metal:header>


<metal:advanced_search_form define-macro="advanced_search_form">

  <div style="border-width: 0px 0px 1px 0px; border-style: solid; margin-bottom: 5px">
    <strong tal:content="view/getAdvancedSearchPageHeading">
        Bugs in Ubuntu: Advanced Search
    </strong>
  </div>
  <br />

  <form name="search" method="GET" action="">
    <span tal:condition="view/current_package|nothing">
      <input type="hidden" name="field.distribution"
             tal:attributes="value view/current_package/distribution/name" />
      <input type="hidden" name="field.sourcepackagename"
             tal:attributes="value view/current_package/sourcepackagename/name" />
    </span>

    <table>
      <tr>
        <th class="section-header">
          Summary and Description
        </th>
      </tr>
      <tr class="section">
        <td style="padding: 10px">
          <small>
            <span tal:content="structure view/searchtext_widget" />
            <input type="submit"
                   name="search"
                   value="Search bugs in mozilla-firefox in ubuntu"
                   tal:attributes="value view/getAdvancedSearchButtonLabel" />
            <a href="#"
               tal:attributes="href view/getSimpleSearchURL">
              Simple
            </a>
            <div style="margin-top: 5px">
              Sort by:
              <metal:widget use-macro="context/@@+bugtask-macros-listview/sortwidget" />
            </div>
          </small>
        </td>
      </tr>
      <tr>
        <th class="section-header">
          Status and Importance
        </th>
      </tr>
      <tr>
        <td class="section">
          <table>
            <tr>
              <td width="25%">
                <table>
                  <tr>
                    <td><small><strong>Status</strong></small></td>
                  </tr>
                  <tr>
                    <td>
                      <small>
                        <span tal:repeat="widget_value view/getStatusWidgetValues">
                          <span tal:define="widget_id string:status.${widget_value/title}">
                            <input name="field.status:list"
                                   type="checkbox"
                                   tal:attributes="value widget_value/value;
                                                   checked widget_value/checked;
                                                   id widget_id">
                            <label tal:content="widget_value/title"
                                   tal:attributes="for widget_id">
                              Unconfirmed
                            </label>
                            <br />
                          </span>
                        </span>
                      </small>
                    </td>
                  </tr>
                </table>
              </td>
              <td width="20%">
                <table>
                  <tr>
                    <td>
                      <small><strong>Severity</strong></small>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <small>
                        <span tal:repeat="widget_value view/getSeverityWidgetValues">
                          <span tal:define="widget_id string:severity.${widget_value/title}">
                            <input name="field.severity:list"
                                   type="checkbox"
                                   tal:attributes="value widget_value/value;
                                                   checked widget_value/checked;
                                                   id widget_id">
                            <label tal:content="widget_value/title"
                                   tal:attributes="for widget_id">Critical</label>
                            <br />
                          </span>
                        </span>
                      </small>
                    </td>
                  </tr>
                </table>
              </td>
              <td width="20%%">
                <table>
                  <tr>
                    <td>
                      <small><strong>Priority</strong></small>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <small>
                        <span tal:repeat="widget_value view/getPriorityWidgetValues">
                          <span tal:define="widget_id string:priority.${widget_value/title}">
                            <input name="field.priority:list"
                                   type="checkbox"
                                   tal:attributes="value widget_value/value;
                                                   checked widget_value/checked;
                                                   id widget_id">
                            <label tal:content="widget_value/title"
                                   tal:attributes="for widget_id">High</label>
                            <br />
                          </span>
                        </span>
                      </small>
                    </td>
                  </tr>
                </table>
              </td>
              <td width="15%">
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <th class="section-header">
          People
        </th>
      </tr>
      <tr>
        <td class="section">
          <table>
            <tr>
              <td width="40%" tal:condition="view/shouldShowAssigneeWidget">
                <table>
                  <tr>
                    <td>
                      <small><strong>Assignee</strong></small>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <input type="radio" name="assignee_option" value="any" id="any" checked> <label for="any">Doesn't matter</label><br />
                      <input type="radio" name="assignee_option" value="none" id="none"><label for="none"> Nobody</label><br />
                        <div class="field">
                          <div tal:attributes="class python:view.assignee_error and 'error' or ''">
                            <span style="white-space: nowrap">
                              <input type="radio" name="assignee_option" value="choose">
                              <span tal:content="structure view/assignee_widget" />
                            </span>
                              <div tal:condition="view/assignee_error"
                                   class="message"
                                   tal:content="view/assignee_error">An error on
                                   owner widget </div>
                          </div>
                        </div>
                    </td>
                  </tr>
                </table>
              </td>
              <td width="40%" tal:condition="view/shouldShowReporterWidget">
                <table>
                  <tr>
                    <td>
                      <small>
                        <label for="field.owner">
                          <strong>Reporter</strong>
                        </label>
                      </small>
                    </td>
                  </tr>
                  <tr>
                    <td style="white-space: nowrap">
                      <div class="field">
                        <div tal:attributes="class python:view.owner_error
                                                          and 'error' or
                                                          ''">
                        <span tal:content="structure view/owner_widget" />
                        <div tal:condition="view/owner_error"
                             class="message"
                             tal:content="view/owner_error">An error on
                             owner widget </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </table>
              </td>
              <td>&nbsp;</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <th class="section-header">
          Release-Specific
        </th>
      </tr>
      <tr>
        <td class="section"
            tal:define="show_component_widget view/shouldShowComponentWidget">
          <table>
            <tr>
              <td>
                <small>
                  <span style="float: left">
                    <label for="field.milestone">
                      <strong>Target Milestone</strong>
                    </label>
                    <br />
                    <span tal:define="widget_values view/getMilestoneWidgetValues">
                      <span tal:repeat="widget_value widget_values">
                        <span tal:define="widget_id string:milestone.${widget_value/title}">
                        <input name="field.milestone:list"
                               type="checkbox"
                               tal:attributes="value widget_value/value;
                                               checked widget_value/checked;
                                               id widget_id">
                          <label tal:content="widget_value/title"
                                 tal:attributes="for widget_id">
                            dapper
                          </label>
                          <br />
                        </span>
                      </span>
                      <span tal:condition="not:widget_values">
                        (none)
                      </span>
                    </span>
                  </span>
                  <span style="float: left; margin-left: 4em"
                        tal:condition="show_component_widget">
                    <label for="field.component">
                      <strong>Component</strong>
                    </label>
                    <br />
                    <span tal:content="structure view/component_widget"
                          tal:condition="show_component_widget">
                    </span>
                  </span>
                </small>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <th class="section-header">
          Other
        </th>
      </tr>
      <tr>
        <td class="section">
          <table>
            <tr>
              <td style="white-space: nowrap">
                <small>
                  <span tal:content="structure view/omit_dupes_widget" />
                  <label for="field.omit_dupes">
                    Omit duplicate bugs from search results
                  </label>
                </small>
              </td>
              <td style="white-space: nowrap">
                <small>
                  <span tal:content="structure view/has_patch_widget" />
                  <label for="field.has_patch">
                    Show only bugs with patches available
                  </label>
                </small>
              </td>
            </tr>
            <tr tal:condition="view/shouldShowNoPackageWidget">
              <td>
                <small>
                  <span tal:content="structure view/has_no_package_widget" />
                  <label for="field.has_no_package">
                    Exclude bugs with packages specified
                  </label>
                </small>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <th class="section-header" style="font-weight: normal">
          <small>
            <input type="submit"
                   name="search"
                   value="Search bugs in mozilla-firefox in ubuntu"
                   tal:attributes="value view/getAdvancedSearchButtonLabel" />
          </small>
        </th>
      </tr>
    </table>
  </form>
</metal:advanced_search_form>
