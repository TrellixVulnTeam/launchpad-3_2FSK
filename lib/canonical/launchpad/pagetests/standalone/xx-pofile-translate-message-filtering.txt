This test will check that our message filtering feature is working as
expected.

We know that the valid msgsets that this form uses are the ones with
the ids between 130 and 151 and, by default, the batch are of 10 items.

We define first a function we are going to use in this test.

  >>> def print_shown_translations(browser):
  ...     """Print the id/value of all shown translations on the page."""
  ...     from canonical.launchpad.database import POTMsgSet
  ...
  ...     for msgset_id in range(130, 152):
  ...         try:
  ...             translation_ctrl = browser.getControl(
  ...                 name='msgset_%d_es_translation_0_new' % msgset_id)
  ...         except LookupError:
  ...             pass
  ...         else:
  ...             potmsgset = POTMsgSet.get(msgset_id)
  ...             pomsgset = potmsgset.getPOMsgSet('es')
  ...             if pomsgset is None:
  ...                 translation = None
  ...             else:
  ...                 translation = pomsgset.active_texts[0]
  ...             print (msgset_id, translation)

Let's see the list of untranslated messsages that the pofile has with the
first batch of entries:

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open(
  ...     'http://localhost/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=untranslated')
  >>> browser.url
  'http://localhost/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=untranslated'

  >>> print_shown_translations(browser)
  (133, None)
  (135, None)
  (136, None)
  (137, None)
  (138, None)
  (139, None)
  (140, None)
  (141, None)
  (142, None)
  (148, None)


The set of messages that are untranslated in the second batch:

  >>> browser.getLink('Next').click()
  >>> browser.url
  'http://localhost/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=untranslated&start=10'

  >>> print_shown_translations(browser)
  (149, None)
  (150, None)
  (151, None)

Now, we are going to select the amount of entries that need to be reviewed.

  >>> browser.open(
  ...     'http://localhost/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=need_review')
  >>> browser.url
  'http://localhost/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=need_review'

  >>> print_shown_translations(browser)
  (132, u'tiene ')
  (146, u'%d foo')

We are now at the end of this template. Let's try the form submission
to be sure that we don't redirect to a broken URL but to the first batch.

  >>> browser.getControl(name='submit_translations').click()
  >>> browser.url
  'http://localhost/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?show=need_review'
