<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="malone">

<body>

<div metal:fill-slot="column_one">
</div>

 <div metal:fill-slot="main" class="visualPadding"
     tal:define="task_batch view/batch;
                 logged_in request/lp:person|nothing;">
  <iframe width="0" height="0" frameborder="0" scrolling="no" id="blackhole"></iframe>

  <script type="text/javascript">
     function reject(url, status_cell_id) {
        document.getElementById("blackhole").src = url;
        document.getElementById(status_cell_id).firstChild.nodeValue = "Rejected";
        return false; 
     }
     function fixed(url, status_cell_id) {
        document.getElementById("blackhole").src = url;
        document.getElementById(status_cell_id).firstChild.nodeValue = "Fixed";
        return false; 
     }
     function accept(url, status_cell_id, assignee_cell_id, assignee) { 
        document.getElementById("blackhole").src = url;
        document.getElementById(status_cell_id).firstChild.nodeValue = "Accepted";
        document.getElementById(assignee_cell_id).firstChild.nodeValue = assignee;
        return false;
     }
  </script>

  <div class="portalMessage" 
       tal:condition="view/status_message"
       tal:content="structure view/status_message">Successful</div>

  <form action="" method="GET">
  <h1>Bugs</h1>
  <small tal:content="python:'displaying matching bugs ' + str(task_batch.startNumber()) + ' to ' + str(task_batch.endNumber()) + ' of ' + str(task_batch.total())">displaying 1 to 20 of 42 </small><small> ::
      <a href="" tal:attributes="href string:${request/URL}?status=10&status=20&assignee=unassigned&product=all&sourcepackagename=all&search=Search&advanced=0">unassigned</a> .
      <span tal:omit-tag="" tal:condition="logged_in"><a href="" tal:attributes="href string:${request/URL}?status=10&status=20&assignee=${request/lp:person/name}&product=all&sourcepackagename=all&search=Search&advanced=0">my todo list</a> .
      </span><a href="" tal:attributes="href string:${request/URL}?status=10&status=20&assignee=all&product=all&sourcepackagename=all&severity=50&search=Search">critical</a>
      <span tal:omit-tag="" tal:condition="logged_in">.
          <a href="" tal:attributes="href string:${request/URL}?status=10&status=20&assignee=all&submitter=${request/lp:person/name}&product=all&sourcepackagename=all&search=Search&advanced=0">submitted by me</a></span>
      :: bug id or text
      <input style="border-style: solid; border-width: 1px; border-color: grey;" type="text" name="searchtext" tal:attributes="value request/searchtext|nothing;"/>
      <input type="submit" style="border-style: solid; border-width: 1px; border-color: grey; background-color: #DCDCDC; " name="search" value="Search" />
    <input
        tal:condition="not:view/advanced"
        style="border-style: solid; border-width: 1px; border-color: grey; background-color: #DCDCDC; "
        type="submit" name="advanced_submit" value="Advanced" />
    <input
        tal:condition="view/advanced"
        style="border-style: solid; border-width: 1px; border-color: grey; background-color: #DCDCDC; "
        type="submit" name="simple_submit" value="Simple" />
    <input type="hidden"
        name="advanced" tal:attributes="value view/advanced" />
  </small>
  <table id="ass_listing" class="listing rowNavigation">
    <tr>
      <th>Bug #</th>
      <th>Product</th>
      <th>Package</th>
      <th>Title</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Severity</th>
      <th>Submitted On</th>
      <th>Submitted By</th>
      <th>Assigned To</th>
      <th tal:condition="request/lp:person">Take Action</th>
    </tr>
    <tr tal:repeat="task task_batch">
      <span tal:omit-tag=""
            tal:define="bugid task/bug/id;
                        assid task/id;
                        product_name task/product/name|nothing;
                        package_name task/sourcepackagename/name|nothing;
                        collection_name string:tasks;
                        ass_link string:/malone/$collection_name/$assid/+edit;
                        ass_owner task/owner/name|nothing;
                        potential_assignee request/lp:person/browsername|nothing;
                        status task/status/title;
                        assignee task/assignee/name|python:'';
                        priority task/priority/title;
                        severity task/severity/title;
                        statusid string:status${repeat/task/number};
                        assigneeid string:assignee${repeat/task/number};">
          <td tal:content="bugid"
              tal:attributes="onclick string:window.location='${ass_link}';">$Bug.title</td>
          <td tal:condition="product_name"
              tal:content="python: product_name"
              tal:attributes="onclick string:window.location='${ass_link}';">product</td>
          <td tal:condition="not:product_name"
              tal:attributes="onclick string:window.location='${ass_link}';">-</td>
          <td tal:content="python:package_name and package_name or '-'"
              tal:attributes="onclick string:window.location='${ass_link}';">-</td>
          <td tal:attributes="onclick string:window.location='${ass_link}';">
              <a href="#" tal:attributes="href task/bug/id" tal:content="task/bug/title">
                title
              </a>
          </td>
          <td tal:content="status"
              tal:attributes="onclick string:window.location='${ass_link}';
                              id statusid">New</td>
          <td tal:content="priority"
              tal:attributes="onclick string:window.location='${ass_link}';">High</td>
          <td tal:content="severity"
              tal:attributes="onclick string:window.location='${ass_link}';">Medium</td>
          <td tal:content="python:task.datecreated.strftime('%d %b %y')"
              tal:attributes="onclick string:window.location='${ass_link}';">date</td>
          <td tal:content="task/owner/browsername|string:-"
              tal:attributes="onclick string:window.location='${ass_link}';">name</td>
          <td tal:content="task/assignee/browsername|string:-"
              tal:attributes="onclick string:window.location='${ass_link}';
                              id assigneeid;">somebody</td>
          <td tal:condition="request/lp:person">
            <a href=""
               tal:condition="product_name"
               tal:attributes="onClick string:return accept('/malone/tasks/${task/id}/+edit?field.bugstatus=Accepted&field.priority=$priority&field.severity=$severity&field.product=$product_name&field.bugstatus-empty-marker=1&field.priority-empty-marker=1&field.severity-empty-marker=1&field.assignee=${request/lp:person/name}&UPDATE_SUBMIT=Change', '$statusid', '$assigneeid', '$potential_assignee');">
                <small>accept</small>
            </a>
            <a href=""
               tal:condition="package_name"
               tal:attributes="onClick string:return accept('/malone/tasks/${task/id}/+edit?field.bugstatus=Accepted&field.priority=$priority&field.severity=$severity&field.bugstatus-empty-marker=1&field.priority-empty-marker=1&field.severity-empty-marker=1&field.binarypackagename=&field.assignee=${request/lp:person/name}&UPDATE_SUBMIT=Change', '$statusid', '$assigneeid', '$potential_assignee');">
                <small>accept</small>
            </a>
            &nbsp;
            <a href=""
               tal:condition="product_name"
               tal:attributes="onClick string:return reject('/malone/tasks/${task/id}/+edit?field.bugstatus=Rejected&field.priority=$priority&field.severity=$severity&field.product=$product_name&field.bugstatus-empty-marker=1&field.priority-empty-marker=1&field.severity-empty-marker=1&field.assignee=$assignee&UPDATE_SUBMIT=Change', '$statusid');"><small>reject</small>
            </a>
            <a href=""
               tal:condition="package_name"
               tal:attributes="onClick string:return reject('/malone/tasks/${task/id}/+edit?field.bugstatus=Rejected&field.priority=$priority&field.severity=$severity&field.bugstatus-empty-marker=1&field.priority-empty-marker=1&field.severity-empty-marker=1&field.binarypackagename=&field.assignee=$assignee&UPDATE_SUBMIT=Change', '$statusid');"><small>reject</small>
            </a>
            &nbsp;
            <a href=""
               tal:condition="product_name"
               tal:attributes="onClick string:return fixed('/malone/tasks/${task/id}/+edit?field.bugstatus=Fixed&field.priority=$priority&field.severity=$severity&field.product=$product_name&field.bugstatus-empty-marker=1&field.priority-empty-marker=1&field.severity-empty-marker=1&field.assignee=$assignee&UPDATE_SUBMIT=Change', '$statusid');"><small>fixed</small>
            </a>
            <a href=""
               tal:condition="package_name"
               tal:attributes="onClick string:return fixed('/malone/tasks/${task/id}/+edit?field.bugstatus=Fixed&field.priority=$priority&field.severity=$severity&field.bugstatus-empty-marker=1&field.priority-empty-marker=1&field.severity-empty-marker=1&field.binarypackagename=&field.assignee=$assignee&UPDATE_SUBMIT=Change', '$statusid');"><small>fixed</small>
            </a>
          </td>
      </span>
    </tr>
    <tr class="batchnav">
      <td class="batchnav" colspan="11" 
          tal:define="prev_page_url view/batchnav/prevBatchURL;
                      next_page_url view/batchnav/nextBatchURL">
          <a tal:condition="prev_page_url"
             tal:attributes="href prev_page_url">&laquo; previous</a>
          <span tal:omit-tag=""
                tal:repeat="page_url view/batchnav/batchPageURLs">
            <a href=""
               tal:content="python:page_url.keys()[0]"
               tal:attributes="href python:page_url.values()[0]">[1]</a>
          </span>
          <a tal:condition="next_page_url"
             tal:attributes="href next_page_url">next &raquo;</a>
      </td>
    </tr>
  </table>
  <a href="+product"
     style="font-size: 85%; display: inline; clear: both; text-decoration: none;"
     title="File a bug on a product">
     <img src="/++resource++add.gif" alt="+" />
      File a bug on a product
  </a><br />
  <a tal:replace="nothing"
     href="+package"
     style="font-size: 85%; display: inline; clear: both; text-decoration: none;"
     title="File a bug on a package">
     <!-- XXX: Brad Bollenbach, 2004-12-16: Put this back in when we're confident in
     package adding -->
     <img src="/++resource++add.gif" alt="+" />
      File a bug on a package
  </a>


  <tal:x condition="not:view/advanced">
      <input type="hidden" name="status" value="10" />
      <input type="hidden" name="status" value="20" />
      <input type="hidden" name="assignee" value="all" />
      <input type="hidden" name="product" value="all" />
      <input type="hidden" name="sourcepackagename" value="all" />
  </tal:x>

  <fieldset tal:condition="view/advanced">
    <legend>Filter Criteria</legend>

        <div class="field">
          <table>
            <tr>
              <th>Status</th>
              <th>Assigned To</th>
              <th>Product</th>
              <th>Source Package</th>
            </tr>
            <tr>
              <td>
                <select name="status" size="5" multiple>
                  <option value="all"
                          tal:attributes="selected request/htmlform:status/selected/all">All</option>
                  <span tal:omit-tag="" tal:repeat="status view/statuses">
                    <option tal:condition="python:request.has_key('search')"
                            tal:define="strvalue python:str(status.value)"
                            tal:content="status/title"
                            tal:attributes="value status/value;
                                            selected request/htmlform:status/selected/?strvalue">New</option>
                    <option tal:condition="python:not request.has_key('search')"
                            tal:define="strvalue python:str(status.value)"
                            tal:content="status/title"
                            tal:attributes="value status/value;
                                            selected python:status.title in ('New', 'Accepted')">New</option>
                  </span>
                </select>
              </td>
              <td>
                <select name="assignee" size="5" multiple>
                  <option value="all"
                          tal:condition="python:request.has_key('search')"
                          tal:attributes="selected request/htmlform:assignee/selected/all">Anyone</option>
                  <option value="all"
                          tal:condition="python:not request.has_key('search')"
                          selected>Anyone</option>
                  <option value="unassigned"
                          tal:attributes="selected request/htmlform:assignee/selected/unassigned">Unassigned</option>
                  <span tal:omit-tag="" tal:repeat="term view/people">
                    <option tal:define="value term/token"
                            tal:content="term/title"
                            tal:attributes="value value;
                                            selected request/htmlform:assignee/selected/?value">New</option>
                  </span>
                </select>
              </td>
              <td>
                <select name="product" size="5" multiple>
                  <option value="all"
                          tal:condition="python:request.has_key('search')"
                          tal:attributes="selected request/htmlform:product/selected/all">All</option>
                  <option value="all"
                          tal:condition="python:not request.has_key('search')"
                          selected>All</option>
                  <span tal:omit-tag="" tal:repeat="term view/products">
                    <option tal:define="value term/token"
                            tal:content="term/title"
                            tal:attributes="value value;
                                            selected request/htmlform:product/selected/?value">apache</option>
                  </span>
                </select>
              </td>
              <td>
                <select name="sourcepackagename" size="5" multiple>
                  <option value="all"
                          tal:condition="python:request.has_key('search')"
                          tal:attributes="selected request/htmlform:sourcepackagename/selected/all">All</option>
                  <option value="all"
                          tal:condition="python:not request.has_key('search')"
                          selected>All</option>
                  <span tal:omit-tag="" tal:repeat="term view/packagenames">
                    <option tal:define="value term/token"
                            tal:content="term/title"
                            tal:attributes="value value;
                                            selected request/htmlform:sourcepackagename/selected/?value">apache</option>
                  </span>
                </select>
                </td>
              </tr>
            </table>
        </div>

        <div class="formControls">
            <input type="submit" name="search" value="Search" />
        </div>

    </fieldset>
  </form>
</div>

</body>
</html>
