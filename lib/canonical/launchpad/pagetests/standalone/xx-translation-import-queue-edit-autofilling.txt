This test is going to test the form prefill so we speedup the productivity
of the Translation import queue reviewers.

First, we need to feed the import queue.

  >>> import canonical.launchpad
  >>> import os.path
  >>> test_file_name = os.path.join(
  ...     os.path.dirname(canonical.launchpad.__file__),
  ...     'pagetests/standalone/xx-translation-import-queue-edit-autofilling.tar.gz')
  >>> tarball = open(test_file_name)

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open('http://launchpad.dev/alsa-utils/trunk/+translations-upload')
  >>> browser.url
  'http://launchpad.dev/alsa-utils/trunk/+translations-upload'
  >>> file_ctrl = browser.getControl('File:')
  >>> file_ctrl.add_file(
  ...     tarball, 'application/x-gzip', 'test-autofilling.tar.gz')
  >>> browser.getControl('Request Upload').click()
  >>> browser.url
  'http://launchpad.dev/alsa-utils/trunk/+translations-upload'
  >>> for tag in find_tags_by_class(browser.contents, 'message'):
  ...     print tag
  <div...Thank you for your upload. 2 files from the tarball will be reviewed...

Let's check the values we get by default from the .pot file. As we can see,
the form is completely empty.

  >>> browser.open('http://launchpad.dev/translations/imports/4')
  >>> browser.url
  'http://launchpad.dev/translations/imports/4'
  >>> browser.getControl(name='field.potemplatename').value
  ''
  >>> browser.getControl(name='field.path').value
  ''

Let's fill the information.

  >>> browser.getControl(name='field.potemplatename').value = 'alsa-utils'
  >>> browser.getControl(name='field.actions.attach').click()
  >>> browser.url
  'http://launchpad.dev/translations/imports'

Now, as we already know the potemplatename, a new form load should
give us that field with information.

  >>> browser.open('http://launchpad.dev/translations/imports/4')
  >>> browser.url
  'http://launchpad.dev/translations/imports/4'
  >>> browser.getControl(name='field.potemplatename').value
  'alsa-utils'

Let's move to the .po file. By default, we don't know anything about it,
but we can guess the language. As it's a guessed value, we warn the user so
he checks that it's ok.

  >>> browser.open('http://launchpad.dev/translations/imports/3')
  >>> browser.url
  'http://launchpad.dev/translations/imports/3'
  >>> browser.getControl(name='field.potemplatename').value
  ''
  >>> browser.getControl(name='field.path').value
  ''
  >>> browser.getControl(name='field.language').value
  ['es']
  >>> browser.getControl(name='field.variant').value
  ''

Let's add the potemplatename information and confirm the language selection.

  >>> browser.getControl(name='field.potemplatename').value = 'alsa-utils'

We set an explicit path for this entry. This will raise the form fields
validation.

  >>> browser.getControl(name='field.path').value = 'po/es.po'
  >>> browser.getControl(name='field.actions.attach').click()
  >>> browser.url
  'http://launchpad.dev/translations/imports'

And reloading the form, we should get all that information.

  >>> browser.open('http://launchpad.dev/translations/imports/3')
  >>> browser.url
  'http://launchpad.dev/translations/imports/3'
  >>> browser.getControl(name='field.potemplatename').value
  'alsa-utils'
  >>> browser.getControl(name='field.path').value
  ''
  >>> browser.getControl(name='field.language').value
  ['es']
  >>> browser.getControl(name='field.variant').value
  ''
