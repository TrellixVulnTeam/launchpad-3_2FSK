= Setting Bug Statuses =

== Changing status to Won't Fix ==

    >>> from canonical.launchpad.interfaces import (
    ...     CreateBugParams, IPersonSet, IProductSet)
    >>> from canonical.lp.dbschema import BugTaskStatus

    >>> firefox = getUtility(IProductSet).getByName('firefox')
    >>> nopriv_user = getUtility(IPersonSet).getByName('no-priv')
    >>> login('foo.bar@canonical.com')
    >>> firefox.bugcontact = nopriv_user
    >>> login('no-priv@canonical.com')
    >>> bug_params = CreateBugParams(
    ...     nopriv_user, 'Test bug', 'Something')
    >>> firefox_bug = firefox.createBug(bug_params)

Bug Contacts can assign status Won't Fix and Triaged to a bug.

    >>> [firefox_bugtask] = firefox_bug.bugtasks
    >>> firefox_bugtask.transitionToStatus(
    ...     BugTaskStatus.WONTFIX, nopriv_user)
    >>> print firefox_bugtask.status.title
    Won't Fix

    >>> firefox_bugtask.transitionToStatus(
    ...     BugTaskStatus.TRIAGED, nopriv_user)
    >>> print firefox_bugtask.status.title
    Triaged

The product registrant can assign Won't Fix and Triaged too.

    >>> firefox_bugtask.transitionToStatus(
    ...     BugTaskStatus.CONFIRMED, nopriv_user)
    >>> print firefox_bugtask.status.title
    Confirmed

    >>> firefox.owner.inTeam(firefox.bugcontact)
    False

    >>> firefox_bugtask.transitionToStatus(
    ...     BugTaskStatus.WONTFIX, firefox.owner)
    >>> print firefox_bugtask.status.title
    Won't Fix

    >>> firefox_bugtask.transitionToStatus(
    ...     BugTaskStatus.TRIAGED, firefox.owner)
    >>> print firefox_bugtask.status.title
    Triaged

Users who are not bug contacts or product registrants cannot change
the status to Won't Fix or Triaged. The option is not exposed in the
UI, and this test proves the rule is enforced for all call sites.

    >>> login('foo.bar@canonical.com')
    >>> firefox.bugcontact = None

    >>> login('no-priv@canonical.com')

    >>> firefox_bugtask.transitionToStatus(
    ...     BugTaskStatus.WONTFIX, nopriv_user)
    Traceback (most recent call last):
    ...
    AssertionError: Only Bug Contacts may change status to Won't Fix

    >>> firefox_bugtask.transitionToStatus(
    ...     BugTaskStatus.TRIAGED, nopriv_user)
    Traceback (most recent call last):
    ...
    AssertionError: Only Bug Contacts may change status to Triaged
