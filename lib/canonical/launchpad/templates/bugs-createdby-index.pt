<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@malone_template/master"
      i18n:domain="malone">

<body>

<div metal:fill-slot="main" tal:define="owner python:request.get('owner', '')">

  <h1 tal:condition="owner">Bugs created by <span tal:content="request/owner">someone</span></h1>
  <h1 tal:condition="python: not owner">All Bugs</h1>
  <form method="GET" action="">
    <b>Show bugs for:</b>
    <select name="owner" onclick="form.submit()">
      <option value="" tal:attributes="selected python:not owner">All Users</option>
      <option tal:repeat="p view/getAllPeople"
              tal:content="p/name"
              tal:attributes="selected python:p.name == owner">someone</option>
    </select>
  </form>
  <table class="listing rowNavigation">
    <tr>
      <th>Bug</th>
      <th>Title</th>
      <th>Source Package/Product Assignment</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Severity</th>
      <th>Date Created</th>
      <th tal:condition="not:owner">Owner</th>
    </tr>
    <tr tal:repeat="bug view/getBugs"
        tal:attributes="onclick string:window.location='${bug/id}';">
      <span tal:define="sp_assignments bug/packageassignments;
                        p_assignments bug/productassignments">
        <td valign="top" align="center" tal:content="bug/id">$Bug.title</td>
        <td valign="top">
          <a tal:content="bug/title" tal:attributes="href bug/id">title</a>
        </td>
        <td valign="top">
          <div tal:repeat="spa python:[s for s in sp_assignments if not s.product]"
               tal:content="python: '(s) ' + spa.sourcepackagename.name"></div>
          <div tal:repeat="pa python:[p for p in p_assignments if p.product]"
               tal:content="python: '(p) ' + pa.product.title"></div>
        </td>
        <td valign="top">
          <div tal:repeat="spa sp_assignments"
               tal:content="spa/status/lp:BugAssignmentStatus"></div>
          <div tal:repeat="pa p_assignments"
               tal:content="pa/status/lp:BugAssignmentStatus"></div>
        </td>
        <td valign="top" nowrap>
          <div tal:repeat="spa sp_assignments"
               tal:content="spa/priority/lp:BugPriority"></div>
          <div tal:repeat="pa p_assignments"
               tal:content="pa/priority/lp:BugPriority"></div>
        </td>
        <td valign="top" nowrap>
          <div tal:repeat="spa sp_assignments"
               tal:content="spa/severity/lp:BugSeverity"></div>
          <div tal:repeat="pa p_assignments"
               tal:content="pa/severity/lp:BugSeverity"></div>
        </td>
        <td valign="top" tal:content="python:bug.datecreated.strftime('%d %b %y')" nowrap>date</td>
        <td valign="top" tal:condition="not:owner" tal:content="bug/owner/name"></td>
      </span>
    </tr>
  </table>

  <input type="submit" value="Add" onclick="window.open('+new','_top')" />

</div>

</body>
</html>
