
Resetting to autotest does in fact reset to autotest.

Check that the +source form loads and that the importstatus is the
expected value.

  >>> browser.addHeader('Authorization',
  ...                   'Basic david.allouche@canonical.com:test')
  >>> browser.open('http://launchpad.dev/a52dec/failedbranch')
  >>> browser.getLink('Edit source').click()
  >>> print browser.url
  http://launchpad.dev/a52dec/failedbranch/+source

  >>> print find_main_content(browser.contents)
  <...
  <h2>Import Status</h2>
  <p>The current import status is: <b>Test Failed</b>. </p>
  ...


Since we are logged in as a VCS imports team member, we can reset the
build to the testing state.

  >>> browser.getControl('Rerun import in the Autotester')
  <SubmitControl ...>

A normal user does not see this button:

  >>> user_browser.open('http://launchpad.dev/a52dec/'
  ...                   'failedbranch/+source')
  >>> user_browser.getControl('Rerun import in the Autotester')
  Traceback (most recent call last):
    ...
  LookupError: label 'Rerun import in the Autotester'


While the form allows us to switch over to "No revision control system
details", we can't reset the import if we make that change:

  >>> browser.getControl('No revision control system, or Bazaar').click()
  >>> browser.getControl('Rerun import in the Autotester').click()
  >>> print browser.url
  http://launchpad.dev/a52dec/failedbranch/+source
  >>> for tag in find_tags_by_class(browser.contents, 'error'):
  ...     print tag
  <p class="error message">There is 1 error.</p>
  <p class="error message">Can not rerun import without CVS or Subversion details.</p>


This is really a CVS import, so we'll switch back to that.  So we'll
switch back to that and reset the import:

  >>> browser.getControl('CVS').click()
  >>> browser.getControl('Rerun import in the Autotester').click()
  >>> print browser.url
  http://launchpad.dev/a52dec/failedbranch


Check that the importstatus was indeed updated.

  >>> print find_portlet(browser.contents, 'Revision control details')
  <...
  <b>Import status:</b>
  Testing<br />
  ...
