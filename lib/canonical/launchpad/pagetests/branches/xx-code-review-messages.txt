= Code Review Messages =

Let's get us a code review message and canonical_url

    # We need to be admin to add a landing target to a random branch
    >>> login('foo.bar@canonical.com')
    >>> message = factory.makeCodeReviewMessage('my subject', 'my body')
    >>> message_url = canonical_url(message)
    >>> print message.message.text_contents
    my body
    >>> logout()

Now, open its home page.

    >>> anon_browser.open(message_url)
    >>> def print_tag(tag_id, browser=None):
    ...     if browser is None:
    ...         browser = anon_browser
    ...     tag = find_tag_by_id(browser.contents, tag_id)
    ...     print extract_text(tag)
    >>> print anon_browser.title
    Code review comment
    >>> print_tag('comment-body')
    my body
    >>> print_tag('comment-subject')
    my subject
    >>> print_tag('comment-from')
    From Person-name21

Hmm.  Probably shouldn't display this...

    >>> anon_browser.getLink('Reply').click()
    Traceback (most recent call last):
    Unauthorized:...

We can reply to a comment.

    >>> nopriv_browser = setupBrowser(auth="Basic no-priv@canonical.com:test")
    >>> nopriv_browser.open(message_url)
    >>> nopriv_browser.getLink('Reply').click()
    >>> nopriv_browser.url == message_url + '/+reply'
    True
    >>> nopriv_browser.getControl('Comment').value = 'I like this'
    >>> nopriv_browser.getControl('Add').click()

After this, we are taken to the view page for that comment.

    >>> print_tag('comment-body', nopriv_browser)
    I like this
