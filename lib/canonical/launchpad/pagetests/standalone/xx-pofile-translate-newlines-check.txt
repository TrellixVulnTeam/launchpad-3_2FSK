In Rosetta, new lines matter with textareas.
This test checks that we don't miss or add extra new lines.

  >>> browser.addHeader('Authorization', 'Basic carlos@canonical.com:test')
  >>> browser.open(
  ...     'http://localhost/ubuntu/hoary/+source/evolution/+pots/'
  ...     'evolution-2.2/es/+translate?start=19&batch=1')
  >>> browser.url
  'http://localhost/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?start=19&batch=1'

We can see that the message we are interested on is not translated.

  >>> print find_tag_by_id(browser.contents, 'msgset_149').renderContents()
  20.
  <input type="hidden" name="msgset_149" />
  >>> print find_tag_by_id(
  ...     browser.contents, 'msgset_149_singular').renderContents()
  Please select a key size in bits.  The cipher you have chosen...
  >>> print find_tag_by_id(
  ...     browser.contents, 'msgset_149_es_translation_0').renderContents()
  (no translation yet)

Now, we submit some text with new lines before and after the text, the
answer should have exactly those strings.

  >>> browser.getControl(
  ...     name='msgset_149_es_translation_0_radiobutton').value = [
  ...         'msgset_149_es_translation_0_new']
  >>> browser.getControl(
  ...     name='msgset_149_es_translation_0_new').value = '\r\nfoo\r\n\r\n'
  >>> browser.getControl(name='submit_translations').click()
  >>> browser.url
  'http://localhost/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?start=19&batch=1'
  >>> print find_tag_by_id(browser.contents, 'msgset_149_es_translation_0_new')
  <textarea ... name="msgset_149_es_translation_0_new" ...>

  foo

  </textarea>

And finally, a line that does not start with a new line so we are sure we
don't get extra whitespaces. The NORMALIZE_WHITESPACE must be there, if you
change the test, to be 100% sure that the textarea content is the right one.

  >>> browser.getControl(
  ...     name='msgset_149_es_translation_0_radiobutton').value = [
  ...         'msgset_149_es_translation_0_new']
  >>> browser.getControl(name='msgset_149_es_translation_0_new').value = 'foo'
  >>> browser.getControl(name='submit_translations').click()
  >>> browser.url
  'http://localhost/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/+translate?start=19&batch=1'
  >>> print find_tag_by_id(
  ...     browser.contents,
  ...     'msgset_149_es_translation_0_new') #doctest: -NORMALIZE_WHITESPACE
  <textarea ... name="msgset_149_es_translation_0_new" ...>
  foo</textarea>

Now, Check that even though the user forgot the trailing new line char, Rosetta
adds it automatically

  >>> browser.open(
  ...     'http://localhost/evolution/trunk/+pots/evolution-2.2/es/'
  ...     '+translate?start=21&batch=1')
  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1'
  >>> browser.getControl(
  ...     name='msgset_165_es_translation_0_radiobutton').value = [
  ...         'msgset_165_es_translation_0_new']
  >>> browser.getControl(name='msgset_165_es_translation_0_new').value = (
  ...     '%s: la opcion \xc2\xab%s\xc2\xbb es ambigua')
  >>> browser.getControl(name='submit_translations').click()

We were redirected to the next form, the translation was accepted.

  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=0&batch=1'

Get previous page to check that the save translation is the right one.

  >>> browser.getLink('Last').click()
  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1'

And, as we can see, we get the trailing new line char

  >>> print find_tag_by_id(browser.contents, 'msgset_165').renderContents()
  23.
  <input type="hidden" name="msgset_165" />
  >>> print find_tag_by_id(
  ...     browser.contents, 'msgset_165_singular').renderContents()
  <code>%s</code>: option `<code>%s</code>' is ambiguous...
  >>> print find_tag_by_id(
  ...     browser.contents, 'msgset_165_es_translation_0').renderContents()
  <code>%s</code>: la opcion «<code>%s</code>» es ambigua<img alt="" src="/@@/translation-newline" /><br />

Now, we do the right submit, with one trailing new line...

  >>> browser.getControl(
  ...     name='msgset_165_es_translation_0_radiobutton').value = [
  ...         'msgset_165_es_translation_0_new']
  >>> browser.getControl(name='msgset_165_es_translation_0_new').value = (
  ...     '%s: la opcion \xc2\xab%s\xc2\xbb es ambigua\r\n')
  >>> browser.getControl(name='submit_translations').click()

We were redirected to the next form, the translation was accepted.

  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=0&batch=1'

Get previous page to check that the save translation is the right one.

  >>> browser.getLink('Last').click()
  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1'

And, as we can see, we get the same output, just one trailing new line char

  >>> print find_tag_by_id(browser.contents, 'msgset_165').renderContents()
  23.
  <input type="hidden" name="msgset_165" />
  >>> print find_tag_by_id(
  ...     browser.contents, 'msgset_165_singular').renderContents()
  <code>%s</code>: option `<code>%s</code>' is ambiguous...
  >>> print find_tag_by_id(
  ...     browser.contents, 'msgset_165_es_translation_0').renderContents()
  <code>%s</code>: la opcion «<code>%s</code>» es ambigua<img alt="" src="/@@/translation-newline" /><br />

Last check, the user sends two new line chars instead of just one...

  >>> browser.getControl(
  ...     name='msgset_165_es_translation_0_radiobutton').value = [
  ...         'msgset_165_es_translation_0_new']
  >>> browser.getControl(name='msgset_165_es_translation_0_new').value = (
  ...     '%s: la opcion \xc2\xab%s\xc2\xbb es ambigua\r\n\r\n')
  >>> browser.getControl(name='submit_translations').click()

We were redirected to the next form, the translation was accepted.

  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=0&batch=1'

Get previous page to check that the save translation is the right one.

  >>> browser.getLink('Last').click()
  >>> browser.url
  'http://localhost/evolution/trunk/+pots/evolution-2.2/es/+translate?start=21&batch=1'

And Rosetta comes to the rescue and stores just one!.

  >>> print find_tag_by_id(browser.contents, 'msgset_165').renderContents()
  23.
  <input type="hidden" name="msgset_165" />
  >>> print find_tag_by_id(
  ...     browser.contents, 'msgset_165_singular').renderContents()
  <code>%s</code>: option `<code>%s</code>' is ambiguous...
  >>> print find_tag_by_id(
  ...     browser.contents, 'msgset_165_es_translation_0').renderContents()
  <code>%s</code>: la opcion «<code>%s</code>» es ambigua<img alt="" src="/@@/translation-newline" /><br />
