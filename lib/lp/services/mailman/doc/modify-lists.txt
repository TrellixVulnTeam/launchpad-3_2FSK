===============
Modifying lists
===============

A team administrator can make changes to the mailing list, although currently
the only thing they can change is the list's welcome message.

First, No Privileges Person will create a new team.  Then he will request a
mailing list for that team, and an expert will approve that request.

    >>> browser = Browser('no-priv@canonical.com:test')
    >>> browser.open('http://launchpad.dev:8085/people/+newteam')
    >>> browser.getControl(name='field.name').value = 'itest-one'
    >>> browser.getControl('Display Name').value = 'ITest One'
    >>> browser.getControl(name='field.subscriptionpolicy').displayValue = [
    ...     'Open Team']
    >>> browser.getControl('Create').click()
    >>> browser.getLink('Create a mailing list').click()
    >>> browser.getControl('Apply for Mailing List').click()

Before approving the creation of the mailing list, let's set the welcome
message.  It's not currently possible to set the welcome message when the list
is created through the web, so this simulates how that would work when the
feature is exposed.

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.ftests import login, logout
    >>> from canonical.launchpad.interfaces import (
    ...     ILaunchpadCelebrities, IMailingListSet, MailingListStatus)

    >>> login('admin@canonical.com')
    >>> list_set = getUtility(IMailingListSet)
    >>> list_one = list_set.get('itest-one')
    >>> list_one.welcome_message = 'Greetings team members!'

    >>> experts = getUtility(ILaunchpadCelebrities).mailing_list_experts
    >>> lpadmin = list(experts.allmembers)[0]
    >>> list_one.review(lpadmin, MailingListStatus.APPROVED)
    >>> logout()
    >>> transaction.commit()
    >>> xmlrpc_watcher.wait_for_create('itest-one')

    >>> from Mailman.Utils import list_names
    >>> sorted(name for name in list_names() if name.startswith('itest-'))
    ['itest-one']

The welcome message should have been set when the list was created.  Let's see
what that is on the Mailman side.

    >>> from Mailman.MailList import MailList
    >>> mailing_list = MailList('itest-one', lock=False)
    >>> mailing_list.welcome_msg
    'Greetings team members!'

Once the list is created, the team owner can change the welcome message
through the web.

    >>> browser.open('http://launchpad.dev:8085/~itest-one/+mailinglist')
    >>> browser.getControl('Welcome message text').value = (
    ...     'Salutations team members!')
    >>> browser.getControl('Save').click()
    >>> xmlrpc_watcher.wait_for_modification('itest-one')

    # Reload the MailList object so that Mailman gets the updated data.
    >>> mailing_list.Load()
    >>> mailing_list.welcome_msg
    'Salutations team members!'
