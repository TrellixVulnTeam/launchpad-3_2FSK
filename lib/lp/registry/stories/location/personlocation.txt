Person Locations
================

People can have a location and time zone in Launchpad.  In some cases, a
person has a time zone, but no location. We test that their home page renders
without problems.

    >>> login('test@canonical.com')
    >>> zzz = factory.makePerson(name='zzz', time_zone='Africa/Maseru',
    ...                          latitude=None, longitude=None)
    >>> logout()

Any person can see another person's time zone if their is also
location data set, otherwise the location portlet does not show up.

    >>> anon_browser.open('http://launchpad.dev/~zzz')
    >>> print extract_text(
    ...     find_tag_by_id(anon_browser.contents, 'portlet-map'))

If a person has a location, but the gmap2 feature is not enabled, the user
sees the timezone, but no map.

    >>> login('test@canonical.com')
    >>> yyy = factory.makePerson(name='yyy', time_zone='Europe/London',
    ...                          latitude=52.2, longitude=0.3)
    >>> logout()

    >>> anon_browser.open('http://launchpad.dev/~yyy')
    >>> markup = str(anon_browser.contents)
    >>> print extract_text(
    ...     find_tag_by_id(markup, 'portlet-map'), skip_tags=[])
    Location
    Time zone: Europe/London...

    >>> 'src="http://maps.google.com/maps' in markup
    False

If a person has a location, there is a little map portlet in their
profile page. We can't test all the google javascript, but we can make sure
there's a map, and the scripts are loaded  when the gmap2 feature is enabled
for users.

    >>> from lp.services.features.model import FeatureFlag, getFeatureStore
    >>> ignore = getFeatureStore().add(FeatureFlag(
    ...     scope=u'default', flag=u'gmap2', value=u'on', priority=1))
    >>> transaction.commit()

    >>> anon_browser.open('http://launchpad.dev/~yyy')
    >>> markup = str(anon_browser.contents)
    >>> print extract_text(
    ...     find_tag_by_id(markup, 'portlet-map'), skip_tags=[])
    Location
    Time zone: Europe/London...
    Y.lp.app.mapping.renderPersonMapSmall(...
    >>> 'src="http://maps.google.com/maps' in markup
    True
    >>> 'build/app/mapping.js' in markup
    True
