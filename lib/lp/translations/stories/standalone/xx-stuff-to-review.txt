= Stuff to Review =

When a translations reviewer visits their own homepage, it shows a list
of translations that they could or should be reviewing.

    >>> from BeautifulSoup import BeautifulSoup

    >>> from zope.component import getUtility
    >>> from zope.security.proxy import removeSecurityProxy

    >>> from lp.services.worlddata.interfaces.language import ILanguageSet
    >>> from lp.translations.interfaces.translator import ITranslatorSet

We'll be following this list as it applies to a new user, xowxz.

    >>> login(ANONYMOUS)

    >>> user = factory.makePerson(
    ...     name='xowxz', email='xowxz@example.com', password="test")

Xowxz is a Khmer reviewer.

    >>> translationgroup = factory.makeTranslationGroup(
    ...     owner=factory.makePerson())
    >>> khmer = getUtility(ILanguageSet).getLanguageByCode('km')
    >>> entry = getUtility(ITranslatorSet).new(
    ...     translationgroup=translationgroup, language=khmer,
    ...     translator=user)

    >>> logout()

    >>> browser = setupBrowser(auth='Basic xowxz@example.com:test')
    >>> homepage = 'http://translations.launchpad.dev/~xowxz'

    >>> def add_unreviewed_pofile(translationgroup):
    ...     """Create a POFile managed by `translationgroup`."""
    ...     pofile = removeSecurityProxy(
    ...         factory.makePOFile(language_code=khmer.code))
    ...     product = pofile.potemplate.productseries.product
    ...     product.translationgroup = translationgroup
    ...     pofile.unreviewed_count = 1
    ...     return pofile

    >>> def contribute(user, pofile):
    ...     """Let `user` add a suggestion to `pofile`."""
    ...     potmsgset = factory.makePOTMsgSet(
    ...         potemplate=pofile.potemplate, singular='x', sequence=1)
    ...     factory.makeTranslationMessage(
    ...         potmsgset=potmsgset, pofile=pofile, translator=user,
    ...         translations=['y'])

    >>> def list_reviewables(browser):
    ...     """List the table of reviewable translations seen in browser."""
    ...     soup = BeautifulSoup(browser.contents)
    ...     listing = soup.find(id="translations-to-review-table")
    ...     if listing:
    ...         for tr in listing.findAll('tr'):
    ...             tds = [td.renderContents() for td in tr.findAll('td')]
    ...             print '    '.join(tds)
    ...
    ...     print "Done."

There are no translations for xowxz to review, so the listing does not
show up.

    >>> browser.open(homepage)
    >>> list_reviewables(browser)
    Done.

Now a POFile managed by the xowxz's translation group receives a
suggestion that xowxz could review.  It shows up in the list.

    >>> login(ANONYMOUS)
    >>> pofile = add_unreviewed_pofile(translationgroup)
    >>> logout()

    >>> browser.open(homepage)
    >>> list_reviewables(browser)
    <a ...>...</a>
    Done.
