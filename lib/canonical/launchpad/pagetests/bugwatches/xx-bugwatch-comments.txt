= Comments Imported From a Bug Watch =

We now support importing comments from remote bug trackers. Currently
this is only available for the DebBugs bug tracker, but it will become
more widely implemented in the near future.

These comments can be displayed like any other comments on a bug. Bug
#15 has a bug watch against a debbugs bug. If we look at the bug page we
won't see any comments listed, since by default they're hidden from
view.

    >>> user_browser.open('http://launchpad.dev/bugs/15')
    >>> print_comments(user_browser.contents)

The page is not linked to, so we have to browse directly to it.

    >>> user_browser.open('http://launchpad.dev/bugs/15/+watch/11/+comments')
    >>> user_browser.url
    'http://launchpad.dev/bugs/15/+watch/11/+comments'

The ordinary user can't see these comments:

    >>> print_comments(user_browser.contents)

But members of the Launchpad development team can see them. The comments
that have been imported are displayed on the page in the same way as bug
comments are displayed on bugs pages. We'll make Mark Shuttleworth a
member of Launchpad Developers in order to demonstrate this.

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces import (
    ...     ILaunchpadCelebrities, IPersonSet)
    >>> from canonical.launchpad.ftests import login, logout
    >>> login('foo.bar@canonical.com')
    >>> sabdfl = getUtility(IPersonSet).getByName('sabdfl')
    >>> launchpad_developers = getUtility(
    ...     ILaunchpadCelebrities).launchpad_developers
    >>> sabdfl.inTeam(launchpad_developers)
    False

    >>> logout()

As we can see, sabdfl cannot see the comments yet:

    >>> sabdfl_browser = setupBrowser(auth="Basic mark@hbd.com:test")
    >>> sabdfl_browser.open(
    ...     'http://launchpad.dev/bugs/15/+watch/11/+comments')
    >>> print_comments(sabdfl_browser.contents)

After joining the launchpad developers team, sabdfl can now see the
comments.

    >>> login('foo.bar@canonical.com')
    >>> foo_bar = getUtility(IPersonSet).getByName('name16')
    >>> launchpad_developers.addMember(sabdfl, reviewer=foo_bar)
    >>> sabdfl.inTeam(launchpad_developers)
    True

    >>> logout()

    >>> sabdfl_browser.open(
    ...     'http://launchpad.dev/bugs/15/+watch/11/+comments')
    >>> print_comments(sabdfl_browser.contents)
    <p>Package: gnome-volume...manager...
    ----------------------------------------
    <p>reassign 308994 pmount...
    ----------------------------------------
    <p>reassign 308994 gnome-volume-...
    ----------------------------------------
    <p>reassign 308994 pmount...
    ----------------------------------------
    <p>Hi!...Usually CD-ROMs are handled in /etc/fstab, so this might
    not even be a...pmount bug...
    ----------------------------------------
    <p>I'll be happy to add the info you request to the bug report if it
    will...
    ----------------------------------------

The comments are also visible on their own pages to members of the
Launchpad Developers team such as sabdfl:

    >>> sabdfl_browser.open(
    ...     'http://launchpad.dev/redfish/+bug/15/comments/1')
    >>> print_comments(sabdfl_browser.contents)
    <p>Package: gnome-volume-<wbr></wbr>manager<br />
    Version: 1.2.0-1<br />
    Severity: important</p>
    <p>When gnome-volume-<wbr></wbr>manager automounts a dvd+rw
    containing an fs in my dvd<br />
    burner on my system, the volume is unreadable, since it gets
    pmounted<br /> rw, and blocks get changed. unmounting the volume
    reports a dirty<br /> dvd+rw. the same volume is readable if mounted
    by hand with the<br /> read-only flag.</p> <p>I've filed a bug
    upstream for this, which is here:</p> <p><a rel="nofollow"
    href="http://bugzilla.gnome.org/show_bug.cgi?id=304070">...</a></p>
    <p>but wanted it in the debian bug database for user and maintainer
    reference.</p>...

The title bar of the comments will contain a link to the profile of the
author of the comment, a link to the to the remote bug from which the
comment was imported and a permalink to the comment itself within
Launchpad.

    >>> header = first_tag_by_class(sabdfl_browser.contents,
    ...     'boardCommentDetails')
    >>> for link in header.findAll('a'):
    ...     print "%s: %s" % (extract_text(link), link.get('href'))
    Debian Bug tracker #308994: http://bugs.debian.org/...?bug=308994
    josh: http://launchpad.dev/~jbuhl-nospam
    gnome-volume-manager... (permalink): /redfish/+bug/15/comments/1

If sabdfl leaves the Launchpad Developers team the comment will no longer
be visible to him:

    >>> login('foo.bar@canonical.com')
    >>> sabdfl.leave(launchpad_developers)
    >>> sabdfl.inTeam(launchpad_developers)
    False

    >>> logout()

    >>> sabdfl_browser.open(
    ...     'http://launchpad.dev/redfish/+bug/15/comments/1')
    >>> print_comments(sabdfl_browser.contents)
