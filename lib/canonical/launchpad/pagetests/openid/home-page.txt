= Openid.launchpad.dev Home Page =

When visiting the openid.launchpad.dev home page anonymously, the user
is presented with a login form:

    >>> browser.open('http://openid.launchpad.dev')
    >>> print browser.title
    Launchpad Login Service
    >>> print extract_text(find_tag_by_id(browser.contents, 'maincontent'))
    This is the Launchpad login service
    ...
    If you want to change any of your account's details, you can do so
    by logging in using the form beside.
    ...

However, if the user is logged in, they are presented with some
information about their account.

    >>> browser.getControl(name='field.email').value = 'mark@hbd.com'
    >>> browser.getControl(name='field.password').value = 'test'
    >>> browser.getControl('Continue').click()

    >>> print browser.title
    Welcome Mark Shuttleworth


== Previously Visited Sites ==

When the person is logged in and points his browser to openid.launchpad.dev,
he will also see a list containing up to 10 sites in which he authenticated
recently, using the OpenID service.

    # Pretend the user authenticated to an OpenID relying party.
    >>> import pytz
    >>> from datetime import datetime
    >>> from zope.component import getUtility
    >>> from canonical.launchpad.interfaces.account import IAccountSet
    >>> from lp.registry.interfaces.person import IPersonSet
    >>> from canonical.launchpad.interfaces.openidserver import (
    ...     IOpenIDRPSummarySet)
    >>> from canonical.launchpad.webapp.dbpolicy import SSODatabasePolicy
    >>> from canonical.launchpad.webapp.interfaces import IStoreSelector
    >>> login(ANONYMOUS)
    >>> getUtility(IStoreSelector).push(SSODatabasePolicy())
    >>> sabdfl_person = getUtility(IPersonSet).getByName('sabdfl')
    >>> sabdfl_account = getUtility(IAccountSet).get(sabdfl_person.accountID)
    >>> summary = getUtility(IOpenIDRPSummarySet).record(
    ...     sabdfl_account, 'http://example.com/',
    ...     date_used=datetime(2009, 01, 01, tzinfo=pytz.UTC))
    >>> db_policy = getUtility(IStoreSelector).pop()
    >>> logout()

    >>> browser.reload()
    >>> print extract_text(find_tag_by_id(browser.contents, 'visited-sites'))
    Sites you last authenticated to
    Site                 First authenticated  Last authenticated
    http://example.com/  2009-01-01           2009-01-01


== Editing User Details ==

The user can edit their details from this page:

    >>> browser.getLink("edit").click()
    >>> browser.getControl("Display Name").value = "sabdfl"
    >>> browser.getControl("Change").click()
    >>> print browser.url
    http://openid.launchpad.dev/
    >>> print browser.title
    Welcome sabdfl

Including their password:

    >>> browser.getLink("edit").click()
    >>> browser.getLink("Change your password").click()
    >>> browser.getControl("Current password:").value = "test"
    >>> browser.getControl("New password:").value = "test2"
    >>> browser.getControl("Retype the password:").value = "test2"
    >>> browser.getControl("Change").click()
    >>> print browser.url
    http://openid.launchpad.dev/


== Logging Out ==

From the Home page, the user can also log out:

    >>> browser.open('http://openid.launchpad.dev')
    >>> browser.getControl('Log Out').click()
    >>> print browser.url
    http://openid.launchpad.dev/
    >>> print browser.title
    Launchpad Login Service


== Logging back in with new password ==

To log back in the user will have to use their new password:

    >>> browser.getControl(name='field.email').value = 'mark@hbd.com'
    >>> browser.getControl(name='field.password').value = 'test2'
    >>> browser.getControl('Continue').click()

    >>> print browser.title
    Welcome sabdfl
