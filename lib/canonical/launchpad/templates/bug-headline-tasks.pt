<script type="text/javascript">
  function toggleFormVisibility(me) {
    if (me.style.display=="none") {
      me.style.display = "block";
    } else {
      me.style.display = "none";
    }

    return false;
  }
</script>

<table class="listing"
       cellpadding="0" cellspacing="0"
       style="width: 100%; margin-bottom: 1px; margin-top: 2px;
              font-size: 90%;">
  <thead>
    <tr>
      <th colspan="2">Affects</th>
      <th>Status</th>
      <th>Severity</th>
      <th>Assigned To</th>
    </tr>
  </thead>

  <tbody>
    <tal:request repeat="bugtask context/bugtasks">
    <tr tal:define="tasklink python: view.taskLink(bugtask)"
        tal:attributes="class python:view.getFixRequestRowCSSClassForBugTask(bugtask)">
      <td class="icon left">
        <a tal:condition="python:bugtask == view.currentBugTask() and not view.user"
           tal:attributes="href string:${bugtask/fmt:url}/+login">
          <img src="/@@/edit.gif" />
        </a>
        <span tal:condition="python:bugtask == view.currentBugTask() and view.user"
           onclick="toggleFormVisibility(document.getElementById('editform'))"
           tal:attributes="href tasklink">
          <img src="/@@/edit.gif" />
        </span>
        <div id="editform"
             style="display: none"
             tal:define="current_task view/currentBugTask">
          <div tal:content="structure current_task/@@+edit-form">
          </div>
        </div>
      </td>
      <td style="margin: 0; padding: 0">
        <a style="display: block; text-decoration: none; padding: 3px"
           tal:attributes="href tasklink"
           tal:content="bugtask/targetname"
        />
      </td>

      <td style="margin: 0; padding: 0">
        <a style="display: block; text-decoration: none; padding: 3px"
           tal:attributes="href tasklink;
                           class string:status${bugtask/status/title}"
           tal:content="bugtask/status/title">
          $BugTask.status
        <img tal:condition="bugtask/statusexplanation"
             src="/@@/text"
             />
        </a>
      </td>

      <td style="margin: 0; padding: 0"
          tal:attributes="class string:severity${bugtask/severity/title}">
        <a style="display: block; text-decoration: none; padding: 3px"
           tal:attributes="href tasklink;
                           class string:status${bugtask/status/title}"
           tal:content="bugtask/severity/title">
          Critical
        </a>
      </td>

      <td style="margin: 0; padding: 0; vertical-align: middle">
        <tal:has_watch condition="bugtask/bugwatch">
          <a style="display: block; text-decoration: none; padding: 3px"
             tal:attributes="href tasklink">
            <img tal:condition="bugtask/assignee"
                 src="/@@/user.gif" alt="" />
            <img
              alt="Linked to "
              src="/@@/arrowRight.gif"
            />
            <span tal:replace="bugtask/bugwatch/bugtracker/name">Zilla</span>
            #<span tal:replace="bugtask/bugwatch/remotebug">123</span>
          </a>
        </tal:has_watch>

        <tal:has_no_watch condition="not: bugtask/bugwatch">
          <a style="display: block; text-decoration: none;"
             tal:attributes="href tasklink">
            <tal:has_assignee condition="bugtask/assignee">
              <img src="/@@/user.gif"
                   style="padding-bottom: 2px"
                   alt="" />
              <span tal:replace="bugtask/assignee/browsername">
                assignee.browsername
              </span>
            </tal:has_assignee>
            <tal:no_assignee condition="not: bugtask/assignee">
              &mdash;
            </tal:no_assignee>
          </a>
        </tal:has_no_watch>

      </td>

    </tr>
    </tal:request>
  </tbody>

</table>

<div style="font-size: 80%; text-align: right; margin-bottom: 1em;"
     tal:define="current_bugtask view/currentBugTask">

  Also affects:
  <span style="white-space: nowrap">
      <img src="/@@/add.gif" alt="+" />
      <a tal:attributes="href string:${current_bugtask/fmt:url}/+upstreamtask"
         title="Mark this bug as occurring upstream">
        Upstream&hellip;
      </a>
  </span>

  <span style="white-space: nowrap">
      <img src="/@@/add.gif" alt="+" />
      <a tal:attributes="href string:${current_bugtask/fmt:url}/+distrotask"
         title="Mark this bug as occurring in a distro package">
        Distribution&hellip;
      </a>
  </span>

</div>

