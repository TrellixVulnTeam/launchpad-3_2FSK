Note: This test does not guarantee full coverage, it is only testing if an
admin is able to create/edit milestones with duplicate names.

Let's make the sample user the owner of Ubuntu and alsa-utils for this test.

    >>> admin_browser.open('http://launchpad.dev/ubuntu/+reassign')
    >>> admin_browser.getControl(name='field.owner').value = 'name12'
    >>> admin_browser.getControl('Change Registrant').click()

    >>> admin_browser.open('http://launchpad.dev/alsa-utils/+reassign')
    >>> admin_browser.getControl(name='field.owner').value = 'name12'
    >>> admin_browser.getControl('Change Registrant').click()

First we test the +addmilestone page.  

    >>> test_browser = setupBrowser(auth='Basic test@canonical.com:test')
    >>> test_browser.open('http://launchpad.dev/ubuntu/hoary/+addmilestone')

Once authorized, let's create 2 milestones!

    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Add').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1

    >>> test_browser.open('http://launchpad.dev/ubuntu/hoary/+addmilestone')
    >>> test_browser.getControl('Name').value = 'milestone2'
    >>> test_browser.getControl('Add').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
    milestone2

Now let's try to create another one named milestone1.

    >>> test_browser.open('http://launchpad.dev/ubuntu/hoary/+addmilestone')
    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Add').click()
    >>> test_browser.url
    'http://launchpad.dev/ubuntu/hoary/+addmilestone'

    >>> for tag in find_tags_by_class(test_browser.contents, 'message'):
    ...     print tag
    <p class="error message">An error occurred.</p>
    <div class="message">The name milestone1 is already used by a milestone
    in Ubuntu.</div>

Edit now...

First we try to change the name of milestone2 to milestone1, which is
already in use.

    >>> test_browser.open(
    ...     'http://launchpad.dev/ubuntu/+milestone/milestone2/+edit')
    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Change').click()
    >>> test_browser.url
    'http://launchpad.dev/ubuntu/+milestone/milestone2/+edit'
    >>> for tag in find_tags_by_class(test_browser.contents, 'message'):
    ...     print tag
    <p class="error message"> There is a problem with the information you
    entered. Please fix it and try again. </p>
    <div class="message">The name milestone1 is already used by a milestone
    in Ubuntu.</div>

Then we try to change milestone2's name to milestone3.

    >>> test_browser.open(
    ...     'http://launchpad.dev/ubuntu/+milestone/milestone2/+edit')
    >>> test_browser.getControl('Name').value = 'milestone3'
    >>> test_browser.getControl('Change').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
    milestone3

Now we do the same for a product instead of a distro.

First we test the +addmilestone page.  

    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/trunk/+addmilestone')

Once authorized, let's create 2 milestones!

    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Add').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
  
    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/trunk/+addmilestone')
    >>> test_browser.getControl('Name').value = 'milestone2'
    >>> test_browser.getControl('Add').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
    milestone2

Now let's try to create another one named milestone1.

    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/trunk/+addmilestone')
    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Add').click()
    >>> test_browser.url
    'http://launchpad.dev/alsa-utils/trunk/+addmilestone'
    >>> for tag in find_tags_by_class(test_browser.contents, 'message'):
    ...     print tag
    <p class="error message">An error occurred.</p>
    <div class="message">The name milestone1 is already used by a milestone
    in alsa-utils.</div>

Edit now...

First we try to change the name of milestone2 to milestone1, wich is
already in use.

    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/+milestone/milestone2/+edit')
    >>> test_browser.getControl('Name').value = 'milestone1'
    >>> test_browser.getControl('Change').click()
    >>> test_browser.url
    'http://launchpad.dev/alsa-utils/+milestone/milestone2/+edit'
    >>> for tag in find_tags_by_class(test_browser.contents, 'message'):
    ...     print tag
    <p class="error message"> There is a problem with the information you
    entered. Please fix it and try again. </p>
    <div class="message">The name milestone1 is already used by a milestone
    in alsa-utils.</div>
    
Then we try to change milestone2's name to milestone3.

    >>> test_browser.open(
    ...     'http://launchpad.dev/alsa-utils/+milestone/milestone2/+edit')
    >>> test_browser.getControl('Name').value = 'milestone3'
    >>> test_browser.getControl('Change').click()
    >>> for tag in find_tags_by_class(test_browser.contents, 'milestone'):
    ...     print extract_text(tag)
    milestone1
    milestone3

