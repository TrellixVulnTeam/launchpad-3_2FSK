SourcePackage View Classes
==========================

  >>> from zope.component import queryView
  >>> from zope.publisher.browser import TestRequest
  >>> from canonical.launchpad.interfaces import IDistributionSet

Empty request.

  >>> mock_form = {}
  >>> request = TestRequest(form=mock_form)

Retrieve an known Sourcepackage object:

  >>> ubuntu = getUtility(IDistributionSet)['ubuntu']
  >>> hoary = ubuntu['hoary']
  >>> pmount = hoary.getSourcePackage('pmount')

Retrieve its respective View class:

  >>> pmount_view = queryView(pmount, "+index", request)

Check the correct 'linkification' of the concatenated changelog.

  >>> print pmount_view.linkified_changelog()
  This is a placeholder changelog for pmount 0.1-2
  <BLANKLINE>
  pmount (<a href="0.1-1">0.1-1</a>) hoary; urgency=low
  <BLANKLINE>
   * Fix description (Malone #1)
   * Fix debian (Debian #2000)
   * Fix warty (Warty Ubuntu #1)
  <BLANKLINE>
   -- Sample Person &lt;test@canonical.com&gt; Tue, 7 Feb 2006 12:10:08 +0300
  <BLANKLINE>
  <BLANKLINE>


Check the consistence of a handy strcuture containing the organized
published history of a sourcepackage. It should containg a list of
dictionaries containing all supported pocket as key 'pocketdetails'
and a list of packages represented by IDistroReleaseSourcePackageRelease
as 'packages', as:

  [
   {'pocketdetails': dbschema.PackagePublishingPocket,
    'packages': [IDistroReleaseSourcePackagerelease, ...]}
   ...
  ]

  >>> for pub in pmount_view.published_by_pocket():
  ...     pkg_versions = [p.version for p in pub['packages']]
  ...     print pub['pocketdetails'].title, sorted(pkg_versions)
  Release [u'0.1-1', u'0.1-2']
  Security []
  Updates []
  Proposed []
  Backports []


Check the consistence of the binaries dictionary, it should contains a
binarypackagename and the architecture where it was built.

Let's retrieve a new view with useful dependency data:

  >>> warty = ubuntu['warty']
  >>> firefox = warty.getSourcePackage('mozilla-firefox')
  >>> firefox_view = queryView(firefox, "+index", request)

XXX cprov 20060210: this method is very confusing because the
architecturespecific attribute is hidden, i.e, this binary is
architecture independent and we don't know at this point, that's why we
have only on binary.

  >>> for bin_name, archs in firefox_view.binaries().items():
  ...    print bin_name, archs
  mozilla-firefox [u'i386']

Check dependency related view attributes:

XXX cprov 20060210: ohh ?! I would really expect True or False from
something named 'has_foo'.

  >>> assert pmount_view.has_build_depends() is None

  >>> firefox_view.has_build_depends()
  u'bacula-common (= 1.34.6-2), bacula-director-common (= 1.34.6-2), postgresql-client (>= 7.4)'

Check the formatted dependency lines provided by the view class, they
return a list of IPackageRelationship objects.

  >>> for dep in firefox_view.builddepends():
  ...    dep.name, dep.signal, dep.version
  ('gcc-3.4-base', None, '')
  ('libc6', '>=', '2.3.2.ds1-4')
  ('gcc-3.4', '>=', '3.4.1-4sarge1')
  ('gcc-3.4', '<<', '3.4.2')
  ('libstdc++6-dev', '>=', '3.4.1-4sarge1')

  >>> for dep in firefox_view.builddependsindep():
  ...    dep.name, dep.signal, dep.version
  ('bacula-common', '=', '1.34.6-2')
  ('bacula-director-common', '=', '1.34.6-2')
  ('postgresql-client', '>=', '7.4')


Ensure we have fixed bug 31039, by properly escape the
sourcepackagename before passing to regexp.

  >>> libc = hoary.getSourcePackage('libstdc++')
  >>> libc_view = queryView(libc, "+index", request)
  >>> print libc_view.linkified_changelog()
  libstdc++ (<a href="9.9-1">9.9-1</a>) hoary; urgency=high
  <BLANKLINE>
   * Placeholder
  <BLANKLINE>
   -- Sample Person &lt;test@canonical.com&gt; Tue, 10 Feb 2006 10:10:08 +0300
  <BLANKLINE>
  <BLANKLINE>

