<tal:root
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  omit-tag="">
<script type="text/javascript"
        tal:condition="view/allow_pending_license">
//<![CDATA[
  function unsetLicenses() {
    var checkboxes = document.getElementsByName('field.licenses');
    for (var i = 0; i < checkboxes.length; i++) {
      checkboxes[i].checked = false;
    }
  }

  function setLicensePendingStatus(pending) {
    document.getElementById('license_pending').checked = pending;
    document.getElementById('license_complete').checked = !pending;
  }
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
YUI().use('node', 'lazr.effects', function(Y) {
    Y.on('domready', function() {
        function make_slider(cfg) {
            var target_name = '#' + cfg.which + '-expand';
            var table_name = '#' + cfg.which;
            var arrow_name = '#' + cfg.which + '-expand-arrow';

            var table = Y.get(table_name);
            if (Y.Lang.isValue(table)) {
                // Workaround for a lazr-js bug.
                table.setStyle('display', 'block');

                // The table starts either collapsed or expanded.
                if (cfg.in) {
                    table.slide = Y.lazr.effects.slide_in(table_name);
                }
                else {
                    table.slide = Y.lazr.effects.slide_out(table_name);
                }
                table.slide.stop();
                table.slide.run();
            }

            Y.on('click', function(e) {
                e.preventDefault();
                var open = false;
                var slide = e.target.slide;
                if (!slide) {
                    Y.log('new slide: ' + table_name);
                    slide = Y.lazr.effects.slide_in(table_name);
                    e.target.slide = slide;
                }
                else {
                    Y.log(table_name + ' (' + slide.get('reverse') + ')');
                    open = !slide.get('reverse');
                    slide.set('reverse', open);
                }
                slide.stop();
                slide.run();
                var src;
                if (open) {
                    src = '/@@/treeExpanded';
                }
                else {
                    src = '/@@/treeCollapsed';
                }
                Y.get(arrow_name).setAttribute('src', src);
            }, target_name);
        }
        make_slider({which: 'recommended'});
        make_slider({which: 'more', in: true});
        make_slider({which: 'deprecated', in: true});
        make_slider({which: 'special', in: true});
    });
});
//]]>
</script>
<div style="color: black">

  Select the license(s) under which you release your project.
  <div tal:condition="view/allow_pending_license"
     tal:define="is_empty not:view/_getFormInput">
    <input id="license_pending" name="license_status" type="radio"
          tal:attributes="checked is_empty"
          onClick="unsetLicenses()" />
    <label for="license_pending">I haven't specified the license yet</label>
    <br/>

    <input id="license_complete" name="license_status" type="radio"
          tal:attributes="checked not:is_empty" />
    <label for="license_complete">
      This project consists of code licensed under:
    </label>
  </div>

  <tal:allow-pending condition="view/allow_pending_license">
    <div tal:attributes="style string:padding-left: 20px"
         onclick="setLicensePendingStatus(false)">
      <a href="" id="recommended-expand" class="js-action">
        <img id="recommended-expand-arrow"
             src="/@@/treeExpanded"
             title="Recommended open source licenses"
             alt="Recommended open source licenses"/>
        Recommended open source licenses
      </a>
      <input tal:replace="structure view/recommended" />
      <a href="" id="more-expand" class="js-action">
        <img id="more-expand-arrow"
             src="/@@/treeCollapsed"
             title="More open source licenses"
             alt="More open source licenses"/>
        More open source licenses
      </a>
      <input tal:replace="structure view/more" />
      <div tal:condition="view/show_deprecated">
        <a href="" id="deprecated-expand" class="js-action">
          <img id="deprecated-expand-arrow"
               src="/@@/treeCollapsed"
               title="Deprecated licenses"
               alt="Deprecated licenses"/>
          Deprecated licenses
        </a>
        <input tal:replace="structure view/deprecated" />
      </div>
      <a href="" id="special-expand" class="js-action">
        <img id="special-expand-arrow"
             src="/@@/treeCollapsed"
             title="Other choices"
             alt="Other choices"/>
        Other choices
      </a>
      <input tal:replace="structure view/special" />
    </div>
  </tal:allow-pending>
  <tal:do-not-allow-pending condition="not:view/allow_pending_license">
    <div>
      <input tal:replace="structure view/recommended" />
      <input tal:replace="structure view/more" />
      <input tal:condition="view/show_deprecated"
             tal:replace="structure view/deprecated" />
      <input tal:replace="structure view/special" />
    </div>
  </tal:do-not-allow-pending>

  <p>
    Launchpad.net is free to use for software projects that share
    their source code and comply with these
    <a tal:define="config modules/canonical.config/config"
       tal:attributes="href config/commercial/licensing_policy_url">
      licensing policies.
    </a>
    <br/>
    <a href="mailto:feedback@launchpad.net">Contact us</a>
    if your project uses a proprietary license.
  </p>
</div>
</tal:root>
