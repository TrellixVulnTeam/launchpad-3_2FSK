<!-- Copyright 2009 Canonical Ltd.  This software is licensed under the
     GNU Affero General Public License version 3 (see the file LICENSE).
-->

<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  xml:lang="en"
  lang="en"
  dir="ltr"
  metal:use-macro="view/macro:page/onecolumn"
  i18n:domain="launchpad"
>

<body>

<div metal:fill-slot="main"
     tal:define="setup view/setupQueueList;
                 message view/performQueueAction;
                 error view/error|nothing">

  <div class="queue_list" tal:condition="not: error">

    <tal:batch define="batch view/decoratedQueueBatch|nothing">

    <form name="queue_items_state" action="" method="GET">

      Show:

      <select name="queue_state" size="1">

        <option tal:repeat="option view/filtered_options"
                tal:attributes="selected option/selected;
                                value option/value"
                tal:content="option/name" />

      </select>

      uploads with names like:

      <input size="20" type="text" name="queue_text"
                       tal:attributes="value view/name_filter" />

      <input type="submit" value="Update" />

    </form>

    <br />

     <tal:navigation
        replace="structure view/batchnav/@@+navigation-links-upper" />

     <form name="queue_items_action" action="" method="POST">
     <input tal:attributes="type string:hidden;
                            name string:queue_state;
                            value view/state/value"/>
     <table class="listing sortable" tal:condition="batch"
            id="distroseriesqueue">
       <thead>
         <tr class="queue-row">
           <tal:checkbox condition="view/availableActions">
             <th colspan="3"> Package </th>
           </tal:checkbox>
           <tal:nocheckbox condition="not: view/availableActions">
             <th colspan="2"> Package </th>
           </tal:nocheckbox>
           <th> Version </th>
           <th> Component </th>
           <th> Section </th>
           <th> Priority </th>
           <th> Pocket </th>
           <th> When </th>
         </tr>
       </thead>
       <tbody class="lesser">
         <tal:batch repeat="packageupload batch">
           <tal:block
                define="filelist_class string:queue-${packageupload/displayname}-${packageupload/id}">
             <tr class="queue-row">
                <tal:comment condition="nothing">
                  Every column is top-padded apart from the checkbox
                  because Firefox renders it offset anyway.  This will make
                  other browsers look odd, now. :/
                </tal:comment>
                <td width="14" style="padding-top: 5px">
                  <a tal:attributes="href string:#;
                     onclick string:return toggleExpandableTableRows('${filelist_class}')">
                    <img tal:attributes="id string:${filelist_class}-arrow"
                         width="14" height="14"
                         src="/@@/treeCollapsed" alt="view files"/>
                  </a>
                </td>
                <td class="icon left" tal:condition="view/availableActions">
                     <input type="checkbox" name="QUEUE_ID"
                            tal:attributes="value packageupload/id"/>
                </td>
                <td style="padding-top: 5px">
                  <metal:iconlist use-macro="template/macros/package-iconlist"/>
                </td>

                <td style="padding-top: 5px"
                    tal:content="packageupload/displayversion">2.0.17-6
                </td>
                <tal:is_source define="is_source packageupload/contains_source">
                  <td style="padding-top: 5px">
                    <tal:component condition="is_source"
                         content="packageupload/sourcepackagerelease/component/name/lower">
                    </tal:component>
                  </td>
                  <td style="padding-top: 5px">
                    <tal:section condition="is_source"
                         content="packageupload/sourcepackagerelease/section/name/lower">
                    </tal:section>
                  </td>
                  <td style="padding-top: 5px">
                    <tal:priority condition="is_source"
                         content="packageupload/sourcepackagerelease/urgency/name/lower">
                    </tal:priority>
                  </td>
                </tal:is_source>
                <td style="padding-top: 5px"
                    tal:content="packageupload/pocket/title">Updates
                </td>
                <td style="padding-top: 5px">
                  <span class="sortkey"
                    tal:content="packageupload/date_created/fmt:datetime" />
                  <span
                    tal:attributes="title packageupload/date_created/fmt:datetime"
                    tal:content="packageupload/date_created/fmt:approximatedate">
                    2006-03-15
                  </span>
                </td>
             </tr>
             <metal:filelist use-macro="template/macros/package-filelist"/>
           </tal:block>
         </tal:batch>
         <tr tal:condition="view/availableActions">
           <td colspan="4" style="text-align: right;
                                  vertical-align: bottom;
                                  padding-bottom: 5px">
             <label>Override for selected uploads:</label>
           </td>
           <td style="vertical-align: bottom">
             <label>Component:</label><br/>
             <select name="component_override" size="1">
               <option value="" selected="selected">(no change)</option>
               <option tal:repeat="option context/components"
                       tal:attributes="value option/name"
                       tal:content="option/name"/>
             </select>
           </td>
           <td style="vertical-align: bottom">
             <label>Section:</label><br/>
             <select name="section_override" size="1">
               <option value="" selected="selected">(no change)</option>
               <option tal:repeat="option view/sortedSections"
                       tal:attributes="value option/name"
                       tal:content="option/name"/>
             </select>
           </td>
           <td style="vertical-align: bottom">
             <label>Priority (binary):</label><br/>
             <select name="priority_override" size="1">
               <option value="" selected="selected">(no change)</option>
               <option tal:repeat="option view/priorities"
                       tal:attributes="value option/title/lower"
                       tal:content="option/title/lower"/>
             </select>
           </td>
           <td colspan="2" style="vertical-align: bottom">
             <input
               tal:condition="view/state/enumvalue:REJECTED"
               disabled="true" value="Reject" name="Reject" type="submit"/>
             <input
               tal:condition="not:view/state/enumvalue:REJECTED"
               value="Reject" name="Reject" type="submit"/>
             <br/>
             <br/>
             <input value="Accept" name="Accept" type="submit"/>
           </td>
         </tr>
       </tbody>
     </table>

     </form>

     <div class="message" tal:condition="not: batch">
       The <span tal:replace="view/state/title" /> queue is empty.
     </div>

     <tal:navigation
        replace="structure view/batchnav/@@+navigation-links-lower" />

     </tal:batch>
  </div>

</div>


<metal:macros fill-slot="bogus">
<metal:macro define-macro="package-filelist">

  <tal:comment replace="nothing">
    This macro expects the following variables defined:
    :packageupload: A PackageUpload record for which we display files.
  </tal:comment>

      <tr tal:repeat="file packageupload/source_files"
          tal:attributes="class string:${filelist_class}"
          style="display:none">
        <td/>
        <td tal:condition="view/availableActions"/>
        <td>
          <a tal:attributes="href file/libraryfile/http_url">
            <tal:filename content="file/libraryfile/filename"/>
          </a>
          (<span tal:replace="file/libraryfile/content/filesize/fmt:bytes" />)
        </td>
        <td colspan="6"/>
      </tr>

    <tal:package repeat="package packageupload/binary_packages">
      <tal:define
        define="is_new python:view.is_new(package);
                component_name package/component/name/lower;
                section_name package/section/name/lower;
                version package/version">
        <tr tal:repeat="file python:packageupload.binary_packages[package]"
            tal:attributes="class string:${filelist_class}"
            style="display:none">
          <td/>
          <td tal:condition="view/availableActions"/>
          <td>
            <a tal:attributes="href file/libraryfile/http_url">
              <tal:filename content="file/libraryfile/filename"/>
            </a>
            (<tal:size replace="file/libraryfile/content/filesize/fmt:bytes" />)
            <span style="color: red" tal:condition="is_new">NEW</span>
          </td>
          <td tal:content="version"/>
          <td tal:content="component_name"/>
          <td tal:content="section_name"/>
          <td tal:content="package/priority/name/lower"/>
          <td colspan="2"/>
        </tr>
      </tal:define>
    </tal:package>

    <tal:custom define="customfiles packageupload/customfiles">
      <tr tal:repeat="custom python:list(customfiles)"
          tal:attributes="class string:${filelist_class}"
          style="display:none">
        <td/>
        <td tal:condition="view/availableActions"></td>
        <td>
          <a tal:attributes="href custom/libraryfilealias/http_url">
            <tal:filename content="custom/libraryfilealias/filename"/>
          </a>
          (<tal:size replace="
                custom/libraryfilealias/content/filesize/fmt:bytes" />)
        </td>
        <td colspan="6"/>
      </tr>
    </tal:custom>

</metal:macro>

<metal:macro define-macro="package-iconlist">
  <tal:comment replace="nothing">
    This macro expects the following variables defined:
    :packageupload: A PackageUpload record for which we display icons.
  </tal:comment>

  <div tal:attributes="id string:queue${packageupload/id}-iconlist">
    <img tal:condition="packageupload/contains_source"
         alt="[Source]" src="/@@/package-source" title="Source"/>
    <img tal:condition="packageupload/contains_build"
         alt="[Build]" src="/@@/package-binary" title="Binary"/>
    <img tal:condition="packageupload/contains_translation"
         alt="[Translation]" src="/@@/translation-file"
         title="Translation"/>
    <img tal:condition="packageupload/contains_installer"
         alt="[Installer]" src="/@@/ubuntu-icon"
         title="Installer"/>
    <img tal:condition="packageupload/contains_upgrader"
         alt="[Upgrader]" src="/@@/ubuntu-icon"
         title="Upgrader"/>
    <img tal:condition="packageupload/contains_ddtp"
         alt="[Debian Description Translation Project Indexes]"
         src="/@@/ubuntu-icon"
         title="Debian Description Translation Project Indexes"/>
    <a tal:attributes="href packageupload/changesfile/http_url;
                       title string:Changes file for ${packageupload/displayname}">
      <tal:name replace="string: ${packageupload/displayname}"/>
    </a>
    <tal:version replace="
          string: (${packageupload/displayarchs})"/>
  </div>
</metal:macro>

</metal:macros>

</body>
</html>
