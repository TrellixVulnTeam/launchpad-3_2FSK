<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">
<body>

<div metal:fill-slot="main">

  <h2>Current Polls for 
    &#8220;<span tal:replace="context/team/browsername" />&#8221;
  </h2>

  <p tal:condition="not: view/hasCurrentPolls">
    This team has no open polls nor polls that are not yet opened.
  </p>

  <ul tal:condition="view/hasCurrentPolls">
    <li tal:repeat="poll context/getOpenPolls">
      <a tal:attributes="href poll/name">
        <span tal:replace="poll/title" />
      </a> - closes <span tal:replace="poll/datecloses/fmt:datetime" />

      <tal:block condition="nothing">Waiting for PresentingLengthsOfTime.
        <tal:block define="user request/lp:person" condition="user">
          <tal:block condition="python: poll.personVoted(user)">
            You have 
            <span tal:replace="poll/datecloses/fmt:approximateduration" /> 
            to change your vote if you wish.
          </tal:block>

          <tal:block condition="python: not poll.personVoted(user)">
            You have
            <span tal:replace="poll/datecloses/fmt:approximateduration" />
            left to vote in this poll.
          </tal:block>
        </tal:block>
      </tal:block>

    </li>

    <li tal:repeat="poll context/getNotYetOpenedPolls">
      <a tal:attributes="href poll/name">
        <span tal:replace="poll/title" />
      </a> - opens <span tal:replace="poll/dateopens/fmt:datetime" />
    </li>
  </ul>

  <tal:block define="closedpolls context/getClosedPolls" condition="closedpolls" >
    <h2>Recent Polls</h2>

    <ul>
      <li tal:repeat="poll closedpolls">
        <a tal:attributes="href poll/name">
          <span tal:replace="poll/title" />
        </a> - closed <span tal:replace="poll/datecloses/fmt:datetime" />
      </li>
    </ul>
  </tal:block>

  <br />
  <tal:block tal:condition="request/lp:person">
    <ul class="add" tal:condition="context/team/required:launchpad.Edit">
      <li><a href="+new">Set up a new poll</a></li>
    </ul>
  </tal:block>

  <tal:block tal:condition="not: request/lp:person">
    <a href="+login">Log in as an admin to set up a new poll</a>
  </tal:block>

</div>

</body>
</html>

