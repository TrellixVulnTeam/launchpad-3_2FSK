<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@main_template/master"
      i18n:domain="launchpad">

<body>

<metal:leftportlets fill-slot="portlets_one">
    <div tal:replace="structure context/@@+portlet-details" />
    <div tal:replace="structure context/@@+portlet-subscribers" />
    <div tal:replace="structure context/@@+portlet-maintainers" />
    <div tal:replace="structure context/@@+portlet-tickets" />
    <div tal:replace="structure context/@@+portlet-productinfestation" />
    <div tal:replace="structure context/@@+portlet-packageinfestation" />
    <div tal:replace="structure context/@@+portlet-duplicates" />
</metal:leftportlets>

<metal:rightportlets fill-slot="portlets_two">
    <div tal:replace="structure context/@@+portlet-actions" />
    <div tal:condition="context/specifications"
         tal:replace="structure context/@@+portlet-specs" />
    <div tal:replace="structure context/@@+portlet-attachments" />
    <div tal:replace="structure context/@@+portlet-cve" />
    <div tal:replace="structure context/@@+portlet-reference" />
    <div tal:replace="structure context/@@+portlet-watch" />
</metal:rightportlets>

<div metal:fill-slot="main">

  <p class="portalMessage" tal:condition="context/duplicateof" 
     style="margin-bottom: 1em">
    This bug is a duplicate of
    <a href="#"
       tal:attributes="href context/duplicateof/fmt:url"
       tal:content="string:bug #${context/duplicateof/id}">bug 42</a>
  </p>

  <p class="documentDescription"
     tal:condition="context/summary"
     tal:content="context/summary">
     $bug.summary
  </p>

  <p tal:repeat="notice view/notices" tal:content="notice"
     class="portalMessage">
    notice goes here
  </p>

  <div tal:replace="structure context/@@+headline-tasks" />

    <tal:description
      content="structure context/description/fmt:text-to-html"
    >
      $Bug.description
    </tal:description>

  <tal:block repeat="message context/messages">
    <div class="boardComment"
         tal:condition="python:context.description != message.contents">

      <div class="boardCommentDetails">
        <strong tal:content="message/title">$Bugmessage.title</strong>

        Posted by <a href="#" tal:attributes="href message/owner/fmt:url" 
                              tal:content="message/owner/browsername|string:(none)">
          $Person.browsername</a>
        at <span tal:replace="message/datecreated/fmt:datetime">Thursday 
        13:21</span>
        <tal:block condition="message/bugattachments">
        - with attachments:
          <tal:block repeat="attachment message/bugattachments">
            <a tal:attributes="href attachment/libraryfile/url"
               tal:content="attachment/libraryfile/filename">foo.txt</a>
          </tal:block>
        </tal:block>
      </div>

      <div class="boardCommentBody">
        <tal:comment
          content="structure message/contents/fmt:text-to-html"
        >
          Comment text.
        </tal:comment>
      </div>

    </div>
  </tal:block> <!-- repeating over message -->

  <tal:logged-in condition="request/lp:person">
    <fieldset class="collapsible collapsed">
      <legend>Add comment to this bug</legend>
        <form action="+messages/+new" method="post">
          <b>Subject:</b>
          <input name="field.subject" type="text" size="50" 
                 tal:attributes="value context/followup_subject" /><br />
          <b>Comment:</b> <textarea name="field.content" rows="10"></textarea>
        <input type="submit" name="UPDATE_SUBMIT" value="Post Comment" />
        </form>
    </fieldset>
  </tal:logged-in>
  <tal:not-logged-in condition="not: request/lp:person">
    <div align="center">
      To post a comment you must <a href="+login">log in</a>.
    </div>
  </tal:not-logged-in>

</div>
</body>
</html>
