= Canonical URL examples =

Here we have a bunch of examples of canonical urls of database and other
objects.

Ideally, we'd check that the URLs we have here can be accessed through the
publisher.  We'll do that later.  For now, we'll just check that the URLs
are what we expect them to be for various example objects.

    >>> from zope.component import getUtility
    >>> from canonical.launchpad.webapp import canonical_url
    >>> from canonical.launchpad.interfaces import ILaunchpadCelebrities
    >>> celebs = getUtility(ILaunchpadCelebrities)

The examples are divided into sections by theme.  Each section starts with
the imports necessary for that section, where further imports are needed.
The proceeds with an example of the IFooSet url, then its contents, and
so on.


== Application homepages ==

    >>> from canonical.launchpad.interfaces import (
    ...     IMaloneApplication, IBazaarApplication,
    ...     IRosettaApplication, ILaunchpadRoot, IRegistryApplication,
    ...     )

The Launchpad homepage.

    >>> canonical_url(getUtility(ILaunchpadRoot))
    'http://localhost:8086/'

The Malone homepage.

    >>> canonical_url(getUtility(IMaloneApplication))
    u'http://localhost:8086/malone'

The Rosetta homepage.

    >>> canonical_url(getUtility(IRosettaApplication))
    u'http://localhost:8086/rosetta'

The Registry homepage.

    >>> canonical_url(getUtility(IRegistryApplication))
    u'http://localhost:8086/registry'

The Bazaar homepage.

    >>> canonical_url(getUtility(IBazaarApplication))
    u'http://localhost:8086/bazaar'


== Persons and Teams ==

    >>> from canonical.launchpad.interfaces import (
    ...     IPersonSet, ICodeOfConductSet, ISignedCodeOfConductSet)

The IPersonSet.

    >>> canonical_url(getUtility(IPersonSet))
    u'http://localhost:8086/people'

An IPerson.

    >>> canonical_url(getUtility(IPersonSet).getByName('sabdfl'))
    u'http://localhost:8086/people/sabdfl'

An ITeam.

    >>> canonical_url(celebs.rosetta_expert)
    u'http://localhost:8086/people/rosetta-admins'

An ICodeOfConductSet

    >>> cocset = getUtility(ICodeOfConductSet)
    >>> canonical_url(cocset)
    u'http://localhost:8086/codeofconduct'

An ISignedCodeOfConductSet

    >>> signedcocset = getUtility(ISignedCodeOfConductSet)
    >>> canonical_url(signedcocset)
    u'http://localhost:8086/codeofconduct/console'

An ISignedCodeOfConduct

    >>> canonical_url(signedcocset['1'])
    u'http://localhost:8086/codeofconduct/console/1'

An ICodeOfConduct

    >>> canonical_url(cocset['1.0'])
    u'http://localhost:8086/codeofconduct/1.0'


== Distributions, distroreleases and so on ==

    >>> from canonical.launchpad.interfaces import IDistributionSet

The IDistributionSet.

    >>> canonical_url(getUtility(IDistributionSet))
    u'http://localhost:8086/distros'

An IDistribution.

    >>> canonical_url(celebs.ubuntu)
    u'http://localhost:8086/distros/ubuntu'

An IDistroRelease.

    >>> hoary = celebs.ubuntu.getRelease('hoary')
    >>> canonical_url(hoary)
    u'http://localhost:8086/distros/ubuntu/hoary'

An ISourcePackage.

    >>> canonical_url(hoary.getSourcePackage('evolution'))
    u'http://localhost:8086/distros/ubuntu/hoary/+source/evolution'

An IDistributionSourcePackage.

    >>> from canonical.launchpad.interfaces.distributionsourcepackage import (
    ...     IDistributionSourcePackage)
    >>> from canonical.launchpad.interfaces.sourcepackagename import (
    ...     ISourcePackageNameSet)
    >>> sourcepackagenameset = getUtility(ISourcePackageNameSet)
    >>> ubuntu_firefox = celebs.ubuntu.getSourcePackage(
    ...     sourcepackagenameset['mozilla-firefox'])
    >>> canonical_url(ubuntu_firefox)
    u'http://localhost:8086/distros/ubuntu/+source/mozilla-firefox'

== Projects and products ==

    >>> from canonical.launchpad.interfaces import IProjectSet, IProductSet

The IProjectSet.

    >>> canonical_url(getUtility(IProjectSet))
    u'http://localhost:8086/projects'

An IProject.

    >>> canonical_url(getUtility(IProjectSet)['ubuntu'])
    u'http://localhost:8086/projects/ubuntu'

The IProductSet.

    >>> productset = getUtility(IProductSet)
    >>> canonical_url(productset)
    u'http://localhost:8086/products'

An IProduct.

    >>> evolution_product = productset['evolution']
    >>> canonical_url(evolution_product)
    u'http://localhost:8086/products/evolution'

An IProductSeries.

    >>> evolution_trunk_series = evolution_product.getSeries('trunk')
    >>> # canonical_url(evolution_trunk_series)

An IProductRelease.

    >>> evolution_release = evolution_trunk_series.getRelease('2.1.6')
    >>> # canonical_url(evolution_release)


== Bugs and bugtasks ==

    >>> from canonical.launchpad.interfaces import (
    ...     IBug, IBugSet, IBugTaskSet, IUpstreamBugTask, IDistroBugTask,
    ...     IDistroReleaseBugTask, IBugWatchSet,
    ...     IBugExternalRefSet)
    >>> from canonical.launchpad.database import (
    ...     BugWatchSet, BugExternalRefSet)

The IBugSet.

    >>> canonical_url(getUtility(IBugSet))
    u'http://localhost:8086/malone/bugs'

An IBug.

    >>> canonical_url(getUtility(IBugSet).get(1))
    u'http://localhost:8086/bugs/1'

An IUpstreamBugTask.

    >>> canonical_url(getUtility(IBugTaskSet).get(2))
    u'http://localhost:8086/products/firefox/+bug/1'

An IDistroBugTask.

    >>> distro_task = getUtility(IBugTaskSet).get(4)
    >>> canonical_url(distro_task)
    u'http://localhost:8086/distros/debian/+source/mozilla-firefox/+bug/1'

An IDistroBugTask without a sourcepackage.

    >>> from canonical.launchpad.ftests import login
    >>> login("foo.bar@canonical.com")

    >>> temp_spname = distro_task.sourcepackagename
    >>> distro_task.sourcepackagename = None
    >>> canonical_url(distro_task)
    u'http://localhost:8086/distros/debian/+bug/1'
    >>> distro_task.sourcepackagename = temp_spname

An IDistroReleaseBugTask.

    >>> distro_release_task = getUtility(IBugTaskSet).get(16)
    >>> canonical_url(distro_release_task)
    u'http://localhost:8086/distros/ubuntu/warty/+source/mozilla-firefox/+bug/5'

An IDistroReleaseBugTask without a sourcepackage.

    >>> temp_spname = distro_release_task.sourcepackagename
    >>> distro_release_task.sourcepackagename = None
    >>> canonical_url(distro_release_task)
    u'http://localhost:8086/distros/ubuntu/warty/+bug/5'
    >>> distro_release_task.sourcepackagename = temp_spname

A private bug, as an anonymous user! (We'll temporarily subscribe to the bug,
to ensure that at least one person has the perms to edit it while it's set
private.)

    >>> from canonical.launchpad.interfaces import ILaunchBag
    >>> current_user = getUtility(ILaunchBag).user
    >>> subscription = distro_release_task.bug.subscribe(current_user)

    >>> distro_release_task.bug.private = True

    >>> login(ANONYMOUS)

    >>> canonical_url(distro_release_task.bug)
    u'http://localhost:8086/bugs/5'

A private bugtask, as an anonymous user.

    >>> canonical_url(distro_release_task)
    u'http://localhost:8086/distros/ubuntu/warty/+source/mozilla-firefox/+bug/5'

    >>> login("foo.bar@canonical.com")
    >>> distro_release_task.bug.private = False
    >>> distro_release_task.bug.unsubscribe(current_user)

An IBugWatchSet.

    This doesn't work, because BugWatchSet.bug is an int, not an IBug object.

    xxx bug_one_watches = BugWatchSet(bug=1)
    xxx canonical_url(bug_one_watches)
    u'http://localhost:8086/malone/bugs/1/watches'

An IBugExternalRefSet.

    This doesn't work, because BugExternalRefSet.bug is an int, not an
    IBug object.

    xxx bug_one_extrefs = BugExternalRefSet(bug=1)
    xxx canonical_url(bug_one_extrefs)
    u'http://localhost:8086/malone/bugs/1/references'


== Remote Bug Trackers and Remote Bugs ==

    >>> from canonical.launchpad.interfaces import IBugTrackerSet
    >>> from canonical.launchpad.browser.bugtracker import RemoteBug

An IBugTrackerSet.

    >>> canonical_url(getUtility(IBugTrackerSet))
    u'http://localhost:8086/malone/bugtrackers'

A remote bug tracker.

    >>> mozilla_bugtracker = getUtility(IBugTrackerSet)['mozilla.org']
    >>> canonical_url(mozilla_bugtracker)
    u'http://localhost:8086/malone/bugtrackers/mozilla.org'

A bug from a remote bug tracker.

    >>> remote_bug = RemoteBug(mozilla_bugtracker, '42',
    ...                        mozilla_bugtracker.getBugsWatching('42'))
    >>> canonical_url(remote_bug)
    u'http://localhost:8086/malone/bugtrackers/mozilla.org/42'

== Branches ==

An IBranch.

    >>> from canonical.launchpad.interfaces import IBranchSet

    >>> branch = getUtility(IBranchSet).get(10)

    >>> canonical_url(branch)
    u'http://localhost:8086/people/sabdfl/+branch/firefox/release-0.9.2'

An IBugBranch.

    >>> bug = getUtility(IBugSet).get(1)
    >>> bug_branch = bug.addBranch(branch)

    >>> canonical_url(bug_branch)
    u'http://localhost:8086/people/sabdfl/+branch/firefox/release-0.9.2/+bug/1'

== POTemplates and so on ==

    >>> from canonical.launchpad.interfaces import (
    ...     IPOTemplateSet, ITranslationGroupSet)

Most Rosetta pages hang off IPOTemplateSubset objects, of which there are two
varieties: distribution and upstream.

First, the distribution kind.  We'll need the source package name.

    >>> sourcepackagename = sourcepackagenameset['evolution']

And here's our subset.

    >>> potemplateset = getUtility(IPOTemplateSet)
    >>> potemplatesubset = potemplateset.getSubset(
    ...     distrorelease=hoary, sourcepackagename=sourcepackagename)

    >>> canonical_url(potemplatesubset)
    u'http://localhost:8086/distros/ubuntu/hoary/+source/evolution/+pots'

We can get a particular PO template for this source package by its PO template
name.

    >>> potemplate = potemplatesubset['evolution-2.2']
    >>> canonical_url(potemplate)
    u'http://localhost:8086/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2'

And we can get a particular PO file for this PO template by its language code.

    >>> pofile = potemplate.getPOFileByLang('es')
    >>> canonical_url(pofile)
    u'http://localhost:8086/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es'

Also, we can get the url to a PO msgset

    >>> potmsgset = potemplate.getPOTMsgSetBySequence(1)
    >>> pomsgset = potmsgset.getPOMsgSet('es')
    >>> canonical_url(pomsgset)
    u'http://localhost:8086/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es/1'

Even for a dummy PO msgset

    >>> pomsgset = potmsgset.getDummyPOMsgSet('es_ES')
    >>> canonical_url(pomsgset)
    u'http://localhost:8086/distros/ubuntu/hoary/+source/evolution/+pots/evolution-2.2/es_ES/1'

Upstream POTemplateSubsets work in much the same way, except they hang off a
product release.  Let's get a product release.

Now we can get an upstream subset and do the same sorts of thing as we did
with the distro subset.

    >>> potemplatesubset = potemplateset.getSubset(
    ...     productseries=evolution_trunk_series)
    >>> potemplate = potemplatesubset['evolution-2.2']
    >>> canonical_url(potemplate)
    u'http://localhost:8086/products/evolution/trunk/+pots/evolution-2.2'

    >>> pofile = potemplate.getPOFileByLang('es')
    >>> canonical_url(pofile)
    u'http://localhost:8086/products/evolution/trunk/+pots/evolution-2.2/es'

Also, we can get the url to a PO msgset

    >>> potmsgset = potemplate.getPOTMsgSetBySequence(1)
    >>> pomsgset = potmsgset.getPOMsgSet('es')
    >>> canonical_url(pomsgset)
    u'http://localhost:8086/products/evolution/trunk/+pots/evolution-2.2/es/1'

Even for a dummy PO msgset

    >>> pomsgset = potmsgset.getDummyPOMsgSet('es_ES')
    >>> canonical_url(pomsgset)
    u'http://localhost:8086/products/evolution/trunk/+pots/evolution-2.2/es_ES/1'

Rosetta also has translation groups.

    >>> canonical_url(getUtility(ITranslationGroupSet))
    u'http://localhost:8086/rosetta/groups'

