<div xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:metal="http://xml.zope.org/namespaces/metal"
     xmlns:i18n="http://xml.zope.org/namespaces/i18n"
     class="portlet" id="portlet-tags">
  <div id="tags-portlet-spinner"
       style="text-align: center; display: none">
    <img src="/@@/spinner" />
  </div>
  <a id="tags-content-link"
     tal:attributes="href context/fmt:url/+bugtarget-portlet-tags-content"></a>
  <script type="text/javascript">
    LPS.use('io-base', 'node', function(Y) {
      Y.on('domready', function() {
        Y.one('#tags-portlet-spinner').setStyle('display', 'block');

        function hide_spinner() {
          Y.one('#tags-portlet-spinner').setStyle('display', 'none');
        }

        function on_success(transactionid, response, arguments) {
          hide_spinner();
          var portlet = Y.one('#portlet-tags');
          if (Y.Lang.trim(response.responseText).length == 0) {
            portlet.setStyle('display', 'none')
          }
          else {
            portlet.set('innerHTML',
                        response.responseText + portlet.get('innerHTML'));
            var show_more_link = Y.one('#show-more-tags-link');
            var show_less_link = Y.one('#show-less-tags-link');
            var tag_list = Y.all('.tag-list li');
            if (tag_list.size() > 10) {
                var extra_tags = tag_list.slice(10);
                extra_tags.addClass('hidden');
                show_more_link.removeClass('hidden');
                show_more_link.on('click', function(e) {
                    e.halt();
                    extra_tags.removeClass('hidden');
                    show_more_link.addClass('hidden');
                    show_less_link.removeClass('hidden');
                });
                show_less_link.on('click', function(e) {
                    e.halt();
                    extra_tags.addClass('hidden');
                    show_more_link.removeClass('hidden');
                    show_less_link.addClass('hidden');
                });
            }
          }
        }

        var config = {on: {success: on_success,
                           failure: hide_spinner}};
        var url = Y.one('#tags-content-link').getAttribute('href').replace('bugs.', '');
        Y.io(url, config);
      });
    });
  </script>
  <a href="" id="show-more-tags-link" class="js-action hidden">Show all tags&hellip;</a>
  <a href="" id="show-less-tags-link" class="js-action hidden">Show less tags&hellip;</a>
  <ul class="edit-official-tags">
    <li tal:condition="view/show_manage_tags_link">
      <a class="sprite edit"
         tal:attributes="href context/fmt:url/+manage-official-tags">
        Edit official tags
      </a>
    </li>
  </ul>
</div>
