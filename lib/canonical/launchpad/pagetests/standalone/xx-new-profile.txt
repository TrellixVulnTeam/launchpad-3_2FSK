
We allow Launchpad admins to create random profiles that can latter be used
throughout Launchpad. These profiles are not considered validated and because
of that we won't send any email notification to them, except for an initial
email explaining that a given user has created a Launchpad profile for that
email address' owner.

    >>> admin_browser.open('http://launchpad.dev/people/+newperson')
    >>> admin_browser.url
    'http://launchpad.dev/people/+newperson'

All fields (email address, displayname and creation reason) in that form
are required.

    >>> admin_browser.getControl('Create Profile').click()
    >>> print admin_browser.contents
    <...
    ...class="error message">There are 3 errors...

Trying to create a profile with an invalid or already used email address
is not allowed.

    >>> admin_browser.getControl('Email address').value = 'foo@'
    >>> admin_browser.getControl('Display name').value = 'Foo'
    >>> admin_browser.getControl('Creation reason').value = (
    ...     'I was just playing around and found this nice form, so I '
    ...     'decided to create a new profile to test.')
    >>> admin_browser.getControl('Create Profile').click()
    >>> for tag in find_tags_by_class(admin_browser.contents, 'message'):
    ...     print tag.renderContents()
    There is 1 error.
    foo@ isn't a valid email address.

    >>> admin_browser.getControl('Email address').value = 'test@canonical.com'
    >>> admin_browser.getControl('Create Profile').click()
    >>> for tag in find_tags_by_class(admin_browser.contents, 'message'):
    ...     print tag.renderContents()
    There is 1 error.
    The profile you're trying to create already exists:...

When all fields are filled correctly, the new profile is created.

    >>> admin_browser.getControl('Email address').value = 'test2@canonical.com'
    >>> admin_browser.getControl('Create Profile').click()
    >>> admin_browser.url
    'http://launchpad.dev/~test2'

    >>> print admin_browser.contents
    <...
    ...This page was created...
    ...by ...
    ...and the reason given by that user for its creation is:...
    ...I was just playing around and found this nice form,...

The creation of this new profile will trigger an email notification to the
profile's email address. This email will contain the name of the person who
created the profile as well as the reason left by that person. It'll also
contain a link to a page where it's possible to finish the registration
process in order to validate that profile.

    >>> import email
    >>> from canonical.launchpad.mail import stub
    >>> from canonical.launchpad.ftests.logintoken import (
    ...     get_token_url_from_email)
    >>> len(stub.test_emails)
    1
    >>> from_addr, to_addrs, raw_msg = stub.test_emails.pop()
    >>> token_url = get_token_url_from_email(raw_msg)

    >>> print email.message_from_string(raw_msg).get_payload()
    Hello!
    ... has created a new Launchpad profile [1] for
    you, and left the following comment as the reason for its creation:
    ...
    If you wish to use this profile, please follow the instructions here:
    ...

    >>> browser.open(token_url)
    >>> browser.url
    'http://launchpad.dev/token/.../+newaccount'

We don't prefill the new account's display name because the one we have was
not entered by the users themselves.

    >>> browser.getControl('Display Name').value
    ''

We also explain the users what to write in each form:

    >>> for tag in find_tags_by_class(browser.contents, 'formHelp'):
    ...     print extract_text(tag)
    Your name as you would like it displayed throughout Launchpad...

Now we fill the form and save it to create the new account.

    >>> browser.getControl('Display Name').value = 'My name'
    >>> browser.getControl('Create password').value = 'aaa'
    >>> browser.getControl(name='field.password_dupe').value = 'aaa'
    >>> browser.getControl('Continue').click()

    >>> browser.url
    'http://launchpad.dev/~test2'


Non-launchpad admins can't acces the page to ceate a new profile.

    >>> user_browser.open('http://launchpad.dev/people/+newperson')
    Traceback (most recent call last):
    ...
    Unauthorized: ...
