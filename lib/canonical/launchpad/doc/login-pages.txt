= Login pages =

The LoginOrRegister view is responsible for the login form and how it
operates within the Launchpad workflows.


== Deactivated accounts cannot login ==

A deactivated account cannot use the LoginOrRegister view to login.
The login_error message explains the situation to the user. Former User
is an example of a user with a DEACTIVATED account.

    >>> from zope.component import getMultiAdapter, getUtility
    >>> from zope.security.proxy import removeSecurityProxy

    >>> from canonical.launchpad.interfaces.person import IPersonSet
    >>> from canonical.launchpad.webapp.publisher import rootObject
    >>> from canonical.launchpad.webapp.servers import LaunchpadTestRequest

    >>> person_set = getUtility(IPersonSet)
    >>> former_user = person_set.getByEmail('former-user@canonical.com')
    >>> former_user_account = removeSecurityProxy(former_user.account)
    >>> former_user_account.status
    <DBItem AccountStatus.DEACTIVATED, ...>

    >>> request = LaunchpadTestRequest(
    ...     SERVER_URL='http://launchpad.dev',
    ...     PATH_INFO='/+login',
    ...     method='POST',
    ...     form={
    ...         'loginpage_email': 'former-user@canonical.com',
    ...         'loginpage_password': u'test',
    ...         'loginpage_submit_login': 'Log In',
    ...         })
    >>> login_view = getMultiAdapter(
    ...     (rootObject, request), name="+login")
    >>> login_view.process_login_form()
    >>> login_view.login_success()
    False
    >>> print login_view.login_error
    The email address belongs to a deactivated account.
    Use the "Forgotten your password" link to reactivate it.

The user can use +resetpassword to reactivate his account.
See "Reactivating an account using reset password" in `logintoken-pages`.


== Suspended account cannot login ==

A user with a suspended account cannot login. The view's login_error
explains the problem.

    >>> from canonical.launchpad.interfaces.account import AccountStatus

    # Only admins can suspend an account.
    >>> login('foo.bar@canonical.com')
    >>> bad_user = factory.makePerson(
    ...     email='bad-user@canonical.com',
    ...     name='bad-user',
    ...     password='invalid')
    >>> bad_user.account.status = AccountStatus.SUSPENDED

    >>> login(ANONYMOUS, request)
    >>> request = LaunchpadTestRequest(
    ...     SERVER_URL='http://launchpad.dev',
    ...     PATH_INFO='/+login',
    ...     method='POST',
    ...     form={
    ...         'loginpage_email': 'bad-user@canonical.com',
    ...         'loginpage_password': u'test',
    ...         'loginpage_submit_login': 'Log In',
    ...         })
    >>> login_view = getMultiAdapter(
    ...     (rootObject, request), name="+login")
    >>> login_view.process_login_form()
    >>> login_view.login_success()
    False
    >>> print login_view.login_error
    The email address belongs to a suspended account.
    Contact a <a href="http://answers.../launchpad/+addquestion">Launchpad
    admin</a> about this issue.
